# 数据库配置快速指南

## 🚀 快速开始 (3步配置数据库)

### 第1步: 安装PostgreSQL

如果还没安装PostgreSQL,请参考: [PostgreSQL环境配置完整指南.md](./PostgreSQL环境配置完整指南.md)

**检查PostgreSQL是否运行:**
```powershell
# 打开PowerShell,运行:
psql -U postgres -c "SELECT version();"
```

---

### 第2步: 配置数据库连接

1. **复制配置文件模板:**
   ```powershell
   # 在项目根目录执行:
   Copy-Item .env.example .env
   ```

2. **修改 `.env` 文件:**
   ```ini
   # 打开 .env 文件,修改这一行:
   DATABASE_URL=postgresql://postgres:你的密码@localhost:5432/o2o_dashboard
   #                              ^^^^^^^^ 改成你自己的PostgreSQL密码
   ```

   **示例:**
   - 如果你的密码是 `123456`,改成:
     ```ini
     DATABASE_URL=postgresql://postgres:123456@localhost:5432/o2o_dashboard
     ```

---

### 第3步: 测试连接

```powershell
# 测试数据库连接
python database/connection.py

# 应该看到:
# [OK] Database connection successful!
```

---

## 📚 文件说明

| 文件 | 作用 | 是否必需 |
|------|------|----------|
| `.env` | 存储你的数据库密码等敏感信息 | ✅ 必需 |
| `.env.example` | 配置文件模板(不含密码) | 📝 参考 |
| `database/config.py` | 配置管理代码 | 📦 自动加载 |
| `database/connection.py` | 数据库连接管理 | 📦 自动加载 |

---

## 🔧 常见问题

### Q1: 提示 "Database connection failed"?

**可能原因:**
1. PostgreSQL没有运行
2. 密码错误
3. 数据库 `o2o_dashboard` 不存在

**解决方法:**
```powershell
# 1. 检查PostgreSQL是否运行
Get-Service -Name postgresql*

# 2. 创建数据库
psql -U postgres -c "CREATE DATABASE o2o_dashboard;"

# 3. 测试连接
python database/connection.py
```

---

### Q2: 提示 "ModuleNotFoundError: No module named 'pg8000'"?

**解决方法:**
```powershell
# 安装依赖
pip install pg8000 python-dotenv sqlalchemy
```

---

### Q3: 想要修改数据库端口或主机?

**方法1: 修改 `.env` 完整URL:**
```ini
# 修改端口为5433
DATABASE_URL=postgresql://postgres:密码@localhost:5433/o2o_dashboard

# 连接远程数据库
DATABASE_URL=postgresql://postgres:密码@192.168.1.100:5432/o2o_dashboard
```

**方法2: 分开配置 (在 `.env` 中添加):**
```ini
DB_HOST=192.168.1.100
DB_PORT=5433
DB_NAME=o2o_dashboard
DB_USER=postgres
DB_PASSWORD=你的密码
```

---

## 💻 在代码中使用

### 基础用法:
```python
from database.config import DATABASE_URL, DATABASE_CONFIG

# 查看配置
print(f"连接到: {DATABASE_CONFIG['host']}:{DATABASE_CONFIG['port']}")
```

### 查看所有配置:
```python
from database.config import print_config

# 打印配置(密码会被隐藏)
print_config()
```

### 获取数据库连接:
```python
from database.connection import get_db_context

# 使用上下文管理器
with get_db_context() as db:
    # 在这里执行数据库操作
    result = db.execute("SELECT * FROM orders LIMIT 10")
    print(list(result))
```

---

## 🔐 安全提示

⚠️ **重要:** 
- ✅ `.env` 文件已在 `.gitignore` 中,不会被提交到Git
- ✅ 不要把 `.env` 文件分享给其他人
- ✅ 每个人都应该有自己的 `.env` 文件
- ❌ 不要在代码中硬编码密码

---

## 📞 需要帮助?

- 查看完整文档: [PostgreSQL环境配置完整指南.md](./PostgreSQL环境配置完整指南.md)
- 数据库问题排查: [部署指南_PostgreSQL.md](./部署指南_PostgreSQL.md)
- 联系项目负责人

---

## ✅ 配置检查清单

运行这个命令检查所有配置是否正确:

```powershell
python -c "from database.config import print_config; print_config()"
```

应该看到类似输出:
```
============================================================
数据库配置信息
============================================================
主机地址: localhost
端口: 5432
数据库名: o2o_dashboard
用户名: postgres
密码: ********
驱动: pg8000

连接池配置:
  连接池大小: 5
  最大溢出: 10
  ...
============================================================
```

如果所有信息都正确,就可以开始使用了! 🎉
