# ğŸš€ O2O è®¢å•æ•°æ®çœ‹æ¿ - éƒ¨ç½²æŒ‡å—

## éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      äº‘æœåŠ¡å™¨ (Ubuntu)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Nginx (:80/:443)                  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ é™æ€æ–‡ä»¶ (/var/www/html)                        â”‚   â”‚
â”‚  â”‚  â””â”€â”€ API ä»£ç† â†’ localhost:8080                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                â”‚
â”‚                            â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Hypercorn (:8080)                       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Worker 1                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Worker 2                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Worker 3                                        â”‚   â”‚
â”‚  â”‚  â””â”€â”€ Worker 4                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚              â–¼                           â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  PostgreSQL (:5432)â”‚       â”‚   Redis (:6379)   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿå¼€å§‹

### 1. è´­ä¹°äº‘æœåŠ¡å™¨

æ¨èé…ç½®:
- **å…¥é—¨**: 2æ ¸4G (çº¦ Â¥50-100/æœˆ) - é€‚åˆ 10 äººä»¥ä¸‹ä½¿ç”¨
- **æ ‡å‡†**: 4æ ¸8G (çº¦ Â¥150-300/æœˆ) - é€‚åˆ 50 äººä»¥ä¸‹ä½¿ç”¨
- **ç³»ç»Ÿ**: Ubuntu 22.04 LTS

æ¨èå‚å•†:
- é˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨
- è…¾è®¯äº‘è½»é‡åº”ç”¨æœåŠ¡å™¨
- åä¸ºäº‘ HECS

### 2. åˆå§‹åŒ–æœåŠ¡å™¨

```bash
# SSH ç™»å½•æœåŠ¡å™¨
ssh root@your-server-ip

# ä¸‹è½½å¹¶è¿è¡Œåˆå§‹åŒ–è„šæœ¬
curl -O https://raw.githubusercontent.com/your-repo/main/deploy/server-setup.sh
chmod +x server-setup.sh
./server-setup.sh
```

### 3. é…ç½® GitHub Actions

åœ¨ GitHub ä»“åº“è®¾ç½® Secrets:

| Secret åç§° | è¯´æ˜ | ç¤ºä¾‹ |
|------------|------|------|
| `SERVER_HOST` | æœåŠ¡å™¨ IP | `123.45.67.89` |
| `SERVER_USER` | SSH ç”¨æˆ·å | `root` |
| `SERVER_SSH_KEY` | SSH ç§é’¥ | `-----BEGIN OPENSSH...` |
| `SERVER_PORT` | SSH ç«¯å£ | `22` |

ç”Ÿæˆ SSH å¯†é’¥å¯¹:
```bash
# åœ¨æœ¬åœ°ç”Ÿæˆ
ssh-keygen -t ed25519 -C "deploy@o2o-analysis" -f deploy_key

# å°†å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨
ssh-copy-id -i deploy_key.pub root@your-server-ip

# å°†ç§é’¥å†…å®¹å¤åˆ¶åˆ° GitHub Secrets (SERVER_SSH_KEY)
cat deploy_key
```

### 4. æ¨é€ä»£ç è‡ªåŠ¨éƒ¨ç½²

```bash
git add .
git commit -m "feat: æ–°åŠŸèƒ½"
git push origin main
# GitHub Actions ä¼šè‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨
```

## æ‰‹åŠ¨éƒ¨ç½²

å¦‚æœä¸æƒ³ç”¨ GitHub Actionsï¼Œå¯ä»¥æ‰‹åŠ¨éƒ¨ç½²:

```bash
# æœ¬åœ°æ‰“åŒ…
cd frontend-react && npm run build

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp -r frontend-react/dist/* root@server:/var/www/html/
scp -r backend/* root@server:/opt/o2o-analysis/backend/

# é‡å¯æœåŠ¡
ssh root@server "systemctl restart o2o-backend && systemctl reload nginx"
```

## å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹åç«¯çŠ¶æ€
systemctl status o2o-backend

# æŸ¥çœ‹åç«¯æ—¥å¿—
journalctl -u o2o-backend -f

# é‡å¯åç«¯
systemctl restart o2o-backend

# é‡è½½ Nginx
systemctl reload nginx

# æŸ¥çœ‹ Nginx æ—¥å¿—
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

## é…ç½® HTTPS (å¯é€‰)

```bash
# å®‰è£… SSL è¯ä¹¦ (éœ€è¦å…ˆç»‘å®šåŸŸå)
certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
certbot renew --dry-run
```

## æ•°æ®åº“å¤‡ä»½

```bash
# æ‰‹åŠ¨å¤‡ä»½
pg_dump -U o2o o2o_analysis > backup_$(date +%Y%m%d).sql

# è®¾ç½®å®šæ—¶å¤‡ä»½ (æ¯å¤©å‡Œæ™¨ 3 ç‚¹)
echo "0 3 * * * pg_dump -U o2o o2o_analysis > /opt/backups/db_\$(date +\%Y\%m\%d).sql" | crontab -
```

## æ•…éšœæ’æŸ¥

### åç«¯æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥æ—¥å¿—
journalctl -u o2o-backend -n 50

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 8080

# æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
cd /opt/o2o-analysis
source .venv/bin/activate
python -m hypercorn app.main:app --bind 0.0.0.0:8080
```

### Nginx 502 é”™è¯¯
```bash
# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
curl http://127.0.0.1:8080/api/health

# æ£€æŸ¥ Nginx é…ç½®
nginx -t
```

### æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ PostgreSQL çŠ¶æ€
systemctl status postgresql

# æµ‹è¯•è¿æ¥
psql -U o2o -d o2o_analysis -c "SELECT 1"
```
