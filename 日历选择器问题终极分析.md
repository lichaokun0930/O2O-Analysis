# ğŸš¨ æ—¥å†é€‰æ‹©å™¨é—®é¢˜ç»ˆæåˆ†æä¸è§£å†³æ–¹æ¡ˆ

## å½“å‰çŠ¶æ€

### âœ… ä»£ç å±‚é¢ï¼ˆå®Œå…¨æ­£ç¡®ï¼‰
- é»˜è®¤å€¼å·²æ”¹ä¸º `value='day'` âœ…
- å›è°ƒå‡½æ•°å®šä¹‰æ­£ç¡® âœ…  
- æ—¥å†é€‰æ‹©å™¨ç»„ä»¶é…ç½®æ­£ç¡® âœ…
- `no_update` é€»è¾‘æ­£ç¡® âœ…
- JavaScript è§¦å‘è„šæœ¬å·²æ·»åŠ  âœ…

### âŒ å®é™…æ•ˆæœï¼ˆæœªç”Ÿæ•ˆï¼‰
- ç•Œé¢ä»æ˜¾ç¤ºä¸‹æ‹‰æ¡†ï¼ˆ10æœˆ18æ—¥ Saturday [æœ€æ–°]...ï¼‰
- ç»ˆç«¯å®Œå…¨æ²¡æœ‰å›è°ƒæ—¥å¿—
- è¯´æ˜å›è°ƒ**ä»æœªè¢«è§¦å‘**

---

## ğŸ” é—®é¢˜å®šä½

### ç°è±¡åˆ†æ

**ä½ çœ‹åˆ°çš„ç•Œé¢**:
```
å¯¹æ¯”æ¨¡å¼: [ğŸ“… æ—¥åº¦å¯¹æ¯” â–¼]  â† é€‰ä¸­çš„æ˜¯æ—¥åº¦
å½“å‰å‘¨æœŸ: [10æœˆ18æ—¥ (Saturday) [æœ€æ–°] â–¼]  â† ä½†æ˜¾ç¤ºçš„æ˜¯ä¸‹æ‹‰æ¡†ï¼
```

**è¿™è¯´æ˜**:
1. ä¸‹æ‹‰æ¡†çš„å€¼ç¡®å®æ˜¯ `'day'`ï¼ˆæ˜¾ç¤º"ğŸ“… æ—¥åº¦å¯¹æ¯”"ï¼‰
2. ä½†å®¹å™¨å†…å®¹**æ²¡æœ‰æ›´æ–°**ä¸ºæ—¥å†é€‰æ‹©å™¨
3. å›è°ƒå®Œå…¨æ²¡æœ‰è¢«è§¦å‘ï¼ˆç»ˆç«¯æ— æ—¥å¿—ï¼‰

### æ ¹æœ¬åŸå› 

**Dash å›è°ƒè§¦å‘æ¡ä»¶**:
```python
@app.callback(
    Output(...),
    Input('time-period-selector', 'value'),
    prevent_initial_call=False  # â† å…è®¸åˆå§‹è°ƒç”¨
)
```

`prevent_initial_call=False` çš„å«ä¹‰ï¼š
- âŒ **ä¸æ˜¯**"é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è°ƒç”¨"
- âœ… **è€Œæ˜¯**"å¦‚æœè¾“å…¥å€¼åœ¨é¡µé¢åŠ è½½æ—¶å·²å­˜åœ¨ï¼Œå…è®¸è§¦å‘å›è°ƒ"

**ä½†æ˜¯**ï¼šDash åªåœ¨"å€¼æ”¹å˜"æ—¶è§¦å‘å›è°ƒï¼

**å…·ä½“æµç¨‹**:
1. é¡µé¢åŠ è½½ï¼Œ`time-period-selector` çš„åˆå§‹å€¼ = `'day'`
2. å®¹å™¨åˆå§‹å†…å®¹ = å ä½ç¬¦ï¼ˆ"åŠ è½½ä¸­..."ï¼‰
3. Dash æ£€æŸ¥ï¼šå€¼æ˜¯ `'day'`ï¼Œå®¹å™¨æ˜¯å ä½ç¬¦
4. **é—®é¢˜**ï¼šDash è®¤ä¸ºè¿™ä¸æ˜¯"å€¼çš„æ”¹å˜"ï¼Œè€Œæ˜¯"åˆå§‹å€¼"
5. ç”±äºæŸç§åŸå› ï¼ˆå¯èƒ½æ˜¯ Dash ç‰ˆæœ¬ã€é…ç½®ã€æˆ–å®¹å™¨ç»“æ„ï¼‰ï¼Œå›è°ƒæ²¡æœ‰è¢«è§¦å‘

---

## ğŸ’¡ ç»ˆæè§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨ dcc.Location å¼ºåˆ¶åˆ·æ–°ï¼ˆæœ€å¯é ï¼‰

**åŸç†**: ç›‘å¬URLå˜åŒ–ï¼Œåœ¨é¡µé¢åŠ è½½æ—¶å¼ºåˆ¶è§¦å‘å›è°ƒ

**å®ç°**:

#### æ­¥éª¤1ï¼šæ·»åŠ  Location ç»„ä»¶ï¼ˆç¬¬800è¡Œå·¦å³ï¼‰

åœ¨ä¸»å¸ƒå±€çš„å¼€å§‹å¤„æ·»åŠ ï¼š
```python
app.layout = dbc.Container([
    dcc.Location(id='url', refresh=False),  # â† æ·»åŠ è¿™ä¸€è¡Œ
    dcc.Store(id='page-load', data={'loaded': False}),  # â† æ·»åŠ è¿™ä¸€è¡Œ
    
    # ...åŸæœ‰å†…å®¹
])
```

#### æ­¥éª¤2ï¼šä¿®æ”¹å›è°ƒæ·»åŠ  Location è¾“å…¥

```python
@app.callback(
    [Output('current-period-container', 'children'),
     Output('compare-period-container', 'children'),
     Output('page-load', 'data')],  # â† æ–°å¢è¾“å‡º
    [Input('time-period-selector', 'value'),
     Input('url', 'pathname')],  # â† æ–°å¢è¾“å…¥
    State('page-load', 'data'),  # â† æ–°å¢çŠ¶æ€
    prevent_initial_call=False
)
def toggle_period_selector_style(time_period, pathname, page_data):
    print(f"ğŸ”„ [å›è°ƒè§¦å‘] time_period={time_period}, pathname={pathname}")
    
    # å¼ºåˆ¶åˆå§‹åŒ–
    if not page_data.get('loaded'):
        page_data = {'loaded': True}
        print("   â†’ é¦–æ¬¡åŠ è½½ï¼Œå¼ºåˆ¶åˆå§‹åŒ–")
    
    # ...åŸæœ‰é€»è¾‘
    
    return current_selector, compare_selector, page_data
```

---

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨ dcc.Interval å®šæ—¶è§¦å‘ï¼ˆæ¬¡ä¼˜ï¼‰

**åœ¨å¸ƒå±€ä¸­æ·»åŠ **:
```python
dcc.Interval(
    id='force-update',
    interval=1000,  # 1ç§’åè§¦å‘
    n_intervals=0,
    max_intervals=1  # åªè§¦å‘ä¸€æ¬¡
)
```

**ä¿®æ”¹å›è°ƒ**:
```python
@app.callback(
    ...,
    [Input('time-period-selector', 'value'),
     Input('force-update', 'n_intervals')],  # â† æ·»åŠ 
    ...
)
def toggle_period_selector_style(time_period, n):
    print(f"ğŸ”„ [å›è°ƒè§¦å‘] time_period={time_period}, n_intervals={n}")
    ...
```

---

### æ–¹æ¡ˆ3ï¼šç›´æ¥åˆ é™¤åˆå§‹å®¹å™¨å†…å®¹ï¼ˆæœ€æ¿€è¿›ï¼‰

**åŸç†**: è®©å®¹å™¨å®Œå…¨ä¸ºç©ºï¼ŒDash å¿…é¡»å¡«å……å†…å®¹

**ä¿®æ”¹å®¹å™¨å®šä¹‰**ï¼ˆç¬¬947è¡Œå·¦å³ï¼‰:
```python
# ä¿®æ”¹å‰
html.Div(id='current-period-container', children=[
    html.Div([
        html.Label("ğŸ“… å½“å‰å‘¨æœŸ"),
        html.P("åŠ è½½ä¸­...")
    ])
])

# ä¿®æ”¹å
html.Div(id='current-period-container')  # â† å®Œå…¨ç©ºçš„å®¹å™¨
```

åŒæ ·ä¿®æ”¹ `compare-period-container`ã€‚

---

### æ–¹æ¡ˆ4ï¼šæ”¹ä¸º clientside_callbackï¼ˆJavaScriptæ‰§è¡Œï¼‰

**ä¼˜åŠ¿**: åœ¨æµè§ˆå™¨ç«¯æ‰§è¡Œï¼Œä¸ä¾èµ–Pythonå›è°ƒ

```python
app.clientside_callback(
    """
    function(time_period) {
        console.log('ğŸ”„ Clientside callback:', time_period);
        
        if (time_period === 'day') {
            return [
                {
                    'type': 'Div',
                    'props': {
                        'children': [
                            {'type': 'Label', 'props': {'children': 'ğŸ“… å½“å‰å‘¨æœŸï¼ˆæ—¥æœŸèŒƒå›´ï¼‰'}},
                            {'type': 'DatePickerRange', 'props': {'id': 'current-period-date-range'}}
                        ]
                    }
                },
                // å¯¹æ¯”å‘¨æœŸ...
            ];
        } else {
            // è¿”å›ä¸‹æ‹‰æ¡†...
        }
    }
    """,
    [Output('current-period-container', 'children'),
     Output('compare-period-container', 'children')],
    Input('time-period-selector', 'value')
)
```

---

## ğŸ¯ ç«‹å³å¯æ‰§è¡Œçš„ä¿®å¤ï¼ˆæ¨èæ–¹æ¡ˆ1ï¼‰

### ç«‹å³æ‰§è¡Œçš„ä»£ç ä¿®æ”¹

#### ä¿®æ”¹1ï¼šæ‰¾åˆ°ä¸»å¸ƒå±€å®šä¹‰ï¼ˆçº¦ç¬¬800è¡Œï¼‰

```python
# æŸ¥æ‰¾ app.layout = dbc.Container([
```

**åœ¨æœ€å‰é¢æ·»åŠ **:
```python
dcc.Store(id='init-store', data=0),  # åˆå§‹åŒ–è§¦å‘å™¨
```

#### ä¿®æ”¹2ï¼šä¿®æ”¹å›è°ƒï¼ˆç¬¬2897è¡Œï¼‰

**ä¿®æ”¹å‰**:
```python
@app.callback(
    [Output('current-period-container', 'children'),
     Output('compare-period-container', 'children')],
    Input('time-period-selector', 'value'),
    prevent_initial_call=False
)
def toggle_period_selector_style(time_period):
```

**ä¿®æ”¹å**:
```python
@app.callback(
    [Output('current-period-container', 'children'),
     Output('compare-period-container', 'children'),
     Output('init-store', 'data')],  # â† æ–°å¢
    [Input('time-period-selector', 'value'),
     Input('init-store', 'data')],  # â† æ”¹ä¸ºåˆ—è¡¨å¹¶æ·»åŠ 
    prevent_initial_call=False
)
def toggle_period_selector_style(time_period, init_data):
    from dash import callback_context
    print(f"ğŸ”„ [toggle_period_selector_style] time_period={time_period}, init_data={init_data}")
    print(f"   è§¦å‘æº: {callback_context.triggered}")
```

**åœ¨å‡½æ•°ç»“å°¾æ·»åŠ **:
```python
    return current_selector, compare_selector, init_data + 1  # â† è¿”å›æ›´æ–°çš„init_data
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### ç¬¬1æ­¥ï¼šæµ‹è¯•æœ€å°åŒ–åº”ç”¨

**è®¿é—®**: http://127.0.0.1:8052

**é¢„æœŸ**:
- ç›´æ¥çœ‹åˆ°æ—¥å†é€‰æ‹©å™¨ âœ…
- ç»ˆç«¯æœ‰å›è°ƒæ—¥å¿— âœ…

**å¦‚æœæˆåŠŸ**: è¯´æ˜ä»£ç é€»è¾‘æ²¡é—®é¢˜ï¼Œæ˜¯ä¸»åº”ç”¨é…ç½®é—®é¢˜
**å¦‚æœå¤±è´¥**: è¯´æ˜æ˜¯ Dash ç‰ˆæœ¬æˆ–ç¯å¢ƒé—®é¢˜

### ç¬¬2æ­¥ï¼šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜

**Windows Chrome**:
```
1. æŒ‰ Ctrl+Shift+Delete
2. é€‰æ‹©"ç¼“å­˜çš„å›¾ç‰‡å’Œæ–‡ä»¶"
3. ç‚¹å‡»"æ¸…é™¤æ•°æ®"
4. å…³é—­æµè§ˆå™¨
5. é‡æ–°æ‰“å¼€å¹¶è®¿é—® http://127.0.0.1:8050
```

### ç¬¬3æ­¥ï¼šä½¿ç”¨æ— ç—•æ¨¡å¼

```
Ctrl+Shift+N (Chrome)
è®¿é—® http://127.0.0.1:8050
```

### ç¬¬4æ­¥ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

```
1. æŒ‰ F12
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾
3. æŸ¥æ‰¾ JavaScript é”™è¯¯
4. æŸ¥æ‰¾å¼ºåˆ¶è§¦å‘è„šæœ¬çš„æ—¥å¿—ï¼š
   ğŸ”„ é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡è§¦å‘å›è°ƒ...
   âœ… æ‰¾åˆ°é€‰æ‹©å™¨ï¼Œå½“å‰å€¼: day
   ğŸš€ å·²è§¦å‘changeäº‹ä»¶
```

---

## ğŸ“Š é—®é¢˜æ’æŸ¥çŸ©é˜µ

| ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| ç»ˆç«¯æ— æ—¥å¿— | å›è°ƒæœªè§¦å‘ | ä½¿ç”¨ Interval å¼ºåˆ¶è§¦å‘ |
| ç•Œé¢ä¸å˜åŒ– | æµè§ˆå™¨ç¼“å­˜ | æ¸…é™¤ç¼“å­˜/æ— ç—•æ¨¡å¼ |
| ä¸‹æ‹‰æ¡†æ˜¾ç¤º | å›è°ƒè¿”å›é”™è¯¯ | æ£€æŸ¥å›è°ƒé€»è¾‘ |
| JavaScriptæŠ¥é”™ | DatePickeræœªåŠ è½½ | æ£€æŸ¥ä¾èµ–å®‰è£… |

---

## ğŸ”§ è°ƒè¯•å‘½ä»¤

```bash
# 1. æ£€æŸ¥ Dash ç‰ˆæœ¬
pip show dash

# 2. æ£€æŸ¥è¯­æ³•
python -m py_compile æ™ºèƒ½é—¨åº—çœ‹æ¿_Dashç‰ˆ.py

# 3. å¯åŠ¨åº”ç”¨å¹¶æŸ¥çœ‹æ—¥å¿—
python æ™ºèƒ½é—¨åº—çœ‹æ¿_Dashç‰ˆ.py 2>&1 | tee log.txt

# 4. æµ‹è¯•æœ€å°åŒ–åº”ç”¨
python æœ€å°åŒ–æµ‹è¯•_æ—¥å†é€‰æ‹©å™¨.py
```

---

## âš ï¸ å¦‚æœæ‰€æœ‰æ–¹æ¡ˆéƒ½å¤±æ•ˆ

### æœ€åæ‰‹æ®µï¼šå®Œå…¨é‡å†™å®¹å™¨é€»è¾‘

**åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ `test_calendar.py`** æµ‹è¯•æ˜¯å¦æ˜¯ä»£ç ç»“æ„é—®é¢˜ï¼š

```python
# ç²¾ç®€åˆ°æœ€åŸºæœ¬çš„ç»“æ„
app.layout = html.Div([
    dcc.Dropdown(id='dd', options=[{'label': 'Day', 'value': 'day'}], value='day'),
    html.Div(id='out')
])

@app.callback(Output('out', 'children'), Input('dd', 'value'))
def update(v):
    print(f"Callback! v={v}")
    if v == 'day':
        return dcc.DatePickerRange(id='dr')
    return html.Div("Not day")
```

å¦‚æœè¿™ä¸ªéƒ½ä¸è¡Œï¼Œé‚£å°±æ˜¯ Dash æˆ– Python ç¯å¢ƒé—®é¢˜ã€‚

---

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: 

1. âœ… **ç«‹å³æµ‹è¯•**: http://127.0.0.1:8052 ï¼ˆæœ€å°åŒ–æµ‹è¯•åº”ç”¨ï¼‰
2. ğŸ“¸ **æˆªå›¾**: æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12 â†’ Consoleï¼‰çš„å®Œæ•´è¾“å‡º
3. ğŸ“‹ **å¤åˆ¶**: ç»ˆç«¯çš„å®Œæ•´æ—¥å¿—

å‘Šè¯‰æˆ‘æµ‹è¯•ç»“æœï¼Œæˆ‘ä»¬ç»§ç»­æ’æŸ¥ï¼
