# 启动模式说明

## 📋 当前配置状态

**版本**: V8.4 生产级  
**当前配置**: 阶段1（8线程，支持30-50人）  
**需要升级**: 阶段2（16线程，支持100-200人）

---

## 🎯 启动模式对比

### 1. 调试模式 - `启动看板-调试模式.ps1`

**用途**: 开发和调试  
**服务器**: Flask内置开发服务器  
**特性**:
- ✅ 热重载：修改代码自动刷新
- ✅ 详细错误信息
- ✅ 调试工具支持
- ❌ 性能较低
- ❌ 不支持并发

**环境变量**:
```powershell
$env:DASH_DEBUG = "true"
$env:FLASK_ENV = "development"
$env:FLASK_DEBUG = "1"
$env:PYTHONDONTWRITEBYTECODE = "1"
```

**适用场景**:
- 开发新功能
- 修复BUG
- 测试代码逻辑

---

### 2. 生产模式 - `启动看板.ps1`

**用途**: 正式使用  
**服务器**: Waitress生产服务器  
**特性**:
- ✅ 高性能
- ✅ 支持并发（当前8线程）
- ✅ 生产级稳定性
- ❌ 无热重载
- ❌ 错误信息简化

**环境变量**:
```powershell
# 不设置DASH_DEBUG，默认为false
# 主程序通过 os.environ.get('DASH_DEBUG', 'false') 判断
```

**当前配置** (阶段1):
```python
serve(
    app.server,
    host='0.0.0.0',
    port=8051,
    threads=8,              # 8个工作线程
    channel_timeout=120,    # 2分钟超时
    connection_limit=100,   # 最多100个连接
)
```

**性能指标**:
- 并发支持: 30-50人
- 响应时间: <500ms
- 稳定性: 95%+

**适用场景**:
- 日常使用
- 多人访问
- 生产环境

---

## 🚀 升级到阶段2（支持100-200人）

### 需要修改的配置

**文件**: `智能门店看板_Dash版.py` (约第21030行)

**当前配置**:
```python
threads=8,              # 8个工作线程
channel_timeout=120,    # 2分钟超时
connection_limit=100,   # 最多100个连接
```

**升级配置**:
```python
threads=16,             # 16个工作线程 (翻倍)
channel_timeout=180,    # 3分钟超时 (增加)
connection_limit=200,   # 最多200个连接 (翻倍)
```

### 性能提升预期

| 指标 | 阶段1 (当前) | 阶段2 (升级后) | 改进 |
|------|-------------|---------------|------|
| 并发支持 | 30-50人 | 100-200人 | 3-4倍 |
| 同时处理 | 8个请求 | 16个请求 | 2倍 |
| 平均等待 | 3-4秒 | 6-7秒 | 略增 |
| 响应时间 | <500ms | <1秒 | 略增 |

### 资源需求

**当前** (阶段1):
- CPU: 4核心
- 内存: 4GB
- Redis: 1GB

**升级后** (阶段2):
- CPU: 8核心 (推荐)
- 内存: 8GB (推荐)
- Redis: 2GB (推荐)

---

## 🔍 如何判断当前模式

### 方法1: 查看启动日志

**调试模式**:
```
🔧 [调试模式] 已开启: 修改代码并保存后，看板将自动重启应用新逻辑
```

**生产模式**:
```
🛡️ [生产模式] 已开启: 使用 Waitress 高性能服务器
🚀 启动生产服务器 (Waitress - 企业级)...
   配置: 8线程, 100连接, 2分钟超时
   适用: 30-50人并发
```

### 方法2: 查看进程

**调试模式**:
```powershell
# Flask开发服务器
python.exe 智能门店看板_Dash版.py
```

**生产模式**:
```powershell
# Waitress服务器
python.exe 智能门店看板_Dash版.py (使用waitress.serve)
```

### 方法3: 测试热重载

**调试模式**:
- 修改代码 → 保存 → 自动刷新 ✅

**生产模式**:
- 修改代码 → 保存 → 不会刷新 ❌
- 需要手动重启: `.\重启看板.ps1`

---

## 📊 性能对比

### 服务器对比

| 服务器 | 并发支持 | 响应时间 | 稳定性 | 热重载 |
|--------|---------|---------|--------|--------|
| Flask开发 | 1人 | 慢 | 差 | ✅ |
| Flask多线程 | 10-20人 | 中等 | 中等 | ❌ |
| Waitress (8线程) | 30-50人 | 快 | 优秀 | ❌ |
| Waitress (16线程) | 100-200人 | 快 | 优秀 | ❌ |

### 配置对比

| 配置 | 线程数 | 连接数 | 超时 | 适用人数 |
|------|--------|--------|------|---------|
| 阶段1 (当前) | 8 | 100 | 2分钟 | 30-50人 |
| 阶段2 (推荐) | 16 | 200 | 3分钟 | 100-200人 |
| 阶段3 (未来) | 32 (双实例) | 400 | 3分钟 | 200-500人 |

---

## 🎯 使用建议

### 日常开发

1. 使用调试模式: `.\启动看板-调试模式.ps1`
2. 修改代码后自动刷新
3. 完成后测试生产模式

### 正式使用

1. 使用生产模式: `.\启动看板.ps1`
2. 支持多人并发访问
3. 生产级稳定性

### 性能测试

1. 使用生产模式
2. 运行压力测试: `python 压力测试_30人.py`
3. 根据结果调整配置

---

## 🔧 快速切换

### 从调试切换到生产

```powershell
# 1. 停止调试模式 (Ctrl+C)
# 2. 启动生产模式
.\启动看板.ps1
```

### 从生产切换到调试

```powershell
# 1. 停止生产模式 (Ctrl+C)
# 2. 启动调试模式
.\启动看板-调试模式.ps1
```

---

## 📝 总结

### 当前状态

- ✅ 调试模式：支持热重载，适合开发
- ✅ 生产模式：使用Waitress，支持30-50人
- ⚠️ 配置：阶段1（8线程），需要升级到阶段2

### 下一步

1. **立即**: 确认是否需要升级到阶段2（16线程）
2. **本周**: 执行升级并测试100人并发
3. **下月**: 规划阶段3（多实例+负载均衡）

---

**创建日期**: 2025-12-11  
**当前版本**: V8.4 生产级  
**当前配置**: 阶段1（8线程，30-50人）  
**推荐升级**: 阶段2（16线程，100-200人）
