# ä¸¤å°ç”µè„‘æ•°æ®åº“åŒæ­¥ - å¿«é€Ÿå‚è€ƒ

## ğŸ¯ ä¸€å¥è¯æ€»ç»“
**æ‰€æœ‰æ•°æ®åº“ç»“æ„å˜æ›´ç”¨è¿ç§»è„šæœ¬,ä¸ä»£ç ä¸€èµ·æäº¤Git,Bç”µè„‘æ‹‰å–åè‡ªåŠ¨åŒæ­¥**

---

## ğŸ“‹ Aç”µè„‘å·¥ä½œæµ (ä¿®æ”¹æ–¹)

### â­ æ¨èæ–¹å¼: æ™ºèƒ½æäº¤(ä¸€é”®æå®š)

```powershell
# 1. ä¿®æ”¹models.pyæ·»åŠ å­—æ®µ
# 2. ä¸€æ¡å‘½ä»¤å®Œæˆæ‰€æœ‰æ“ä½œ
.\Aç”µè„‘_æ™ºèƒ½æäº¤.ps1 -message "æ·»åŠ XXXå­—æ®µ"

# è„šæœ¬ä¼šè‡ªåŠ¨:
# âœ“ æ£€æµ‹models.pyä¿®æ”¹
# âœ“ è¯¢é—®è¿ç§»æè¿°
# âœ“ åˆ›å»ºå¹¶åº”ç”¨è¿ç§»
# âœ“ éªŒè¯æ•°æ®åº“ç»“æ„
# âœ“ æäº¤æ‰€æœ‰åˆ°GitHub
```

### æ‰‹åŠ¨æ–¹å¼(é«˜çº§ç”¨æˆ·)

```powershell
# 1. ä¿®æ”¹models.pyæ·»åŠ å­—æ®µ
# 2. åˆ›å»ºè¿ç§»è„šæœ¬
cd database\migrations
copy migration_template.sql v2_description.sql
notepad v2_description.sql  # ç¼–è¾‘SQL

# 3. åº”ç”¨åˆ°Aç”µè„‘æ•°æ®åº“
python apply_migration.py v2_description.sql

# 4. éªŒè¯
python check_structure.py

# 5. æäº¤Git
git add database\migrations\v2_description.sql database\models.py
git commit -m "æ·»åŠ XXXå­—æ®µ"
git push
```

---

## ğŸ”„ Bç”µè„‘å·¥ä½œæµ (åŒæ­¥æ–¹)

### æ–¹å¼1: ä¸€é”®åŒæ­¥(æ¨è)

```powershell
.\Bç”µè„‘_åŒæ­¥æ•°æ®åº“.ps1
```

### æ–¹å¼2: æ‰‹åŠ¨æ‰§è¡Œ

```powershell
# 1. æ‹‰å–ä»£ç 
git pull

# 2. è‡ªåŠ¨åŒæ­¥æ‰€æœ‰è¿ç§»
python database\migrations\sync_migrations.py

# 3. éªŒè¯ç»“æ„
python database\migrations\check_structure.py

# 4. æ¸…ç†ç¼“å­˜
python æ¸…ç†Redisç¼“å­˜.py

# 5. é‡å¯çœ‹æ¿
.\å¯åŠ¨çœ‹æ¿.ps1
```

---

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

| å‘½ä»¤ | ç”¨é€” |
|------|------|
| `.\Aç”µè„‘_æ™ºèƒ½æäº¤.ps1 -message "xxx"` | â­ Aç”µè„‘ä¸€é”®æ™ºèƒ½æäº¤ |
| `.\Bç”µè„‘_æ‹‰å–ä»£ç .ps1` | â­ Bç”µè„‘æ™ºèƒ½æ‹‰å–ä»£ç  |
| `.\Bç”µè„‘_åŒæ­¥æ•°æ®åº“.ps1` | Bç”µè„‘ä»…åŒæ­¥æ•°æ®åº“ |
| `python database\migrations\sync_migrations.py` | è‡ªåŠ¨åŒæ­¥æ‰€æœ‰è¿ç§» |
| `python database\migrations\check_structure.py` | éªŒè¯ç»“æ„ä¸€è‡´æ€§ |
| `python database\migrations\apply_migration.py vX.sql` | åº”ç”¨å•ä¸ªè¿ç§» |
| `python database\migrations\migration_history.py` | æŸ¥çœ‹å·²åº”ç”¨è¿ç§» |

---

## ğŸ“ ç›®å½•ç»“æ„

```
database/
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ README.md                    # è¿ç§»ç›®å½•è¯´æ˜
â”‚   â”œâ”€â”€ migration_template.sql       # è¿ç§»æ¨¡æ¿
â”‚   â”œâ”€â”€ v1_add_stock_fields.sql      # è¿ç§»1: åº“å­˜å­—æ®µ
â”‚   â”œâ”€â”€ migration_history.py         # ç®¡ç†å†å²è¡¨
â”‚   â”œâ”€â”€ apply_migration.py           # åº”ç”¨å•ä¸ªè¿ç§»
â”‚   â”œâ”€â”€ sync_migrations.py           # è‡ªåŠ¨åŒæ­¥
â”‚   â””â”€â”€ check_structure.py           # éªŒè¯ä¸€è‡´æ€§
```

---

## âœ… è¿ç§»è„šæœ¬ç¤ºä¾‹

```sql
-- v2_add_new_field.sql
-- æ—¥æœŸ: 2025-11-22
-- è¯´æ˜: æ·»åŠ æ–°å­—æ®µ

ALTER TABLE orders ADD COLUMN IF NOT EXISTS new_field VARCHAR(100);
COMMENT ON COLUMN orders.new_field IS 'å­—æ®µè¯´æ˜';

-- éªŒè¯
DO $$
BEGIN
    IF EXISTS (
        SELECT 1 FROM information_schema.columns
        WHERE table_name = 'orders' AND column_name = 'new_field'
    ) THEN
        RAISE NOTICE 'âœ“ å­—æ®µæ·»åŠ æˆåŠŸ';
    END IF;
END $$;
```

---

## âš¡ å¿«é€Ÿæ•…éšœæ’æŸ¥

### é—®é¢˜: Bç”µè„‘æŠ¥é”™å­—æ®µä¸å­˜åœ¨

```powershell
# 1. æ£€æŸ¥ç»“æ„å·®å¼‚
python database\migrations\check_structure.py

# 2. è‡ªåŠ¨åŒæ­¥
python database\migrations\sync_migrations.py

# 3. éªŒè¯
python database\migrations\check_structure.py
```

### é—®é¢˜: è¿ç§»æ‰§è¡Œå¤±è´¥

```powershell
# 1. æŸ¥çœ‹è¿ç§»å†å²
python database\migrations\migration_history.py

# 2. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯(åœ¨è¾“å‡ºä¸­)

# 3. ä¿®å¤è¿ç§»è„šæœ¬åé‡æ–°æ‰§è¡Œ
python database\migrations\apply_migration.py vX.sql
```

### é—®é¢˜: æ•°æ®æ˜¾ç¤ºå¼‚å¸¸

```powershell
# åŒæ­¥åæ¸…ç†ç¼“å­˜
python æ¸…ç†Redisç¼“å­˜.py
.\å¯åŠ¨çœ‹æ¿.ps1
```

---

## ğŸ“ æ ¸å¿ƒåŸåˆ™

1. **ä¿®æ”¹models.py â†’ å¿…é¡»åˆ›å»ºè¿ç§»è„šæœ¬**
2. **è¿ç§»è„šæœ¬ä¸ä»£ç ä¸€èµ·æäº¤Git**
3. **Bç”µè„‘æ‹‰å–åè‡ªåŠ¨è¿è¡Œsync_migrations.py**
4. **å®šæœŸéªŒè¯check_structure.py**

---

## ğŸ“Š å®Œæ•´æ•°æ®æµ

```
Aç”µè„‘ä¿®æ”¹models.py
    â†“
åˆ›å»ºè¿ç§»è„šæœ¬vX.sql
    â†“
åº”ç”¨åˆ°Aç”µè„‘æ•°æ®åº“
    â†“
éªŒè¯ç»“æ„ä¸€è‡´æ€§
    â†“
æäº¤åˆ°Git(ä»£ç +è¿ç§»)
    â†“
Bç”µè„‘æ‹‰å–ä»£ç 
    â†“
è‡ªåŠ¨åŒæ­¥è¿ç§»(sync_migrations.py)
    â†“
éªŒè¯ç»“æ„ä¸€è‡´æ€§
    â†“
æ¸…ç†Redisç¼“å­˜
    â†“
é‡å¯çœ‹æ¿
    â†“
âœ“ ä¸¤å°ç”µè„‘å®Œå…¨ä¸€è‡´
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

- âœ… æ¯æ¬¡ä¿®æ”¹ç«‹å³åˆ›å»ºè¿ç§»
- âœ… ä¸€ä¸ªè¿ç§»åªåšä¸€ä»¶äº‹
- âœ… ä½¿ç”¨æœ‰æ„ä¹‰çš„è¿ç§»åç§°
- âœ… è¿ç§»ä¸­åŒ…å«éªŒè¯é€»è¾‘
- âœ… æ·»åŠ è¯¦ç»†çš„æ³¨é‡Šè¯´æ˜
- âœ… æäº¤å‰å…ˆéªŒè¯Aç”µè„‘
- âœ… Bç”µè„‘æ‹‰å–åç«‹å³åŒæ­¥

---

## ğŸš€ ä»æ­¤å‘Šåˆ«æ‰‹åŠ¨åŒæ­¥!

**Aç”µè„‘**: ä¸€æ¡å‘½ä»¤æå®šæ‰€æœ‰æ“ä½œ!  
**Bç”µè„‘**: ä¸€æ¡å‘½ä»¤åŒæ­¥æ‰€æœ‰ä¿®æ”¹!

```powershell
# Aç”µè„‘: æ™ºèƒ½è¯†åˆ«å¹¶æäº¤
.\Aç”µè„‘_æ™ºèƒ½æäº¤.ps1 -message "æ·»åŠ XXXå­—æ®µ"

# Bç”µè„‘: æ™ºèƒ½æ‹‰å–ä»£ç 
.\Bç”µè„‘_æ‹‰å–ä»£ç .ps1
```

**è¯¦ç»†æŒ‡å—**:
- `Aç”µè„‘_æ™ºèƒ½æäº¤ä½¿ç”¨æŒ‡å—.md` - Aç”µè„‘å®Œæ•´ä½¿ç”¨è¯´æ˜
- `ABç”µè„‘æ“ä½œå¿«é€Ÿå‚è€ƒ.md` - A/Bç”µè„‘é€ŸæŸ¥è¡¨
