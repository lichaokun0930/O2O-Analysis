# 🚀 智能门店看板 - 云端部署与管理手册

> 部署日期: 2025年10月25日  
> 服务器: 阿里云轻量应用服务器  
> 操作系统: Ubuntu 24.04 LTS

---

## 📋 目录

1. [服务器信息](#服务器信息)
2. [访问地址](#访问地址)
3. [服务管理命令](#服务管理命令)
4. [日常维护](#日常维护)
5. [文件管理](#文件管理)
6. [故障排查](#故障排查)
7. [安全设置](#安全设置)
8. [备份恢复](#备份恢复)

---

## 🖥️ 服务器信息

### 基本配置
- **公网IP**: `101.200.0.185`
- **地域**: 华北2 (北京)
- **配置**: 2核CPU / 4GB内存 / 50GB SSD
- **带宽**: 200Mbps
- **操作系统**: Ubuntu 24.04.2 LTS
- **Python版本**: 3.12.3
- **费用**: ¥70/月

### 登录信息
- **用户名**: `root`
- **登录方式**: 
  - 阿里云控制台 Workbench 远程连接
  - WinSCP (文件传输)
  - SSH客户端 (命令行)

### 项目目录结构
```
/opt/dashboard/
├── venv/                          # Python虚拟环境
├── data/                          # 数据文件目录
├── 智能门店看板_Dash版.py          # 主程序
├── gemini_ai_助手.py              # AI助手模块
├── 订单数据处理器.py              # 数据处理模块
├── 问题诊断引擎.py                # 诊断引擎
├── 真实数据处理器.py              # 数据处理器
├── scene_inference.py             # 场景推断
├── cache_utils.py                 # 缓存工具
├── echarts_responsive_utils.py    # 图表工具
├── requirements.txt               # 依赖列表
└── .env                          # 环境配置
```

---

## 🌐 访问地址

### 看板访问地址
```
http://101.200.0.185:8050
```

**支持设备**:
- 💻 Windows/Mac电脑
- 📱 iPhone/Android手机
- 📲 iPad/平板电脑

**支持浏览器**:
- Chrome (推荐)
- Edge
- Safari
- Firefox

**访问特点**:
- ✅ 24小时在线
- ✅ 随时随地访问
- ✅ 无需VPN
- ✅ 多设备同时使用

---

## ⚙️ 服务管理命令

### 1. 连接服务器

#### 方式1: 阿里云Workbench (推荐)
1. 登录阿里云控制台
2. 进入"轻量应用服务器"
3. 点击服务器 "Ubuntu-cvwa"
4. 点击"远程连接" → "Workbench远程连接"

#### 方式2: WinSCP (文件传输)
1. 打开WinSCP
2. 主机名: `101.200.0.185`
3. 端口: `22`
4. 用户名: `root`
5. 密码: (您设置的root密码)

#### 方式3: PowerShell SSH
```powershell
ssh root@101.200.0.185
```

### 2. 看板服务管理

#### 查看服务状态
```bash
systemctl status dashboard
```
**输出说明**:
- `Active: active (running)` - 服务正常运行 ✅
- `Active: inactive (dead)` - 服务已停止 ❌
- `Active: failed` - 服务启动失败 ⚠️

#### 启动服务
```bash
systemctl start dashboard
```

#### 停止服务
```bash
systemctl stop dashboard
```

#### 重启服务
```bash
systemctl restart dashboard
```

#### 查看服务是否开机自启
```bash
systemctl is-enabled dashboard
```
输出 `enabled` 表示已设置开机自启

#### 启用开机自启
```bash
systemctl enable dashboard
```

#### 禁用开机自启
```bash
systemctl disable dashboard
```

### 3. 查看日志

#### 实时查看日志 (最常用)
```bash
journalctl -u dashboard -f
```
按 `Ctrl+C` 退出

#### 查看最近100行日志
```bash
journalctl -u dashboard -n 100
```

#### 查看今天的日志
```bash
journalctl -u dashboard --since today
```

#### 查看最近1小时的日志
```bash
journalctl -u dashboard --since "1 hour ago"
```

#### 查看指定时间段的日志
```bash
journalctl -u dashboard --since "2025-10-25 20:00" --until "2025-10-25 22:00"
```

---

## 🔧 日常维护

### 1. 检查服务器运行状态

#### 查看系统资源使用情况
```bash
# 查看CPU、内存使用
top

# 更友好的界面 (需要安装: apt install htop)
htop

# 查看磁盘使用
df -h

# 查看内存使用
free -h
```

#### 查看Python进程
```bash
ps aux | grep python
```

#### 查看端口占用
```bash
netstat -tlnp | grep 8050
# 或
ss -tlnp | grep 8050
```

### 2. 更新看板代码

#### 步骤1: 停止服务
```bash
systemctl stop dashboard
```

#### 步骤2: 使用WinSCP上传新文件
覆盖 `/opt/dashboard/` 目录下的文件

#### 步骤3: 重启服务
```bash
systemctl restart dashboard
```

#### 步骤4: 查看日志确认启动成功
```bash
journalctl -u dashboard -f
```

### 3. 更新Python依赖包

```bash
# 进入项目目录
cd /opt/dashboard

# 激活虚拟环境
source venv/bin/activate

# 更新pip
pip install --upgrade pip

# 安装新依赖
pip install 新包名

# 或更新所有依赖
pip install -r requirements.txt --upgrade

# 退出虚拟环境
deactivate

# 重启服务
systemctl restart dashboard
```

### 4. 清理日志文件

```bash
# 查看日志占用空间
journalctl --disk-usage

# 清理7天前的日志
journalctl --vacuum-time=7d

# 限制日志最大占用500M
journalctl --vacuum-size=500M
```

---

## 📁 文件管理

### 1. 数据文件管理

#### 查看数据文件
```bash
ls -lh /opt/dashboard/data/
```

#### 删除旧数据文件
```bash
rm /opt/dashboard/data/旧文件名.xlsx
```

#### 上传新数据文件
使用WinSCP拖拽到 `/opt/dashboard/data/` 目录

### 2. 备份看板代码

#### 创建备份
```bash
# 备份整个项目目录
cd /opt
tar -czf dashboard_backup_$(date +%Y%m%d).tar.gz dashboard/

# 查看备份文件
ls -lh dashboard_backup_*.tar.gz
```

#### 下载备份到本地
使用WinSCP下载 `/opt/dashboard_backup_*.tar.gz` 文件

### 3. 恢复备份

```bash
# 解压备份文件
cd /opt
tar -xzf dashboard_backup_20251025.tar.gz

# 重启服务
systemctl restart dashboard
```

---

## 🔍 故障排查

### 问题1: 网页无法访问

#### 解决步骤:

**1. 检查服务是否运行**
```bash
systemctl status dashboard
```

**2. 如果服务停止,启动服务**
```bash
systemctl start dashboard
```

**3. 查看日志找到错误原因**
```bash
journalctl -u dashboard -n 50
```

**4. 检查防火墙端口是否开放**
- 登录阿里云控制台
- 进入服务器 → 防火墙
- 确认 8050 端口规则存在

**5. 检查进程是否在监听端口**
```bash
netstat -tlnp | grep 8050
```

### 问题2: 服务启动失败

#### 查看详细错误信息
```bash
journalctl -u dashboard -n 50 --no-pager
```

#### 常见错误及解决方法

**错误: ModuleNotFoundError**
```bash
# 解决方法: 安装缺失的模块
cd /opt/dashboard
source venv/bin/activate
pip install 缺失的模块名
deactivate
systemctl restart dashboard
```

**错误: Permission denied**
```bash
# 解决方法: 修复文件权限
chmod -R 755 /opt/dashboard
systemctl restart dashboard
```

**错误: Address already in use**
```bash
# 解决方法: 杀死占用端口的进程
lsof -ti:8050 | xargs kill -9
systemctl start dashboard
```

### 问题3: 服务频繁重启

```bash
# 查看重启记录
systemctl status dashboard

# 查看详细日志
journalctl -u dashboard --since "30 minutes ago"

# 检查是否内存不足
free -h
```

### 问题4: AI聊天功能超时

**原因**: 服务器访问Google API受限

**临时解决方案**:
1. AI功能可能无法使用
2. 其他数据分析功能正常

**永久解决方案** (可选):
- 配置网络代理
- 使用国内AI服务替代

---

## 🔒 安全设置

### 1. 修改root密码

```bash
passwd
```
输入新密码两次

### 2. 限制访问IP (可选)

#### 在阿里云控制台操作:
1. 进入服务器 → 防火墙
2. 修改8050端口规则
3. 来源IP改为: `您的IP地址/32`

### 3. 添加看板登录密码 (可选)

需要修改代码添加认证功能,请联系技术支持。

### 4. 定期更新系统

```bash
# 更新软件包列表
apt update

# 升级所有软件包
apt upgrade -y

# 重启服务器 (可选)
reboot
```

---

## 💾 备份恢复

### 自动备份脚本

#### 创建备份脚本
```bash
cat > /opt/backup_dashboard.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/opt/backups"
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR
tar -czf $BACKUP_DIR/dashboard_$DATE.tar.gz /opt/dashboard/
# 保留最近30天的备份
find $BACKUP_DIR -name "dashboard_*.tar.gz" -mtime +30 -delete
echo "备份完成: dashboard_$DATE.tar.gz"
EOF

chmod +x /opt/backup_dashboard.sh
```

#### 手动执行备份
```bash
/opt/backup_dashboard.sh
```

#### 设置定时备份 (每天凌晨3点)
```bash
crontab -e
# 添加以下内容:
0 3 * * * /opt/backup_dashboard.sh >> /var/log/dashboard_backup.log 2>&1
```

---

## 📞 技术支持

### 常用资源

- **阿里云控制台**: https://home.console.aliyun.com/
- **Dash官方文档**: https://dash.plotly.com/
- **Python官方文档**: https://docs.python.org/3/

### 快速命令参考卡

```bash
# ========== 服务管理 ==========
systemctl status dashboard      # 查看状态
systemctl start dashboard       # 启动服务
systemctl stop dashboard        # 停止服务
systemctl restart dashboard     # 重启服务
journalctl -u dashboard -f      # 查看日志

# ========== 系统状态 ==========
top                            # 查看资源使用
df -h                          # 查看磁盘
free -h                        # 查看内存
netstat -tlnp | grep 8050      # 查看端口

# ========== 文件操作 ==========
cd /opt/dashboard              # 进入项目目录
ls -lh                         # 查看文件列表
tail -f 文件名                  # 实时查看文件
```

---

## 📝 更新日志

### 2025-10-25
- ✅ 完成云端部署
- ✅ 配置systemd服务
- ✅ 开放8050防火墙端口
- ✅ 设置开机自启
- ✅ 上传所有必需文件

---

## ⚠️ 重要提醒

1. **定期检查**: 每周至少检查一次服务运行状态
2. **及时备份**: 上传重要数据后记得备份
3. **监控成本**: 注意服务器到期时间,避免欠费停机
4. **安全意识**: 不要在看板中上传敏感机密数据
5. **访问记录**: 注意查看日志,了解访问情况

---

**文档版本**: v1.0  
**最后更新**: 2025-10-25  
**维护人员**: GitHub Copilot
