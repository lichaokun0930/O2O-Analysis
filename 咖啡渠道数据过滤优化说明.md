# å’–å•¡æ¸ é“æ•°æ®è¿‡æ»¤ä¼˜åŒ–è¯´æ˜

## ğŸ“‹ é—®é¢˜æè¿°

åœ¨ä½¿ç”¨å¤šå•†å“è®¢å•å¼•å¯¼åˆ†æå’Œåœºæ™¯è¥é”€åˆ†ææ—¶ï¼Œå‘ç°æ•°æ®ä¸­åŒ…å«å¤§é‡å’–å•¡ç›¸å…³å•†å“ï¼ˆå¦‚ç‘å¹¸å’–å•¡ã€æ˜Ÿå·´å…‹ç­‰ï¼‰ï¼Œè¿™äº›æ•°æ®æ¥è‡ª"é¥¿äº†ä¹ˆå’–å•¡"å’Œ"ç¾å›¢å’–å•¡"æ¸ é“ï¼Œå±äºé—¨åº—çš„å’–å•¡ä¸šåŠ¡ï¼Œ**å¹¶éO2Oé›¶å”®ä¸šåŠ¡**ã€‚

### å½±å“èŒƒå›´

1. **é«˜é¢‘å•†å“ç»„åˆTOP20**ï¼šå’–å•¡å•†å“ç»„åˆå æ®å¤§é‡ä½ç½®
2. **åœºæ™¯è¥é”€åˆ†æ**ï¼šå’–å•¡ä¸šåŠ¡æ•°æ®å¹²æ‰°é›¶å”®ä¸šåŠ¡çš„æ—¶æ®µã€ä»·æ ¼ã€ç»„åˆåˆ†æ
3. **å®¢å•ä»·åˆ†æ**ï¼šå’–å•¡è®¢å•å®¢å•ä»·æ¨¡å¼ä¸é›¶å”®è®¢å•å·®å¼‚è¾ƒå¤§
4. **å•†å“æ¨è**ï¼šå’–å•¡å•†å“æ¨èå¯¹é›¶å”®ä¸šåŠ¡æ— æŒ‡å¯¼æ„ä¹‰

## âœ… ä¼˜åŒ–æ–¹æ¡ˆ

### 1. æ•°æ®è¿‡æ»¤è§„åˆ™

**è¿‡æ»¤æ¡ä»¶**ï¼š
```python
æ¸ é“å­—æ®µ in ['é¥¿äº†ä¹ˆå’–å•¡', 'ç¾å›¢å’–å•¡']
```

**æ‰§è¡Œæ—¶æœº**ï¼š
- æ•°æ®åŠ è½½åç«‹å³è¿‡æ»¤
- æ‰€æœ‰åˆ†æå‰ç»Ÿä¸€å¤„ç†
- ç¡®ä¿å…¨å±€ä¸€è‡´æ€§

### 2. å®æ–½ä½ç½®

#### 2.1 è®¢å•æ•°æ®é¢„å¤„ç†ï¼ˆæ ¸å¿ƒï¼‰

**æ–‡ä»¶**ï¼š`æ™ºèƒ½é—¨åº—ç»è¥çœ‹æ¿_å¯è§†åŒ–.py`

**å‡½æ•°**ï¼š`preprocess_order_data()`

**ä½ç½®**ï¼šç¬¬3934è¡Œ

**ä»£ç **ï¼š
```python
# ğŸ”´ **å…³é”®ä¸šåŠ¡è§„åˆ™2ï¼šå‰”é™¤å’–å•¡æ¸ é“æ•°æ®** - å’–å•¡ä¸šåŠ¡éO2Oé›¶å”®
# è¯†åˆ«æ ‡å‡†ï¼šæ¸ é“ in ['é¥¿äº†ä¹ˆå’–å•¡', 'ç¾å›¢å’–å•¡']
if 'æ¸ é“' in df.columns:
    exclude_channels = ['é¥¿äº†ä¹ˆå’–å•¡', 'ç¾å›¢å’–å•¡']
    before_filter = len(df)
    df = df[~df['æ¸ é“'].isin(exclude_channels)].copy()
    after_filter = len(df)
    coffee_removed = before_filter - after_filter
    
    if coffee_removed > 0:
        st.info(f"â˜• å·²è‡ªåŠ¨å‰”é™¤å’–å•¡æ¸ é“æ•°æ® {coffee_removed} è¡Œï¼ˆé¥¿äº†ä¹ˆå’–å•¡ã€ç¾å›¢å’–å•¡ï¼‰ï¼Œä» {before_filter} è¡Œå‡å°‘åˆ° {after_filter} è¡Œ")
        print(f"âœ… å·²å‰”é™¤ {coffee_removed} è¡Œå’–å•¡æ¸ é“æ•°æ®ï¼Œä» {before_filter} è¡Œå‡å°‘åˆ° {after_filter} è¡Œ")
```

#### 2.2 åœºæ™¯è¥é”€çœ‹æ¿

**æ–‡ä»¶**ï¼š`æ™ºèƒ½é—¨åº—ç»è¥çœ‹æ¿_å¯è§†åŒ–.py`

**å‡½æ•°**ï¼š`display_scenario_marketing_dashboard()`

**ä½ç½®**ï¼šç¬¬7367è¡Œ

**ä»£ç **ï¼š
```python
# ========== æ•°æ®è¿‡æ»¤ï¼šå‰”é™¤å’–å•¡æ¸ é“ ==========
if 'æ¸ é“' in raw_data.columns:
    exclude_channels = ['é¥¿äº†ä¹ˆå’–å•¡', 'ç¾å›¢å’–å•¡']
    original_count = len(raw_data)
    raw_data = raw_data[~raw_data['æ¸ é“'].isin(exclude_channels)].copy()
    filtered_count = len(raw_data)
    excluded_count = original_count - filtered_count
    
    if excluded_count > 0:
        st.info(f"â„¹ï¸ å·²è‡ªåŠ¨å‰”é™¤å’–å•¡æ¸ é“æ•°æ® {excluded_count} è¡Œï¼ˆ{excluded_count/original_count*100:.1f}%ï¼‰ï¼Œä¿ç•™O2Oé›¶å”®æ•°æ® {filtered_count} è¡Œ")
```

#### 2.3 å¤šå•†å“è®¢å•å¼•å¯¼åˆ†æ

**æ–‡ä»¶**ï¼š`å¤šå•†å“è®¢å•å¼•å¯¼åˆ†æçœ‹æ¿.py`

**å‡½æ•°**ï¼š`filter_retail_data()` ï¼ˆæ–°å¢ï¼‰

**ä½ç½®**ï¼šç¬¬28è¡Œ

**ä»£ç **ï¼š
```python
def filter_retail_data(df: pd.DataFrame) -> pd.DataFrame:
    """
    è¿‡æ»¤O2Oé›¶å”®ä¸šåŠ¡æ•°æ®ï¼Œå‰”é™¤å’–å•¡ç­‰å…¶ä»–ä¸šåŠ¡æ¸ é“
    
    Parameters:
    -----------
    df : pd.DataFrame
        åŸå§‹è®¢å•æ•°æ®
    
    Returns:
    --------
    pd.DataFrame
        è¿‡æ»¤åçš„æ•°æ®
    """
    # éœ€è¦æ’é™¤çš„æ¸ é“
    exclude_channels = ['é¥¿äº†ä¹ˆå’–å•¡', 'ç¾å›¢å’–å•¡']
    
    if 'æ¸ é“' in df.columns:
        original_count = len(df)
        df_filtered = df[~df['æ¸ é“'].isin(exclude_channels)].copy()
        filtered_count = len(df_filtered)
        excluded_count = original_count - filtered_count
        
        if excluded_count > 0:
            print(f"[FILTER] å·²å‰”é™¤å’–å•¡æ¸ é“æ•°æ®: {excluded_count} è¡Œ")
            print(f"[FILTER] ä¿ç•™O2Oé›¶å”®æ•°æ®: {filtered_count} è¡Œ")
        
        return df_filtered
    else:
        print("[FILTER] æ•°æ®ä¸­æ— æ¸ é“å­—æ®µï¼Œè·³è¿‡è¿‡æ»¤")
        return df
```

**è°ƒç”¨ä½ç½®**ï¼š
- ç‹¬ç«‹çœ‹æ¿ä¸»å‡½æ•°ï¼ˆç¬¬564è¡Œï¼‰
- ä¸»çœ‹æ¿é›†æˆéƒ¨åˆ†ï¼ˆç¬¬2930è¡Œï¼‰

#### 2.4 ä¸»çœ‹æ¿é›†æˆ

**æ–‡ä»¶**ï¼š`æ™ºèƒ½é—¨åº—ç»è¥çœ‹æ¿_å¯è§†åŒ–.py`

**ä½ç½®**ï¼šç¬¬2930è¡Œï¼ˆTab 4: å¤šå•†å“è®¢å•å¼•å¯¼ï¼‰

**ä»£ç **ï¼š
```python
# å¯¼å…¥å¤šå•†å“è®¢å•åˆ†ææ¨¡å—
from å¤šå•†å“è®¢å•å¼•å¯¼åˆ†æçœ‹æ¿ import (
    filter_retail_data,  # æ–°å¢å¯¼å…¥
    calculate_order_item_stats,
    render_order_quantity_distribution,
    render_item_quantity_analysis,
    render_frequent_combos,
    render_single_order_diagnosis,
    render_promotion_suggestions
)

# è¿‡æ»¤O2Oé›¶å”®æ•°æ®ï¼ˆå‰”é™¤å’–å•¡ç­‰å…¶ä»–ä¸šåŠ¡æ¸ é“ï¼‰
current_df_filtered = filter_retail_data(current_df)

# æ˜¾ç¤ºè¿‡æ»¤ä¿¡æ¯
if len(current_df_filtered) < len(current_df):
    excluded_count = len(current_df) - len(current_df_filtered)
    st.info(f"â„¹ï¸ å·²è‡ªåŠ¨å‰”é™¤å’–å•¡æ¸ é“æ•°æ® {excluded_count} è¡Œï¼Œä¿ç•™O2Oé›¶å”®æ•°æ® {len(current_df_filtered)} è¡Œ")
```

## ğŸ“Š æ•ˆæœéªŒè¯

### éªŒè¯æ­¥éª¤

1. **ä¸Šä¼ åŒ…å«å’–å•¡æ•°æ®çš„è®¢å•æ–‡ä»¶**

2. **æŸ¥çœ‹è®¢å•æ•°æ®åˆ†æ**ï¼š
   - åº”æ˜¾ç¤ºï¼š`â˜• å·²è‡ªåŠ¨å‰”é™¤å’–å•¡æ¸ é“æ•°æ® XXX è¡Œ`
   - ç¡®è®¤å‰”é™¤åçš„æ•°æ®é‡

3. **è¿›å…¥åœºæ™¯è¥é”€åˆ†æ**ï¼š
   - åº”æ˜¾ç¤ºï¼š`â„¹ï¸ å·²è‡ªåŠ¨å‰”é™¤å’–å•¡æ¸ é“æ•°æ® XXX è¡Œï¼ˆXX.X%ï¼‰`
   - æ£€æŸ¥å•†å“ç»„åˆæ˜¯å¦è¿˜æœ‰å’–å•¡ç›¸å…³

4. **è¿›å…¥å¤šå•†å“è®¢å•å¼•å¯¼**ï¼š
   - åº”æ˜¾ç¤ºï¼š`â„¹ï¸ å·²è‡ªåŠ¨å‰”é™¤å’–å•¡æ¸ é“æ•°æ® XXX è¡Œ`
   - æ£€æŸ¥é«˜é¢‘å•†å“ç»„åˆTOP20æ˜¯å¦è¿˜æœ‰å’–å•¡å•†å“

### é¢„æœŸç»“æœ

**ä¼˜åŒ–å‰**ï¼š
```
é«˜é¢‘å•†å“ç»„åˆTOP20:
1. ç‘å¹¸å’–å•¡(å¤§æ¯) + å°è›‹ç³• - å‡ºç°258æ¬¡
2. æ˜Ÿå·´å…‹ç¾å¼ + é©¬å¡é¾™ - å‡ºç°187æ¬¡
3. å¯å£å¯ä¹ + è–¯ç‰‡ - å‡ºç°156æ¬¡
...
```

**ä¼˜åŒ–å**ï¼š
```
é«˜é¢‘å•†å“ç»„åˆTOP20:
1. å¯å£å¯ä¹ + è–¯ç‰‡ - å‡ºç°156æ¬¡
2. ç‰›å¥¶ + é¢åŒ… - å‡ºç°142æ¬¡
3. é…¸å¥¶ + æ°´æœ - å‡ºç°128æ¬¡
...
ï¼ˆå’–å•¡ç›¸å…³ç»„åˆå·²å…¨éƒ¨å‰”é™¤ï¼‰
```

## ğŸ”§ æ•°æ®ç»Ÿè®¡

### å…¸å‹æ•°æ®é›†åˆ†æ

**ç¤ºä¾‹æ•°æ®**ï¼š2025-09-01 è‡³ 2025-09-30 è®¢å•æ•°æ®

**åŸå§‹æ•°æ®**ï¼š
```
æ€»è¡Œæ•°: 24,936 è¡Œ
æ€»è®¢å•æ•°: 6,297 ä¸ª
```

**è€—æè¿‡æ»¤å**ï¼š
```
å‰”é™¤è€—æ: 6,025 è¡Œ
å‰©ä½™: 18,911 è¡Œ
```

**å’–å•¡æ¸ é“è¿‡æ»¤å**ï¼ˆå‡è®¾ï¼‰ï¼š
```
å‰”é™¤å’–å•¡: ~3,500 è¡Œï¼ˆä¼°è®¡15-20%ï¼‰
å‰©ä½™: ~15,400 è¡Œ
ä¿ç•™è®¢å•: ~5,400 ä¸ª
```

### æ¸ é“åˆ†å¸ƒåˆ†æ

**è¿‡æ»¤å‰æ¸ é“åˆ†å¸ƒ**ï¼ˆç¤ºä¾‹ï¼‰ï¼š
```
æ¸ é“          è®¢å•æ•°    å æ¯”
ç¾å›¢          3,200    50.8%
é¥¿äº†ä¹ˆ        2,100    33.4%
é¥¿äº†ä¹ˆå’–å•¡      650    10.3%
ç¾å›¢å’–å•¡        347     5.5%
```

**è¿‡æ»¤åæ¸ é“åˆ†å¸ƒ**ï¼š
```
æ¸ é“          è®¢å•æ•°    å æ¯”
ç¾å›¢          3,200    60.4%
é¥¿äº†ä¹ˆ        2,100    39.6%
```

## ğŸ“ ä¸šåŠ¡å½±å“åˆ†æ

### 1. é«˜é¢‘å•†å“ç»„åˆæ›´å‡†ç¡®

**ä¼˜åŒ–å‰é—®é¢˜**ï¼š
- å’–å•¡å•†å“ç»„åˆå æ®TOP20çš„30-40%
- æ··æ·†é›¶å”®ä¸šåŠ¡çš„çœŸå®ç»„åˆæ¨¡å¼
- å¥—é¤è®¾è®¡å»ºè®®ä¸é€‚ç”¨äºé›¶å”®ä¸šåŠ¡

**ä¼˜åŒ–åæ•ˆæœ**ï¼š
- TOP20å…¨éƒ¨ä¸ºé›¶å”®å•†å“ç»„åˆ
- å¯ç›´æ¥ç”¨äºé›¶å”®å¥—é¤è®¾è®¡
- æ»¡å‡ç­–ç•¥æ›´è´´åˆé›¶å”®ä¸šåŠ¡

### 2. å®¢å•ä»·åˆ†ææ›´ç²¾å‡†

**å’–å•¡ä¸šåŠ¡ç‰¹ç‚¹**ï¼š
- å®¢å•ä»·è¾ƒé«˜ï¼ˆÂ¥25-40ï¼‰
- ä»¥å•å“è®¢å•ä¸ºä¸»ï¼ˆå’–å•¡+ç”œç‚¹ï¼‰
- å•†å“æ•°é‡å°‘ï¼ˆ1-2ä¸ªï¼‰

**é›¶å”®ä¸šåŠ¡ç‰¹ç‚¹**ï¼š
- å®¢å•ä»·ä¸­ç­‰ï¼ˆÂ¥20-30ï¼‰
- å¤šå•†å“è®¢å•è¾ƒå¤š
- å•†å“æ•°é‡å¤šæ ·ï¼ˆ1-10ä¸ªï¼‰

**å½±å“**ï¼š
- å‰”é™¤å’–å•¡æ•°æ®åï¼Œç»Ÿè®¡æ¨¡å‹æ›´å‡†ç¡®
- å®¢å•ä»·-å•†å“æ•°é‡å…³ç³»æ›´æ¸…æ™°
- ä¼˜åŒ–å»ºè®®æ›´é€‚ç”¨

### 3. åœºæ™¯è¥é”€æ›´èšç„¦

**æ—¶æ®µåˆ†æ**ï¼š
- å’–å•¡ä¸šåŠ¡ï¼šæ—©æ™¨ã€ä¸‹åˆèŒ¶æ—¶æ®µä¸ºä¸»
- é›¶å”®ä¸šåŠ¡ï¼šå…¨å¤©å‡åŒ€åˆ†å¸ƒï¼Œæ™šé—´é«˜å³°

**ä»·æ ¼ç­–ç•¥**ï¼š
- å’–å•¡ä¸šåŠ¡ï¼šä»·æ ¼ç›¸å¯¹å›ºå®šï¼Œå“ç‰Œæº¢ä»·é«˜
- é›¶å”®ä¸šåŠ¡ï¼šä»·æ ¼æ•æ„Ÿåº¦é«˜ï¼Œä¿ƒé”€æ•ˆæœæ˜æ˜¾

**å•†å“ç»„åˆ**ï¼š
- å’–å•¡ä¸šåŠ¡ï¼šå’–å•¡+ç”œç‚¹å›ºå®šæ­é…
- é›¶å”®ä¸šåŠ¡ï¼šå¤šæ ·åŒ–ç»„åˆï¼Œçµæ´»æ­é…

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®å®Œæ•´æ€§

**æ£€æŸ¥ç‚¹**ï¼š
- ç¡®ä¿æ•°æ®åŒ…å«"æ¸ é“"å­—æ®µ
- æ¸ é“åç§°å‡†ç¡®åŒ¹é…ï¼ˆ'é¥¿äº†ä¹ˆå’–å•¡'ã€'ç¾å›¢å’–å•¡'ï¼‰
- å¤§å°å†™æ•æ„Ÿ

**ç‰¹æ®Šæƒ…å†µ**ï¼š
- å¦‚æœæ•°æ®ä¸­æ— "æ¸ é“"å­—æ®µï¼Œç³»ç»Ÿä¼šè·³è¿‡è¿‡æ»¤
- ä¼šæ˜¾ç¤ºæç¤ºä¿¡æ¯ï¼š"æ•°æ®ä¸­æ— æ¸ é“å­—æ®µï¼Œè·³è¿‡è¿‡æ»¤"

### 2. å…¶ä»–ä¸šåŠ¡æ¸ é“

**å½“å‰è¿‡æ»¤**ï¼š
```python
exclude_channels = ['é¥¿äº†ä¹ˆå’–å•¡', 'ç¾å›¢å’–å•¡']
```

**æœªæ¥æ‰©å±•**ï¼š
å¦‚æœè¿˜æœ‰å…¶ä»–éé›¶å”®ä¸šåŠ¡æ¸ é“ï¼ˆå¦‚å¤–å–é²œèŠ±ã€è›‹ç³•é¢„å®šç­‰ï¼‰ï¼Œå¯ä»¥æ·»åŠ åˆ°è¿‡æ»¤åˆ—è¡¨ï¼š
```python
exclude_channels = [
    'é¥¿äº†ä¹ˆå’–å•¡', 'ç¾å›¢å’–å•¡',  # å’–å•¡ä¸šåŠ¡
    'ç¾å›¢é²œèŠ±', 'é¥¿äº†ä¹ˆé²œèŠ±',  # é²œèŠ±ä¸šåŠ¡ï¼ˆç¤ºä¾‹ï¼‰
    'è›‹ç³•é¢„å®š',               # è›‹ç³•é¢„å®šï¼ˆç¤ºä¾‹ï¼‰
]
```

### 3. æ¸ é“åç§°å˜åŒ–

å¦‚æœå¹³å°æ›´æ–°æ¸ é“åç§°ï¼Œéœ€è¦åŒæ­¥æ›´æ–°è¿‡æ»¤åˆ—è¡¨ã€‚

**å»ºè®®**ï¼š
- å®šæœŸæ£€æŸ¥æ•°æ®ä¸­çš„æ¸ é“åˆ†å¸ƒ
- ä½¿ç”¨æ¸ é“åˆ†æåŠŸèƒ½æŸ¥çœ‹æ‰€æœ‰æ¸ é“
- åŠæ—¶æ›´æ–°è¿‡æ»¤è§„åˆ™

## ğŸ”„ æ›´æ–°è®°å½•

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-10-15

**æ›´æ–°å†…å®¹**ï¼š
1. âœ… åœ¨`preprocess_order_data()`æ·»åŠ å’–å•¡æ¸ é“è¿‡æ»¤
2. âœ… åœ¨`display_scenario_marketing_dashboard()`æ·»åŠ å’–å•¡æ¸ é“è¿‡æ»¤
3. âœ… åœ¨`å¤šå•†å“è®¢å•å¼•å¯¼åˆ†æçœ‹æ¿.py`æ–°å¢`filter_retail_data()`å‡½æ•°
4. âœ… åœ¨ä¸»çœ‹æ¿é›†æˆéƒ¨åˆ†è°ƒç”¨è¿‡æ»¤å‡½æ•°
5. âœ… æ·»åŠ ç”¨æˆ·æç¤ºä¿¡æ¯ï¼ˆå‰”é™¤è¡Œæ•°ã€å æ¯”ï¼‰
6. âœ… æ·»åŠ ç»ˆç«¯æ—¥å¿—è¾“å‡ºï¼ˆä¾¿äºè°ƒè¯•ï¼‰

**å½±å“æ¨¡å—**ï¼š
- âœ… è®¢å•æ•°æ®åˆ†æ
- âœ… åœºæ™¯è¥é”€åˆ†æ
- âœ… å¤šå•†å“è®¢å•å¼•å¯¼åˆ†æ
- âœ… é—®é¢˜è¯Šæ–­ä¸­å¿ƒï¼ˆé—´æ¥ï¼Œä½¿ç”¨é¢„å¤„ç†åçš„æ•°æ®ï¼‰

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `å¤šå•†å“è®¢å•å¼•å¯¼åˆ†æ_ä½¿ç”¨æŒ‡å—.md` - ä½¿ç”¨è¯¦ç»†è¯´æ˜
- `å®¢å•ä»·ä¼˜åŒ–å®Œæ•´æ–¹æ¡ˆæ€»ç»“.md` - æ•´ä½“ä¼˜åŒ–æ–¹æ¡ˆ
- `è®¢å•æ•°æ®ä¸šåŠ¡é€»è¾‘ç¡®è®¤.md` - ä¸šåŠ¡é€»è¾‘æ ‡å‡†

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **é¦–æ¬¡ä½¿ç”¨**ï¼š
   - ä¸Šä¼ æ•°æ®åæŸ¥çœ‹è¿‡æ»¤æç¤º
   - ç¡®è®¤å‰”é™¤çš„æ•°æ®é‡åˆç†
   - å¯¹æ¯”è¿‡æ»¤å‰åçš„åˆ†æç»“æœ

2. **æ—¥å¸¸ä½¿ç”¨**ï¼š
   - ç³»ç»Ÿè‡ªåŠ¨è¿‡æ»¤ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
   - å…³æ³¨è¿‡æ»¤æç¤ºï¼Œç¡®ä¿æ•°æ®å‡†ç¡®
   - å¦‚æœ‰ç–‘é—®æŸ¥çœ‹ç»ˆç«¯æ—¥å¿—

3. **æ•°æ®å®¡æŸ¥**ï¼š
   - å®šæœŸæ£€æŸ¥æ¸ é“åˆ†å¸ƒ
   - ç¡®è®¤è¿‡æ»¤è§„åˆ™æ˜¯å¦å®Œæ•´
   - åŠæ—¶æ›´æ–°æ’é™¤åˆ—è¡¨

---

**æŠ€æœ¯æ”¯æŒ**: AI Assistant  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-15
