# 场景营销智能决策引擎 - 安装与使用指南

## 📦 依赖安装

### 必需依赖

场景营销智能决策引擎需要以下Python库：

```bash
# 进入虚拟环境
cd "d:\Python1\O2O_Analysis\O2O数据分析"
.\.venv\Scripts\Activate.ps1

# 安装核心依赖
pip install pandas numpy scikit-learn plotly

# 安装FP-Growth关联规则挖掘库
pip install mlxtend

# 安装XGBoost（可选，如无法安装会自动使用RandomForest替代）
pip install xgboost
```

### 依赖说明

| 库名 | 用途 | 必需性 |
|------|------|--------|
| pandas | 数据处理 | ✅ 必需 |
| numpy | 数值计算 | ✅ 必需 |
| scikit-learn | 机器学习模型 | ✅ 必需 |
| plotly | 数据可视化 | ✅ 必需 |
| mlxtend | FP-Growth算法 | ✅ 必需 |
| xgboost | 梯度提升模型 | ⚠️ 可选 |

## 🚀 快速开始

### 1. 测试安装

```bash
# 运行测试脚本
cd "d:\Python1\O2O_Analysis\O2O数据分析\测算模型"
..\.venv\Scripts\python.exe test_scene_intelligence.py
```

### 2. 启动可视化看板

```bash
# 启动Streamlit看板
cd "d:\Python1\O2O_Analysis\O2O数据分析\测算模型"
..\.venv\Scripts\streamlit.exe run 智能门店经营看板_可视化.py --server.port 8502
```

### 3. 使用场景营销功能

在看板中进入"场景营销"模块，你会看到4个子场景：

#### 📅 时段场景营销
- **功能**: 分析不同时段的销售特征
- **AI增强**: 
  - 🤖 XGBoost场景识别模型
  - 自动识别：上午提神/下午茶歇/晚间放松/深夜应急
  - 特征重要性分析
  - 场景概率预测

#### 📍 地点场景营销
- **功能**: 配送距离与成本分析
- **洞察**: 
  - 配送费成本计算
  - 距离分段分析
  - 商圈营销策略

#### 💰 价格敏感营销
- **功能**: 客单价分层与满减策略
- **AI增强**:
  - 🤖 RFM客户分群模型
  - 识别4类用户：高频应急、计划囤货、价格敏感、偶发尝鲜
  - 3D可视化客户分布
  - 差异化营销策略

#### 📦 产品组合营销
- **功能**: 商品组合与交叉销售
- **AI增强**:
  - 🤖 FP-Growth关联规则挖掘
  - 自动发现商品组合（追剧套餐、提神套餐等）
  - 关联规则网络图
  - 场景化套餐建议

## 🔧 模型使用说明

### FP-Growth商品组合挖掘

```python
from 场景营销智能决策引擎 import ProductCombinationMiner

# 初始化
miner = ProductCombinationMiner(
    min_support=0.01,      # 最小支持度1%
    min_confidence=0.3     # 最小置信度30%
)

# 挖掘关联规则
result = miner.mine_from_orders(order_data)

# 获取TOP规则
top_rules = miner.get_top_rules(top_n=10, sort_by='lift')

# 获取场景化套餐
scene_packages = result['scene_packages']
```

**输出指标**:
- **支持度**: 商品组合在所有订单中出现的频率
- **置信度**: 购买前项后购买后项的概率
- **提升度**: 相比随机情况的推荐效果（>1表示正相关）

### XGBoost场景识别模型

```python
from 场景营销智能决策引擎 import SceneRecognitionModel

# 初始化
model = SceneRecognitionModel()

# 训练模型
train_result = model.train(order_data)

# 预测场景
predictions = model.predict_scene(new_order_data)

# 场景分类：
# - 上午提神 (6-12点)
# - 下午茶歇 (14-18点)
# - 晚间放松 (18-22点)
# - 深夜应急 (22-6点)
```

**特征工程**:
- 时段特征 (hour, weekday)
- 配送距离 (distance)
- 订单结构 (商品数, 订单金额)
- 配送费占比 (delivery_fee_ratio)

### RFM客户分群模型

```python
from 场景营销智能决策引擎 import RFMCustomerSegmentation

# 初始化
rfm_model = RFMCustomerSegmentation(n_clusters=4)

# 计算RFM特征
rfm_data = rfm_model.calculate_rfm(order_data)

# 客户分群
segment_result = rfm_model.segment_customers()

# 获取群组摘要
summary = rfm_model.get_cluster_summary()
```

**客户群组**:
- **高频应急用户**: 高频+高配送费，重视速度
- **计划囤货用户**: 低频+高客单，重视性价比
- **价格敏感用户**: 高频+低客单，优惠驱动
- **偶发尝鲜用户**: 低频+低客单，需要激活

### 统一智能引擎

```python
from 场景营销智能决策引擎 import SceneMarketingIntelligence

# 一键运行所有分析
engine = SceneMarketingIntelligence()
results = engine.run_full_analysis(order_data)

# 生成报告
report = engine.get_summary_report()
print(report)
```

## 📊 在Streamlit看板中使用

### 1. 上传数据
- 在侧边栏选择"订单数据分析"模式
- 上传包含订单明细的Excel文件

### 2. 选择场景营销模块
- 点击"场景营销看板"标签
- 选择时段/地点/价格/产品组合场景

### 3. 运行AI分析
- 点击"🚀 开始智能分析"按钮
- 等待模型训练（首次约30秒）
- 查看分析结果和可视化

### 4. 查看结果
- **关联规则**: TOP规则、场景套餐、网络图
- **场景识别**: 模型性能、场景预测、特征重要性
- **客户分群**: 群组画像、3D可视化、策略建议

## 🎯 实战应用场景

### 场景1: 设计场景化套餐

**问题**: 如何设计"追剧套餐"、"提神套餐"？

**解决方案**:
1. 使用FP-Growth挖掘高频商品组合
2. 查看场景化套餐建议
3. 选择支持度>2%、置信度>50%的组合
4. 设计套餐价格（略低于单品总价）

**示例**:
```
追剧套餐发现：
- 薯片 + 可乐 (支持度3.5%, 置信度65%, 提升度2.1x)
- 推荐价格: ¥15 (单买¥18)
- 预期提升客单价15%
```

### 场景2: 识别订单场景特征

**问题**: 晚上23点的订单和下午15点的订单有什么不同？

**解决方案**:
1. 使用XGBoost场景识别模型训练
2. 查看特征重要性（时段、距离、配送费占比）
3. 对比不同场景的商品偏好
4. 制定差异化推送策略

**示例**:
```
深夜应急场景特征：
- 配送费占比高（>15%）
- 配送距离远（>3km）
- 商品数少（1-2件）
- 典型商品：纸巾、泡面、电池
- 策略：保证库存、合理溢价、快速配送
```

### 场景3: 精准客户营销

**问题**: 如何针对不同客户群体制定营销策略？

**解决方案**:
1. 使用RFM模型自动分群
2. 查看各群组特征画像
3. 针对性制定营销策略
4. 监控分群效果

**示例**:
```
高频应急用户（占比25%）：
- 平均频次: 15次/月
- 配送费占比: 18%
- 距离: 3.5km
- 策略: VIP加急服务、应急品保障、会员专享
```

## 🔍 常见问题

### Q1: 为什么FP-Growth挖掘不到规则？

**A**: 可能是支持度阈值太高，建议：
- 降低min_support（如0.005）
- 确保有足够的多商品订单（至少100单）
- 检查数据中是否包含'订单ID'和'商品名称'列

### Q2: XGBoost场景识别准确率低怎么办？

**A**: 可能需要：
- 增加训练数据量（建议1000+订单）
- 检查场景标注规则是否合理
- 调整特征工程（添加更多场景特征）
- 使用RandomForest替代（自动降级）

### Q3: RFM分群质量不高（轮廓系数<0.3）？

**A**: 建议：
- 调整聚类数量（试试3-6个簇）
- 确保数据中有足够的用户多样性
- 添加更多RFM相关特征
- 检查异常值并清洗

### Q4: 模型训练很慢怎么办？

**A**: 优化建议：
- 使用数据抽样（如最近3个月）
- 减少特征数量
- 降低模型复杂度（树深度、迭代次数）
- 使用session_state缓存已训练模型

## 📈 性能建议

### 数据量建议
- **最小数据量**: 100个订单（基础分析）
- **推荐数据量**: 1000+订单（可靠分析）
- **最佳数据量**: 5000+订单（完整分析）

### 运行时间预估
- FP-Growth挖掘: 5-30秒（取决于订单数）
- XGBoost训练: 10-60秒
- RFM分群: 5-20秒
- 完整分析: 30-120秒

### 缓存策略
- 模型保存在st.session_state中
- 切换时间维度不会重新训练
- 上传新数据会清空缓存

## 🆘 技术支持

如遇问题，请检查：
1. ✅ 依赖库是否全部安装
2. ✅ 数据格式是否符合要求
3. ✅ Python版本>=3.8
4. ✅ 虚拟环境是否正确激活

## 📝 更新日志

### v1.0 (2025-10-14)
- ✅ FP-Growth商品组合挖掘
- ✅ XGBoost场景识别模型
- ✅ RFM客户分群模型
- ✅ 决策树规则生成
- ✅ Streamlit看板集成
- ✅ 完整文档与测试

---

**开发**: AI Assistant  
**日期**: 2025-10-14  
**版本**: 1.0.0
