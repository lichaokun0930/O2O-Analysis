# 时段与场景业务设计文档

## 📋 设计理念

基于用户深刻的业务理解，我们采用**双层架构**设计：

1. **时段（Time Slot）**：客观的时间划分，自动生成
2. **场景（Scene）**：主观的行为标签，业务定义

---

## ⏰ 时段划分方案（8时段）

### 完整时段定义

| 时段名称 | 时间范围 | 典型场景 | 用户行为特征 | 业务价值 |
|---------|---------|---------|-------------|---------|
| **清晨** | 6-9点 | 出行/整理/早餐 | ⏱️ 赶时间、快节奏 | 快餐、便携食品、应急商品 |
| **上午** | 9-12点 | 办公/居家/日用补充 | 💼 工作或家务时段 | 零食、饮品、日用品 |
| **正午** | 12-14点 | 午餐 | 🍱 午餐刚需高峰 | 正餐、快餐、外卖 |
| **下午** | 14-18点 | 工作/家务/亲子/小憩/下午茶 | ☕ 多元化需求 | 下午茶、零食、饮品、儿童食品 |
| **傍晚** | 18-21点 | 下班/归家/晚餐/路途 | 🏠 通勤与晚餐叠加 | 正餐、熟食、半成品 |
| **晚间** | 21-24点 | 居家/夜生活前 | 🌙 放松与社交 | 零食、饮品、娱乐食品 |
| **深夜** | 0-3点 | 突发/急用/夜宵 | 🌃 应急与夜宵需求 | 夜宵、应急商品、即食品 |
| **凌晨** | 3-6点 | 万籁俱寂/熬夜党 | 😴 极低频特殊场景 | 应急商品、特殊人群需求 |

### 时段划分的逻辑优化

与传统7时段相比的改进：

**原方案（7时段）**：
```
早上(6-10) → 上午(10-12) → 午餐(12-14) → 下午(14-17) 
→ 晚餐(17-20) → 夜间(20-23) → 深夜(23-6)
```

**新方案（8时段）**：
```
清晨(6-9) → 上午(9-12) → 正午(12-14) → 下午(14-18) 
→ 傍晚(18-21) → 晚间(21-24) → 深夜(0-3) → 凌晨(3-6)
```

**优化点**：

1. ✅ **6-9点 vs 6-10点**：
   - 9点是上班分界线，更符合作息规律
   - 避免8-9点的"早高峰尾声"被分散

2. ✅ **正午(12-14) vs 午餐(12-14)**：
   - "正午"更中性，包含非餐饮需求
   - "午餐"过于局限在餐饮场景

3. ✅ **14-18点 vs 14-17点**：
   - 18点是下班时间，17-18点应归入下午
   - 避免将"下班前一小时"误归为晚餐时段

4. ✅ **傍晚(18-21) vs 晚餐(17-20)**：
   - "傍晚"包含下班、通勤、晚餐多重场景
   - 21点是更自然的晚间分界线

5. ✅ **晚间(21-24) vs 夜间(20-23)**：
   - "晚间"更温和，符合居家放松氛围
   - 24点是自然的日期分界线

6. ✅ **深夜(0-3) + 凌晨(3-6)**：
   - 拆分原"深夜(23-6)"的7小时超长时段
   - 凌晨3-6点订单极少，单独标记便于分析异常

---

## 🎭 场景分类方案

### 场景的三个维度

场景是比时段更细粒度的业务标签，我们建议从三个维度定义：

#### 维度1：餐饮场景（Meal Scene）

| 场景名称 | 典型时段 | 商品类型 | 业务特征 |
|---------|---------|---------|---------|
| 早餐 | 清晨 | 豆浆、油条、包子、粥 | 快速、便携、低价 |
| 午餐 | 正午 | 盖浇饭、快餐、便当 | 刚需、足量、性价比 |
| 晚餐 | 傍晚 | 正餐、熟食、半成品 | 多样化、家庭装、品质 |
| 夜宵 | 深夜 | 烧烤、泡面、小吃 | 应急、即食、重口味 |
| 下午茶 | 下午 | 奶茶、甜品、零食 | 休闲、小份、高毛利 |

#### 维度2：活动场景（Activity Scene）

| 场景名称 | 典型时段 | 用户行为 | 商品特征 |
|---------|---------|---------|---------|
| 办公 | 上午/下午 | 工作间隙补充能量 | 小包装、易携带 |
| 居家 | 晚间 | 家庭消费、休闲 | 家庭装、多规格 |
| 出行 | 清晨/傍晚 | 通勤路上、旅途 | 便携、即食 |
| 应急 | 深夜/凌晨 | 突发需求、救急 | 刚需、小包装 |
| 聚餐 | 傍晚/晚间 | 社交、庆祝 | 大份、组合装 |
| 亲子 | 下午/傍晚 | 陪伴孩子 | 儿童食品、健康 |

#### 维度3：渠道场景（Channel Scene）

| 场景名称 | 订单特征 | 配送方式 | 价格敏感度 |
|---------|---------|---------|-----------|
| 堂食 | 店内消费 | 无需配送 | 中等 |
| 外卖 | 线上下单 | 配送上门 | 较高 |
| 自提 | 线上下单 | 到店自取 | 较低 |
| 团购 | 批量订单 | 集中配送 | 低（追求优惠） |

---

## 🔄 时段与场景的关系

### 一对多映射关系

一个**时段**可以包含多个**场景**：

```
清晨(6-9点)
  ├─ 早餐（豆浆油条）
  ├─ 出行（便携食品）
  └─ 应急（忘带午餐的补充）

傍晚(18-21点)
  ├─ 晚餐（正餐）
  ├─ 出行（下班路上）
  ├─ 聚餐（朋友聚会）
  └─ 亲子（接孩子后购物）
```

### 场景可以跨时段

一个**场景**可以出现在多个**时段**：

```
应急场景
  ├─ 清晨：忘带早餐
  ├─ 上午：办公室突然加班
  ├─ 深夜：加班到很晚
  └─ 凌晨：夜班工作者

外卖场景
  ├─ 正午：午餐外卖
  ├─ 傍晚：晚餐外卖
  └─ 深夜：夜宵外卖
```

---

## 💾 数据结构设计

### 推荐的Excel数据格式

| 订单ID | 下单时间 | 商品名称 | 时段 | 场景 | 渠道 |
|--------|---------|---------|------|------|------|
| 001 | 2025-10-16 08:30 | 豆浆油条 | 清晨 | 早餐 | 自提 |
| 002 | 2025-10-16 12:30 | 盖浇饭 | 正午 | 午餐 | 外卖 |
| 003 | 2025-10-16 15:00 | 奶茶 | 下午 | 下午茶 | 堂食 |
| 004 | 2025-10-16 19:00 | 汉堡套餐 | 傍晚 | 晚餐 | 外卖 |
| 005 | 2025-10-16 22:00 | 薯片可乐 | 晚间 | 居家 | 自提 |
| 006 | 2025-10-17 01:30 | 泡面 | 深夜 | 夜宵 | 堂食 |

**字段说明**：
- **时段**：系统自动从"下单时间"生成，无需手动填写
- **场景**：需要业务团队根据订单特征手动标注
- **渠道**：可选字段，用于渠道分析

---

## 📊 筛选器使用场景

### 场景1：只使用时段筛选

**适用情况**：
- 分析时间分布规律
- 对比不同时段的销量
- 优化营业时间

**示例**：
```
时段筛选：傍晚(18-21点)
场景筛选：（不选）

分析目标：傍晚时段哪些商品销量下滑？
结果：发现"汉堡"在傍晚时段从周均120单降到80单
```

### 场景2：时段 + 场景双重筛选

**适用情况**：
- 精准定位特定业务场景
- 分析细分市场
- 优化商品组合

**示例1：餐饮场景分析**
```
时段筛选：正午(12-14点)
场景筛选：午餐

分析目标：午餐时段的竞争力如何？
结果：发现快餐类商品被竞品抢走市场
```

**示例2：渠道场景分析**
```
时段筛选：深夜(0-3点)
场景筛选：外卖

分析目标：深夜外卖的盈利性如何？
结果：订单少但客单价高，配送成本偏高
```

### 场景3：只使用场景筛选

**适用情况**：
- 分析某个场景在全天的表现
- 不限定时间的场景分析

**示例**：
```
时段筛选：（不选）
场景筛选：应急

分析目标：应急需求的商品有哪些？
结果：发现应急场景在深夜和清晨都有需求，商品重合度高
```

---

## 🎯 业务应用建议

### 应用1：时段营销策略

根据时段特征制定促销活动：

| 时段 | 营销策略 | 推荐商品 |
|------|---------|---------|
| 清晨 | "早餐组合优惠" | 豆浆+油条套餐 |
| 上午 | "工作能量补充" | 咖啡+零食组合 |
| 正午 | "午餐快抢" | 限时快餐折扣 |
| 下午 | "下午茶时光" | 奶茶+甜品优惠 |
| 傍晚 | "晚餐优惠券" | 正餐类折扣 |
| 晚间 | "夜间小食" | 零食买一送一 |
| 深夜 | "夜宵专享" | 夜宵类特价 |

### 应用2：场景化商品组合

根据场景设计商品搭配：

**早餐场景**：
- 基础款：豆浆 + 油条
- 营养款：牛奶 + 面包 + 鸡蛋
- 快捷款：手抓饼 + 咖啡

**办公场景**：
- 提神款：咖啡 + 坚果
- 充饥款：面包 + 酸奶
- 社交款：零食拼盘（办公室分享）

**应急场景**：
- 速食款：泡面 + 火腿肠
- 补充款：面包 + 牛奶
- 临时餐：便当 + 饮料

### 应用3：库存优化

根据时段和场景优化库存：

```
早餐商品（豆浆、油条）
  └─ 清晨时段备货充足
  └─ 正午后减少备货

夜宵商品（烧烤、泡面）
  └─ 傍晚开始备货
  └─ 深夜保持库存
  └─ 清晨清仓处理
```

---

## 🔧 系统实现细节

### 自动时段生成

系统会自动从"下单时间"字段提取小时数，映射到8个时段：

```python
hour = 订单时间.hour

if 6 <= hour < 9:
    时段 = "清晨(6-9点)"
elif 9 <= hour < 12:
    时段 = "上午(9-12点)"
elif 12 <= hour < 14:
    时段 = "正午(12-14点)"
elif 14 <= hour < 18:
    时段 = "下午(14-18点)"
elif 18 <= hour < 21:
    时段 = "傍晚(18-21点)"
elif 21 <= hour < 24:
    时段 = "晚间(21-24点)"
elif 0 <= hour < 3:
    时段 = "深夜(0-3点)"
else:  # 3-6点
    时段 = "凌晨(3-6点)"
```

### 场景字段标注建议

**方法1：基于商品名称规则**
```
商品名称包含"豆浆/油条/包子" → 场景=早餐
商品名称包含"盖浇饭/快餐/便当" → 场景=午餐
商品名称包含"奶茶/甜品/蛋糕" → 场景=下午茶
```

**方法2：基于时段推断**
```
时段=清晨 且 商品类型=餐饮 → 场景=早餐
时段=正午 且 商品类型=餐饮 → 场景=午餐
时段=深夜 且 商品类型=餐饮 → 场景=夜宵
```

**方法3：人工标注**
- 最准确但工作量大
- 适用于精细化运营
- 建议先标注TOP商品

---

## 📈 数据分析示例

### 示例1：发现时段机会

**问题**：哪个时段的销量下滑最严重？

**分析步骤**：
1. 选择"对比周期"：按周对比
2. 时段筛选：逐个选择各时段
3. 查看"销量下滑商品诊断"

**发现**：
- 傍晚时段销量下滑15%
- 主要是晚餐类商品被竞品抢走
- 需要加强傍晚时段的促销力度

### 示例2：场景化商品优化

**问题**：下午茶场景的竞争力如何？

**分析步骤**：
1. 时段筛选：下午(14-18点)
2. 场景筛选：下午茶
3. 查看销量变化

**发现**：
- 奶茶销量稳定
- 甜品销量下滑30%
- 需要优化甜品SKU或推出新品

### 示例3：异常时段分析

**问题**：凌晨时段有订单吗？

**分析步骤**：
1. 时段筛选：凌晨(3-6点)
2. 查看订单量和商品分布

**可能发现**：
- 订单极少（<1%）
- 多为应急需求（药品、卫生用品）
- 建议：保留24小时营业或调整为营业到凌晨3点

---

## ✅ 总结

### 核心理念

1. **时段是客观的**：基于时间自动生成，无需人工介入
2. **场景是主观的**：基于业务理解手动标注，灵活可调
3. **双层架构**：时段提供时间维度，场景提供行为维度
4. **可独立使用**：时段筛选足以满足大部分分析需求

### 使用建议

- **初期**：只使用时段筛选，快速发现时间规律
- **进阶**：添加场景字段，实现精准分析
- **高级**：结合渠道、商品类别等多维度交叉分析

### 优化空间

- 可根据实际订单数据调整时段边界
- 可根据业务发展添加新的场景标签
- 可基于机器学习自动推断部分场景

---

## 📞 技术支持

如需调整时段划分规则或场景分类方案，请参考：
- 代码文件：`智能门店经营看板_可视化.py` 第7800-7850行
- 功能位置：问题诊断模块 → 时段自动生成
