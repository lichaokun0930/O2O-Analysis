#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
å•†å“åœºæ™¯æ™ºèƒ½æ‰“æ ‡å¼•æ“
================================================================================
ä¸ºå•†å“æ‰“ä¸Šå¤šç»´åº¦åœºæ™¯æ ‡ç­¾,åˆ†æè´­ä¹°é©±åŠ¨å’Œå†³ç­–å› ç´ 

æ ¸å¿ƒåŠŸèƒ½:
1. å¤šç»´åº¦åœºæ™¯è¯†åˆ« - åŸºç¡€åœºæ™¯ã€å­£èŠ‚åœºæ™¯ã€èŠ‚å‡æ—¥åœºæ™¯ã€å¤©æ°”åœºæ™¯
2. å•†å“åœºæ™¯é€‚é…æ€§åˆ†æ - åˆ†æå•†å“åœ¨å„åœºæ™¯ä¸‹çš„è¡¨ç°
3. è´­ä¹°é©±åŠ¨åˆ†æ - è¯†åˆ«ä¿ƒä½¿è´­ä¹°çš„æ ¸å¿ƒå› ç´ 
4. ä¸‹å•å†³ç­–åˆ†æ - åˆ†æç”¨æˆ·å†³ç­–è·¯å¾„å’Œå½±å“å› ç´ 

ä½œè€…: AI Assistant
æ—¥æœŸ: 2025-10-26
"""

import pandas as pd
import numpy as np
from datetime import datetime
from typing import Dict, List, Tuple
import warnings
warnings.filterwarnings('ignore')


# ================================================================================
# 1. æ‰©å±•åœºæ™¯ç»´åº¦å®šä¹‰
# ================================================================================

class SceneDimensions:
    """å¤šç»´åº¦åœºæ™¯å®šä¹‰"""
    
    # åŸºç¡€æ—¶æ®µåœºæ™¯ (åŸæœ‰)
    BASE_SCENES = {
        'æ—©é¤': ['è±†æµ†', 'æ²¹æ¡', 'åŒ…å­', 'ç²¥', 'ç…é¥¼', 'é¸¡è›‹', 'é¢åŒ…', 'ç‰›å¥¶', 'ç‡•éº¦'],
        'åˆé¤': ['ä¾¿å½“', 'ç›’é¥­', 'å¥—é¤', 'ç‚’é¥­', 'ç‚’é¢', 'æ‹‰é¢', 'ç±³é¥­'],
        'æ™šé¤': ['æ™šé¥­', 'ç‚’èœ', 'çƒ§çƒ¤'],
        'å¤œå®µ': ['å®µå¤œ', 'ä¸²ä¸²', 'å°é¾™è™¾', 'å•¤é…’'],
        'ä¸‹åˆèŒ¶': ['å’–å•¡', 'å¥¶èŒ¶', 'è›‹ç³•', 'ç”œå“', 'å†°æ·‡æ·‹'],
        'ä¼‘é—²é›¶é£Ÿ': ['è–¯ç‰‡', 'é¥¼å¹²', 'ç³–æœ', 'å·§å…‹åŠ›', 'åšæœ', 'æœå†»', 'ç“œå­'],
        'æ—¥ç”¨è¡¥å……': ['çº¸å·¾', 'å«ç”Ÿçº¸', 'æ´—è¡£æ¶²', 'æ´—æ´ç²¾', 'ç‰™è†', 'é¦™çš‚'],
        'åº”æ€¥è´­ä¹°': ['ç”µæ± ', 'å……ç”µå™¨', 'é›¨ä¼', 'å£ç½©', 'åˆ›å¯è´´'],
        'è¥å…»è¡¥å……': ['ç»´ç”Ÿç´ ', 'è›‹ç™½ç²‰', 'é’™ç‰‡', 'ä¿å¥å“'],
        'ç¤¾äº¤å¨±ä¹': ['çº¢é…’', 'ç™½é…’', 'é¦™çƒŸ', 'ç¤¼å“']
    }
    
    # å­£èŠ‚åœºæ™¯ (æ–°å¢)
    SEASON_SCENES = {
        'æ˜¥å­£åœºæ™¯': {
            'æ—¶é—´èŒƒå›´': '3-5æœˆ',
            'å•†å“å…³é”®è¯': ['è¸é’', 'é˜²æ™’', 'æ¶¦è‚¤', 'æ¢å­£', 'è½»é£Ÿ', 'ç»¿èŒ¶', 'èŠ±èŒ¶'],
            'ç‰¹ç‚¹': 'ä¸‡ç‰©å¤è‹,è½»è£…å‡ºè¡Œ,é‡å…»ç”Ÿ'
        },
        'å¤å­£åœºæ™¯': {
            'æ—¶é—´èŒƒå›´': '6-8æœˆ',
            'å•†å“å…³é”®è¯': ['å†°æ·‡æ·‹', 'å†·é¥®', 'é˜²æ™’éœœ', 'å‡‰å¸­', 'ç”µæ‰‡', 'è¥¿ç“œ', 'å•¤é…’', 'å†°é•‡'],
            'ç‰¹ç‚¹': 'é«˜æ¸©ç‚çƒ­,é‡æ¶ˆæš‘,æˆ·å¤–æ´»åŠ¨'
        },
        'ç§‹å­£åœºæ™¯': {
            'æ—¶é—´èŒƒå›´': '9-11æœˆ',
            'å•†å“å…³é”®è¯': ['æ¶¦ç‡¥', 'ä¿æ¹¿', 'çƒ­é¥®', 'è¡¥å“', 'æœˆé¥¼', 'å¤§é—¸èŸ¹', 'å…»ç”Ÿ'],
            'ç‰¹ç‚¹': 'å¤©æ°”å¹²ç‡¥,é‡æ»‹è¡¥,è´´ç§‹è†˜'
        },
        'å†¬å­£åœºæ™¯': {
            'æ—¶é—´èŒƒå›´': '12-2æœˆ',
            'å•†å“å…³é”®è¯': ['ä¿æš–', 'çƒ­é¥®', 'ç«é”…', 'ç¾Šè‚‰', 'æš–å®å®', 'å§œèŒ¶', 'æ»‹è¡¥'],
            'ç‰¹ç‚¹': 'å¯’å†·ä½æ¸©,é‡ä¿æš–,çƒ­é‡è¡¥å……'
        }
    }
    
    # èŠ‚å‡æ—¥åœºæ™¯ (æ–°å¢)
    HOLIDAY_SCENES = {
        'æ˜¥èŠ‚åœºæ™¯': {
            'æ—¶é—´': 'å†œå†æ­£æœˆåˆä¸€å‰å',
            'å•†å“å…³é”®è¯': ['å¹´è´§', 'ç³–æœ', 'åšæœ', 'ç¤¼ç›’', 'å¯¹è”', 'çº¢åŒ…', 'çƒŸèŠ±'],
            'è´­ä¹°é©±åŠ¨': 'å›¢åœ†èšä¼šã€èµ°äº²è®¿å‹ã€å›¤è´§',
            'å†³ç­–ç‰¹ç‚¹': 'å¤§æ‰¹é‡é‡‡è´­ã€é‡å“ç‰Œã€é‡åŒ…è£…'
        },
        'ç«¯åˆåœºæ™¯': {
            'æ—¶é—´': 'å†œå†äº”æœˆåˆäº”',
            'å•†å“å…³é”®è¯': ['ç²½å­', 'å’¸è›‹', 'é›„é»„é…’'],
            'è´­ä¹°é©±åŠ¨': 'ä¼ ç»Ÿä¹ ä¿—ã€èŠ‚æ—¥æ°›å›´',
            'å†³ç­–ç‰¹ç‚¹': 'åº”æ™¯æ¶ˆè´¹ã€ä¸´æ—¶æ€§å¼º'
        },
        'ä¸­ç§‹åœºæ™¯': {
            'æ—¶é—´': 'å†œå†å…«æœˆåäº”',
            'å•†å“å…³é”®è¯': ['æœˆé¥¼', 'å¤§é—¸èŸ¹', 'ç¤¼ç›’', 'æ°´æœ'],
            'è´­ä¹°é©±åŠ¨': 'é€ç¤¼éœ€æ±‚ã€å®¶åº­å›¢èš',
            'å†³ç­–ç‰¹ç‚¹': 'é‡åŒ…è£…ã€é‡å“ç‰Œã€ç¤¼å“å±æ€§å¼º'
        },
        'åŒ11åœºæ™¯': {
            'æ—¶é—´': '11æœˆ11æ—¥',
            'å•†å“å…³é”®è¯': ['å›¤è´§', 'ä¿ƒé”€', 'é¢„å”®'],
            'è´­ä¹°é©±åŠ¨': 'ä»·æ ¼ä¼˜æƒ ã€å›¤è´§å¿ƒç†',
            'å†³ç­–ç‰¹ç‚¹': 'å¤§æ‰¹é‡ã€ä»·æ ¼æ•æ„Ÿã€è®¡åˆ’æ€§å¼º'
        },
        '618åœºæ™¯': {
            'æ—¶é—´': '6æœˆ18æ—¥',
            'å•†å“å…³é”®è¯': ['ä¿ƒé”€', 'æ»¡å‡', 'æŠ˜æ‰£'],
            'è´­ä¹°é©±åŠ¨': 'ä»·æ ¼ä¼˜æƒ ',
            'å†³ç­–ç‰¹ç‚¹': 'ä»·æ ¼é©±åŠ¨ã€å†²åŠ¨æ¶ˆè´¹'
        },
        'å‘¨æœ«åœºæ™¯': {
            'æ—¶é—´': 'æ¯å‘¨å…­æ—¥',
            'å•†å“å…³é”®è¯': ['ä¼‘é—²', 'èšä¼š', 'å®¶åº­è£…', 'é›¶é£Ÿ', 'é¥®æ–™'],
            'è´­ä¹°é©±åŠ¨': 'å±…å®¶ä¼‘é—²ã€å®¶åº­èšä¼š',
            'å†³ç­–ç‰¹ç‚¹': 'æ‰¹é‡è´­ä¹°ã€é‡äº«å—'
        },
        'å·¥ä½œæ—¥åœºæ™¯': {
            'æ—¶é—´': 'å‘¨ä¸€è‡³å‘¨äº”',
            'å•†å“å…³é”®è¯': ['é€Ÿé£Ÿ', 'ä¾¿å½“', 'æç¥', 'åŠå…¬'],
            'è´­ä¹°é©±åŠ¨': 'å¿«é€Ÿä¾¿æ·ã€æ•ˆç‡ä¼˜å…ˆ',
            'å†³ç­–ç‰¹ç‚¹': 'å°æ‰¹é‡ã€å³æ—¶æ¶ˆè´¹'
        }
    }
    
    # å¤©æ°”åœºæ™¯ (æ–°å¢)
    WEATHER_SCENES = {
        'æ™´å¤©åœºæ™¯': {
            'å•†å“å…³é”®è¯': ['å†·é¥®', 'é˜²æ™’', 'æˆ·å¤–', 'è¿åŠ¨é¥®æ–™', 'å†°æ·‡æ·‹'],
            'è´­ä¹°é©±åŠ¨': 'å‡ºè¡Œæ„æ„¿å¼ºã€æˆ·å¤–æ´»åŠ¨',
            'å†³ç­–ç‰¹ç‚¹': 'å†²åŠ¨æ¶ˆè´¹ã€å³æ—¶éœ€æ±‚'
        },
        'é›¨å¤©åœºæ™¯': {
            'å•†å“å…³é”®è¯': ['é›¨ä¼', 'é›¨è¡£', 'çƒ­é¥®', 'æ–¹ä¾¿é¢', 'é›¶é£Ÿ', 'å¤–å–'],
            'è´­ä¹°é©±åŠ¨': 'å±…å®¶é¿é›¨ã€åº”æ€¥éœ€æ±‚',
            'å†³ç­–ç‰¹ç‚¹': 'ä¾¿åˆ©æ€§ä¼˜å…ˆã€æ‡’äººç»æµ'
        },
        'é«˜æ¸©åœºæ™¯': {
            'æ¸©åº¦é˜ˆå€¼': '>32Â°C',
            'å•†å“å…³é”®è¯': ['å†°æ·‡æ·‹', 'å†·é¥®', 'å†°é•‡', 'é˜²æš‘', 'å‡‰èŒ¶', 'è¥¿ç“œ'],
            'è´­ä¹°é©±åŠ¨': 'è§£æš‘é™æ¸©ã€èˆ’é€‚éœ€æ±‚',
            'å†³ç­–ç‰¹ç‚¹': 'å³æ—¶æ¶ˆè´¹ã€é«˜é¢‘æ¬¡'
        },
        'ä½æ¸©åœºæ™¯': {
            'æ¸©åº¦é˜ˆå€¼': '<10Â°C',
            'å•†å“å…³é”®è¯': ['çƒ­é¥®', 'å§œèŒ¶', 'ç«é”…æ–™', 'æš–å®å®', 'ä¿æ¸©æ¯'],
            'è´­ä¹°é©±åŠ¨': 'å¾¡å¯’ä¿æš–ã€çƒ­é‡è¡¥å……',
            'å†³ç­–ç‰¹ç‚¹': 'åŠŸèƒ½æ€§å¼ºã€åˆšéœ€å±æ€§'
        }
    }
    
    # ç‰¹æ®Šæ—¶æ®µåœºæ™¯ (æ–°å¢)
    SPECIAL_TIME_SCENES = {
        'å¼€å­¦å­£åœºæ™¯': {
            'æ—¶é—´': '8æœˆåº•-9æœˆåˆ',
            'å•†å“å…³é”®è¯': ['æ–‡å…·', 'ä¹¦åŒ…', 'é›¶é£Ÿ', 'é¥®æ–™', 'æ–¹ä¾¿é£Ÿå“'],
            'è´­ä¹°é©±åŠ¨': 'æ–°å­¦æœŸå‡†å¤‡ã€å­¦ç”Ÿéœ€æ±‚',
            'å†³ç­–ç‰¹ç‚¹': 'é›†ä¸­é‡‡è´­ã€åˆšéœ€'
        },
        'è€ƒè¯•å­£åœºæ™¯': {
            'æ—¶é—´': '6æœˆã€12æœˆ',
            'å•†å“å…³é”®è¯': ['æç¥', 'å’–å•¡', 'åŠŸèƒ½é¥®æ–™', 'å·§å…‹åŠ›', 'åšæœ'],
            'è´­ä¹°é©±åŠ¨': 'å¤‡è€ƒå‹åŠ›ã€æç¥éœ€æ±‚',
            'å†³ç­–ç‰¹ç‚¹': 'åŠŸèƒ½æ€§å¼ºã€é«˜é¢‘å¤è´­'
        },
        'å‡è‚¥å­£åœºæ™¯': {
            'æ—¶é—´': 'æ˜¥èŠ‚åã€å¤å­£å‰',
            'å•†å“å…³é”®è¯': ['ä½è„‚', 'ä½å¡', 'ä»£é¤', 'é…¸å¥¶', 'æ°´æœ', 'æ²™æ‹‰'],
            'è´­ä¹°é©±åŠ¨': 'å¥åº·æ„è¯†ã€èº«æç®¡ç†',
            'å†³ç­–ç‰¹ç‚¹': 'å¥åº·å¯¼å‘ã€æŒç»­æ€§å¼º'
        },
        'è¿åŠ¨åœºæ™¯': {
            'å•†å“å…³é”®è¯': ['èƒ½é‡æ£’', 'è¿åŠ¨é¥®æ–™', 'è›‹ç™½ç²‰', 'ç”µè§£è´¨'],
            'è´­ä¹°é©±åŠ¨': 'è¿åŠ¨è¡¥ç»™ã€ä½“èƒ½æ¢å¤',
            'å†³ç­–ç‰¹ç‚¹': 'ä¸“ä¸šæ€§å¼ºã€å“ç‰Œå¿ è¯šåº¦é«˜'
        }
    }


# ================================================================================
# 2. è´­ä¹°é©±åŠ¨åˆ†æå¼•æ“
# ================================================================================

class PurchaseDriverAnalyzer:
    """è´­ä¹°é©±åŠ¨åˆ†æå™¨"""
    
    # è´­ä¹°é©±åŠ¨ç±»å‹å®šä¹‰
    DRIVER_TYPES = {
        'ä»·æ ¼é©±åŠ¨': {
            'è§¦å‘æ¡ä»¶': ['ä¿ƒé”€', 'æŠ˜æ‰£', 'æ»¡å‡', 'ä¼˜æƒ åˆ¸', 'ç‰¹ä»·', 'ç§’æ€'],
            'ç”¨æˆ·ç‰¹å¾': 'ä»·æ ¼æ•æ„Ÿå‹',
            'å†³ç­–è·¯å¾„': 'æ¯”ä»· â†’ è®¡ç®—ä¼˜æƒ  â†’ å›¤è´§',
            'è¥é”€ç­–ç•¥': 'æ»¡å‡æ´»åŠ¨ã€ä¹°èµ ã€ä¼šå‘˜æŠ˜æ‰£'
        },
        'åœºæ™¯é©±åŠ¨': {
            'è§¦å‘æ¡ä»¶': ['æ—¶æ®µåŒ¹é…', 'åœºæ™¯åŒ¹é…', 'èŠ‚å‡æ—¥'],
            'ç”¨æˆ·ç‰¹å¾': 'åœºæ™¯å¯¼å‘å‹',
            'å†³ç­–è·¯å¾„': 'éœ€æ±‚è¯†åˆ« â†’ åœºæ™¯åŒ¹é… â†’ å¿«é€Ÿä¸‹å•',
            'è¥é”€ç­–ç•¥': 'åœºæ™¯åŒ–æ¨èã€å¥—é¤ç»„åˆã€æ—¶æ®µä¿ƒé”€'
        },
        'å“è´¨é©±åŠ¨': {
            'è§¦å‘æ¡ä»¶': ['å“ç‰Œ', 'è¿›å£', 'æœ‰æœº', 'é«˜ç«¯', 'ç²¾é€‰'],
            'ç”¨æˆ·ç‰¹å¾': 'å“è´¨è¿½æ±‚å‹',
            'å†³ç­–è·¯å¾„': 'å“ç‰Œè®¤çŸ¥ â†’ å“è´¨è¯„ä¼° â†’ å¿ è¯šå¤è´­',
            'è¥é”€ç­–ç•¥': 'å“ç‰ŒèƒŒä¹¦ã€å“è´¨è®¤è¯ã€ä¼šå‘˜ä¸“äº«'
        },
        'ä¾¿åˆ©é©±åŠ¨': {
            'è§¦å‘æ¡ä»¶': ['å³æ—¶é…é€', '30åˆ†é’Ÿè¾¾', 'æ¥¼ä¸‹è‡ªæ', '24å°æ—¶'],
            'ç”¨æˆ·ç‰¹å¾': 'ä¾¿åˆ©ä¼˜å…ˆå‹',
            'å†³ç­–è·¯å¾„': 'æ€¥éœ€ â†’ å¿«é€Ÿä¸‹å• â†’ ä¸è®¡æˆæœ¬',
            'è¥é”€ç­–ç•¥': 'æé€Ÿè¾¾ã€åº”æ€¥å¥—é¤ã€å³æ—¶æ¨é€'
        },
        'å¥åº·é©±åŠ¨': {
            'è§¦å‘æ¡ä»¶': ['ä½è„‚', 'ä½ç³–', 'æ— æ·»åŠ ', 'æœ‰æœº', 'å¥åº·'],
            'ç”¨æˆ·ç‰¹å¾': 'å¥åº·æ„è¯†å‹',
            'å†³ç­–è·¯å¾„': 'æˆåˆ†æŸ¥çœ‹ â†’ è¥å…»å¯¹æ¯” â†’ ç†æ€§é€‰æ‹©',
            'è¥é”€ç­–ç•¥': 'å¥åº·æ ‡ç­¾ã€è¥å…»æˆåˆ†ã€ä¸“å®¶æ¨è'
        },
        'ç¤¾äº¤é©±åŠ¨': {
            'è§¦å‘æ¡ä»¶': ['ç¤¼ç›’', 'é€ç¤¼', 'èšä¼š', 'åˆ†äº«è£…'],
            'ç”¨æˆ·ç‰¹å¾': 'ç¤¾äº¤æ´»è·ƒå‹',
            'å†³ç­–è·¯å¾„': 'ç¤¾äº¤éœ€æ±‚ â†’ é€‰æ‹©ç¤¼å“ â†’ æ³¨é‡åŒ…è£…',
            'è¥é”€ç­–ç•¥': 'ç¤¼ç›’åŒ…è£…ã€å®šåˆ¶æœåŠ¡ã€ç¤¾äº¤åˆ†äº«'
        },
        'å°é²œé©±åŠ¨': {
            'è§¦å‘æ¡ä»¶': ['æ–°å“', 'é™å®š', 'ç½‘çº¢', 'çˆ†æ¬¾'],
            'ç”¨æˆ·ç‰¹å¾': 'å°é²œæ¢ç´¢å‹',
            'å†³ç­–è·¯å¾„': 'å‘ç°æ–°å“ â†’ å°è¯•ä½“éªŒ â†’ åˆ†äº«è¯„ä»·',
            'è¥é”€ç­–ç•¥': 'æ–°å“é¦–å‘ã€é™é‡é”€å”®ã€KOLæ¨è'
        },
        'å›¤è´§é©±åŠ¨': {
            'è§¦å‘æ¡ä»¶': ['å®¶åº­è£…', 'å¤§åŒ…è£…', 'å¤šä»¶ä¼˜æƒ ', 'ä¿è´¨æœŸé•¿'],
            'ç”¨æˆ·ç‰¹å¾': 'è®¡åˆ’å›¤è´§å‹',
            'å†³ç­–è·¯å¾„': 'éœ€æ±‚é¢„åˆ¤ â†’ æ‰¹é‡é‡‡è´­ â†’ é•¿æœŸå‚¨å¤‡',
            'è¥é”€ç­–ç•¥': 'ç»„åˆä¼˜æƒ ã€ä¼šå‘˜ä¸“äº«ã€æ»¡é¢åŒ…é‚®'
        }
    }
    
    @staticmethod
    def analyze_purchase_driver(row: pd.Series) -> Dict:
        """
        åˆ†æå•æ¡è®¢å•çš„è´­ä¹°é©±åŠ¨
        
        å‚æ•°:
            row: è®¢å•è¡Œæ•°æ®
            
        è¿”å›:
            Dict: è´­ä¹°é©±åŠ¨åˆ†æç»“æœ
        """
        product_name = str(row.get('å•†å“åç§°', '')).lower()
        scene = str(row.get('åœºæ™¯', ''))
        timeslot = str(row.get('æ—¶æ®µ', ''))
        
        # æ£€æµ‹å„ç§é©±åŠ¨å› ç´ 
        drivers = []
        driver_scores = {}
        
        # 1. ä»·æ ¼é©±åŠ¨æ£€æµ‹
        price_keywords = ['ä¿ƒé”€', 'æŠ˜æ‰£', 'æ»¡å‡', 'ä¼˜æƒ ', 'ç‰¹ä»·', 'ç§’æ€']
        if any(kw in product_name for kw in price_keywords):
            drivers.append('ä»·æ ¼é©±åŠ¨')
            driver_scores['ä»·æ ¼é©±åŠ¨'] = 0.9
        
        # 2. åœºæ™¯é©±åŠ¨æ£€æµ‹ (å¦‚æœåœºæ™¯å’Œæ—¶æ®µåŒ¹é…)
        if scene and timeslot:
            drivers.append('åœºæ™¯é©±åŠ¨')
            driver_scores['åœºæ™¯é©±åŠ¨'] = 0.8
        
        # 3. å“è´¨é©±åŠ¨æ£€æµ‹
        quality_keywords = ['å“ç‰Œ', 'è¿›å£', 'æœ‰æœº', 'ç²¾é€‰', 'é«˜ç«¯']
        if any(kw in product_name for kw in quality_keywords):
            drivers.append('å“è´¨é©±åŠ¨')
            driver_scores['å“è´¨é©±åŠ¨'] = 0.7
        
        # 4. ä¾¿åˆ©é©±åŠ¨æ£€æµ‹
        if 'åº”æ€¥' in scene or 'å‡Œæ™¨' in timeslot or 'æ·±å¤œ' in timeslot:
            drivers.append('ä¾¿åˆ©é©±åŠ¨')
            driver_scores['ä¾¿åˆ©é©±åŠ¨'] = 0.85
        
        # 5. å¥åº·é©±åŠ¨æ£€æµ‹
        health_keywords = ['ä½è„‚', 'ä½ç³–', 'æ— ç³–', 'æ— æ·»åŠ ', 'å¥åº·', 'å…»ç”Ÿ']
        if any(kw in product_name for kw in health_keywords):
            drivers.append('å¥åº·é©±åŠ¨')
            driver_scores['å¥åº·é©±åŠ¨'] = 0.75
        
        # 6. ç¤¾äº¤é©±åŠ¨æ£€æµ‹
        social_keywords = ['ç¤¼ç›’', 'ç¤¼å“', 'é€ç¤¼', 'èšä¼š', 'åˆ†äº«è£…']
        if any(kw in product_name for kw in social_keywords):
            drivers.append('ç¤¾äº¤é©±åŠ¨')
            driver_scores['ç¤¾äº¤é©±åŠ¨'] = 0.8
        
        # 7. å°é²œé©±åŠ¨æ£€æµ‹
        new_keywords = ['æ–°å“', 'é™å®š', 'ç½‘çº¢', 'çˆ†æ¬¾', 'é¦–å‘']
        if any(kw in product_name for kw in new_keywords):
            drivers.append('å°é²œé©±åŠ¨')
            driver_scores['å°é²œé©±åŠ¨'] = 0.7
        
        # 8. å›¤è´§é©±åŠ¨æ£€æµ‹
        stock_keywords = ['å®¶åº­è£…', 'å¤§åŒ…è£…', 'ç»„åˆè£…', 'æ•´ç®±']
        if any(kw in product_name for kw in stock_keywords):
            drivers.append('å›¤è´§é©±åŠ¨')
            driver_scores['å›¤è´§é©±åŠ¨'] = 0.75
        
        # å¦‚æœæ²¡æœ‰æ˜ç¡®é©±åŠ¨,é»˜è®¤ä¸ºåœºæ™¯é©±åŠ¨
        if not drivers:
            drivers.append('åœºæ™¯é©±åŠ¨')
            driver_scores['åœºæ™¯é©±åŠ¨'] = 0.5
        
        # è¿”å›ä¸»è¦é©±åŠ¨(å¾—åˆ†æœ€é«˜çš„)
        primary_driver = max(driver_scores, key=driver_scores.get) if driver_scores else 'åœºæ™¯é©±åŠ¨'
        
        return {
            'ä¸»è¦é©±åŠ¨': primary_driver,
            'æ‰€æœ‰é©±åŠ¨': ', '.join(drivers),
            'é©±åŠ¨å¾—åˆ†': driver_scores.get(primary_driver, 0.5),
            'é©±åŠ¨æ•°é‡': len(drivers)
        }


# ================================================================================
# 3. å•†å“åœºæ™¯æ™ºèƒ½æ‰“æ ‡å¼•æ“
# ================================================================================

class ProductSceneTagger:
    """å•†å“åœºæ™¯æ™ºèƒ½æ‰“æ ‡å¼•æ“"""
    
    def __init__(self):
        self.scene_dims = SceneDimensions()
        self.driver_analyzer = PurchaseDriverAnalyzer()
    
    def tag_product_scenes(self, df: pd.DataFrame) -> pd.DataFrame:
        """
        ä¸ºå•†å“æ‰“ä¸Šå¤šç»´åº¦åœºæ™¯æ ‡ç­¾
        
        å‚æ•°:
            df: è®¢å•æ•°æ®DataFrame
            
        è¿”å›:
            DataFrame: æ·»åŠ åœºæ™¯æ ‡ç­¾çš„æ•°æ®
        """
        df = df.copy()
        
        # 1. æ·»åŠ åŸºç¡€æ—¶æ®µåœºæ™¯ (å¦‚æœæ²¡æœ‰)
        if 'åœºæ™¯' not in df.columns:
            df['åœºæ™¯'] = df.apply(self._infer_base_scene, axis=1)
        
        # 2. æ·»åŠ å­£èŠ‚åœºæ™¯
        df['å­£èŠ‚åœºæ™¯'] = df.apply(self._infer_season_scene, axis=1)
        
        # 3. æ·»åŠ èŠ‚å‡æ—¥åœºæ™¯
        df['èŠ‚å‡æ—¥åœºæ™¯'] = df.apply(self._infer_holiday_scene, axis=1)
        
        # 4. æ·»åŠ å¤©æ°”åœºæ™¯ (åŸºäºå•†å“ç‰¹å¾æ¨æ–­)
        df['å¤©æ°”åœºæ™¯'] = df.apply(self._infer_weather_scene, axis=1)
        
        # 5. æ·»åŠ ç‰¹æ®Šæ—¶æ®µåœºæ™¯
        df['ç‰¹æ®Šåœºæ™¯'] = df.apply(self._infer_special_scene, axis=1)
        
        # 6. åˆ†æè´­ä¹°é©±åŠ¨
        driver_results = df.apply(self.driver_analyzer.analyze_purchase_driver, axis=1)
        df['è´­ä¹°é©±åŠ¨'] = driver_results.apply(lambda x: x['ä¸»è¦é©±åŠ¨'])
        df['æ‰€æœ‰é©±åŠ¨'] = driver_results.apply(lambda x: x['æ‰€æœ‰é©±åŠ¨'])
        df['é©±åŠ¨å¾—åˆ†'] = driver_results.apply(lambda x: x['é©±åŠ¨å¾—åˆ†'])
        
        # 7. åˆ†æå†³ç­–å› ç´ 
        df['å†³ç­–å› ç´ '] = df.apply(self._analyze_decision_factors, axis=1)
        
        return df
    
    def _infer_base_scene(self, row: pd.Series) -> str:
        """æ¨æ–­åŸºç¡€åœºæ™¯"""
        product_name = str(row.get('å•†å“åç§°', '')).lower()
        
        for scene, keywords in self.scene_dims.BASE_SCENES.items():
            for keyword in keywords:
                if keyword in product_name:
                    return scene
        
        return 'æ—¥å¸¸è´­ç‰©'
    
    def _infer_season_scene(self, row: pd.Series) -> str:
        """æ¨æ–­å­£èŠ‚åœºæ™¯"""
        product_name = str(row.get('å•†å“åç§°', '')).lower()
        
        # æ£€æŸ¥æ—¥æœŸå­—æ®µ
        date_col = None
        for col in ['æ—¥æœŸ', 'ä¸‹å•æ—¶é—´', 'è®¢å•æ—¥æœŸ']:
            if col in row.index and pd.notna(row.get(col)):
                date_col = col
                break
        
        if date_col:
            try:
                order_date = pd.to_datetime(row[date_col])
                month = order_date.month
                
                # æ ¹æ®æœˆä»½åˆ¤æ–­å­£èŠ‚
                if 3 <= month <= 5:
                    season = 'æ˜¥å­£åœºæ™¯'
                elif 6 <= month <= 8:
                    season = 'å¤å­£åœºæ™¯'
                elif 9 <= month <= 11:
                    season = 'ç§‹å­£åœºæ™¯'
                else:
                    season = 'å†¬å­£åœºæ™¯'
                
                # éªŒè¯å•†å“æ˜¯å¦åŒ¹é…å­£èŠ‚å…³é”®è¯
                season_info = self.scene_dims.SEASON_SCENES[season]
                for keyword in season_info['å•†å“å…³é”®è¯']:
                    if keyword in product_name:
                        return season
                
                return season  # è¿”å›åŸºäºæ—¶é—´çš„å­£èŠ‚
            except:
                pass
        
        # å¦‚æœæ²¡æœ‰æ—¥æœŸ,åŸºäºå•†å“å…³é”®è¯æ¨æ–­
        for season, info in self.scene_dims.SEASON_SCENES.items():
            for keyword in info['å•†å“å…³é”®è¯']:
                if keyword in product_name:
                    return season
        
        return 'å…¨å­£èŠ‚'
    
    def _infer_holiday_scene(self, row: pd.Series) -> str:
        """æ¨æ–­èŠ‚å‡æ—¥åœºæ™¯"""
        product_name = str(row.get('å•†å“åç§°', '')).lower()
        
        # æ£€æŸ¥æ—¥æœŸå­—æ®µ
        date_col = None
        for col in ['æ—¥æœŸ', 'ä¸‹å•æ—¶é—´', 'è®¢å•æ—¥æœŸ']:
            if col in row.index and pd.notna(row.get(col)):
                date_col = col
                break
        
        if date_col:
            try:
                order_date = pd.to_datetime(row[date_col])
                weekday = order_date.weekday()  # 0=Monday, 6=Sunday
                
                # åˆ¤æ–­æ˜¯å¦å‘¨æœ«
                if weekday >= 5:
                    return 'å‘¨æœ«åœºæ™¯'
                else:
                    # æ£€æŸ¥æ˜¯å¦å·¥ä½œæ—¥
                    return 'å·¥ä½œæ—¥åœºæ™¯'
            except:
                pass
        
        # åŸºäºå•†å“å…³é”®è¯æ¨æ–­èŠ‚å‡æ—¥
        for holiday, info in self.scene_dims.HOLIDAY_SCENES.items():
            for keyword in info['å•†å“å…³é”®è¯']:
                if keyword in product_name:
                    return holiday
        
        return 'æ—¥å¸¸'
    
    def _infer_weather_scene(self, row: pd.Series) -> str:
        """æ¨æ–­å¤©æ°”åœºæ™¯ (åŸºäºå•†å“ç‰¹å¾)"""
        product_name = str(row.get('å•†å“åç§°', '')).lower()
        
        for weather, info in self.scene_dims.WEATHER_SCENES.items():
            for keyword in info['å•†å“å…³é”®è¯']:
                if keyword in product_name:
                    return weather
        
        return 'å¸¸è§„å¤©æ°”'
    
    def _infer_special_scene(self, row: pd.Series) -> str:
        """æ¨æ–­ç‰¹æ®Šæ—¶æ®µåœºæ™¯"""
        product_name = str(row.get('å•†å“åç§°', '')).lower()
        
        for special, info in self.scene_dims.SPECIAL_TIME_SCENES.items():
            for keyword in info['å•†å“å…³é”®è¯']:
                if keyword in product_name:
                    return special
        
        return 'æ— '
    
    def _analyze_decision_factors(self, row: pd.Series) -> str:
        """åˆ†æä¸‹å•å†³ç­–å› ç´ """
        factors = []
        
        # 1. æ—¶é—´å› ç´ 
        timeslot = str(row.get('æ—¶æ®µ', ''))
        if 'åº”æ€¥' in timeslot or 'å‡Œæ™¨' in timeslot:
            factors.append('æ—¶é—´ç´§è¿«')
        
        # 2. ä»·æ ¼å› ç´ 
        if 'ä»·æ ¼é©±åŠ¨' in str(row.get('è´­ä¹°é©±åŠ¨', '')):
            factors.append('ä»·æ ¼ä¼˜æƒ ')
        
        # 3. å“è´¨å› ç´ 
        if 'å“è´¨é©±åŠ¨' in str(row.get('è´­ä¹°é©±åŠ¨', '')):
            factors.append('å“è´¨ä¿éšœ')
        
        # 4. åœºæ™¯åŒ¹é…
        if 'åœºæ™¯é©±åŠ¨' in str(row.get('è´­ä¹°é©±åŠ¨', '')):
            factors.append('åœºæ™¯åŒ¹é…')
        
        # 5. ä¾¿åˆ©æ€§
        if 'ä¾¿åˆ©é©±åŠ¨' in str(row.get('è´­ä¹°é©±åŠ¨', '')):
            factors.append('å³æ—¶ä¾¿åˆ©')
        
        if not factors:
            factors.append('å¸¸è§„éœ€æ±‚')
        
        return ' + '.join(factors)
    
    def generate_product_scene_profile(self, df: pd.DataFrame) -> pd.DataFrame:
        """
        ç”Ÿæˆå•†å“åœºæ™¯ç”»åƒæŠ¥å‘Š
        
        å‚æ•°:
            df: å·²æ‰“æ ‡çš„è®¢å•æ•°æ®
            
        è¿”å›:
            DataFrame: å•†å“åœºæ™¯ç”»åƒ
        """
        # æŒ‰å•†å“èšåˆåˆ†æ
        product_profiles = []
        
        for product_name in df['å•†å“åç§°'].unique():
            product_df = df[df['å•†å“åç§°'] == product_name]
            
            # ç»Ÿè®¡å„ç»´åº¦åœºæ™¯
            base_scenes = product_df['åœºæ™¯'].value_counts().to_dict()
            season_scenes = product_df['å­£èŠ‚åœºæ™¯'].value_counts().to_dict()
            holiday_scenes = product_df['èŠ‚å‡æ—¥åœºæ™¯'].value_counts().to_dict()
            weather_scenes = product_df['å¤©æ°”åœºæ™¯'].value_counts().to_dict()
            
            # ç»Ÿè®¡è´­ä¹°é©±åŠ¨
            drivers = product_df['è´­ä¹°é©±åŠ¨'].value_counts().to_dict()
            
            # ç»Ÿè®¡å†³ç­–å› ç´ 
            decisions = product_df['å†³ç­–å› ç´ '].value_counts().to_dict()
            
            # è®¡ç®—åœºæ™¯é€‚é…åº¦å¾—åˆ†
            scene_coverage = len(base_scenes)  # è¦†ç›–çš„åœºæ™¯æ•°
            total_orders = len(product_df)
            
            # ä¸»è¦åœºæ™¯ (è®¢å•é‡æœ€å¤šçš„å‰3ä¸ª)
            top_scenes = sorted(base_scenes.items(), key=lambda x: x[1], reverse=True)[:3]
            main_scenes = ', '.join([f"{s[0]}({s[1]}å•)" for s in top_scenes])
            
            # ä¸»è¦é©±åŠ¨
            main_driver = max(drivers, key=drivers.get) if drivers else 'æœªçŸ¥'
            
            # ä¸»è¦å†³ç­–å› ç´ 
            main_decision = max(decisions, key=decisions.get) if decisions else 'æœªçŸ¥'
            
            product_profiles.append({
                'å•†å“åç§°': product_name,
                'æ€»è®¢å•é‡': total_orders,
                'åœºæ™¯è¦†ç›–æ•°': scene_coverage,
                'ä¸»è¦åœºæ™¯': main_scenes,
                'ä¸»è¦å­£èŠ‚': max(season_scenes, key=season_scenes.get) if season_scenes else 'å…¨å­£èŠ‚',
                'ä¸»è¦èŠ‚å‡æ—¥': max(holiday_scenes, key=holiday_scenes.get) if holiday_scenes else 'æ—¥å¸¸',
                'ä¸»è¦å¤©æ°”': max(weather_scenes, key=weather_scenes.get) if weather_scenes else 'å¸¸è§„',
                'è´­ä¹°é©±åŠ¨': main_driver,
                'å†³ç­–å› ç´ ': main_decision,
                'åœºæ™¯é€‚é…åº¦': round(scene_coverage / 10 * 100, 1)  # æ»¡åˆ†10ä¸ªåœºæ™¯
            })
        
        return pd.DataFrame(product_profiles).sort_values('æ€»è®¢å•é‡', ascending=False)


# ================================================================================
# 4. åœºæ™¯è¥é”€å»ºè®®ç”Ÿæˆå™¨
# ================================================================================

class SceneMarketingAdvisor:
    """åœºæ™¯è¥é”€å»ºè®®ç”Ÿæˆå™¨"""
    
    @staticmethod
    def generate_marketing_advice(product_profile: pd.Series) -> Dict:
        """
        æ ¹æ®å•†å“åœºæ™¯ç”»åƒç”Ÿæˆè¥é”€å»ºè®®
        
        å‚æ•°:
            product_profile: å•†å“åœºæ™¯ç”»åƒæ•°æ®è¡Œ
            
        è¿”å›:
            Dict: è¥é”€å»ºè®®
        """
        advice = {
            'å•†å“åç§°': product_profile['å•†å“åç§°'],
            'åœºæ™¯å®šä½': '',
            'æ¨èç­–ç•¥': [],
            'è¥é”€æ—¶æœº': [],
            'ç»„åˆå»ºè®®': []
        }
        
        # 1. åœºæ™¯å®šä½
        main_scenes = product_profile['ä¸»è¦åœºæ™¯']
        if 'æ—©é¤' in main_scenes:
            advice['åœºæ™¯å®šä½'] = 'æ—©é¤åˆšéœ€å“'
            advice['æ¨èç­–ç•¥'].append('æ™¨é—´æ—¶æ®µæ¨é€')
            advice['è¥é”€æ—¶æœº'].append('6-9ç‚¹é«˜å³°æœŸ')
            advice['ç»„åˆå»ºè®®'].append('ä¸è±†æµ†ã€æ²¹æ¡ç»„åˆå¥—é¤')
        elif 'ä¸‹åˆèŒ¶' in main_scenes:
            advice['åœºæ™¯å®šä½'] = 'ä¸‹åˆèŒ¶çƒ­é—¨'
            advice['æ¨èç­–ç•¥'].append('14-16ç‚¹é‡ç‚¹æ¨å¹¿')
            advice['è¥é”€æ—¶æœº'].append('å·¥ä½œæ—¥ä¸‹åˆ')
            advice['ç»„åˆå»ºè®®'].append('ä¸è›‹ç³•ã€å’–å•¡æ­é…')
        elif 'å¤œå®µ' in main_scenes:
            advice['åœºæ™¯å®šä½'] = 'å¤œå®µå¿…å¤‡'
            advice['æ¨èç­–ç•¥'].append('æ·±å¤œè¥é”€')
            advice['è¥é”€æ—¶æœº'].append('21ç‚¹åæ¨é€')
            advice['ç»„åˆå»ºè®®'].append('ä¸å•¤é…’ã€çƒ§çƒ¤ç»„åˆ')
        
        # 2. æ ¹æ®è´­ä¹°é©±åŠ¨å®šåˆ¶ç­–ç•¥
        driver = product_profile['è´­ä¹°é©±åŠ¨']
        if driver == 'ä»·æ ¼é©±åŠ¨':
            advice['æ¨èç­–ç•¥'].append('æ»¡å‡æ´»åŠ¨ã€é™æ—¶ç§’æ€')
        elif driver == 'å“è´¨é©±åŠ¨':
            advice['æ¨èç­–ç•¥'].append('å“è´¨è®¤è¯ã€å“ç‰ŒèƒŒä¹¦')
        elif driver == 'ä¾¿åˆ©é©±åŠ¨':
            advice['æ¨èç­–ç•¥'].append('30åˆ†é’Ÿè¾¾ã€å³æ—¶æ¨é€')
        elif driver == 'å¥åº·é©±åŠ¨':
            advice['æ¨èç­–ç•¥'].append('å¥åº·æ ‡ç­¾ã€è¥å…»æˆåˆ†å±•ç¤º')
        
        # 3. æ ¹æ®å­£èŠ‚åœºæ™¯å»ºè®®
        season = product_profile['ä¸»è¦å­£èŠ‚']
        if season == 'å¤å­£åœºæ™¯':
            advice['è¥é”€æ—¶æœº'].append('6-8æœˆé‡ç‚¹æ¨å¹¿')
        elif season == 'å†¬å­£åœºæ™¯':
            advice['è¥é”€æ—¶æœº'].append('12-2æœˆé‡ç‚¹æ¨å¹¿')
        
        # 4. åœºæ™¯é€‚é…åº¦è¯„ä¼°
        adaptability = product_profile['åœºæ™¯é€‚é…åº¦']
        if adaptability > 50:
            advice['æ¨èç­–ç•¥'].append('å¤šåœºæ™¯è¥é”€ï¼Œè¦†ç›–å…¨æ—¶æ®µ')
        else:
            advice['æ¨èç­–ç•¥'].append('èšç„¦æ ¸å¿ƒåœºæ™¯ï¼Œç²¾å‡†è¥é”€')
        
        return advice


# ================================================================================
# 5. ä¸»å‡½æ•° - å¿«é€Ÿä½¿ç”¨
# ================================================================================

def smart_tag_products(df: pd.DataFrame) -> Tuple[pd.DataFrame, pd.DataFrame]:
    """
    ä¸€é”®ä¸ºå•†å“æ‰“æ ‡å¹¶ç”Ÿæˆåœºæ™¯ç”»åƒ
    
    å‚æ•°:
        df: è®¢å•æ•°æ®DataFrame (å¿…é¡»åŒ…å«: å•†å“åç§°, æ—¥æœŸ/ä¸‹å•æ—¶é—´)
        
    è¿”å›:
        Tuple[DataFrame, DataFrame]: (æ‰“æ ‡åçš„è®¢å•æ•°æ®, å•†å“åœºæ™¯ç”»åƒ)
    
    ä½¿ç”¨ç¤ºä¾‹:
        >>> df = pd.read_excel('è®¢å•æ•°æ®.xlsx')
        >>> tagged_df, profiles = smart_tag_products(df)
        >>> print(profiles.head(10))  # æŸ¥çœ‹Top10å•†å“åœºæ™¯ç”»åƒ
    """
    print("ğŸš€ å•†å“åœºæ™¯æ™ºèƒ½æ‰“æ ‡å¼•æ“å¯åŠ¨...")
    print("=" * 80)
    
    # åˆå§‹åŒ–æ‰“æ ‡å¼•æ“
    tagger = ProductSceneTagger()
    
    # 1. ä¸ºè®¢å•æ‰“æ ‡
    print("ğŸ“Š æ­¥éª¤1/3: ä¸ºè®¢å•æ•°æ®æ‰“ä¸Šå¤šç»´åº¦åœºæ™¯æ ‡ç­¾...")
    tagged_df = tagger.tag_product_scenes(df)
    print(f"   âœ… å®Œæˆ! æ·»åŠ äº† 7 ä¸ªåœºæ™¯ç»´åº¦æ ‡ç­¾")
    print(f"      - åŸºç¡€åœºæ™¯: {tagged_df['åœºæ™¯'].nunique()} ç§")
    print(f"      - å­£èŠ‚åœºæ™¯: {tagged_df['å­£èŠ‚åœºæ™¯'].nunique()} ç§")
    print(f"      - èŠ‚å‡æ—¥åœºæ™¯: {tagged_df['èŠ‚å‡æ—¥åœºæ™¯'].nunique()} ç§")
    print(f"      - å¤©æ°”åœºæ™¯: {tagged_df['å¤©æ°”åœºæ™¯'].nunique()} ç§")
    print(f"      - è´­ä¹°é©±åŠ¨: {tagged_df['è´­ä¹°é©±åŠ¨'].nunique()} ç§")
    
    # 2. ç”Ÿæˆå•†å“ç”»åƒ
    print("\nğŸ“ˆ æ­¥éª¤2/3: ç”Ÿæˆå•†å“åœºæ™¯é€‚é…æ€§ç”»åƒ...")
    product_profiles = tagger.generate_product_scene_profile(tagged_df)
    print(f"   âœ… å®Œæˆ! ç”Ÿæˆ {len(product_profiles)} ä¸ªå•†å“çš„åœºæ™¯ç”»åƒ")
    
    # 3. ç”Ÿæˆè¥é”€å»ºè®®
    print("\nğŸ’¡ æ­¥éª¤3/3: ç”Ÿæˆåœºæ™¯è¥é”€å»ºè®®...")
    advisor = SceneMarketingAdvisor()
    marketing_advice = product_profiles.head(20).apply(
        advisor.generate_marketing_advice, axis=1
    ).tolist()
    print(f"   âœ… å®Œæˆ! ä¸ºTop20å•†å“ç”Ÿæˆè¥é”€å»ºè®®")
    
    print("\n" + "=" * 80)
    print("âœ… å•†å“åœºæ™¯æ™ºèƒ½æ‰“æ ‡å®Œæˆ!")
    print(f"\nğŸ“Š æ•°æ®ç»Ÿè®¡:")
    print(f"   - è®¢å•æ€»æ•°: {len(tagged_df):,}")
    print(f"   - å•†å“æ€»æ•°: {tagged_df['å•†å“åç§°'].nunique():,}")
    print(f"   - åœºæ™¯è¦†ç›–: {tagged_df['åœºæ™¯'].nunique()} ä¸ªåŸºç¡€åœºæ™¯")
    print(f"   - è´­ä¹°é©±åŠ¨: {tagged_df['è´­ä¹°é©±åŠ¨'].nunique()} ç§é©±åŠ¨ç±»å‹")
    
    return tagged_df, product_profiles


# ================================================================================
# æµ‹è¯•ä»£ç 
# ================================================================================

if __name__ == "__main__":
    print("\n" + "=" * 80)
    print("å•†å“åœºæ™¯æ™ºèƒ½æ‰“æ ‡å¼•æ“ - æµ‹è¯•æ¨¡å¼")
    print("=" * 80)
    
    # åˆ›å»ºæµ‹è¯•æ•°æ®
    test_data = pd.DataFrame({
        'æ—¥æœŸ': pd.to_datetime([
            '2025-09-01 08:30:00',  # æ—©é¤æ—¶æ®µ
            '2025-06-15 15:00:00',  # å¤å­£ä¸‹åˆèŒ¶
            '2025-12-25 19:00:00',  # å†¬å­£æ™šé¤
            '2025-11-11 10:00:00',  # åŒ11å›¤è´§
            '2025-09-15 23:00:00',  # ä¸­ç§‹èŠ‚å¤œå®µ
            '2025-09-01 14:30:00',  # ç§‹å­£ä¸‹åˆèŒ¶
        ]),
        'å•†å“åç§°': [
            'è±†æµ†',
            'å†°æ·‡æ·‹',
            'ç«é”…åº•æ–™',
            'è–¯ç‰‡å®¶åº­è£…',
            'æœˆé¥¼ç¤¼ç›’',
            'ä½è„‚é…¸å¥¶'
        ],
        'ä¸€çº§åˆ†ç±»å': ['é¥®æ–™', 'å†·é¥®', 'é€Ÿé£Ÿ', 'ä¼‘é—²é£Ÿå“', 'ç³•ç‚¹', 'ä¹³åˆ¶å“'],
        'è®¢å•ID': ['001', '002', '003', '004', '005', '006']
    })
    
    print("\nğŸ“‹ æµ‹è¯•æ•°æ®:")
    print(test_data[['å•†å“åç§°', 'æ—¥æœŸ']])
    
    # æ‰§è¡Œæ™ºèƒ½æ‰“æ ‡
    tagged_df, profiles = smart_tag_products(test_data)
    
    print("\n\nğŸ“Š æ‰“æ ‡ç»“æœç¤ºä¾‹:")
    print(tagged_df[['å•†å“åç§°', 'åœºæ™¯', 'å­£èŠ‚åœºæ™¯', 'èŠ‚å‡æ—¥åœºæ™¯', 'è´­ä¹°é©±åŠ¨', 'å†³ç­–å› ç´ ']].to_string(index=False))
    
    print("\n\nğŸ¯ å•†å“åœºæ™¯ç”»åƒ:")
    print(profiles.to_string(index=False))
    
    print("\nâœ… æµ‹è¯•å®Œæˆ!")
