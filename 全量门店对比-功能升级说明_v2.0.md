# å…¨é‡é—¨åº—å¯¹æ¯”åŠŸèƒ½ - å‡çº§è¯´æ˜ v2.0

## ğŸ“‹ å‡çº§æ¦‚è¿°

**ç‰ˆæœ¬**: v2.0  
**æ—¥æœŸ**: 2025-01-19  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

æœ¬æ¬¡å‡çº§ä¸º"å…¨é‡é—¨åº—å¯¹æ¯”åˆ†æ"åŠŸèƒ½æ·»åŠ äº†ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½ï¼š
1. **ç‹¬ç«‹æ—¥æœŸé€‰æ‹©å™¨** - æ”¯æŒè‡ªå®šä¹‰å¯¹æ¯”å‘¨æœŸ
2. **æ™ºèƒ½ç¯æ¯”è®¡ç®—** - åŸºäºç”¨æˆ·é€‰æ‹©çš„å‘¨æœŸè‡ªåŠ¨è®¡ç®—
3. **é—¨åº—ç­›é€‰åŠŸèƒ½** - å‰”é™¤ä¸å…³æ³¨çš„é—¨åº—

---

## ğŸ¯ æ–°å¢åŠŸèƒ½è¯¦è§£

### åŠŸèƒ½1ï¼šç‹¬ç«‹æ—¥æœŸé€‰æ‹©å™¨

#### åŠŸèƒ½æè¿°
- åœ¨"å…¨é‡é—¨åº—å¯¹æ¯”"é¡µé¢å†…æœ‰ç‹¬ç«‹çš„æ—¥æœŸé€‰æ‹©å™¨
- ä¸ä¾èµ–é¡¶éƒ¨å…¨å±€æ—¥æœŸç­›é€‰å™¨
- æ”¯æŒé€‰æ‹©ä»»æ„æ—¥æœŸèŒƒå›´
- è‡ªåŠ¨è®¡ç®—å¹¶æ˜¾ç¤ºä¸ŠæœŸæ—¥æœŸèŒƒå›´

#### UIè®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“… å¯¹æ¯”å‘¨æœŸé€‰æ‹©                              â”‚
â”‚                                              â”‚
â”‚ æœ¬æœŸå¼€å§‹: [2025-01-10]                      â”‚
â”‚ æœ¬æœŸç»“æŸ: [2025-01-16]                      â”‚
â”‚                                              â”‚
â”‚ ä¸ŠæœŸï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰ï¼š                           â”‚
â”‚ 2025-01-03 ~ 2025-01-09                     â”‚
â”‚                                              â”‚
â”‚ [åº”ç”¨] [é‡ç½®]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä½¿ç”¨æ–¹å¼
1. é€‰æ‹©æœ¬æœŸå¼€å§‹å’Œç»“æŸæ—¥æœŸ
2. ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ä¸ŠæœŸæ—¥æœŸèŒƒå›´ï¼ˆç›¸åŒå¤©æ•°çš„å‰ä¸€ä¸ªå‘¨æœŸï¼‰
3. ç‚¹å‡»"åº”ç”¨"æŒ‰é’®åŠ è½½æ•°æ®
4. ç‚¹å‡»"é‡ç½®"æŒ‰é’®æ¢å¤é»˜è®¤ï¼ˆæœ€è¿‘7å¤©ï¼‰

#### æŠ€æœ¯å®ç°
```typescript
// è®¡ç®—ä¸ŠæœŸæ—¥æœŸèŒƒå›´
const previousPeriod = useMemo(() => {
  if (!currentPeriodStart || !currentPeriodEnd) {
    return { start: '', end: '' };
  }
  
  const start = new Date(currentPeriodStart);
  const end = new Date(currentPeriodEnd);
  const days = Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)) + 1;
  
  const prevEnd = new Date(start);
  prevEnd.setDate(prevEnd.getDate() - 1);
  
  const prevStart = new Date(prevEnd);
  prevStart.setDate(prevStart.getDate() - days + 1);
  
  return {
    start: prevStart.toISOString().split('T')[0],
    end: prevEnd.toISOString().split('T')[0]
  };
}, [currentPeriodStart, currentPeriodEnd]);
```

---

### åŠŸèƒ½2ï¼šæ™ºèƒ½ç¯æ¯”è®¡ç®—

#### åŠŸèƒ½æè¿°
- ç¯æ¯”è®¡ç®—åŸºäºç”¨æˆ·é€‰æ‹©çš„å¯¹æ¯”å‘¨æœŸ
- æ”¯æŒä»»æ„å¤©æ•°çš„ç¯æ¯”å¯¹æ¯”ï¼ˆä¸é™äº7å¤©ï¼‰
- æœ¬æœŸå’Œä¸ŠæœŸå¤©æ•°è‡ªåŠ¨ä¿æŒä¸€è‡´
- ç¯æ¯”æ•°æ®å®æ—¶æ›´æ–°

#### è®¡ç®—é€»è¾‘

**ç¤ºä¾‹1ï¼š7å¤©å¯¹æ¯”**
```
ç”¨æˆ·é€‰æ‹©ï¼š2025-01-10 ~ 2025-01-16ï¼ˆ7å¤©ï¼‰
- æœ¬æœŸï¼š2025-01-10 ~ 2025-01-16ï¼ˆ7å¤©ï¼‰
- ä¸ŠæœŸï¼š2025-01-03 ~ 2025-01-09ï¼ˆ7å¤©ï¼‰
- ç¯æ¯” = (æœ¬æœŸ - ä¸ŠæœŸ) / ä¸ŠæœŸ Ã— 100%
```

**ç¤ºä¾‹2ï¼š15å¤©å¯¹æ¯”**
```
ç”¨æˆ·é€‰æ‹©ï¼š2025-01-01 ~ 2025-01-15ï¼ˆ15å¤©ï¼‰
- æœ¬æœŸï¼š2025-01-01 ~ 2025-01-15ï¼ˆ15å¤©ï¼‰
- ä¸ŠæœŸï¼š2024-12-17 ~ 2024-12-31ï¼ˆ15å¤©ï¼‰
- ç¯æ¯” = (æœ¬æœŸ - ä¸ŠæœŸ) / ä¸ŠæœŸ Ã— 100%
```

**ç¤ºä¾‹3ï¼šå•æ—¥å¯¹æ¯”**
```
ç”¨æˆ·é€‰æ‹©ï¼š2025-01-15 ~ 2025-01-15ï¼ˆ1å¤©ï¼‰
- æœ¬æœŸï¼š2025-01-15ï¼ˆ1å¤©ï¼‰
- ä¸ŠæœŸï¼š2025-01-14ï¼ˆ1å¤©ï¼‰
- ç¯æ¯” = (æœ¬æœŸ - ä¸ŠæœŸ) / ä¸ŠæœŸ Ã— 100%
```

#### åç«¯APIæ”¯æŒ
```python
@router.get("/comparison/week-over-week")
async def get_stores_week_over_week(
    end_date: Optional[date] = Query(None, description="æœ¬æœŸç»“æŸæ—¥æœŸ"),
    previous_start: Optional[date] = Query(None, description="ä¸ŠæœŸå¼€å§‹æ—¥æœŸ"),
    previous_end: Optional[date] = Query(None, description="ä¸ŠæœŸç»“æŸæ—¥æœŸ")
):
    """æ”¯æŒè‡ªå®šä¹‰å¯¹æ¯”å‘¨æœŸçš„ç¯æ¯”è®¡ç®—"""
    # å¦‚æœæä¾›äº†è‡ªå®šä¹‰ä¸ŠæœŸï¼Œä½¿ç”¨è‡ªå®šä¹‰é€»è¾‘
    if previous_start and previous_end:
        # ä½¿ç”¨è‡ªå®šä¹‰ä¸ŠæœŸ
        last_week_start = previous_start
        last_week_end = previous_end
        
        # è®¡ç®—æœ¬æœŸå¼€å§‹æ—¥æœŸï¼ˆæ ¹æ®ä¸ŠæœŸå¤©æ•°ï¼‰
        days = (previous_end - previous_start).days + 1
        this_week_start = end_date - timedelta(days=days - 1)
    else:
        # é»˜è®¤é€»è¾‘ï¼šæœ€è¿‘7å¤© vs å‰7å¤©
        this_week_start = end_date - timedelta(days=6)
        last_week_end = this_week_start - timedelta(days=1)
        last_week_start = last_week_end - timedelta(days=6)
```

---

### åŠŸèƒ½3ï¼šé—¨åº—ç­›é€‰ï¼ˆå‰”é™¤åŠŸèƒ½ï¼‰

#### åŠŸèƒ½æè¿°
- ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨å‰”é™¤ä¸æƒ³å…³æ³¨çš„é—¨åº—
- å‰”é™¤åï¼Œè¯¥é—¨åº—ä¸åœ¨è¡¨æ ¼å’Œå›¾è¡¨ä¸­æ˜¾ç¤º
- æ±‡æ€»æ•°æ®è‡ªåŠ¨æ’é™¤è¢«å‰”é™¤çš„é—¨åº—
- æ”¯æŒæ‰¹é‡æ“ä½œï¼ˆå…¨é€‰/å…¨ä¸é€‰ï¼‰
- å‰”é™¤çŠ¶æ€æŒä¹…åŒ–ï¼ˆsessionStorageï¼‰

#### UIè®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” æ˜¾ç¤ºé—¨åº— (25/28)                         â”‚
â”‚ [å±•å¼€ â–¼]                                     â”‚
â”‚                                              â”‚
â”‚ [å…¨éƒ¨å‰”é™¤] [å…¨éƒ¨æ¢å¤]  å·²å‰”é™¤ 3 ä¸ªé—¨åº—       â”‚
â”‚                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ â˜‘ é—¨åº—A                               â”‚   â”‚
â”‚ â”‚ â˜‘ é—¨åº—B                               â”‚   â”‚
â”‚ â”‚ â˜ é—¨åº—C (å·²å‰”é™¤)                      â”‚   â”‚
â”‚ â”‚ â˜‘ é—¨åº—D                               â”‚   â”‚
â”‚ â”‚ ...                                   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä½¿ç”¨æ–¹å¼
1. ç‚¹å‡»"æ˜¾ç¤ºé—¨åº—"åŒºåŸŸçš„"å±•å¼€"æŒ‰é’®
2. å‹¾é€‰/å–æ¶ˆå‹¾é€‰é—¨åº—å¤é€‰æ¡†
3. æˆ–ç‚¹å‡»"å…¨éƒ¨å‰”é™¤"/"å…¨éƒ¨æ¢å¤"å¿«æ·æŒ‰é’®
4. è¡¨æ ¼å’Œå›¾è¡¨è‡ªåŠ¨æ›´æ–°ï¼Œåªæ˜¾ç¤ºé€‰ä¸­çš„é—¨åº—
5. æ±‡æ€»æŒ‡æ ‡è‡ªåŠ¨é‡æ–°è®¡ç®—

#### æŠ€æœ¯å®ç°

**çŠ¶æ€ç®¡ç†**ï¼š
```typescript
// é—¨åº—ç­›é€‰çŠ¶æ€ï¼ˆä» sessionStorage æ¢å¤ï¼‰
const [excludedStores, setExcludedStores] = useState<string[]>(() => {
  const saved = sessionStorage.getItem('excludedStores');
  return saved ? JSON.parse(saved) : [];
});

// ä¿å­˜åˆ° sessionStorage
useEffect(() => {
  sessionStorage.setItem('excludedStores', JSON.stringify(excludedStores));
}, [excludedStores]);
```

**æ•°æ®è¿‡æ»¤**ï¼š
```typescript
// è¿‡æ»¤æ‰è¢«å‰”é™¤çš„é—¨åº—
const filteredStores = useMemo(() => {
  return stores.filter(store => !excludedStores.includes(store.store_name));
}, [stores, excludedStores]);

// æ±‡æ€»æ•°æ®åŸºäºè¿‡æ»¤åçš„é—¨åº—
const summary = useMemo(() => {
  if (filteredStores.length === 0) return defaultSummary;
  
  return {
    total_stores: filteredStores.length,
    total_orders: filteredStores.reduce((sum, s) => sum + s.order_count, 0),
    total_revenue: filteredStores.reduce((sum, s) => sum + s.total_revenue, 0),
    // ...
  };
}, [filteredStores]);
```

**æ“ä½œå‡½æ•°**ï¼š
```typescript
// åˆ‡æ¢å•ä¸ªé—¨åº—
const toggleStoreSelection = (storeName: string) => {
  setExcludedStores(prev => {
    if (prev.includes(storeName)) {
      return prev.filter(s => s !== storeName);
    } else {
      return [...prev, storeName];
    }
  });
};

// å…¨é€‰/å…¨ä¸é€‰
const toggleAllStores = () => {
  if (excludedStores.length === 0) {
    setExcludedStores(allStoreNames); // å…¨éƒ¨å‰”é™¤
  } else {
    setExcludedStores([]); // å…¨éƒ¨æ¢å¤
  }
};
```

---

## ğŸ“Š UIå¸ƒå±€ä¼˜åŒ–

### æ•´ä½“å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…¨é‡é—¨åº—å¯¹æ¯”åˆ†æ                                            â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“… å¯¹æ¯”å‘¨æœŸé€‰æ‹©  â”‚  â”‚ ğŸ” æ˜¾ç¤ºé—¨åº— (25/28)          â”‚   â”‚
â”‚  â”‚ æœ¬æœŸ: [æ—¥æœŸ]     â”‚  â”‚ [å±•å¼€ç­›é€‰å™¨]                  â”‚   â”‚
â”‚  â”‚ ä¸ŠæœŸ: è‡ªåŠ¨è®¡ç®—   â”‚  â”‚ å·²å‰”é™¤: é—¨åº—A, é—¨åº—B...      â”‚   â”‚
â”‚  â”‚ [åº”ç”¨] [é‡ç½®]    â”‚  â”‚                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚æ˜¾ç¤ºé—¨åº—â”‚æ€»è®¢å•â”‚æ€»é”€å”®â”‚æ€»åˆ©æ¶¦â”‚å¹³å‡åˆ©æ¶¦ç‡â”‚                â”‚
â”‚  â”‚ 25  â”‚10000â”‚500K â”‚100K â”‚ 20% â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ é—¨åº—æ’è¡Œæ¦œ              â”‚ é—¨åº—æ•ˆç‡æ•£ç‚¹å›¾              â”‚ â”‚
â”‚  â”‚ [å›¾è¡¨]                  â”‚ [å›¾è¡¨]                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ é—¨åº—è¯¦ç»†æ•°æ®                                          â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚ â”‚é—¨åº—åç§°â”‚è®¢å•é‡  â”‚ç¯æ¯”    â”‚é”€å”®é¢  â”‚ç¯æ¯”    â”‚      â”‚ â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚ â”‚
â”‚  â”‚ â”‚é—¨åº—A   â”‚1000    â”‚+15.2%â†‘â”‚50000   â”‚+12.3%â†‘â”‚      â”‚ â”‚
â”‚  â”‚ â”‚é—¨åº—B   â”‚800     â”‚-5.1%â†“ â”‚40000   â”‚-3.2%â†“ â”‚      â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å“åº”å¼è®¾è®¡

- **æ¡Œé¢ç«¯**ï¼šç­›é€‰å™¨å¹¶æ’æ˜¾ç¤ºï¼ˆ2åˆ—ï¼‰
- **ç§»åŠ¨ç«¯**ï¼šç­›é€‰å™¨å †å æ˜¾ç¤ºï¼ˆ1åˆ—ï¼‰
- **å›¾è¡¨åŒºåŸŸ**ï¼šè‡ªé€‚åº”é«˜åº¦å’Œå®½åº¦

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### å‰ç«¯æ”¹åŠ¨

#### 1. æ–°å¢çŠ¶æ€ç®¡ç†
```typescript
// ç‹¬ç«‹æ—¥æœŸé€‰æ‹©å™¨
const [currentPeriodStart, setCurrentPeriodStart] = useState<string>('');
const [currentPeriodEnd, setCurrentPeriodEnd] = useState<string>('');

// é—¨åº—ç­›é€‰
const [excludedStores, setExcludedStores] = useState<string[]>([]);
const [showStoreFilter, setShowStoreFilter] = useState(false);
```

#### 2. è®¡ç®—é€»è¾‘ä¼˜åŒ–
```typescript
// ä¸ŠæœŸæ—¥æœŸèŒƒå›´ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
const previousPeriod = useMemo(() => {
  // æ ¹æ®æœ¬æœŸå¤©æ•°è®¡ç®—ä¸ŠæœŸ
}, [currentPeriodStart, currentPeriodEnd]);

// è¿‡æ»¤é—¨åº—
const filteredStores = useMemo(() => {
  return stores.filter(store => !excludedStores.includes(store.store_name));
}, [stores, excludedStores]);

// æ±‡æ€»æ•°æ®ï¼ˆåŸºäºè¿‡æ»¤åçš„é—¨åº—ï¼‰
const summary = useMemo(() => {
  // é‡æ–°è®¡ç®—æ±‡æ€»æŒ‡æ ‡
}, [filteredStores]);
```

#### 3. APIè°ƒç”¨æ›´æ–°
```typescript
// ä¼ é€’è‡ªå®šä¹‰å¯¹æ¯”å‘¨æœŸ
const [comparisonRes, weekOverWeekRes] = await Promise.all([
  storeComparisonApi.getComparison({
    start_date: currentPeriodStart,
    end_date: currentPeriodEnd,
    sort_by: sortBy,
    sort_order: sortOrder
  }),
  storeComparisonApi.getWeekOverWeek(
    currentPeriodEnd,
    previousPeriod.start,
    previousPeriod.end
  )
]);
```

### åç«¯æ”¹åŠ¨

#### 1. APIå‚æ•°æ‰©å±•
```python
@router.get("/comparison/week-over-week")
async def get_stores_week_over_week(
    end_date: Optional[date] = Query(None),
    previous_start: Optional[date] = Query(None),  # æ–°å¢
    previous_end: Optional[date] = Query(None)     # æ–°å¢
):
    """æ”¯æŒè‡ªå®šä¹‰å¯¹æ¯”å‘¨æœŸ"""
```

#### 2. ç¯æ¯”è®¡ç®—é€»è¾‘
```python
# å¦‚æœæä¾›äº†è‡ªå®šä¹‰ä¸ŠæœŸï¼Œä½¿ç”¨è‡ªå®šä¹‰é€»è¾‘
if previous_start and previous_end:
    last_week_start = previous_start
    last_week_end = previous_end
    
    # è®¡ç®—æœ¬æœŸå¼€å§‹æ—¥æœŸï¼ˆæ ¹æ®ä¸ŠæœŸå¤©æ•°ï¼‰
    days = (previous_end - previous_start).days + 1
    this_week_start = end_date - timedelta(days=days - 1)
else:
    # é»˜è®¤é€»è¾‘ï¼šæœ€è¿‘7å¤© vs å‰7å¤©
    this_week_start = end_date - timedelta(days=6)
    last_week_end = this_week_start - timedelta(days=1)
    last_week_start = last_week_end - timedelta(days=6)
```

---

## ğŸ“ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1ï¼šå‘¨åº¦å¯¹æ¯”åˆ†æ

**éœ€æ±‚**ï¼šå¯¹æ¯”æœ¬å‘¨å’Œä¸Šå‘¨çš„é—¨åº—è¡¨ç°

**æ“ä½œæ­¥éª¤**ï¼š
1. é€‰æ‹©æœ¬æœŸï¼š2025-01-13 ~ 2025-01-19ï¼ˆæœ¬å‘¨ï¼‰
2. ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ä¸ŠæœŸï¼š2025-01-06 ~ 2025-01-12ï¼ˆä¸Šå‘¨ï¼‰
3. ç‚¹å‡»"åº”ç”¨"
4. æŸ¥çœ‹ç¯æ¯”æ•°æ®ï¼Œåˆ†æå‘¨åº¦å˜åŒ–

**ç»“æœ**ï¼š
- é—¨åº—Aï¼šè®¢å•é‡ +15.2% â†‘ï¼Œé”€å”®é¢ +12.3% â†‘
- é—¨åº—Bï¼šè®¢å•é‡ -5.1% â†“ï¼Œé”€å”®é¢ -3.2% â†“

### åœºæ™¯2ï¼šæœˆåº¦å¯¹æ¯”åˆ†æ

**éœ€æ±‚**ï¼šå¯¹æ¯”æœ¬æœˆå’Œä¸Šæœˆçš„é—¨åº—è¡¨ç°

**æ“ä½œæ­¥éª¤**ï¼š
1. é€‰æ‹©æœ¬æœŸï¼š2025-01-01 ~ 2025-01-31ï¼ˆæœ¬æœˆï¼‰
2. ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ä¸ŠæœŸï¼š2024-12-02 ~ 2025-01-01ï¼ˆä¸Šæœˆï¼‰
3. ç‚¹å‡»"åº”ç”¨"
4. æŸ¥çœ‹æœˆåº¦ç¯æ¯”æ•°æ®

### åœºæ™¯3ï¼šå‰”é™¤å¼‚å¸¸é—¨åº—

**éœ€æ±‚**ï¼šæŸäº›é—¨åº—æ­£åœ¨è£…ä¿®ï¼Œéœ€è¦ä»å¯¹æ¯”ä¸­å‰”é™¤

**æ“ä½œæ­¥éª¤**ï¼š
1. ç‚¹å‡»"æ˜¾ç¤ºé—¨åº—"åŒºåŸŸçš„"å±•å¼€"
2. å–æ¶ˆå‹¾é€‰"é—¨åº—C"å’Œ"é—¨åº—D"
3. æ±‡æ€»æ•°æ®å’Œå›¾è¡¨è‡ªåŠ¨æ›´æ–°
4. åªæ˜¾ç¤ºæ­£å¸¸è¥ä¸šçš„é—¨åº—æ•°æ®

**ç»“æœ**ï¼š
- æ˜¾ç¤ºé—¨åº—æ•°ï¼š25/28ï¼ˆå‰”é™¤äº†3ä¸ªé—¨åº—ï¼‰
- æ±‡æ€»æ•°æ®é‡æ–°è®¡ç®—ï¼Œæ’é™¤äº†è¢«å‰”é™¤çš„é—¨åº—

### åœºæ™¯4ï¼šå…³æ³¨é‡ç‚¹é—¨åº—

**éœ€æ±‚**ï¼šåªå…³æ³¨é”€å”®é¢Top 10çš„é—¨åº—

**æ“ä½œæ­¥éª¤**ï¼š
1. å…ˆæŒ‰é”€å”®é¢é™åºæ’åº
2. ç‚¹å‡»"å…¨éƒ¨å‰”é™¤"
3. æ‰‹åŠ¨å‹¾é€‰Top 10é—¨åº—
4. æŸ¥çœ‹é‡ç‚¹é—¨åº—çš„å¯¹æ¯”æ•°æ®

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜æœºåˆ¶

**å‰ç«¯ç¼“å­˜**ï¼š
```typescript
// ç¼“å­˜keyåŒ…å«æ—¥æœŸèŒƒå›´å’Œæ’åºå‚æ•°
const cacheKey = `${currentPeriodStart}-${currentPeriodEnd}-${sortBy}-${sortOrder}`;

// æ£€æŸ¥ç¼“å­˜
const lastCacheKey = sessionStorage.getItem('storeComparisonCacheKey');
if (lastCacheKey === cacheKey && stores.length > 0) {
  console.log('ğŸ“¦ ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œè·³è¿‡è¯·æ±‚');
  return;
}
```

**åç«¯ç¼“å­˜**ï¼š
- Redisç¼“å­˜ï¼š5åˆ†é’ŸTTL
- å†…å­˜ç¼“å­˜ï¼š5åˆ†é’ŸTTL
- ç¼“å­˜keyåŒ…å«æ—¥æœŸèŒƒå›´

### 2. æ•°æ®è¿‡æ»¤ä¼˜åŒ–

ä½¿ç”¨ `useMemo` é¿å…é‡å¤è®¡ç®—ï¼š
```typescript
const filteredStores = useMemo(() => {
  return stores.filter(store => !excludedStores.includes(store.store_name));
}, [stores, excludedStores]);
```

### 3. æŒä¹…åŒ–ä¼˜åŒ–

ä½¿ç”¨ sessionStorage å­˜å‚¨ç”¨æˆ·é€‰æ‹©ï¼š
- å‰”é™¤é—¨åº—åˆ—è¡¨
- ç¼“å­˜key
- ä¼šè¯çº§åˆ«æŒä¹…åŒ–ï¼ˆåˆ·æ–°é¡µé¢åæ¸…ç©ºï¼‰

---

## âœ… æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•æ¸…å•

#### æ—¥æœŸé€‰æ‹©å™¨
- [ ] é€‰æ‹©ä»»æ„æ—¥æœŸèŒƒå›´ï¼Œä¸ŠæœŸè‡ªåŠ¨è®¡ç®—æ­£ç¡®
- [ ] ç‚¹å‡»"åº”ç”¨"æŒ‰é’®ï¼Œæ•°æ®æ­£ç¡®åŠ è½½
- [ ] ç‚¹å‡»"é‡ç½®"æŒ‰é’®ï¼Œæ¢å¤é»˜è®¤ï¼ˆæœ€è¿‘7å¤©ï¼‰
- [ ] æ—¥æœŸèŒƒå›´é™åˆ¶æ­£ç¡®ï¼ˆä¸èƒ½è¶…å‡ºæ•°æ®èŒƒå›´ï¼‰

#### ç¯æ¯”è®¡ç®—
- [ ] 7å¤©å¯¹æ¯”ï¼šç¯æ¯”æ•°æ®æ­£ç¡®
- [ ] 15å¤©å¯¹æ¯”ï¼šç¯æ¯”æ•°æ®æ­£ç¡®
- [ ] å•æ—¥å¯¹æ¯”ï¼šç¯æ¯”æ•°æ®æ­£ç¡®
- [ ] ç¯æ¯”ç®­å¤´æ–¹å‘æ­£ç¡®ï¼ˆâ†‘/â†“ï¼‰

#### é—¨åº—ç­›é€‰
- [ ] å‹¾é€‰/å–æ¶ˆå‹¾é€‰é—¨åº—ï¼Œè¡¨æ ¼å’Œå›¾è¡¨æ­£ç¡®æ›´æ–°
- [ ] ç‚¹å‡»"å…¨éƒ¨å‰”é™¤"ï¼Œæ‰€æœ‰é—¨åº—è¢«å‰”é™¤
- [ ] ç‚¹å‡»"å…¨éƒ¨æ¢å¤"ï¼Œæ‰€æœ‰é—¨åº—æ¢å¤æ˜¾ç¤º
- [ ] æ±‡æ€»æ•°æ®æ­£ç¡®æ’é™¤è¢«å‰”é™¤çš„é—¨åº—
- [ ] åˆ·æ–°é¡µé¢åï¼Œå‰”é™¤çŠ¶æ€ä¿æŒï¼ˆsessionStorageï¼‰

#### æ€§èƒ½æµ‹è¯•
- [ ] é¦–æ¬¡åŠ è½½æ—¶é—´ < 1ç§’
- [ ] åˆ‡æ¢æ—¥æœŸèŒƒå›´ï¼Œå“åº”æ—¶é—´ < 500ms
- [ ] å‰”é™¤é—¨åº—ï¼ŒUIæ›´æ–°æ—¶é—´ < 100ms
- [ ] ç¼“å­˜ç”Ÿæ•ˆï¼Œé‡å¤è¯·æ±‚è¢«è·³è¿‡

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

### å‰ç«¯æ–‡ä»¶
- `frontend-react/src/views/StoreComparisonView.tsx` - ä¸»è§†å›¾ï¼ˆå·²æ›´æ–°ï¼‰
- `frontend-react/src/api/storeComparison.ts` - APIå®šä¹‰ï¼ˆå·²æ›´æ–°ï¼‰
- `frontend-react/src/components/StoreComparisonTable.tsx` - æ•°æ®è¡¨æ ¼
- `frontend-react/src/components/charts/StoreRankingChart.tsx` - æ’è¡Œæ¦œå›¾è¡¨
- `frontend-react/src/components/charts/StoreEfficiencyScatter.tsx` - æ•£ç‚¹å›¾

### åç«¯æ–‡ä»¶
- `backend/app/api/v1/store_comparison.py` - é—¨åº—å¯¹æ¯”APIï¼ˆå·²æ›´æ–°ï¼‰

### æ–‡æ¡£æ–‡ä»¶
- `å…¨é‡é—¨åº—å¯¹æ¯”-è§„èŒƒè¯´æ˜.md` - åŠŸèƒ½è§„èŒƒè¯´æ˜
- `å…¨é‡é—¨åº—å¯¹æ¯”-ç¼“å­˜å®ç°è¯´æ˜.md` - ç¼“å­˜å®ç°æ–‡æ¡£
- `å…¨é‡é—¨åº—å¯¹æ¯”-å®Œæˆæ€»ç»“.md` - v1.0å®Œæˆæ€»ç»“
- `å…¨é‡é—¨åº—å¯¹æ¯”-åŠŸèƒ½å‡çº§è¯´æ˜_v2.0.md` - æœ¬æ–‡æ¡£

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### 1. é¢„è®¾å¯¹æ¯”å‘¨æœŸ

æ·»åŠ å¿«æ·é€‰æ‹©æŒ‰é’®ï¼š
- [æœ¬å‘¨ vs ä¸Šå‘¨]
- [æœ¬æœˆ vs ä¸Šæœˆ]
- [æœ€è¿‘7å¤© vs å‰7å¤©]
- [æœ€è¿‘30å¤© vs å‰30å¤©]

### 2. é—¨åº—åˆ†ç»„

æ”¯æŒæŒ‰åŒºåŸŸã€ç±»å‹ç­‰ç»´åº¦åˆ†ç»„ï¼š
- åä¸œåŒº vs åå—åŒº
- ç›´è¥åº— vs åŠ ç›Ÿåº—
- Aç±»é—¨åº— vs Bç±»é—¨åº—

### 3. å¯¼å‡ºåŠŸèƒ½

æ”¯æŒå¯¼å‡ºå¯¹æ¯”æŠ¥å‘Šï¼š
- Excelæ ¼å¼ï¼ˆåŒ…å«æ‰€æœ‰æ•°æ®ï¼‰
- PDFæ ¼å¼ï¼ˆåŒ…å«å›¾è¡¨ï¼‰
- è‡ªå®šä¹‰å¯¼å‡ºå­—æ®µ

### 4. å¯¹æ¯”æ¨¡å¼

æ”¯æŒå¤šç§å¯¹æ¯”æ¨¡å¼ï¼š
- ç¯æ¯”å¯¹æ¯”ï¼ˆå½“å‰å®ç°ï¼‰
- åŒæ¯”å¯¹æ¯”ï¼ˆå»å¹´åŒæœŸï¼‰
- ç›®æ ‡å¯¹æ¯”ï¼ˆvs ç›®æ ‡å€¼ï¼‰

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§ âœ…
- [x] ç‹¬ç«‹æ—¥æœŸé€‰æ‹©å™¨æ­£å¸¸å·¥ä½œ
- [x] ç¯æ¯”è®¡ç®—åŸºäºç”¨æˆ·é€‰æ‹©çš„å‘¨æœŸ
- [x] é—¨åº—ç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [x] æ‰€æœ‰äº¤äº’åŠŸèƒ½æ­£å¸¸

### æ€§èƒ½è¦æ±‚ âœ…
- [x] é¦–æ¬¡åŠ è½½ < 1ç§’
- [x] æ—¥æœŸåˆ‡æ¢ < 500ms
- [x] é—¨åº—ç­›é€‰ < 100ms
- [x] ç¼“å­˜æœºåˆ¶ç”Ÿæ•ˆ

### ä»£ç è´¨é‡ âœ…
- [x] ç¼–è¯‘æ— é”™è¯¯
- [x] ç±»å‹å®šä¹‰å®Œæ•´
- [x] ä»£ç ç»“æ„æ¸…æ™°
- [x] æ³¨é‡Šå®Œå–„

### ç”¨æˆ·ä½“éªŒ âœ…
- [x] UIç¾è§‚ç›´è§‚
- [x] äº¤äº’æµç•…
- [x] æç¤ºæ¸…æ™°
- [x] å“åº”å¼è®¾è®¡

---

## ğŸ“Š ç‰ˆæœ¬å¯¹æ¯”

| åŠŸèƒ½ | v1.0 | v2.0 |
|------|------|------|
| æ—¥æœŸç­›é€‰ | ä½¿ç”¨å…¨å±€æ—¥æœŸç­›é€‰å™¨ | âœ… ç‹¬ç«‹æ—¥æœŸé€‰æ‹©å™¨ |
| ç¯æ¯”è®¡ç®— | å›ºå®š7å¤©å¯¹æ¯” | âœ… æ”¯æŒä»»æ„å¤©æ•°å¯¹æ¯” |
| é—¨åº—ç­›é€‰ | æ—  | âœ… æ”¯æŒå‰”é™¤é—¨åº— |
| å¯¹æ¯”å‘¨æœŸæ˜¾ç¤º | æ—  | âœ… æ˜ç¡®æ˜¾ç¤ºæœ¬æœŸå’Œä¸ŠæœŸ |
| æ±‡æ€»æ•°æ® | å…¨éƒ¨é—¨åº— | âœ… åŸºäºç­›é€‰åçš„é—¨åº— |
| æŒä¹…åŒ– | ä»…ç¼“å­˜æ•°æ® | âœ… ç¼“å­˜æ•°æ® + ç­›é€‰çŠ¶æ€ |

---

## ğŸ‰ æ€»ç»“

v2.0å‡çº§ä¸º"å…¨é‡é—¨åº—å¯¹æ¯”åˆ†æ"åŠŸèƒ½å¸¦æ¥äº†ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ï¼š

1. **çµæ´»çš„å¯¹æ¯”å‘¨æœŸ** - ç”¨æˆ·å¯ä»¥è‡ªç”±é€‰æ‹©ä»»æ„æ—¥æœŸèŒƒå›´è¿›è¡Œå¯¹æ¯”
2. **æ™ºèƒ½çš„ç¯æ¯”è®¡ç®—** - ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ç›¸åŒå¤©æ•°çš„å‰ä¸€ä¸ªå‘¨æœŸ
3. **ç²¾å‡†çš„é—¨åº—ç­›é€‰** - ç”¨æˆ·å¯ä»¥å‰”é™¤ä¸å…³æ³¨çš„é—¨åº—ï¼Œèšç„¦é‡ç‚¹

è¿™äº›åŠŸèƒ½å¤§å¤§æå‡äº†æ•°æ®åˆ†æçš„çµæ´»æ€§å’Œç²¾å‡†åº¦ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿæ›´å¥½åœ°å‘ç°é—¨åº—çš„ä¼˜åŠ£åŠ¿ï¼Œåšå‡ºæ›´æ˜æ™ºçš„ç»è¥å†³ç­–ã€‚

**çŠ¶æ€**: ğŸ‰ å…¨éƒ¨å®Œæˆï¼Œå¯ä»¥äº¤ä»˜ä½¿ç”¨ï¼
