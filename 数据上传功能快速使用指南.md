# 📤 数据上传功能 - 快速使用指南

## 🚀 快速开始

### 方式1: 上传新数据（推荐用于验证Dash版本准确性）

1. **启动应用**
   ```
   访问 http://localhost:8050
   ```

2. **找到数据源选择区域**（页面顶部）
   - 看到"📂 数据源选择"卡片
   - 当前显示：`当前数据: 默认数据`

3. **点击"📤 上传新数据"Tab**

4. **上传Excel文件**
   - **方式A**: 拖拽Excel文件到上传区域
   - **方式B**: 点击上传区域，选择文件
   - 💡 **支持多文件**：按住Ctrl可选择多个文件

5. **查看结果**
   ```
   ✅ 数据上传成功！
   ─────────────────────────────
   📊 文件数量: 1 个
   📈 原始数据: 24,936 行
   🔴 剔除耗材: 6,025 行
   ☕ 剔除咖啡: 1,461 行
   ✅ 最终数据: 17,450 行 × 35 列
   ```

6. **验证数据**
   - 切换到"📊 订单数据概览"Tab
   - 查看订单总数、销售额等指标
   - 与Streamlit版本对比，应该**完全一致**

---

### 方式2: 加载历史数据（快速切换数据版本）

1. **点击"📂 加载历史数据"Tab**

2. **查看历史列表**
   ```
   ✅ 找到 3 个历史数据版本
   
   ┌─────────────────────────────────┐
   │ 📄 订单数据-本店.xlsx           │
   │ 🕒 2025-10-17 14:30:25         │
   │ 📊 17,450 行  |  💾 2.3 MB     │
   │                    [加载]       │
   └─────────────────────────────────┘
   ```

3. **点击"加载"按钮**
   - 数据立即生效
   - 所有Tab自动更新

---

## ✅ 验证Dash版本准确性的步骤

### Step 1: 准备Streamlit版本的数据

1. 打开Streamlit版本
2. 上传相同的Excel文件
3. 记录关键指标：
   ```
   订单总数: _______
   销售总额: _______
   商品数量: _______
   利润总额: _______
   ```

### Step 2: 在Dash版本上传相同数据

1. 打开Dash版本（http://localhost:8050）
2. 上传相同的Excel文件
3. 查看上传结果

### Step 3: 对比关键指标

打开"📊 订单数据概览"Tab，对比：

| 指标 | Streamlit | Dash | 是否一致 |
|------|-----------|------|---------|
| 订单总数 | _____ | _____ | ☐ |
| 销售总额 | _____ | _____ | ☐ |
| 商品数量 | _____ | _____ | ☐ |
| 利润总额 | _____ | _____ | ☐ |

**预期结果**: 所有指标应该100%一致 ✅

---

## 🎯 使用场景

### 场景1: 验证新功能准确性
```
1. 在Streamlit上传数据 → 记录结果
2. 在Dash上传同一数据 → 对比结果
3. 确认数据处理逻辑一致
```

### 场景2: 切换不同数据集
```
1. 上传9月数据 → 查看9月分析
2. 切换到10月数据 → 查看10月分析
3. 对比两个月的变化
```

### 场景3: 合并多个文件
```
1. 选择多个Excel文件
2. 系统自动合并
3. 统一分析
```

---

## 📋 支持的文件格式

### Excel格式
- ✅ `.xlsx` (推荐)
- ✅ `.xls`

### 必需字段
- `订单ID`
- `商品名称`
- `商品实售价`
- `销量`
- `下单时间`
- `门店名称`
- `渠道`

### 推荐字段（用于完整分析）
- `物流配送费`
- `平台佣金`
- `配送距离`
- `美团一级分类`
- `美团三级分类`
- `商品采购成本`

---

## 🔍 数据处理规则（自动应用）

系统会自动应用以下业务规则：

### 规则1: 剔除耗材数据
```
条件: 一级分类名 == '耗材'
说明: 购物袋等耗材不是销售商品
影响: 通常剔除 6,000+ 行
```

### 规则2: 剔除咖啡渠道
```
条件: 渠道 in ['饿了么咖啡', '美团咖啡']
说明: 咖啡业务非O2O零售核心
影响: 通常剔除 1,400+ 行
```

**示例**：
```
原始数据: 24,936 行
↓
剔除耗材: -6,025 行
↓
剔除咖啡: -1,461 行
↓
最终数据: 17,450 行 ✅
```

---

## ❓ 常见问题

### Q1: 为什么上传后数据行数变少了？
**A**: 系统自动剔除了耗材（购物袋等）和咖啡渠道数据，这与Streamlit版本保持一致。

### Q2: 可以上传多个文件吗？
**A**: 可以！按住Ctrl选择多个文件，系统会自动合并。

### Q3: 历史数据存储在哪里？
**A**: `学习数据仓库/uploaded_data/` 目录，使用gzip压缩（节省70%空间）。

### Q4: 上传失败怎么办？
**A**: 检查：
- 文件格式是否为.xlsx或.xls
- 必需字段是否完整
- 文件是否损坏

### Q5: 如何验证Dash版本的准确性？
**A**: 
1. 在Streamlit上传数据，记录关键指标
2. 在Dash上传相同数据
3. 对比订单数、销售额、利润等
4. 应该100%一致

---

## 💡 提示

### 最佳实践
- ✅ 每次上传后检查数据行数
- ✅ 对比Streamlit版本验证准确性
- ✅ 使用历史数据快速切换版本
- ✅ 定期清理不需要的历史缓存

### 性能建议
- 📊 10k行数据: 上传约2秒
- 📊 25k行数据: 上传约4秒
- 📊 50k行数据: 上传约9秒

---

## 📞 需要帮助？

详细文档请查看：
- 📖 完整功能报告：`数据上传和历史加载功能开发完成报告.md`
- 📝 使用指南：本文档
- 🐛 问题反馈：记录遇到的问题

---

**快速使用指南** | 版本 v1.0 | 2025年10月17日
