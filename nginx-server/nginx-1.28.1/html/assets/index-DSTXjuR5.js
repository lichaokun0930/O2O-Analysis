const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DataManagement-D5Hd_hDJ.js","assets/react-vendor-BU-CX47b.js","assets/react-vendor-xiMy4gMA.css","assets/StoreComparisonView-BVgDpz5R.js","assets/Skeleton-B00SeqEU.js"])))=>i.map(i=>d[i]);
import{a as ft,r,j as e,p as he,f as ge,i as Te,b as mt,c as pt,d as Fe,S as ht,C as Ce,e as gt,g as be,h as Ue,D as bt,z as yt,k as Oe,l as _e,u as Lt,Z as vt,L as Dt,m as Et,P as Tt,T as Re,n as Ot,M as At,o as Rt,U as It,q as Pt,A as wt,B as Ft,s as Bt,t as Wt,v as Vt,w as Ut,x as qe,y as $e,E as Ze,F as oe,G as Ht,H as He,I as Gt,J as Ye,X as jt,R as ue,K as ke,N as Kt,O as qt,Q as Yt,V as Me,W as Ge,Y as Ae,_ as Nt,$ as Jt,a0 as Xt,a1 as Zt,a2 as Qt,a3 as es,a4 as Je,a5 as ts,a6 as ss,a7 as as,a8 as rs,a9 as ns,aa as os,ab as ls,ac as Qe,ad as Ke,ae as is,af as cs,ag as De,ah as ds,ai as ve,aj as xs,ak as us,al as et,am as St,an as fs,ao as ms}from"./react-vendor-BU-CX47b.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function l(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=l(n);fetch(n.href,o)}})();const we={getSummary:async(t,a)=>{const l=new URLSearchParams;return t&&l.append("store_name",t),a&&l.append("category",a),(await fe.get(`/inventory-risk/summary?${l.toString()}`)).data.data},getSoldOutProducts:async(t,a,l=1,s=20)=>{const n=new URLSearchParams;t&&n.append("store_name",t),a&&n.append("category",a),n.append("page",l.toString()),n.append("page_size",s.toString());const o=await fe.get(`/inventory-risk/sold-out?${n.toString()}`);return{data:o.data.data,total:o.data.total}},getSlowMovingProducts:async(t,a,l,s=1,n=20)=>{const o=new URLSearchParams;t&&o.append("store_name",t),a&&o.append("category",a),l&&o.append("severity",l),o.append("page",s.toString()),o.append("page_size",n.toString());const d=await fe.get(`/inventory-risk/slow-moving?${o.toString()}`);return{data:d.data.data,total:d.data.total,by_severity:d.data.by_severity}},getCategoryRiskStats:async t=>{const a=new URLSearchParams;return t&&a.append("store_name",t),(await fe.get(`/inventory-risk/category-risk?${a.toString()}`)).data.data},getRiskTrend:async(t,a,l=30)=>{const s=new URLSearchParams;return t&&s.append("store_name",t),a&&s.append("category",a),s.append("days",l.toString()),(await fe.get(`/inventory-risk/trend?${s.toString()}`)).data},getSoldOutAnalysis:async(t,a,l=30)=>{const s=new URLSearchParams;return t&&s.append("store_name",t),a&&s.append("category",a),s.append("days",l.toString()),(await fe.get(`/inventory-risk/sold-out-analysis?${s.toString()}`)).data}},ps={async getPerformanceWithRisk(t){const a=new URLSearchParams;t.store_name&&a.append("store_name",t.store_name),t.parent_category&&a.append("parent_category",t.parent_category),t.channel&&a.append("channel",t.channel);const l=`/category-matrix/with-risk${a.toString()?"?"+a.toString():""}`;return(await fe.get(l)).data},async getPerformance(t){const a=new URLSearchParams;t.store_name&&a.append("store_name",t.store_name),t.parent_category&&a.append("parent_category",t.parent_category),t.channel&&a.append("channel",t.channel),t.start_date&&a.append("start_date",t.start_date),t.end_date&&a.append("end_date",t.end_date);const l=`/category-matrix/performance${a.toString()?"?"+a.toString():""}`;return(await fe.get(l)).data}},Xe="/api/v1";console.log("API Base URL:",Xe);const fe=ft.create({baseURL:Xe,timeout:6e4,headers:{"Content-Type":"application/json"}});fe.interceptors.response.use(t=>t,t=>{var a;return console.error("API Error:",t.message,(a=t.config)==null?void 0:a.url),Promise.reject(t)});const Q=ft.create({baseURL:Xe,timeout:6e4,headers:{"Content-Type":"application/json"}});Q.interceptors.response.use(t=>t.data,t=>{var a;return console.error("API Error:",t.message,(a=t.config)==null?void 0:a.url),Promise.reject(t)});const tt={getStats(){return Q.get("/data/stats")},getStores(){return Q.get("/data/stores")},loadFromDatabase(t){return Q.post("/data/database/load",null,{params:t})},uploadOrders(t,a){const l=new FormData;l.append("file",t);const s=new URLSearchParams;return a!=null&&a.mode&&s.append("mode",a.mode),fetch(`/api/v1/data/upload/orders?${s.toString()}`,{method:"POST",body:l}).then(async n=>{const o=await n.json();if(!n.ok)throw new Error(o.detail||"ä¸Šä¼ å¤±è´¥");return o})},getStoreStats(t){return Q.get(`/data/store/${encodeURIComponent(t)}/stats`)},deleteStoreData(t){return Q.delete(`/data/store/${encodeURIComponent(t)}`)},clearCache(t){return Q.post("/data/clear-cache",{level:t})},optimizeDatabase(){return Q.post("/data/database/optimize")}},ie={getOverview(t){return Q.get("/orders/overview",{params:t})},getComparison(t){return Q.get("/orders/comparison",{params:t})},getChannelStats(t){return Q.get("/orders/channels",{params:t})},getCostStructure(t){return Q.get("/orders/cost-structure",{params:t})},getTrend(t){return Q.get("/orders/trend",{params:t})},getStores(){return Q.get("/orders/stores")},getChannels(t){return Q.get("/orders/channel-list",{params:t})},getPriceDistribution(t){return Q.get("/orders/price-distribution",{params:t})},getProfitDistribution(t){return Q.get("/orders/profit-distribution",{params:t})},getChannelComparison(t){return Q.get("/orders/channel-comparison",{params:t})},getAnomalyDetection(t){return Q.get("/orders/anomaly-detection",{params:t})},getDateRange(t){return Q.get("/orders/date-range",{params:t})},getCategoryHourlyTrend(t){return Q.get("/orders/category-hourly-trend",{params:t})},getTopProductsByDate(t){return Q.get("/orders/top-products-by-date",{params:t})},getHourlyProfit(t){return Q.get("/orders/hourly-profit",{params:t})},getDistanceAnalysis(t){return Q.get("/orders/distance-analysis",{params:t})},getDeliveryRadar(t){return Q.get("/orders/delivery-radar",{params:t})},getMarketingStructure(t){return Q.get("/orders/marketing-structure",{params:t})},getMarketingTrend(t){return Q.get("/orders/marketing-trend",{params:t})}},kt=r.createContext(null),hs=(t,a)=>{const l=a||new Date,s=n=>n.toISOString().split("T")[0];switch(t){case"today":return{start:s(l),end:s(l)};case"yesterday":{const n=new Date(l);return n.setDate(l.getDate()-1),{start:s(n),end:s(n)}}case"7days":{const n=new Date(l);return n.setDate(l.getDate()-6),{start:s(n),end:s(l)}}case"30days":{const n=new Date(l);return n.setDate(l.getDate()-29),{start:s(n),end:s(l)}}case"thisWeek":{const n=new Date(l);return n.setDate(l.getDate()-l.getDay()),{start:s(n),end:s(l)}}case"thisMonth":{const n=new Date(l.getFullYear(),l.getMonth(),1);return{start:s(n),end:s(l)}}case"all":return{start:"",end:""};default:return{start:s(l),end:s(l)}}},gs=({children:t})=>{const[a,l]=r.useState([]),[s,n]=r.useState(""),[o,d]=r.useState(!1),[x,f]=r.useState("all"),[m,c]=r.useState([]),[i,p]=r.useState(!1),[u,h]=r.useState({type:"all",start:"",end:""}),[j,b]=r.useState(null),[M,L]=r.useState(!1),[P,T]=r.useState(null),[w,z]=r.useState(!1),[O,E]=r.useState(null),[$,I]=r.useState(null),[H,K]=r.useState(!1),[k,D]=r.useState({database:"checking",redis:"checking",lastCheck:null}),W=r.useCallback(y=>{if(y==="all")h({type:"all",start:"",end:""});else{const g=j!=null&&j.max_date?new Date(j.max_date):new Date,{start:N,end:R}=hs(y,g);h({type:y,start:N,end:R}),console.log(`ğŸ“… æ—¥æœŸèŒƒå›´è®¡ç®—: ${y}, å‚è€ƒæ—¥æœŸ: ${g.toISOString().split("T")[0]}, ç»“æœ: ${N} ~ ${R}`)}},[j]),v=r.useCallback(async()=>{if(!s){b(null);return}L(!0);try{const y={store_name:s},g=await ie.getDateRange(y);g.success&&(b(g.data),console.log("ğŸ“… é—¨åº—æ•°æ®æ—¥æœŸèŒƒå›´:",g.data))}catch(y){console.error("è·å–é—¨åº—æ—¥æœŸèŒƒå›´å¤±è´¥:",y),b(null)}finally{L(!1)}},[s]),C=r.useCallback(async()=>{if(!s){c([]);return}p(!0);try{const y=await ie.getChannels({store_name:s});y.success&&y.data&&(c(y.data),x!=="all"&&!y.data.includes(x)&&f("all"),console.log("ğŸ“¡ æ¸ é“åˆ—è¡¨å·²æ›´æ–°:",y.data.length,"ä¸ªæ¸ é“"))}catch(y){console.error("è·å–æ¸ é“åˆ—è¡¨å¤±è´¥:",y),c([])}finally{p(!1)}},[s,x]),F=r.useCallback(y=>{n(y)},[]),A=r.useCallback(async()=>{d(!0);try{const y=await tt.getStores();y.success&&l(y.data)}catch(y){console.error("è·å–é—¨åº—åˆ—è¡¨å¤±è´¥:",y),l([])}finally{d(!1)}},[]),S=r.useCallback(async()=>{z(!0);try{const y=await tt.getStats();T(y),D({database:y.database_status==="å·²è¿æ¥"?"connected":"disconnected",redis:y.redis_status==="å·²è¿æ¥"?"connected":"disconnected",lastCheck:new Date})}catch(y){console.error("è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥:",y),D({database:"disconnected",redis:"disconnected",lastCheck:new Date})}finally{z(!1)}},[]),V=r.useCallback(async(y=3,g=2e3)=>{let N=null;for(let R=0;R<y;R++)try{await S();return}catch(q){N=q,console.log(`é‡è¯• ${R+1}/${y} å¤±è´¥ï¼Œ${g}ms åå†æ¬¡å°è¯•...`),R<y-1&&await new Promise(X=>setTimeout(X,g))}console.error("æ‰€æœ‰é‡è¯•å‡å¤±è´¥:",N)},[S]),U=r.useCallback(async()=>{if(!s){E(null),I(null),K(!1),console.log("ğŸ“Š æœªé€‰æ‹©é—¨åº—ï¼Œä¸åŠ è½½æ•°æ®");return}K(!0);try{const y={store_name:s};u.type!=="all"&&u.start&&u.end&&(y.start_date=u.start,y.end_date=u.end),console.log("ğŸ“Š è¯·æ±‚è®¢å•æ¦‚è§ˆ, å‚æ•°:",y,"æ—¥æœŸç±»å‹:",u.type);const[g,N]=await Promise.all([ie.getOverview(y),ie.getComparison(y)]);if(g.success?E(g.data):(console.error("âŒ è®¢å•æ¦‚è§ˆè·å–å¤±è´¥:",g),E(null)),N.success&&N.data){const R=N.data.previous;R&&(R.order_count>0||R.total_sales>0||R.total_profit!==0)?(I(N.data),console.log("ğŸ“Š ç¯æ¯”æ•°æ®æœ‰æ•ˆ:",N.data.period)):(I(null),console.log("ğŸ“Š ä¸Šä¸€å‘¨æœŸæ— æ•°æ®ï¼Œä¸æ˜¾ç¤ºç¯æ¯”"))}else I(null)}catch(y){console.error("âŒ è·å–è®¢å•æ¦‚è§ˆå¤±è´¥:",y),E(null),I(null)}finally{K(!1)}},[s,u.type,u.start,u.end]),Y=r.useCallback(async()=>{await Promise.all([A(),S(),v(),C()]),await U()},[A,S,v,C,U]);r.useEffect(()=>{A(),V(5,2e3)},[]),r.useEffect(()=>{const y=setInterval(()=>{S()},3e4);return()=>clearInterval(y)},[]),r.useEffect(()=>{v(),C()},[s]),r.useEffect(()=>{U()},[s,u.type,u.start,u.end]);const G={stores:a,selectedStore:s,setSelectedStore:F,storesLoading:o,selectedChannel:x,setSelectedChannel:f,channelList:m,channelListLoading:i,dateRange:u,setDateRange:h,setQuickDateRange:W,storeDateRange:j,storeDateRangeLoading:M,stats:P,statsLoading:w,orderOverview:O,orderComparison:$,orderOverviewLoading:H,systemStatus:k,refreshStores:A,refreshStats:S,refreshOrderOverview:U,refreshStoreDateRange:v,refreshChannelList:C,refreshAll:Y};return e.jsx(kt.Provider,{value:G,children:t})},ce=()=>{const t=r.useContext(kt);if(!t)throw new Error("useGlobalContext must be used within GlobalProvider");return t},bs="modulepreload",ys=function(t){return"/"+t},st={},Le=function(a,l,s){let n=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),x=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));n=Promise.allSettled(l.map(f=>{if(f=ys(f),f in st)return;st[f]=!0;const m=f.endsWith(".css"),c=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${c}`))return;const i=document.createElement("link");if(i.rel=m?"stylesheet":bs,m||(i.as="script"),i.crossOrigin="",i.href=f,x&&i.setAttribute("nonce",x),document.head.appendChild(i),m)return new Promise((p,u)=>{i.addEventListener("load",p),i.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${f}`)))})}))}function o(d){const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=d,window.dispatchEvent(x),!x.defaultPrevented)throw d}return n.then(d=>{for(const x of d||[])x.status==="rejected"&&o(x.reason);return a().catch(o)})},at=[{type:"all",label:"å…¨éƒ¨æ—¶é—´"},{type:"yesterday",label:"æ˜¨æ—¥"},{type:"7days",label:"è¿‘7å¤©"},{type:"30days",label:"è¿‘30å¤©"},{type:"thisWeek",label:"æœ¬å‘¨"},{type:"thisMonth",label:"æœ¬æœˆ"}],vs=()=>{var V,U,Y,G;const{stores:t,selectedStore:a,setSelectedStore:l,storesLoading:s,dateRange:n,setQuickDateRange:o,setDateRange:d,storeDateRange:x}=ce(),[f,m]=r.useState(!1),[c,i]=r.useState(!1),[p,u]=r.useState(!1),[h,j]=r.useState(""),[b,M]=r.useState(),L=r.useRef(null),P=r.useRef(null),T=r.useRef(null),w=r.useRef(null),z=r.useRef(null),O=r.useRef(null),E=x!=null&&x.min_date?he(x.min_date,"yyyy-MM-dd",new Date):void 0,$=x!=null&&x.max_date?he(x.max_date,"yyyy-MM-dd",new Date):void 0;r.useEffect(()=>{const y=g=>{const N=g.target;f&&L.current&&!L.current.contains(N)&&w.current&&!w.current.contains(N)&&m(!1),c&&P.current&&!P.current.contains(N)&&z.current&&!z.current.contains(N)&&i(!1),p&&T.current&&!T.current.contains(N)&&O.current&&!O.current.contains(N)&&u(!1)};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[f,c,p]);const I=y=>y.replace(/\s*\([0-9,]+å•\)\s*$/,"").trim(),H=t.filter(y=>I(y.label).toLowerCase().includes(h.toLowerCase())),K=a?I(((V=t.find(y=>y.value===a))==null?void 0:V.label)||a):"é€‰æ‹©é—¨åº—",k=n.type==="custom"?`${n.start} ~ ${n.end}`:((U=at.find(y=>y.type===n.type))==null?void 0:U.label)||"å…¨éƒ¨",D=r.useCallback(y=>{l(y),m(!1),j("")},[l]),W=r.useCallback(y=>{o(y),i(!1)},[o]),v=r.useCallback(y=>{M(y)},[]),C=r.useCallback(()=>{b!=null&&b.from&&(b!=null&&b.to)&&(d({type:"custom",start:ge(b.from,"yyyy-MM-dd"),end:ge(b.to,"yyyy-MM-dd")}),u(!1))},[b,d]),F=r.useCallback(()=>{if(n.type==="custom"&&n.start&&n.end){const y=he(n.start,"yyyy-MM-dd",new Date),g=he(n.end,"yyyy-MM-dd",new Date);Te(y)&&Te(g)&&M({from:y,to:g})}else M(void 0);u(!0)},[n]),A=r.useCallback(y=>!!(E&&mt(y,E)||$&&pt(y,$)),[E,$]),S=y=>{if(!y.current)return{top:0,left:0};const g=y.current.getBoundingClientRect();return{top:g.bottom+8,left:g.left}};return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:L,onClick:()=>m(!f),className:"flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-sm text-white transition-all",children:[e.jsx(ht,{size:16,className:"text-indigo-400"}),e.jsx("span",{className:"max-w-[120px] truncate",children:K}),e.jsx(Ce,{size:14,className:`text-slate-400 transition-transform ${f?"rotate-180":""}`})]}),f&&Fe.createPortal(e.jsxs("div",{ref:w,style:S(L),className:"fixed w-64 bg-slate-900 border border-white/10 rounded-xl shadow-2xl z-[9999] overflow-hidden animate-fade-in-up",children:[e.jsx("div",{className:"p-2 border-b border-white/10",children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white/5 rounded-lg",children:[e.jsx(gt,{size:14,className:"text-slate-400"}),e.jsx("input",{type:"text",placeholder:"æœç´¢é—¨åº—...",value:h,onChange:y=>j(y.target.value),className:"flex-1 bg-transparent text-sm text-white placeholder-slate-500 outline-none",autoFocus:!0})]})}),e.jsxs("div",{className:"max-h-64 overflow-y-auto custom-scrollbar",children:[e.jsx("div",{className:"px-4 py-2 text-xs text-slate-500 border-b border-white/5",children:"è¯·é€‰æ‹©ä¸€ä¸ªé—¨åº—æŸ¥çœ‹æ•°æ®"}),s?e.jsx("div",{className:"px-4 py-8 text-center text-slate-500 text-sm",children:"åŠ è½½ä¸­..."}):H.length===0?e.jsx("div",{className:"px-4 py-8 text-center text-slate-500 text-sm",children:h?"æœªæ‰¾åˆ°åŒ¹é…çš„é—¨åº—":"æš‚æ— é—¨åº—æ•°æ®"}):H.map(y=>e.jsxs("button",{onClick:()=>D(y.value),className:`w-full flex items-center justify-between px-4 py-2.5 text-sm transition-colors ${a===y.value?"bg-indigo-500/20 text-indigo-300":"text-slate-300 hover:bg-white/5"}`,children:[e.jsx("span",{children:I(y.label)}),a===y.value&&e.jsx(be,{size:14,className:"text-indigo-400"})]},y.value))]})]}),document.body)]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:P,onClick:()=>i(!c),className:"flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-sm text-white transition-all",children:[e.jsx(Ue,{size:16,className:"text-emerald-400"}),e.jsx("span",{className:"max-w-[180px] truncate",children:k}),e.jsx(Ce,{size:14,className:`text-slate-400 transition-transform ${c?"rotate-180":""}`})]}),c&&Fe.createPortal(e.jsx("div",{ref:z,style:S(P),className:"fixed w-40 bg-slate-900 border border-white/10 rounded-xl shadow-2xl z-[9999] overflow-hidden animate-fade-in-up",children:at.map(({type:y,label:g})=>e.jsxs("button",{onClick:()=>W(y),className:`w-full flex items-center justify-between px-4 py-2.5 text-sm transition-colors ${n.type===y?"bg-emerald-500/20 text-emerald-300":"text-slate-300 hover:bg-white/5"}`,children:[e.jsx("span",{children:g}),n.type===y&&e.jsx(be,{size:14,className:"text-emerald-400"})]},y))}),document.body)]}),e.jsxs("button",{ref:T,onClick:F,className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-all ${n.type==="custom"?"bg-indigo-500/20 border-indigo-500/50 text-indigo-300":"bg-white/5 border-white/10 text-slate-400 hover:bg-white/10 hover:text-white hover:border-white/20"}`,children:[e.jsx(Ue,{size:16,className:n.type==="custom"?"text-indigo-400":"text-slate-400"}),e.jsx("span",{className:"text-sm",children:"è‡ªå®šä¹‰"})]}),p&&Fe.createPortal(e.jsxs("div",{ref:O,style:{top:((Y=T.current)==null?void 0:Y.getBoundingClientRect().bottom)+8,left:Math.min(((G=T.current)==null?void 0:G.getBoundingClientRect().left)||0,window.innerWidth-620)},className:"fixed z-[9999] p-5 rounded-xl border shadow-2xl bg-slate-900 border-white/10",children:[(x==null?void 0:x.min_date)&&(x==null?void 0:x.max_date)&&e.jsx("div",{className:"mb-4 px-3 py-2 bg-indigo-500/10 border border-indigo-500/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-indigo-300",children:["ğŸ“… å¯é€‰æ•°æ®èŒƒå›´: ",x.min_date," ~ ",x.max_date]})}),e.jsx("style",{children:`
            .calendar-container .rdp-root {
              --rdp-accent-color: #6366f1;
              --rdp-accent-background-color: rgba(99, 102, 241, 0.2);
            }
            .calendar-container .rdp-months {
              display: flex;
              gap: 2rem;
            }
            .calendar-container .rdp-month_caption {
              display: flex;
              justify-content: center;
              align-items: center;
              height: 40px;
              font-weight: 600;
              font-size: 14px;
              color: #f1f5f9;
            }
            .calendar-container .rdp-nav {
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              display: flex;
              justify-content: space-between;
              padding: 0 8px;
            }
            .calendar-container .rdp-button_previous,
            .calendar-container .rdp-button_next {
              width: 32px;
              height: 32px;
              border-radius: 8px;
              background: rgba(255, 255, 255, 0.05);
              color: #94a3b8;
              display: flex;
              align-items: center;
              justify-content: center;
              border: none;
              cursor: pointer;
              transition: all 0.15s;
            }
            .calendar-container .rdp-button_previous:hover,
            .calendar-container .rdp-button_next:hover {
              background: rgba(255, 255, 255, 0.1);
              color: #f1f5f9;
            }
            .calendar-container .rdp-weekday {
              color: #64748b;
              font-size: 12px;
              font-weight: 500;
              padding: 8px 0;
            }
            .calendar-container .rdp-day {
              width: 36px;
              height: 36px;
            }
            .calendar-container .rdp-day button {
              width: 36px;
              height: 36px;
              border-radius: 8px;
              color: #cbd5e1;
              font-weight: 400;
              font-size: 13px;
              transition: all 0.15s;
              border: none;
              background: transparent;
              cursor: pointer;
            }
            .calendar-container .rdp-day button:hover:not(:disabled) {
              background: rgba(255, 255, 255, 0.08);
              color: #f1f5f9;
            }
            .calendar-container .rdp-today button {
              color: #818cf8;
              box-shadow: inset 0 0 0 1px #6366f1;
            }
            .calendar-container .rdp-selected button,
            .calendar-container .rdp-range_start button,
            .calendar-container .rdp-range_end button {
              background: #6366f1 !important;
              color: white !important;
            }
            .calendar-container .rdp-range_middle button {
              background: rgba(99, 102, 241, 0.2) !important;
              color: #a5b4fc !important;
              border-radius: 0 !important;
            }
            .calendar-container .rdp-range_start button {
              border-radius: 8px 0 0 8px !important;
            }
            .calendar-container .rdp-range_end button {
              border-radius: 0 8px 8px 0 !important;
            }
            .calendar-container .rdp-disabled button {
              color: #334155 !important;
              opacity: 0.4;
              cursor: not-allowed !important;
            }
            .calendar-container .rdp-disabled button:hover {
              background: transparent !important;
            }
            .calendar-container .rdp-outside button {
              color: #475569;
              opacity: 0.5;
            }
          `}),e.jsx("div",{className:"calendar-container",children:e.jsx(bt,{mode:"range",numberOfMonths:2,selected:b,onSelect:v,locale:yt,disabled:A,defaultMonth:$?new Date($.getFullYear(),$.getMonth()-1):new Date,startMonth:E,endMonth:$,showOutsideDays:!1,components:{Chevron:({orientation:y})=>y==="left"?e.jsx(Oe,{size:18}):e.jsx(_e,{size:18})}})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-slate-400",children:b!=null&&b.from&&(b!=null&&b.to)?e.jsxs("span",{className:"text-emerald-400 font-medium",children:["å·²é€‰: ",ge(b.from,"yyyy-MM-dd")," ~ ",ge(b.to,"yyyy-MM-dd")]}):b!=null&&b.from?e.jsx("span",{className:"text-amber-400",children:"è¯·é€‰æ‹©ç»“æŸæ—¥æœŸ"}):e.jsx("span",{children:"ç‚¹å‡»é€‰æ‹©å¼€å§‹æ—¥æœŸ"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 text-sm text-slate-400 hover:text-white transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:C,disabled:!(b!=null&&b.from)||!(b!=null&&b.to),className:"px-5 py-2 bg-indigo-500 text-white rounded-lg text-sm font-medium hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"ç¡®è®¤é€‰æ‹©"})]})]})]}),document.body)]})},rt=new Set,ws=t=>{if(!rt.has(t))switch(rt.add(t),t){case"/data":Le(()=>import("./DataManagement-D5Hd_hDJ.js"),__vite__mapDeps([0,1,2]));break;case"/stores":Le(()=>import("./StoreComparisonView-BVgDpz5R.js"),__vite__mapDeps([3,1,2]));break}},js=({children:t,theme:a,onToggleTheme:l})=>{const s=Lt(),{systemStatus:n}=ce(),[o,d]=r.useState(!1),x=()=>n.database==="checking"?"CHECKING...":n.database==="disconnected"?"DB OFFLINE":n.redis==="disconnected"?"CACHE OFFLINE":"ONLINE",f=n.database==="connected";return e.jsxs("div",{className:"flex min-h-screen font-sans selection:bg-neon-purple selection:text-white relative transition-colors duration-500",children:[e.jsxs("aside",{className:"hidden md:flex flex-col glass-panel border-r border-white/5 sticky top-0 h-screen z-40",style:{width:o?"80px":"256px",transition:"width 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsxs("div",{className:"h-20 flex items-center border-b border-white/5 overflow-hidden",style:{paddingLeft:o?"0":"24px",justifyContent:o?"center":"flex-start",transition:"padding 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsxs("div",{className:"relative group cursor-pointer flex-shrink-0",children:[e.jsx("div",{className:"absolute inset-0 bg-neon-purple blur-lg opacity-20 group-hover:opacity-40 transition-opacity"}),e.jsx("div",{className:"relative bg-gradient-to-br from-indigo-600 to-purple-700 w-9 h-9 rounded-xl flex items-center justify-center shadow-lg border border-white/10 group-hover:scale-105 transition-transform",children:e.jsx(vt,{size:20,className:"text-white fill-current"})})]}),e.jsxs("div",{className:"ml-3 overflow-hidden whitespace-nowrap",style:{opacity:o?0:1,width:o?0:"auto",transition:"opacity 0.25s ease, width 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsxs("span",{className:"font-bold text-xl tracking-tight text-white font-mono",children:["O2O",e.jsx("span",{className:"text-neon-purple",children:"Dashboard"})]}),e.jsx("div",{className:"text-[10px] text-slate-400 uppercase tracking-widest",children:"React v1.0"})]})]}),e.jsxs("nav",{className:"flex-1 py-8 space-y-2 px-3 overflow-hidden",children:[e.jsx(je,{to:"/",icon:e.jsx(Dt,{size:20}),label:"ç»è¥æ€»è§ˆ",active:s.pathname==="/",collapsed:o}),e.jsx(je,{to:"/stores",icon:e.jsx(ht,{size:20}),label:"å…¨é‡é—¨åº—å¯¹æ¯”",active:s.pathname==="/stores",collapsed:o}),e.jsx(je,{to:"/data",icon:e.jsx(Et,{size:20}),label:"æ•°æ®ç®¡ç†",active:s.pathname==="/data",collapsed:o}),e.jsx(je,{to:"/channels",icon:e.jsx(Tt,{size:20}),label:"æ¸ é“åˆ†æ",active:s.pathname==="/channels",collapsed:o}),e.jsx(je,{to:"/trends",icon:e.jsx(Re,{size:20}),label:"è¶‹åŠ¿æ´å¯Ÿ",active:s.pathname==="/trends",collapsed:o}),e.jsx("div",{className:"my-4 border-t border-white/5 mx-2"}),e.jsx(je,{to:"/settings",icon:e.jsx(Ot,{size:20}),label:"ç³»ç»Ÿè®¾ç½®",active:s.pathname==="/settings",collapsed:o})]}),e.jsxs("div",{className:"p-4 border-t border-white/5 bg-gradient-to-t from-slate-900/10 to-transparent overflow-hidden",children:[e.jsxs("button",{onClick:l,className:"w-full flex items-center gap-3 p-2 mb-4 rounded-lg bg-white/5 hover:bg-white/10 border border-white/5 transition-colors group",style:{justifyContent:o?"center":"flex-start"},children:[e.jsx("div",{className:`p-1.5 rounded-md flex-shrink-0 ${a==="dark"?"bg-indigo-500 text-white":"text-slate-400"}`,children:e.jsx(At,{size:14})}),e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden whitespace-nowrap",style:{opacity:o?0:1,width:o?0:"auto",transition:"opacity 0.25s ease, width 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsx("div",{className:`p-1.5 rounded-md ${a==="light"?"bg-amber-400 text-white":"text-slate-400"}`,children:e.jsx(Rt,{size:14})}),e.jsx("span",{className:"text-xs font-medium text-slate-400 group-hover:text-white",children:a==="dark"?"Presentation":"Workstation"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",style:{justifyContent:o?"center":"flex-start",paddingLeft:o?0:"8px"},children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-slate-800 flex items-center justify-center border border-white/10 shadow-inner ring-1 ring-white/5 flex-shrink-0",children:e.jsx(It,{size:16,className:"text-slate-300"})}),e.jsxs("div",{className:"overflow-hidden whitespace-nowrap",style:{opacity:o?0:1,width:o?0:"auto",transition:"opacity 0.25s ease, width 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsx("p",{className:"text-sm font-bold text-slate-100",children:"Admin User"}),e.jsx("p",{className:"text-xs text-neon-cyan font-mono",children:"OPERATOR_LVL_5"})]})]}),e.jsxs("button",{onClick:()=>d(!o),className:"w-full mt-4 flex items-center justify-center gap-2 p-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/5 text-slate-400 hover:text-white group",style:{transition:"all 0.2s ease"},children:[e.jsx("div",{style:{transform:o?"rotate(0deg)":"rotate(180deg)",transition:"transform 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:e.jsx(_e,{size:16})}),e.jsx("span",{className:"text-xs overflow-hidden whitespace-nowrap",style:{opacity:o?0:1,width:o?0:"auto",transition:"opacity 0.25s ease, width 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:"æ”¶èµ·ä¾§æ "})]})]})]}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0 overflow-hidden relative z-10",children:[e.jsxs("header",{className:"h-20 bg-transparent flex items-center justify-between px-6 md:px-8 sticky top-0 z-30 backdrop-blur-sm",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-white tracking-wide",children:"å…¨æ¸ é“ç»è¥å¤ç›˜çœ‹æ¿"}),e.jsxs("p",{className:`text-xs font-mono mt-0.5 opacity-70 flex items-center gap-1.5 ${f?"text-slate-400":"text-amber-400"}`,children:[f?e.jsx(Pt,{size:10,className:"text-emerald-400"}):e.jsx(wt,{size:10,className:"text-amber-400"}),"SYSTEM: ",x()]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(vs,{}),e.jsxs("div",{className:`hidden sm:flex items-center gap-2 glass-panel px-4 py-1.5 rounded-full border text-xs shadow-lg ${f?"border-white/10 text-neon-cyan":"border-amber-500/30 text-amber-400"}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full animate-pulse ${f?"bg-neon-cyan":"bg-amber-400"}`}),e.jsx("span",{className:"font-mono",children:f?"LIVE_DATA":"OFFLINE"})]}),e.jsxs("button",{className:"relative p-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-full text-slate-300 hover:text-white transition-all hover:shadow-[0_0_15px_rgba(255,255,255,0.1)] group",children:[e.jsx(Ft,{size:20,className:"group-hover:rotate-12 transition-transform"}),e.jsx("span",{className:"absolute top-0 right-0 w-2.5 h-2.5 bg-neon-rose rounded-full border-2 border-slate-900"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 md:p-8 z-10 custom-scrollbar",children:e.jsx("div",{className:"w-full h-full flex flex-col gap-8 pb-10",children:t})})]})]})},je=({to:t,icon:a,label:l,active:s=!1,collapsed:n=!1})=>{const o=r.useCallback(()=>{ws(t)},[t]);return e.jsxs(Bt,{to:t,className:`relative group w-full flex items-center gap-3 px-3 py-3 rounded-xl overflow-hidden ${s?"text-white shadow-[0_0_20px_rgba(139,92,246,0.15)] bg-white/5":"text-slate-400 hover:text-white"}`,style:{justifyContent:n?"center":"flex-start",transition:"all 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},title:n?l:void 0,onMouseEnter:o,children:[s&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-neon-purple rounded-full shadow-[0_0_10px_#a78bfa]"}),!s&&e.jsx("div",{className:"absolute inset-0 bg-white/0 group-hover:bg-white/5 transition-colors"}),e.jsx("div",{className:`relative z-10 flex-shrink-0 transition-transform group-hover:scale-110 ${s?"text-neon-purple":"group-hover:text-slate-200"}`,children:a}),e.jsx("span",{className:"relative z-10 text-sm font-medium tracking-wide whitespace-nowrap overflow-hidden",style:{opacity:n?0:1,width:n?0:"auto",transition:"opacity 0.25s ease, width 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:l}),n&&e.jsxs("div",{className:"absolute left-full ml-2 px-3 py-1.5 bg-slate-800 text-white text-xs font-medium rounded-lg shadow-xl border border-white/10 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50",children:[l,e.jsx("div",{className:"absolute left-0 top-1/2 -translate-x-1 -translate-y-1/2 w-2 h-2 bg-slate-800 rotate-45 border-l border-b border-white/10"})]})]})},Ns=(t,a=1500)=>{const[l,s]=r.useState(t);return r.useEffect(()=>{if(t==="-"||t==="0"||!t){s(t);return}const n=parseFloat(t.replace(/[^0-9.-]/g,""));if(isNaN(n)){s(t);return}const o=t.includes("Â¥")?"Â¥":"",d=t.includes("k")?"k":"",x=t.includes("."),f=n<0;let m=null,c,i=!1;const p=j=>{if(i)return;m||(m=j);const b=Math.min((j-m)/a,1),M=1-Math.pow(1-b,5),L=Math.abs(n)*M,P=x?L.toFixed(1):Math.round(L).toLocaleString();s(`${o}${f?"-":""}${P}${d}`),b<1?c=requestAnimationFrame(p):s(t)},u=`${o}${f?"-":""}0${d}`;s(u);const h=setTimeout(()=>{c=requestAnimationFrame(p)},16);return()=>{i=!0,clearTimeout(h),c&&cancelAnimationFrame(c)}},[t,a]),l},nt={emerald:"bg-emerald-500/10 text-emerald-400 border-emerald-500/20",indigo:"bg-indigo-500/10 text-indigo-400 border-indigo-500/20",violet:"bg-violet-500/10 text-violet-400 border-violet-500/20",amber:"bg-amber-500/10 text-amber-400 border-amber-500/20",cyan:"bg-cyan-500/10 text-cyan-400 border-cyan-500/20",rose:"bg-rose-500/10 text-rose-400 border-rose-500/20"},ot={emerald:"bg-emerald-600",indigo:"bg-indigo-600",violet:"bg-violet-600",amber:"bg-amber-600",cyan:"bg-cyan-600",rose:"bg-rose-600"},Ne=({title:t,value:a,change:l,subtext:s,icon:n,trendColor:o="green",iconColor:d,theme:x="dark",loading:f=!1,compact:m=!1,isPercentChange:c=!1})=>{const i=l!==void 0,p=i?l>=0:!0,h=Ns(f?"-":a),j=x==="dark",b=d||(o==="red"?"rose":"emerald"),M=nt[b]||nt.emerald,L=ot[b]||ot.emerald,P=j?"text-white":"text-slate-900",T=j?"text-slate-400":"text-slate-500",w=m?"p-4":"p-6",z=m?"text-[10px]":"text-[11px]",O=m?"text-xl":"text-3xl",E=m?"p-2":"p-3",$=()=>i?c?`${l>=0?"+":""}${l.toFixed(1)}pp`:`${l>=0?"+":""}${l.toFixed(1)}%`:"";return e.jsx("div",{className:"relative group rounded-2xl transition-all duration-500 hover:shadow-[0_10px_40px_-10px_rgba(0,0,0,0.5)]",children:e.jsxs("div",{className:`glass-panel rounded-2xl ${w} h-full relative overflow-hidden transition-colors ${j?"group-hover:border-white/10":"group-hover:border-black/5"}`,children:[e.jsx("div",{className:`absolute top-0 bottom-0 left-0 w-1/2 bg-gradient-to-r from-transparent ${j?"via-white/5":"via-black/5"} to-transparent skew-x-[-15deg] animate-shimmer pointer-events-none`}),e.jsx("div",{className:`absolute -top-10 -right-10 w-32 h-32 rounded-full blur-[60px] opacity-0 transition-all duration-700 group-hover:opacity-15 group-hover:scale-110 ${L}`}),e.jsxs("div",{className:"flex justify-between items-start mb-3 relative z-10",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`${z} font-bold uppercase tracking-widest mb-1 font-mono ${T} truncate`,children:t}),f?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Wt,{size:m?16:24,className:`animate-spin ${T}`})}):e.jsx("h3",{className:`${O} font-bold font-mono tracking-tight drop-shadow-lg tabular-nums ${P} truncate`,children:h})]}),e.jsx("div",{className:`${E} rounded-xl border backdrop-blur-md transition-transform duration-300 group-hover:rotate-6 ${M} flex-shrink-0`,children:n})]}),e.jsxs("div",{className:"flex items-center justify-between relative z-10 mt-2",children:[i?e.jsxs("div",{className:`flex items-center text-[10px] font-bold px-2 py-0.5 rounded-md border backdrop-blur-sm ${p?"bg-emerald-500/5 text-emerald-400 border-emerald-500/20":"bg-rose-500/5 text-rose-400 border-rose-500/20"}`,children:[p?e.jsx(Vt,{size:12,className:"mr-0.5"}):e.jsx(Ut,{size:12,className:"mr-0.5"}),e.jsx("span",{className:"font-mono",children:$()})]}):e.jsx("div",{className:`flex items-center text-[10px] font-medium px-2 py-0.5 rounded-md border backdrop-blur-sm ${j?"bg-slate-500/5 text-slate-400 border-slate-500/20":"bg-slate-100 text-slate-500 border-slate-200"}`,children:e.jsx("span",{className:"font-mono",children:"æ— æ•°æ®"})}),e.jsxs("div",{className:`flex items-center gap-1 text-[10px] font-medium tracking-wide ${T}`,children:[e.jsx(qe,{size:10,className:"opacity-50"}),s]})]})]})})};let lt=!1;const it=()=>{lt||(Ze("neon-cyber",{backgroundColor:"transparent",textStyle:{fontFamily:"JetBrains Mono, Inter, sans-serif"},title:{textStyle:{color:"#f8fafc"},subtextStyle:{color:"#94a3b8"}},line:{itemStyle:{borderWidth:2},lineStyle:{width:3},symbolSize:8,symbol:"circle",smooth:!0},categoryAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#94a3b8",fontSize:11},splitLine:{show:!1}},valueAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#64748b",fontSize:10},splitLine:{show:!0,lineStyle:{color:"rgba(255,255,255,0.05)",type:"dashed"}}},tooltip:{backgroundColor:"rgba(15, 23, 42, 0.95)",borderColor:"rgba(255, 255, 255, 0.1)",textStyle:{color:"#f8fafc"},padding:12,extraCssText:"backdrop-filter: blur(10px); border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);"}}),Ze("clean-light",{backgroundColor:"transparent",textStyle:{fontFamily:"JetBrains Mono, Inter, sans-serif"},title:{textStyle:{color:"#0f172a"},subtextStyle:{color:"#64748b"}},line:{itemStyle:{borderWidth:2},lineStyle:{width:3},symbolSize:8,symbol:"circle",smooth:!0},categoryAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#64748b",fontSize:11},splitLine:{show:!1}},valueAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#64748b",fontSize:10},splitLine:{show:!0,lineStyle:{color:"rgba(0,0,0,0.06)",type:"dashed"}}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"rgba(0, 0, 0, 0.1)",textStyle:{color:"#0f172a"},padding:12,extraCssText:"backdrop-filter: blur(10px); border-radius: 8px; box-shadow: 0 10px 20px rgba(0,0,0,0.1);"}}),lt=!0)};function ct(t,a){let l=null;return(...s)=>{l&&clearTimeout(l),l=setTimeout(()=>t(...s),a)}}const me=(t,a,l="dark",s)=>{const n=r.useRef(null),o=r.useRef(null),d=r.useRef(!1),x=r.useRef(null),f=r.useRef(null),m=r.useCallback(()=>{if(!(d.current||!o.current))try{if(!n.current||!document.body.contains(n.current))return;o.current.resize({animation:{duration:200,easing:"cubicOut"}})}catch(c){console.debug("[useChart] Resize skipped:",c)}},[]);return r.useEffect(()=>{if(!n.current)return;it();const c=l==="light"?"clean-light":"neon-cyber";if(o.current){try{o.current.dispose()}catch(i){console.debug("[useChart] Dispose error:",i)}o.current=null}return d.current=!1,o.current=$e(n.current,c,{renderer:"canvas",useDirtyRect:!0}),s&&o.current.on("click",s),f.current=ct(m,100),x.current=new ResizeObserver(()=>{var i;(i=f.current)==null||i.call(f)}),x.current.observe(n.current),()=>{if(d.current=!0,x.current&&(x.current.disconnect(),x.current=null),o.current){try{o.current.off("click"),o.current.dispose()}catch(i){console.debug("[useChart] Cleanup error:",i)}o.current=null}}},[l,m]),r.useEffect(()=>{if(console.log("[useChart] æ›´æ–° effect è§¦å‘, chartRef:",!!n.current,"chartInstance:",!!o.current),n.current&&!o.current&&!d.current){console.log("[useChart] å»¶è¿Ÿåˆ›å»ºå›¾è¡¨å®ä¾‹"),it();const h=l==="light"?"clean-light":"neon-cyber";o.current=$e(n.current,h,{renderer:"canvas",useDirtyRect:!0}),x.current||(f.current=ct(m,100),x.current=new ResizeObserver(()=>{var j;(j=f.current)==null||j.call(f)}),x.current.observe(n.current)),s&&o.current.on("click",s)}if(d.current||!o.current){console.log("[useChart] è·³è¿‡æ›´æ–°: isDisposed=",d.current,"chartInstance=",!!o.current);return}const c=Object.keys(t||{});if(c.length===0){console.log("[useChart] è·³è¿‡æ›´æ–°: ç©ºå¯¹è±¡");return}const i=t==null?void 0:t.series;if(Array.isArray(i)&&i.length===0){console.log("[useChart] è·³è¿‡æ›´æ–°: ç©º series æ•°ç»„");return}const p=c.some(h=>h!=="series"&&t[h]!==void 0);if(!Array.isArray(i)&&!p){console.log("[useChart] è·³è¿‡æ›´æ–°: æ—  series ä¸”æ— å…¶ä»–é…ç½®");return}const u=Array.isArray(i)&&i.some(h=>{if(!Array.isArray(h.data)||h.data.length===0)return!1;const j=h.data[0];return j==null?!1:typeof j=="object"&&"value"in j?j.value!==void 0&&j.value!==null:!0});if(console.log("[useChart] æ•°æ®æ£€æŸ¥: seriesCount=",i==null?void 0:i.length,"hasData=",u),Array.isArray(i)&&i.length>0&&!u){console.log("[useChart] è·³è¿‡æ›´æ–°: æœ‰ series ä½†æ— æ•°æ®");return}try{console.log("[useChart] æ‰§è¡Œ setOption, seriesCount:",i==null?void 0:i.length),o.current.setOption(t,{notMerge:!0,lazyUpdate:!1,silent:!1}),console.log("[useChart] setOption å®Œæˆ")}catch(h){console.error("[useChart] setOption error:",h)}requestAnimationFrame(()=>{if(!d.current&&o.current)try{o.current.resize()}catch(h){console.debug("[useChart] resize error:",h)}})},[t,l,m,...a]),r.useEffect(()=>{if(!(d.current||!o.current))return o.current.off("click"),s&&o.current.on("click",s),()=>{o.current&&o.current.off("click")}},[s]),n},dt={é…é€è´¹å‡å…:"#f43f5e",æ»¡å‡é‡‘é¢:"#f59e0b",å•†å“å‡å…:"#eab308",å•†å®¶ä»£é‡‘åˆ¸:"#22c55e",å•†å®¶æ‰¿æ‹…åˆ¸:"#14b8a6",æ»¡èµ é‡‘é¢:"#3b82f6",å•†å®¶å…¶ä»–ä¼˜æƒ :"#8b5cf6",æ–°å®¢å‡å…:"#ec4899"},Be=[["delivery_discount","é…é€è´¹å‡å…"],["full_reduction","æ»¡å‡é‡‘é¢"],["product_discount","å•†å“å‡å…"],["merchant_voucher","å•†å®¶ä»£é‡‘åˆ¸"],["merchant_share","å•†å®¶æ‰¿æ‹…åˆ¸"],["gift_amount","æ»¡èµ é‡‘é¢"],["other_discount","å•†å®¶å…¶ä»–ä¼˜æƒ "],["new_customer_discount","æ–°å®¢å‡å…"]];function Ss(t,a,l){const s=[],n=[],o="#6366f1",d=new Set,x=new Set;return t.forEach(f=>{const m=f.marketing_costs;let c=!1;Be.forEach(([i,p])=>{m[i]>0&&(c=!0,x.add(p))}),c&&d.add(f.channel)}),t.forEach(f=>{d.has(f.channel)&&s.push({name:f.channel,itemStyle:{color:o,opacity:1,borderColor:l,shadowBlur:10,shadowColor:o},label:{position:"left"}})}),Be.forEach(([,f])=>{if(x.has(f)){const m=dt[f];s.push({name:f,itemStyle:{color:m,borderColor:"#fff",borderWidth:1,shadowBlur:15,shadowColor:m},label:{position:"right"}})}}),t.forEach(f=>{if(!d.has(f.channel))return;const m=f.marketing_costs;Be.forEach(([c,i])=>{const p=m[c];if(p>0){const u=dt[i];n.push({source:f.channel,target:i,value:p,lineStyle:{color:new oe(0,0,1,0,[{offset:0,color:o},{offset:1,color:u}]),opacity:.4,curveness:.5}})}})}),{nodes:s,links:n}}const ks=({data:t,theme:a})=>{const l=a==="dark",s=l?"#cbd5e1":"#475569",n=l?"#fff":"#0f172a",o=l?"#a5b4fc":"#6366f1",{nodes:d,links:x}=r.useMemo(()=>Ss(t,l,o),[t,l,o]),f=r.useMemo(()=>!d.length||!x.length?{series:[]}:{backgroundColor:"transparent",tooltip:{trigger:"item",triggerOn:"mousemove",backgroundColor:l?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:l?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",padding:12,extraCssText:"backdrop-filter: blur(10px);",textStyle:{color:l?"#f8fafc":"#0f172a",fontFamily:"JetBrains Mono",fontSize:12},formatter:c=>{var i;return!c||!c.data?"":c.dataType==="node"?`<b>${c.data.name}</b>`:c.dataType==="edge"?`${c.data.source} â†’ ${c.data.target}<br/>Â¥${((i=c.data.value)==null?void 0:i.toLocaleString())||0}`:""}},series:[{type:"sankey",left:120,right:100,top:20,bottom:20,nodeAlign:"justify",draggable:!1,data:d,links:x,emphasis:{focus:"adjacency"},label:{color:s,fontSize:11,fontFamily:"Inter"},lineStyle:{color:"source",curveness:.5},itemStyle:{borderWidth:0}}]},[d,x,l,s]),m=me(f,[d,x,a],a);return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col relative group",children:[e.jsxs("div",{className:"mb-2 shrink-0 relative z-10 pointer-events-none",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:n},children:[e.jsx("span",{className:"w-1 h-5 bg-neon-blue rounded-full shadow-[0_0_10px_#60a5fa]"}),"è¥é”€æˆæœ¬ç»“æ„"]}),e.jsx("p",{className:"text-xs mt-1 font-mono uppercase tracking-wider opacity-70",style:{color:s},children:"MARKETING COST FLOW: CHANNEL â†’ TYPE"})]}),e.jsx("div",{className:"flex-1 w-full min-h-[300px] relative z-0",children:e.jsx("div",{ref:m,className:"w-full h-full"})})]})},Cs=({storeName:t,channel:a,theme:l,selectedDate:s,selectedDateRange:n})=>{const[o,d]=r.useState(null),[x,f]=r.useState(!0),m=r.useRef(null),c=r.useRef(null),{dateRange:i}=ce(),p=l==="dark",u=p?"#64748b":"#94a3b8",h=p?"#fff":"#0f172a",j=p?"#94a3b8":"#64748b",b=p?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",M=s||void 0;r.useEffect(()=>{(async()=>{f(!0);try{const z={store_name:t,channel:a};M?z.target_date=M:n?(z.start_date=n.start,z.end_date=n.end):i.type!=="all"&&i.start&&i.end&&(z.start_date=i.start,z.end_date=i.end),console.log("ğŸ“Š åˆ†æ—¶æ®µè¯Šæ–­è¯·æ±‚å‚æ•°:",z,"| dateRange:",i);const O=await ie.getHourlyProfit(z);O.success&&O.data&&(d(O.data),console.log("ğŸ“Š åˆ†æ—¶æ®µè¯Šæ–­è¿”å›æ•°æ®:",O.data.date))}catch(z){console.error("è·å–åˆ†æ—¶åˆ©æ¶¦æ•°æ®å¤±è´¥:",z)}finally{f(!1)}})()},[t,a,M,n,i.type,i.start,i.end]),r.useEffect(()=>{if(!m.current||!o)return;c.current||(c.current=$e(m.current,p?"dark":void 0));const{hours:w,orders:z,profits:O,avg_profits:E,peak_periods:$}=o,I=$&&$.length>0?$.map(k=>[{xAxis:w[k.start_hour]||`${k.start_hour}:00`,itemStyle:{color:p?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.03)"}},{xAxis:w[Math.min(k.end_hour+1,23)]||`${k.end_hour+1}:00`}]):[],H={backgroundColor:"transparent",grid:{top:35,right:45,bottom:25,left:40,containLabel:!0},tooltip:{trigger:"axis",backgroundColor:p?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:p?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:16,textStyle:{fontFamily:"JetBrains Mono",color:p?"#fff":"#0f172a",fontSize:12},axisPointer:{type:"shadow"},formatter:k=>{var C;const D=((C=k[0])==null?void 0:C.axisValue)||"";let W=`<div style="font-weight:600;margin-bottom:8px;font-size:13px">${D}</div>`;k.forEach(F=>{const A=F.value,S=F.seriesName==="å‡€åˆ©æ¶¦"?A>=0?"#22c55e":"#f43f5e":F.color;W+=`<div style="display:flex;justify-content:space-between;align-items:center;margin:4px 0">
              <span style="display:flex;align-items:center;gap:6px">
                <span style="width:8px;height:8px;border-radius:50%;background:${S}"></span>
                ${F.seriesName}
              </span>
              <span style="font-weight:600;margin-left:20px">${F.seriesName==="å‡€åˆ©æ¶¦"?`Â¥${A.toFixed(2)}`:A}</span>
            </div>`});const v=w.indexOf(D);if(v>=0&&z[v]>0){const F=E[v],A=F>=0?"#22c55e":"#f43f5e";W+=`<div style="border-top:1px solid ${p?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"};margin-top:8px;padding-top:8px">
              <span style="color:${p?"#94a3b8":"#64748b"}">å•å‡åˆ©æ¶¦:</span>
              <span style="font-weight:600;color:${A};margin-left:8px">Â¥${F.toFixed(2)}</span>
            </div>`}return W}},legend:{data:["è®¢å•æ•°","å‡€åˆ©æ¶¦"],top:2,right:5,textStyle:{color:u,fontSize:10},itemWidth:10,itemHeight:10,itemGap:12,itemStyle:{}},xAxis:{type:"category",data:w,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:u,fontSize:10,interval:2,formatter:k=>k.replace(":00","")}},yAxis:[{type:"value",name:"",position:"left",splitLine:{lineStyle:{color:b,type:"dashed"}},axisLabel:{color:u,fontSize:10},nameTextStyle:{color:u,fontSize:10}},{type:"value",name:"",position:"right",splitLine:{show:!1},axisLabel:{color:u,fontSize:10,formatter:k=>`Â¥${k}`},nameTextStyle:{color:u,fontSize:10}}],series:[{name:"è®¢å•æ•°",type:"bar",data:z,barWidth:12,itemStyle:{borderRadius:[3,3,0,0],color:new oe(0,0,0,1,[{offset:0,color:p?"rgba(139, 92, 246, 0.8)":"rgba(139, 92, 246, 0.7)"},{offset:1,color:p?"rgba(139, 92, 246, 0.2)":"rgba(139, 92, 246, 0.1)"}])},markArea:I.length>0?{silent:!0,data:I}:void 0},{name:"å‡€åˆ©æ¶¦",type:"line",yAxisIndex:1,data:O,smooth:.3,symbol:"circle",symbolSize:6,itemStyle:{color:"#22c55e"},lineStyle:{width:2.5,color:"#22c55e",shadowColor:"rgba(34, 197, 94, 0.3)",shadowBlur:8},areaStyle:{color:new oe(0,0,0,1,[{offset:0,color:"rgba(34, 197, 94, 0.25)"},{offset:.5,color:"rgba(34, 197, 94, 0.05)"},{offset:1,color:"rgba(244, 63, 94, 0.15)"}])},markLine:{silent:!0,symbol:"none",lineStyle:{color:p?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.1)",type:"dashed",width:1},data:[{yAxis:0}],label:{show:!1}}}]};c.current.setOption(H,!0);const K=()=>{var k;(k=c.current)==null||k.resize()};return window.addEventListener("resize",K),()=>{window.removeEventListener("resize",K)}},[o,p,u,b]),r.useEffect(()=>{c.current&&(c.current.dispose(),c.current=null)},[l]),r.useEffect(()=>()=>{c.current&&(c.current.dispose(),c.current=null)},[]);const L=r.useMemo(()=>{if(o!=null&&o.date){if(o.date.includes("~")){const w=o.date.split("~").map(z=>z.trim());return w.length===2&&w[0]&&w[1]?`${w[0].slice(5)} ~ ${w[1].slice(5)}`:o.date}return o.date.slice(5)}return null},[o==null?void 0:o.date]),P=o&&o.orders&&o.orders.some(w=>w>0),T=n!=null;return e.jsxs("div",{className:"glass-panel rounded-2xl p-4 h-full flex flex-col relative",children:[e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-emerald-500/5 to-transparent pointer-events-none rounded-b-2xl"}),e.jsxs("div",{className:"mb-2 relative z-10",children:[e.jsxs("h3",{className:"text-base font-bold flex items-center gap-2",style:{color:h},children:[e.jsx("span",{className:"w-1 h-4 bg-gradient-to-b from-emerald-400 to-emerald-600 rounded-full"}),L?`${L} åˆ†æ—¶æ®µè¯Šæ–­`:"åˆ†æ—¶æ®µè¯Šæ–­",(s||T)&&e.jsx("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded-full bg-emerald-500/20 text-emerald-400 ml-1",children:"å·²è”åŠ¨"})]}),e.jsx("p",{className:"text-[10px] mt-0.5 font-mono uppercase tracking-wider opacity-70",style:{color:j},children:"HOURLY PROFIT ANALYSIS"})]}),e.jsx("div",{className:"flex-1 w-full min-h-0",children:x?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-sm",style:{color:j},children:"åŠ è½½ä¸­..."})}):P?e.jsx("div",{ref:m,className:"w-full h-full"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"text-sm",style:{color:j},children:"æš‚æ— æ•°æ®"})})})]})},_s={indigo:{bg:"bg-indigo-500/20",text:"text-indigo-300",icon:"text-indigo-400"},pink:{bg:"bg-pink-500/20",text:"text-pink-300",icon:"text-pink-400"},cyan:{bg:"bg-cyan-500/20",text:"text-cyan-300",icon:"text-cyan-400"},emerald:{bg:"bg-emerald-500/20",text:"text-emerald-300",icon:"text-emerald-400"}},Ct=({selectedChannel:t,channelList:a,onSelect:l,isDark:s,accentColor:n="indigo"})=>{const[o,d]=r.useState(!1),x=r.useRef(null),f=r.useRef(null),m=_s[n];r.useEffect(()=>{const i=p=>{const u=p.target;o&&x.current&&!x.current.contains(u)&&f.current&&!f.current.contains(u)&&d(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[o]);const c=t==="all"?"å…¨éƒ¨æ¸ é“":t;return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:x,onClick:()=>d(!o),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-medium transition-all duration-200 ${s?"bg-white/5 hover:bg-white/10 border-white/10 text-slate-300":"bg-black/5 hover:bg-black/10 border-black/10 text-slate-600"}`,children:[e.jsx(Ht,{size:12,className:m.icon}),e.jsx("span",{className:"max-w-[80px] truncate",children:c}),e.jsx(Ce,{size:12,className:`text-slate-400 transition-transform ${o?"rotate-180":""}`})]}),o&&e.jsx("div",{ref:f,className:`absolute top-full right-0 mt-2 w-40 rounded-xl border shadow-2xl z-50 overflow-hidden animate-fade-in-up ${s?"bg-slate-900 border-white/10":"bg-white border-black/10"}`,children:e.jsxs("div",{className:"max-h-64 overflow-y-auto custom-scrollbar",children:[e.jsxs("button",{onClick:()=>{l("all"),d(!1)},className:`w-full flex items-center justify-between px-4 py-2.5 text-xs transition-colors ${t==="all"?`${m.bg} ${m.text}`:s?"text-slate-300 hover:bg-white/5":"text-slate-600 hover:bg-black/5"}`,children:[e.jsx("span",{children:"å…¨éƒ¨æ¸ é“"}),t==="all"&&e.jsx(be,{size:12,className:m.icon})]}),a.map(i=>e.jsxs("button",{onClick:()=>{l(i),d(!1)},className:`w-full flex items-center justify-between px-4 py-2.5 text-xs transition-colors ${t===i?`${m.bg} ${m.text}`:s?"text-slate-300 hover:bg-white/5":"text-slate-600 hover:bg-black/5"}`,children:[e.jsx("span",{children:i}),t===i&&e.jsx(be,{size:12,className:m.icon})]},i))]})})]})},zs=({data:t,theme:a,onDateSelect:l,selectedDate:s,selectedDateRange:n})=>{const[o,d]=r.useState(!1),[x,f]=r.useState(null),[m,c]=r.useState(!1),{selectedStore:i,dateRange:p,selectedChannel:u,setSelectedChannel:h,channelList:j}=ce(),b=a==="dark",M=b?"#64748b":"#94a3b8",L=b?"#fff":"#0f172a",P=b?"#94a3b8":"#64748b",T=b?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)";r.useEffect(()=>{(async()=>{if(!i){f(null);return}c(!0);try{const C={store_name:i,channel:u==="all"?void 0:u,granularity:"day"};p.type!=="all"&&p.start&&p.end?(C.start_date=p.start,C.end_date=p.end):C.days=30;const F=await ie.getTrend(C);F.success&&F.data&&f(F.data)}catch(C){console.error("è·å–è¶‹åŠ¿æ•°æ®å¤±è´¥:",C)}finally{c(!1)}})()},[i,u,p.type,p.start,p.end]);const w=(v,C,F)=>{if(v.length===0)return[];const A=v.filter(y=>y>0);if(A.length===0)return[];const S=A.reduce((y,g)=>y+g,0)/A.length,V=A.reduce((y,g)=>y+Math.pow(g-S,2),0)/A.length,U=Math.sqrt(V),Y=S-U,G=[];return v.forEach((y,g)=>{y<Y&&y>0&&G.push({name:"Profit Rate Low",xAxis:C[g],yAxis:F[g],value:`${y.toFixed(1)}%`,itemStyle:{color:"#f43f5e"}})}),G},{categories:z,fullDates:O,values:E,anomalies:$,profitRates:I,avgValues:H}=r.useMemo(()=>{if(x&&x.dates.length>0){const Y=x.dates.map((X,re)=>{var ne,xe;return{date:X.slice(5),fullDate:X,revenue:x.amounts[re]||0,profit:x.profits[re]||0,orders:x.order_counts[re]||0,profitRate:((ne=x.profit_rates)==null?void 0:ne[re])||0,avgValue:((xe=x.avg_values)==null?void 0:xe[re])||0}}),G=Y.map(X=>X.profitRate),y=Y.map(X=>X.avgValue),g=Y.map(X=>X.date),N=Y.map(X=>X.fullDate),R=Y.map(X=>X.revenue),q=w(G,g,R);return{categories:g,fullDates:N,values:Y,anomalies:q,profitRates:G,avgValues:y}}let v=[];t.length>0&&(v=t[0].dailyTrend.map(G=>({date:G.date,fullDate:G.date,revenue:0,profit:0,orders:0,profitRate:0,avgValue:0})),t.forEach(G=>{G.dailyTrend.forEach((y,g)=>{v[g]&&(v[g].revenue+=y.revenue,v[g].profit+=y.profit,v[g].orders+=y.orders)})}),v.forEach(G=>{G.profitRate=G.revenue>0?G.profit/G.revenue*100:0,G.avgValue=G.orders>0?G.revenue/G.orders:0}));const C=v.map(Y=>Y.profitRate),F=v.map(Y=>Y.avgValue),A=v.map(Y=>Y.date),S=v.map(Y=>Y.fullDate),V=v.map(Y=>Y.revenue),U=w(C,A,V);return{categories:A,fullDates:S,values:v,anomalies:U,profitRates:C,avgValues:F}},[t,x]),K=r.useCallback(v=>{if(l&&v.dataIndex!==void 0){const C=z.length,F=O[v.dataIndex];s===F?l(null,void 0,C):l(F,v.dataIndex,C)}},[l,s,z.length,O]);r.useMemo(()=>Math.max(...E.map(v=>v.revenue),1e3),[E]);const k=r.useMemo(()=>{const v=E.map(N=>N.revenue),C=E.map(N=>N.profit),F=E.map(N=>N.orders),A=I,S=Math.max(...v,1e3),V=Math.max(...C,100),U=Math.ceil(V*3/100)*100,Y=Math.max(...F,10),G=Math.ceil(Y*1.3/10)*10,y=Math.max(...A,10),g=Math.ceil(y*2.2/10)*10;return{revenueMax:S,profitMax:U,ordersMax:G,rateMax:Math.max(g,100)}},[E,I]),D={grid:{top:30,right:50,bottom:40,left:50,containLabel:!1},tooltip:{trigger:"axis",backgroundColor:b?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:b?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:16,textStyle:{fontFamily:"JetBrains Mono",color:b?"#fff":"#0f172a"},axisPointer:{type:"cross",label:{backgroundColor:"#6366f1"},lineStyle:{type:"dashed",color:"#6366f1"}},formatter:v=>{var A;if(!Array.isArray(v))return"";const C=v.filter(S=>S.seriesName!=="HitBox");if(C.length===0)return"";let F=`<div style="font-weight:bold;margin-bottom:8px">${(A=C[0])==null?void 0:A.axisValue}</div>`;return C.forEach(S=>{var U;let V="";S.seriesName==="åˆ©æ¶¦ç‡"?V=`${(U=S.value)==null?void 0:U.toFixed(1)}%`:S.seriesName==="è®¢å•æ•°"?V=`${S.value}`:V=`Â¥${(S.value||0).toLocaleString()}`,F+=`<div style="display:flex;justify-content:space-between;gap:16px">
            <span>${S.marker}${S.seriesName}</span>
            <span style="font-weight:bold">${V}</span>
          </div>`}),F}},legend:{data:["é”€å”®é¢","æ€»åˆ©æ¶¦","åˆ©æ¶¦ç‡","è®¢å•æ•°"],bottom:0,textStyle:{color:M,fontSize:10},itemGap:16,icon:"circle",itemWidth:10,itemHeight:10},xAxis:{type:"category",data:z,boundaryGap:!0,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:M,fontSize:10,fontFamily:"JetBrains Mono"}},yAxis:[{type:"value",name:"",splitLine:{lineStyle:{color:T,type:"dashed"}},axisLabel:{color:M,fontSize:10,formatter:v=>`Â¥${v/1e3}k`}},{type:"value",name:"",position:"right",min:0,max:k.rateMax,splitLine:{show:!1},axisLabel:{color:M,fontSize:10,formatter:"{value}%"}},{type:"value",name:"",position:"left",show:!1,splitLine:{show:!1},min:0,max:100},{type:"value",name:"",position:"left",show:!1,splitLine:{show:!1},min:0,max:k.profitMax},{type:"value",name:"",position:"left",show:!1,splitLine:{show:!1},min:0,max:k.ordersMax}],series:[{name:"HitBox",type:"bar",yAxisIndex:2,data:E.map(()=>100),barWidth:"80%",barGap:"-100%",z:10,itemStyle:{color:"transparent"},tooltip:{show:!1},silent:!1},{name:"è®¢å•æ•°",type:"bar",yAxisIndex:4,data:E.map(v=>{const C=n?v.fullDate>=n.start&&v.fullDate<=n.end:!1,F=s&&v.fullDate===s,A=C||F;return{value:v.orders,itemStyle:s||n?{borderRadius:[2,2,0,0],color:A?new oe(0,0,0,1,[{offset:0,color:C?"#34d399":"#818cf8"},{offset:1,color:C?"#059669":"#6366f1"}]):new oe(0,0,0,1,[{offset:0,color:b?"rgba(71, 85, 105, 0.2)":"rgba(71, 85, 105, 0.15)"},{offset:1,color:b?"rgba(51, 65, 85, 0.05)":"rgba(71, 85, 105, 0.02)"}]),shadowBlur:A?15:0,shadowColor:A?C?"rgba(52, 211, 153, 0.5)":"rgba(99, 102, 241, 0.5)":"transparent"}:{borderRadius:[2,2,0,0],color:new oe(0,0,0,1,[{offset:0,color:b?"rgba(71, 85, 105, 0.55)":"rgba(71, 85, 105, 0.35)"},{offset:1,color:b?"rgba(51, 65, 85, 0.15)":"rgba(71, 85, 105, 0.05)"}])}}}),emphasis:{itemStyle:{color:new oe(0,0,0,1,[{offset:0,color:b?"rgba(148, 163, 184, 0.95)":"rgba(100, 116, 139, 0.7)"},{offset:1,color:b?"rgba(100, 116, 139, 0.4)":"rgba(100, 116, 139, 0.2)"}]),shadowColor:b?"rgba(148, 163, 184, 0.4)":"rgba(100, 116, 139, 0.3)",shadowBlur:12}},barWidth:"60%",barGap:"-100%",z:1},{name:"æ€»åˆ©æ¶¦",type:"line",smooth:.4,symbol:"none",showSymbol:!1,yAxisIndex:3,itemStyle:{color:"#22c55e"},lineStyle:{width:2.5,color:"#22c55e",opacity:s?.3:1,shadowColor:"rgba(34, 197, 94, 0.7)",shadowBlur:10,shadowOffsetY:-4},emphasis:{focus:"series",itemStyle:{color:"#22c55e",borderColor:"#fff",borderWidth:2},lineStyle:{width:3,shadowBlur:14,shadowOffsetY:-5}},data:E.map(v=>v.profit),z:2},{name:"åˆ©æ¶¦ç‡",type:"line",smooth:.4,symbol:"none",showSymbol:!1,yAxisIndex:1,itemStyle:{color:"#fbbf24"},lineStyle:{width:2,color:"#fbbf24",type:[5,5],opacity:s?.3:1},emphasis:{focus:"series",itemStyle:{color:"#fbbf24",borderColor:"#fff",borderWidth:2},lineStyle:{width:2.5,type:"solid"}},data:I,z:3},{name:"é”€å”®é¢",type:"line",smooth:.4,symbol:"none",showSymbol:!1,yAxisIndex:0,itemStyle:{color:b?"#f8fafc":"#334155"},lineStyle:{width:3,color:b?"#f8fafc":"#334155",opacity:s?.3:1,shadowColor:b?"rgba(255, 255, 255, 0.8)":"rgba(51, 65, 85, 0.5)",shadowBlur:20,shadowOffsetY:0},areaStyle:{opacity:s?.05:.2,color:new oe(0,0,0,1,[{offset:0,color:"rgba(74, 144, 226, 0.3)"},{offset:1,color:"rgba(74, 144, 226, 0.05)"}])},emphasis:{focus:"series",itemStyle:{color:"#fff",borderColor:"#818cf8",borderWidth:2,shadowColor:"rgba(129, 140, 248, 0.5)",shadowBlur:10},lineStyle:{width:4}},data:E.map(v=>v.revenue),markPoint:o&&$.length>0?{data:$.filter(v=>v.xAxis!==void 0&&v.yAxis!==void 0&&!isNaN(v.yAxis)).map(v=>({name:v.name,coord:[v.xAxis,v.yAxis],itemStyle:v.itemStyle})),symbol:"pin",symbolSize:40,label:{show:!0,fontSize:8,formatter:"!"},animation:!0,animationDuration:800,animationEasing:"elasticOut"}:void 0,z:3}]},W=me(D,[t,o,a,x,u,s,n,k],a,K);return e.jsxs("div",{className:`glass-panel rounded-2xl p-6 h-full flex flex-col relative overflow-hidden group transition-all duration-300 ${s?"border-indigo-500/50 shadow-[0_0_30px_rgba(99,102,241,0.15)]":""}`,children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-24 bg-gradient-to-b from-indigo-500/5 to-transparent pointer-events-none"}),e.jsxs("div",{className:"mb-2 flex justify-between items-start relative z-10",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:L},children:[e.jsx("span",{className:"w-1 h-5 bg-gradient-to-b from-indigo-400 to-indigo-600 rounded-full shadow-[0_0_10px_#818cf8]"}),"é”€å”®è¶‹åŠ¿åˆ†æ",s&&e.jsx("span",{className:"text-xs bg-indigo-500 text-white px-2 py-0.5 rounded-md font-mono ml-2",children:s.slice(5)})]}),e.jsxs("p",{className:"text-xs mt-1 font-mono uppercase tracking-widest opacity-70 flex items-center gap-1",style:{color:P},children:[u==="all"?"å…¨éƒ¨æ¸ é“":u," Â· å«åˆ©æ¶¦ç‡",l&&e.jsx("span",{className:"ml-2 text-indigo-400",children:"| ç‚¹å‡»æŸ±å­ä¸‹é’»"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ct,{selectedChannel:u,channelList:j,onSelect:h,isDark:b}),e.jsxs("button",{onClick:()=>d(!o),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-medium transition-all duration-300 ${o?"bg-rose-500/10 border-rose-500/30 text-rose-300 shadow-[0_0_15px_rgba(244,63,94,0.2)]":b?"bg-slate-800/50 border-white/5 text-slate-400 hover:text-white":"bg-white/50 border-black/5 text-slate-600 hover:text-slate-900"}`,children:[o?e.jsx(He,{size:14,className:"animate-pulse"}):e.jsx(He,{size:14}),o?"å¼‚å¸¸ ON":"å¼‚å¸¸ OFF"]})]})]}),m&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 z-20 rounded-2xl",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"})}),e.jsx("div",{className:"flex-1 w-full min-h-[350px] relative cursor-pointer",children:e.jsx("div",{ref:W,className:"absolute inset-0 w-full h-full"})})]})},$s=({isOpen:t,onClose:a,itemName:l,riskType:s,data:n,loading:o=!1})=>{const[d,x]=r.useState(!1);if(r.useEffect(()=>{if(t)x(!0);else{const p=setTimeout(()=>x(!1),200);return()=>clearTimeout(p)}},[t]),!d&&!t)return null;const f=s==="OUT_OF_STOCK",m=n.reduce((p,u)=>p+(u.impactValue||0),0),c={light:{label:"è½»åº¦",color:"text-yellow-400",bg:"bg-yellow-500/10",border:"border-yellow-500/30"},medium:{label:"ä¸­åº¦",color:"text-orange-400",bg:"bg-orange-500/10",border:"border-orange-500/30"},heavy:{label:"é‡åº¦",color:"text-rose-400",bg:"bg-rose-500/10",border:"border-rose-500/30"},critical:{label:"è¶…é‡åº¦",color:"text-red-500",bg:"bg-red-500/10",border:"border-red-500/30"}},i=f?null:{light:n.filter(p=>p.severity==="light"),medium:n.filter(p=>p.severity==="medium"),heavy:n.filter(p=>p.severity==="heavy"),critical:n.filter(p=>p.severity==="critical")};return e.jsxs("div",{className:"fixed inset-0 z-[60] flex justify-end",children:[e.jsx("div",{className:`absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity duration-200 ${t?"opacity-100":"opacity-0"}`,onClick:a}),e.jsxs("div",{className:`relative w-full max-w-lg h-full bg-slate-900 border-l border-white/10 shadow-2xl transform transition-transform duration-200 ease-out flex flex-col ${t?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:`px-5 py-4 border-b flex items-center justify-between ${f?"border-rose-500/20 bg-rose-500/5":"border-orange-500/20 bg-orange-500/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${f?"bg-rose-500/20":"bg-orange-500/20"}`,children:f?e.jsx(Gt,{size:18,className:"text-rose-400"}):e.jsx(Ye,{size:18,className:"text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-bold text-white",children:l}),e.jsx("p",{className:`text-xs ${f?"text-rose-400":"text-orange-400"}`,children:f?"å”®ç½„å“æ˜ç»†":"æ»é”€å“æ˜ç»†"})]})]}),e.jsx("button",{onClick:a,className:"p-2 rounded-lg hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:e.jsx(jt,{size:18})})]}),e.jsxs("div",{className:"px-5 py-3 border-b border-white/5 flex items-center justify-between bg-slate-800/30",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-500 uppercase",children:"å•†å“æ•°"}),e.jsx("p",{className:"text-lg font-bold text-white font-mono",children:n.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-500 uppercase",children:f?"æ½œåœ¨æŸå¤±":"ç§¯å‹èµ„é‡‘"}),e.jsxs("p",{className:`text-lg font-bold font-mono ${f?"text-rose-400":"text-orange-400"}`,children:["Â¥",m.toLocaleString()]})]})]}),o&&e.jsx(ue,{size:16,className:"text-indigo-400 animate-spin"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:o?e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx(ue,{size:24,className:"text-indigo-400 animate-spin"})}):n.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-40 text-slate-500",children:e.jsx("span",{className:"text-sm",children:"æš‚æ— æ•°æ®"})}):f?e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-slate-800/95 z-10",children:e.jsxs("tr",{className:"border-b border-white/5",children:[e.jsx("th",{className:"text-left py-3 px-4 text-[10px] text-slate-500 font-medium uppercase",children:"å•†å“åç§°"}),e.jsx("th",{className:"text-right py-3 px-4 text-[10px] text-slate-500 font-medium uppercase w-24",children:"å½±å“é‡‘é¢"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:n.map((p,u)=>e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors",children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"text-slate-200 font-medium truncate max-w-[280px]",title:p.skuName,children:p.skuName}),e.jsx("div",{className:"text-[10px] text-slate-500 mt-0.5",children:p.reason})]}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-rose-400 font-mono font-medium",children:["Â¥",(p.impactValue||0).toLocaleString()]})})]},p.id||u))})]}):e.jsx("div",{className:"space-y-4 p-4",children:["critical","heavy","medium","light"].map(p=>{const u=(i==null?void 0:i[p])||[];if(u.length===0)return null;const h=c[p],j=u.reduce((b,M)=>b+(M.impactValue||0),0);return e.jsxs("div",{className:`rounded-lg border ${h.border} ${h.bg} overflow-hidden`,children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-xs font-bold ${h.color}`,children:[h.label,"æ»é”€"]}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:[p==="light"&&"(7å¤©)",p==="medium"&&"(8-15å¤©)",p==="heavy"&&"(16-30å¤©)",p==="critical"&&"(>30å¤©)"]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("span",{className:"text-slate-400",children:[u.length,"ä»¶"]}),e.jsxs("span",{className:`font-mono ${h.color}`,children:["Â¥",j.toLocaleString()]})]})]}),e.jsx("table",{className:"w-full text-sm",children:e.jsx("tbody",{className:"divide-y divide-white/5",children:u.map((b,M)=>e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors",children:[e.jsx("td",{className:"py-2.5 px-4",children:e.jsx("div",{className:"text-slate-200 text-xs truncate max-w-[240px]",title:b.skuName,children:b.skuName})}),e.jsx("td",{className:"py-2.5 px-4 text-right whitespace-nowrap",children:e.jsx("span",{className:`text-xs font-mono ${h.color}`,children:b.duration})}),e.jsx("td",{className:"py-2.5 px-4 text-right whitespace-nowrap",children:e.jsxs("span",{className:"text-xs text-slate-400 font-mono",children:["Â¥",(b.impactValue||0).toLocaleString()]})})]},b.id||M))})})]},p)})})})]})]})},Ms=({theme:t="dark"})=>{const a=t==="dark",{selectedStore:l}=ce(),[s,n]=r.useState([]),[o,d]=r.useState(!1),[x,f]=r.useState(null),[m,c]=r.useState(null),[i,p]=r.useState(null),[u,h]=r.useState([]),[j,b]=r.useState(!1),[M,L]=r.useState(null),[P,T]=r.useState(!1),[w,z]=r.useState({isOpen:!1,date:"",type:null,data:[],loading:!1,total:0}),[O,E]=r.useState({isOpen:!1,itemName:"",type:null,data:[],loading:!1});r.useEffect(()=>{(async()=>{d(!0),f(null);try{const N=await ps.getPerformanceWithRisk({store_name:l||void 0,parent_category:m||void 0});N.success&&N.data&&N.data.length>0?n(N.data):(n([]),N.error&&f(N.error))}catch(N){n([]),f((N==null?void 0:N.message)||"è·å–æ•°æ®å¤±è´¥")}finally{d(!1)}})()},[l,m]);const $=i||m;r.useEffect(()=>{(async()=>{if(!l){h([]);return}console.log("[TrendFetch] currentFilterCategory:",$),b(!0);try{const N=await we.getRiskTrend(l,$||void 0,30);console.log("[TrendFetch] APIå“åº”:",N),N.success&&N.data?h(N.data):h([])}catch(N){console.error("[TrendFetch] é”™è¯¯:",N),h([])}finally{b(!1)}})()},[l,$]),r.useEffect(()=>{(async()=>{if(!l){L(null);return}T(!0);try{const N=await we.getSoldOutAnalysis(l,$||void 0,30);N.success&&N.data?L(N.data):L(null)}catch{L(null)}finally{T(!1)}})()},[l,$]);const I=r.useCallback(async(g,N)=>{if(w.isOpen&&w.date===g&&w.type===N){z(R=>({...R,isOpen:!1}));return}z({isOpen:!0,date:g,type:N,data:[],loading:!0,total:0});try{let R=[],q=0;if(N==="OUT_OF_STOCK"){const X=await we.getSoldOutProducts(l||void 0,void 0,1,5);R=X.data||[],q=X.total||0}else{const X=await we.getSlowMovingProducts(l||void 0,void 0,void 0,1,5);R=X.data||[],q=X.total||0}z(X=>({...X,data:R,loading:!1,total:q}))}catch{z(q=>({...q,data:[],loading:!1,total:0}))}},[w,l]),H=r.useCallback(()=>{if(!w.type)return;E({isOpen:!0,itemName:w.date,type:w.type,data:[],loading:!0}),(async()=>{try{let N=[];w.type==="OUT_OF_STOCK"?N=(await we.getSoldOutProducts(l||void 0,void 0,1,100)).data||[]:N=(await we.getSlowMovingProducts(l||void 0,void 0,void 0,1,100)).data||[],E(R=>({...R,data:N,loading:!1}))}catch{E(R=>({...R,data:[],loading:!1}))}})()},[w,l]),K=()=>E(g=>({...g,isOpen:!1})),k=g=>g>=.55?"#22d3ee":g>=.45?"#34d399":g>=.35?"#818cf8":g>=.25?"#a78bfa":g>=.15?"#fbbf24":"#f43f5e",D=r.useMemo(()=>!s||s.length===0?[]:s.map(g=>{const N=g.name.split("|"),R=N.length>1?N[1]:g.name,q=(g.grossMargin||0)/100;return{name:R,fullName:g.name,value:g.revenue||0,profit:g.profit||0,orderCount:g.orderCount||0,margin:g.grossMargin||0,marginDecimal:q,soldOut:g.soldOutCount||0,slowMoving:g.slowMovingCount||0,turnover:g.inventoryTurnover||0,itemStyle:{color:k(q),borderColor:a?"#0f172a":"#fff",borderWidth:2,gapWidth:1}}}),[s,a]),W=r.useMemo(()=>D.length>0&&D.some(g=>g.value>0),[D]),v=r.useMemo(()=>{if(u.length===0)return null;const g=u[u.length-1],N=u[0];return{latestSoldOut:g.soldOutCount,latestSlowMoving:g.slowMovingCount,latestSlowMovingRate:g.slowMovingRate||0,soldOutChange:g.soldOutCount-N.soldOutCount,slowMovingChange:g.slowMovingCount-N.slowMovingCount,slowMovingRateChange:(g.slowMovingRate||0)-(N.slowMovingRate||0),totalSkuWithStock:g.totalSkuWithStock||0}},[u]),C=r.useCallback(g=>{var R,q;const N=g;if(N.name)if(console.log("[TreemapClick] params:",{name:N.name,fullName:(R=N.data)==null?void 0:R.fullName,selectedCategory:m}),!m)c(N.name),p(null);else{const X=((q=N.data)==null?void 0:q.fullName)||N.name;console.log("[TreemapClick] é€‰ä¸­ä¸‰çº§åˆ†ç±»:",X),p(i===X?null:X)}},[m,i]),F=r.useMemo(()=>{if(!W)return{series:[]};const g=D.map(N=>({...N,itemStyle:{...N.itemStyle,borderColor:i===N.fullName?"#a855f7":a?"#0f172a":"#fff",borderWidth:i===N.fullName?3:2}}));return{animation:!0,animationDuration:500,animationEasing:"cubicOut",animationDurationUpdate:500,animationEasingUpdate:"cubicOut",tooltip:{backgroundColor:a?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:a?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",textStyle:{fontFamily:"JetBrains Mono",color:a?"#fff":"#0f172a"},padding:12,formatter:N=>{const R=N.data;return R?`
            <div style="font-weight: bold; margin-bottom: 8px;">${R.name}</div>
            <div>é”€å”®é¢: Â¥${(R.value||0).toLocaleString()}</div>
            <div>åˆ©æ¶¦: Â¥${(R.profit||0).toLocaleString()}</div>
            <div>åˆ©æ¶¦ç‡: ${(R.margin||0).toFixed(1)}%</div>
            <div>è®¢å•æ•°: ${R.orderCount||0}</div>
            ${R.soldOut>0?`<div style="color:#f43f5e">å”®ç½„: ${R.soldOut}ä¸ª</div>`:""}
            ${R.slowMoving>0?`<div style="color:#f97316">æ»é”€: ${R.slowMoving}ä¸ª</div>`:""}
            ${m?'<div style="color:#a855f7;margin-top:4px;font-size:10px">ç‚¹å‡»ç­›é€‰è¶‹åŠ¿å›¾</div>':""}
          `:""}},series:[{type:"treemap",data:g,left:0,right:0,top:0,bottom:0,roam:!1,nodeClick:!1,breadcrumb:{show:!1},animation:!0,animationDurationUpdate:500,animationEasingUpdate:"cubicOut",label:{show:!0,formatter:N=>{const R=N.data;let q=`${R.name}
Â¥${(R.value/1e3).toFixed(0)}k`;return(R.soldOut>0||R.slowMoving>0)&&(q+=`
âš ï¸`),i===R.fullName&&(q+=`
âœ“`),q},fontSize:10,color:"#fff",textShadowBlur:2,textShadowColor:"rgba(0,0,0,0.5)"},itemStyle:{borderRadius:4,borderColor:a?"#1e293b":"#fff",borderWidth:2}}]}},[D,a,W,i,m]),A=me(F,[D,a,m,i],t,C),S=r.useMemo(()=>{if(u.length===0)return{series:[]};const g=u.map(R=>R.date.slice(5)),N=u.map(R=>R.soldOutCount);return{backgroundColor:"transparent",tooltip:{trigger:"axis",backgroundColor:"rgba(15, 23, 42, 0.95)",borderColor:"rgba(244, 63, 94, 0.3)",textStyle:{color:"#e2e8f0",fontSize:11},formatter:R=>{const q=R[0];return`<div class="font-mono text-xs">
            <div class="text-slate-400">${q.axisValue}</div>
            <div class="text-rose-400 font-bold mt-1">å”®ç½„å“: ${q.value} ä¸ª</div>
            <div class="text-slate-500 text-[10px] mt-1">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</div>
          </div>`}},grid:{top:10,left:35,right:10,bottom:25},xAxis:{type:"category",data:g,axisLine:{lineStyle:{color:"rgba(148, 163, 184, 0.2)"}},axisTick:{show:!1},axisLabel:{color:"#64748b",fontSize:9,interval:Math.floor(g.length/5)}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgba(148, 163, 184, 0.08)"}},axisLabel:{color:"#64748b",fontSize:9}},series:[{type:"line",data:N,smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{color:"#f43f5e",width:2},itemStyle:{color:"#f43f5e"},emphasis:{itemStyle:{borderColor:"#fff",borderWidth:2,shadowBlur:10,shadowColor:"rgba(244,63,94,0.5)"}},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(244, 63, 94, 0.3)"},{offset:1,color:"rgba(244, 63, 94, 0)"}]}}}]}},[u]),V=r.useCallback(g=>{if(g.dataIndex!==void 0&&u[g.dataIndex]){const N=u[g.dataIndex].date;I(N,"OUT_OF_STOCK")}},[u,I]),U=me(S,[u],t,V),Y=r.useMemo(()=>{if(u.length===0)return{series:[]};const g=u.map(ee=>ee.date.slice(5)),N=u.map(ee=>{var te;return((te=ee.slowMovingByLevel)==null?void 0:te.watch)||0}),R=u.map(ee=>{var te;return((te=ee.slowMovingByLevel)==null?void 0:te.light)||0}),q=u.map(ee=>{var te;return((te=ee.slowMovingByLevel)==null?void 0:te.medium)||0}),X=u.map(ee=>{var te;return((te=ee.slowMovingByLevel)==null?void 0:te.heavy)||0}),re=N.some(ee=>ee>0),ne=R.some(ee=>ee>0),xe=q.some(ee=>ee>0),ye=X.some(ee=>ee>0),de=[];return ye&&de.push({name:"é‡åº¦(30å¤©)",type:"bar",stack:"total",data:X,itemStyle:{color:"#dc2626"},barWidth:"60%"}),xe&&de.push({name:"ä¸­åº¦(15å¤©)",type:"bar",stack:"total",data:q,itemStyle:{color:"#f97316"}}),ne&&de.push({name:"è½»åº¦(7å¤©)",type:"bar",stack:"total",data:R,itemStyle:{color:"#fbbf24"}}),re&&de.push({name:"å…³æ³¨(3å¤©)",type:"bar",stack:"total",data:N,itemStyle:{color:"#a3e635",borderRadius:[2,2,0,0]}}),de.length===0?{series:[]}:{backgroundColor:"transparent",tooltip:{trigger:"axis",backgroundColor:"rgba(15, 23, 42, 0.95)",borderColor:"rgba(249, 115, 22, 0.3)",textStyle:{color:"#e2e8f0",fontSize:11},formatter:ee=>{var ae,le;const te=((ae=ee[0])==null?void 0:ae.axisValue)||"",_=(le=ee[0])==null?void 0:le.dataIndex,J=u[_];let se=0,B=`<div class="font-mono text-xs"><div class="text-slate-400 mb-1">${te}</div>`;ee.forEach(pe=>{se+=pe.value||0,B+=`<div style="display:flex;align-items:center;gap:4px;padding:2px 0">
              <span style="background:${pe.color};width:6px;height:6px;border-radius:1px;"></span>
              <span style="color:#94a3b8">${pe.seriesName}:</span>
              <span style="color:${pe.color};font-weight:bold">${pe.value}</span>
            </div>`});const Z=(J==null?void 0:J.slowMovingRate)||0;return B+=`<div style="border-top:1px solid rgba(255,255,255,0.1);margin-top:4px;padding-top:4px;color:#f97316;font-weight:bold">åˆè®¡: ${se} (${Z}%)</div>`,B+='<div style="color:#64748b;font-size:10px;margin-top:4px">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</div></div>',B}},legend:{show:!1},grid:{top:10,left:35,right:10,bottom:25},xAxis:{type:"category",data:g,axisLine:{lineStyle:{color:"rgba(148, 163, 184, 0.2)"}},axisTick:{show:!1},axisLabel:{color:"#64748b",fontSize:9,interval:Math.floor(g.length/5)}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgba(148, 163, 184, 0.08)"}},axisLabel:{color:"#64748b",fontSize:9}},series:de}},[u]),G=r.useCallback(g=>{if(g.dataIndex!==void 0&&u[g.dataIndex]){const N=u[g.dataIndex].date;I(N,"SLOW_MOVING")}},[u,I]),y=me(Y,[u],t,G);return e.jsxs("div",{className:`glass-panel rounded-2xl p-4 h-full flex flex-col relative overflow-hidden transition-all duration-300 ${m?"border-purple-500/50 shadow-[0_0_30px_rgba(168,85,247,0.15)]":""}`,children:[e.jsx($s,{isOpen:O.isOpen,onClose:K,itemName:O.itemName,riskType:O.type,data:O.data,loading:O.loading}),e.jsxs("div",{className:"mb-3 shrink-0 flex justify-between items-start z-20 relative",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("h3",{className:"text-base font-bold text-white flex items-center gap-2",children:[e.jsx(ke,{size:16,className:"text-purple-400"}),"å“ç±»æ•ˆç›ŠçŸ©é˜µå·¥ä½œå°"]}),e.jsx("div",{className:"flex items-center gap-2 mt-0.5 h-5",children:o?e.jsxs("p",{className:"text-[10px] text-indigo-400 font-mono flex items-center gap-1 animate-pulse",children:[e.jsx(ue,{size:10,className:"animate-spin"})," åŠ è½½ä¸­..."]}):m?e.jsxs("div",{className:"flex items-center gap-2 animate-fade-in-up",children:[e.jsx("span",{className:"text-[10px] text-slate-500",children:"ROOT /"}),e.jsx("span",{className:"text-[10px] font-bold text-purple-300 px-1.5 py-0.5 bg-purple-500/10 rounded border border-purple-500/20",children:m})]}):e.jsxs("p",{className:"text-[10px] text-slate-400 font-mono uppercase tracking-wider opacity-70 flex items-center gap-1",children:[e.jsx(Kt,{size:10})," ç‚¹å‡»æ ‘çŠ¶å›¾ä¸‹é’» Â· ç‚¹å‡»è¶‹åŠ¿å›¾æŸ¥çœ‹è¯¦æƒ…"]})})]}),m&&e.jsxs("button",{onClick:g=>{g.stopPropagation(),c(null),p(null)},className:"group flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-white/10 hover:bg-white/20 text-white text-[10px] font-bold transition-all border border-white/10",children:[e.jsx(qt,{size:12,className:"group-hover:-translate-x-1 transition-transform"}),"è¿”å›"]})]}),x&&e.jsxs("div",{className:"mb-2 px-2 py-1.5 bg-rose-500/10 border border-rose-500/20 rounded-lg text-rose-400 text-[10px] flex items-center gap-2",children:[e.jsx("span",{children:"âš ï¸"}),e.jsx("span",{children:x})]}),e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col gap-3 relative z-10",children:[e.jsxs("div",{className:"h-[60%] relative rounded-xl overflow-hidden border border-white/5 bg-slate-950/20 transition-all duration-300",children:[e.jsxs("div",{className:"absolute top-2 left-2 z-10 flex items-center gap-1.5 px-1.5 py-0.5 bg-black/40 backdrop-blur-md rounded text-[9px] text-slate-300 font-mono pointer-events-none",children:[e.jsx(Yt,{size:9}),"å®è§‚è§†å›¾"]}),e.jsx("div",{ref:A,className:`absolute inset-0 transition-opacity duration-300 ${W&&!o?"opacity-100":"opacity-0"}`}),o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(ue,{size:20,className:"text-indigo-400 animate-spin"})}),!o&&!W&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-slate-500 text-xs gap-1 p-4",children:[e.jsx(ke,{size:24,className:"text-slate-600"}),e.jsx("span",{children:D.length===0?"æš‚æ— å“ç±»æ•°æ®":"é”€å”®é¢ä¸º0"})]})]}),e.jsxs("div",{className:"h-[40%] grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"h-full flex flex-col bg-slate-950/20 rounded-xl border border-white/5 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-2.5 py-1.5 border-b border-white/5 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Me,{size:11,className:"text-rose-400"}),e.jsx("span",{className:"text-[11px] font-medium text-white",children:"å”®ç½„è¶‹åŠ¿"}),$&&e.jsx("span",{className:"text-[8px] px-1 py-0.5 rounded bg-purple-500/20 text-purple-300 border border-purple-500/30 max-w-[80px] truncate",title:$,children:$.includes("|")?$.split("|").pop():$}),e.jsx("span",{className:"text-[8px] text-slate-500 ml-1",title:"åº“å­˜=0 ä¸” è¿‘7å¤©æœ‰é”€é‡",children:"(åº“å­˜=0ä¸”è¿‘7å¤©æœ‰é”€)"})]}),v&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-bold text-rose-400",children:v.latestSoldOut}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"ä¸ª"}),v.soldOutChange!==0&&e.jsxs("span",{className:`text-[9px] px-1 py-0.5 rounded ${v.soldOutChange>0?"bg-rose-500/20 text-rose-400":"bg-emerald-500/20 text-emerald-400"}`,children:[v.soldOutChange>0?"â†‘":"â†“",Math.abs(v.soldOutChange)]})]})]}),e.jsxs("div",{className:"flex-1 relative",children:[j&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 z-10",children:e.jsx(ue,{size:16,className:"text-indigo-400 animate-spin"})}),e.jsx("div",{ref:U,className:"absolute inset-0"})]})]}),e.jsxs("div",{className:"h-full flex flex-col bg-slate-950/20 rounded-xl border border-white/5 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-2.5 py-1.5 border-b border-white/5 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ge,{size:11,className:"text-orange-400"}),e.jsx("span",{className:"text-[11px] font-medium text-white",children:"æ»é”€è¶‹åŠ¿"}),$&&e.jsx("span",{className:"text-[8px] px-1 py-0.5 rounded bg-purple-500/20 text-purple-300 border border-purple-500/30 max-w-[80px] truncate",title:$,children:$.includes("|")?$.split("|").pop():$}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-lime-400"}),e.jsx("span",{className:"text-[8px] text-slate-500",children:"å…³æ³¨"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-yellow-400"}),e.jsx("span",{className:"text-[8px] text-slate-500",children:"è½»"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-orange-500"}),e.jsx("span",{className:"text-[8px] text-slate-500",children:"ä¸­"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-red-600"}),e.jsx("span",{className:"text-[8px] text-slate-500",children:"é‡"})]})]}),v&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-bold text-orange-400",children:v.latestSlowMoving}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"ä¸ª"}),v.slowMovingChange!==0&&e.jsxs("span",{className:`text-[9px] px-1 py-0.5 rounded ${v.slowMovingChange>0?"bg-rose-500/20 text-rose-400":"bg-emerald-500/20 text-emerald-400"}`,children:[v.slowMovingChange>0?"â†‘":"â†“",Math.abs(v.slowMovingChange)]})]})]}),e.jsxs("div",{className:"flex-1 relative",children:[j&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 z-10",children:e.jsx(ue,{size:16,className:"text-indigo-400 animate-spin"})}),e.jsx("div",{ref:y,className:"absolute inset-0"})]})]})]})]}),M&&e.jsxs("div",{className:"mt-3 grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"bg-slate-900/50 rounded-lg border border-white/5 p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(Ae,{size:12,className:"text-rose-400"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"é¢„ä¼°æŸå¤±"})]}),e.jsxs("div",{className:"text-lg font-bold text-rose-400",children:["Â¥",M.estimatedLoss.toLocaleString()]}),e.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5",children:"åŸºäºæ—¥å‡é”€å”®é¢"})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg border border-white/5 p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(Nt,{size:12,className:"text-amber-400"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"å¹³å‡æ¢å¤"})]}),e.jsxs("div",{className:"text-lg font-bold text-amber-400",children:[M.avgRecoveryDays," ",e.jsx("span",{className:"text-xs font-normal",children:"å¤©"})]}),e.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5",children:"ä»å”®ç½„åˆ°è¡¥è´§"})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg border border-white/5 p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(ke,{size:12,className:"text-indigo-400"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"å“ç±»åˆ†å¸ƒ"})]}),e.jsxs("div",{className:"space-y-1",children:[M.byCategory.slice(0,3).map((g,N)=>e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsxs("span",{className:"text-slate-300 truncate max-w-[80px]",title:g.category,children:[N+1,". ",g.category]}),e.jsxs("span",{className:"text-rose-400 font-mono",children:[g.count,"ä¸ª"]})]},g.category)),M.byCategory.length===0&&e.jsx("div",{className:"text-[10px] text-slate-500",children:"æš‚æ— æ•°æ®"})]})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg border border-white/5 p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(Jt,{size:12,className:"text-purple-400"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"é«˜é¢‘å”®ç½„"})]}),e.jsxs("div",{className:"space-y-1",children:[M.frequentSoldOut.slice(0,3).map((g,N)=>e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsxs("span",{className:"text-slate-300 truncate max-w-[80px]",title:g.name,children:[N+1,". ",g.name]}),e.jsxs("span",{className:"text-purple-400 font-mono",children:[g.times,"æ¬¡"]})]},g.name)),M.frequentSoldOut.length===0&&e.jsx("div",{className:"text-[10px] text-slate-500",children:"æš‚æ— é«˜é¢‘å”®ç½„"})]})]})]}),P&&!M&&e.jsxs("div",{className:"mt-3 flex items-center justify-center py-4 bg-slate-900/30 rounded-lg border border-white/5",children:[e.jsx(ue,{size:14,className:"text-indigo-400 animate-spin mr-2"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"åŠ è½½å”®ç½„åˆ†æ..."})]}),w.isOpen&&e.jsx("div",{className:"mt-3 animate-fade-in-up",children:e.jsxs("div",{className:"bg-slate-900/50 rounded-xl border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/5 bg-slate-800/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[w.type==="OUT_OF_STOCK"?e.jsx(Me,{size:14,className:"text-rose-400"}):e.jsx(Ge,{size:14,className:"text-orange-400"}),e.jsx("span",{className:"text-xs font-bold text-white",children:w.type==="OUT_OF_STOCK"?"å”®ç½„å“è¯¦æƒ…":"æ»é”€å“è¯¦æƒ…"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:[w.date," Â· å…± ",w.total," ä¸ª"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w.total>5&&e.jsxs("button",{onClick:H,className:"flex items-center gap-1 px-2 py-1 rounded text-[10px] font-bold bg-indigo-500/20 text-indigo-400 border border-indigo-500/30 hover:bg-indigo-500 hover:text-white transition-all",children:["æŸ¥çœ‹å…¨éƒ¨ ",e.jsx(Xt,{size:10})]}),e.jsx("button",{onClick:()=>z(g=>({...g,isOpen:!1})),className:"p-1 rounded hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:e.jsx(Zt,{size:14})})]})]}),e.jsx("div",{className:"p-2",children:w.loading?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(ue,{size:16,className:"text-indigo-400 animate-spin"})}):w.data.length===0?e.jsx("div",{className:"text-center py-4 text-slate-500 text-xs",children:"æš‚æ— æ•°æ®"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-2",children:w.data.slice(0,5).map((g,N)=>e.jsxs("div",{className:"flex items-center gap-2 px-2.5 py-2 bg-slate-800/50 rounded-lg border border-white/5 hover:border-white/10 transition-colors",children:[e.jsx("div",{className:`w-1.5 h-8 rounded-full ${w.type==="OUT_OF_STOCK"?"bg-rose-500":"bg-orange-500"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-white truncate",title:g.skuName,children:g.skuName}),e.jsx("div",{className:"text-[10px] text-slate-500",children:g.reason})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-[10px] font-mono text-slate-400",children:["Â¥",(g.impactValue||0).toFixed(0)]}),e.jsx("div",{className:"text-[9px] text-slate-600",children:g.duration||g.action})]})]},g.id||N))})})]})})]})},Ls=({data:t,theme:a})=>{const l=a==="dark",s=l?"#64748b":"#94a3b8",n=l?"#fff":"#0f172a",o=l?"#94a3b8":"#64748b",d=l?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",{categories:x,series:f}=r.useMemo(()=>{const i={},p=t;p.length>0&&p[0].marketingTrend&&p[0].marketingTrend.forEach(h=>{i[h.date]={date:h.date,itemDiscount:0,thresholdDiscount:0,vouchers:0,other:0}}),p.forEach(h=>{var j;(j=h.marketingTrend)==null||j.forEach(b=>{i[b.date]&&(i[b.date].itemDiscount+=b.itemDiscount,i[b.date].thresholdDiscount+=b.thresholdDiscount,i[b.date].vouchers+=b.vouchers,i[b.date].other+=b.other)})});const u=Object.keys(i);return{categories:u,series:[{name:"å•å“ç›´é™",data:u.map(h=>i[h].itemDiscount),color:"#f43f5e"},{name:"æ»¡å‡æ´»åŠ¨",data:u.map(h=>i[h].thresholdDiscount),color:"#f59e0b"},{name:"çº¢åŒ…/åˆ¸",data:u.map(h=>i[h].vouchers),color:"#3b82f6"},{name:"æ¨å¹¿/å¹¿å‘Š",data:u.map(h=>i[h].other),color:"#8b5cf6"}]}},[t]),m={grid:{top:30,right:10,bottom:0,left:10,containLabel:!0},tooltip:{trigger:"axis",backgroundColor:l?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:l?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:12,textStyle:{fontFamily:"JetBrains Mono",color:l?"#fff":"#0f172a"},axisPointer:{type:"shadow"}},legend:{data:["å•å“ç›´é™","æ»¡å‡æ´»åŠ¨","çº¢åŒ…/åˆ¸","æ¨å¹¿/å¹¿å‘Š"],textStyle:{color:s,fontSize:10},bottom:0,itemWidth:10,itemHeight:10},xAxis:{type:"category",data:x,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:s,fontSize:10}},yAxis:{type:"value",splitLine:{lineStyle:{color:d,type:"dashed"}},axisLabel:{color:s,fontSize:10,formatter:i=>`Â¥${i/1e3}k`}},series:f.map(i=>({name:i.name,type:"bar",stack:"total",data:i.data,itemStyle:{color:i.color},barWidth:"40%"}))},c=me(m,[t,a],a);return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col relative overflow-hidden",children:[e.jsxs("div",{className:"mb-4 relative z-10",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:n},children:[e.jsx("span",{className:"w-1 h-4 bg-gradient-to-b from-rose-400 to-rose-600 rounded-sm"}),"è¥é”€æˆæœ¬è¶‹åŠ¿"]}),e.jsx("p",{className:"text-xs mt-1 font-mono uppercase tracking-wider opacity-70",style:{color:o},children:"7-DAY COST BREAKDOWN"})]}),e.jsx("div",{className:"flex-1 w-full min-h-[250px]",children:e.jsx("div",{ref:c,className:"w-full h-full"})})]})},Ds=({theme:t,selectedDistanceBand:a,storeName:l,selectedDate:s,selectedDateRange:n})=>{const o=t==="dark",d=o?"#94a3b8":"#64748b",x=o?"#fff":"#0f172a",f=o?"#94a3b8":"#64748b",m=o?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",{selectedStore:c,dateRange:i}=ce(),p=l||c,[u,h]=r.useState([]),[j,b]=r.useState(!1),[M,L]=r.useState(null),[P,T]=r.useState(null),w=r.useRef(null),z=r.useRef(null);r.useEffect(()=>{if(console.log("ğŸ“¡ DeliveryHeatmap - selectedStore:",p,"selectedDate:",s,"selectedDateRange:",n),!p){h([]),L(null);return}(async()=>{var D;b(!0);try{const W={store_name:p};s?W.target_date=s:n?(W.start_date=n.start,W.end_date=n.end):i.type!=="all"&&i.start&&i.end&&(W.start_date=i.start,W.end_date=i.end),a&&(W.min_distance=a.minDistance,W.max_distance=a.maxDistance),console.log("ğŸ“¡ é…é€æº¢ä»·é›·è¾¾è¯·æ±‚å‚æ•°:",W);const v=await ie.getDeliveryRadar(W);v.success&&(console.log("ğŸ“¡ é…é€æº¢ä»·é›·è¾¾æ•°æ®:",(D=v.data)==null?void 0:D.length,"æ¡, æ—¥æœŸ:",v.date),h(v.data||[]),L(v.date||null))}catch(W){console.error("è·å–é…é€æº¢ä»·é›·è¾¾æ•°æ®å¤±è´¥:",W)}finally{b(!1)}})()},[p,s,n,i.type,i.start,i.end,a]);const{basePoints:O,channelStats:E}=r.useMemo(()=>{if(!u.length)return console.log("ğŸ“¡ DeliveryHeatmap basePoints - æ— æ•°æ®"),{basePoints:[],channelStats:[]};const D=u.filter(S=>typeof S.distance=="number"&&!isNaN(S.distance)&&typeof S.hour=="number"&&!isNaN(S.hour)&&typeof S.delivery_cost=="number"&&!isNaN(S.delivery_cost)&&typeof S.order_value=="number"&&!isNaN(S.order_value)&&typeof S.profit=="number"&&!isNaN(S.profit)).filter(S=>S.is_premium),W={};D.forEach(S=>{const V=S.channel||"å…¶ä»–";let U="å…¶ä»–";V.includes("ç¾å›¢")?U="ç¾å›¢":V.includes("é¥¿äº†ä¹ˆ")?U="é¥¿äº†ä¹ˆ":V.includes("æŠ–éŸ³")?U="æŠ–éŸ³":V.includes("äº¬ä¸œ")&&(U="äº¬ä¸œ"),W[U]=(W[U]||0)+1});const v={ç¾å›¢:"#FFB800",é¥¿äº†ä¹ˆ:"#0096FF",æŠ–éŸ³:"#1a1a1a",äº¬ä¸œ:"#E4393C",å…¶ä»–:"#8B5CF6"},C=Object.entries(W).map(([S,V])=>({name:S,count:V,color:v[S]||"#8B5CF6"})).sort((S,V)=>V.count-S.count);let F=D;P&&(F=D.filter(S=>{const V=S.channel||"å…¶ä»–";return P==="ç¾å›¢"?V.includes("ç¾å›¢"):P==="é¥¿äº†ä¹ˆ"?V.includes("é¥¿äº†ä¹ˆ"):P==="æŠ–éŸ³"?V.includes("æŠ–éŸ³"):P==="äº¬ä¸œ"?V.includes("äº¬ä¸œ"):P==="å…¶ä»–"?!V.includes("ç¾å›¢")&&!V.includes("é¥¿äº†ä¹ˆ")&&!V.includes("æŠ–éŸ³")&&!V.includes("äº¬ä¸œ"):!0}));const A=F.map(S=>({value:[S.distance,S.hour,S.delivery_cost,S.order_value,S.profit,S.channel||""],originalAngle:S.hour,isPremium:S.is_premium}));return console.log("ğŸ“¡ DeliveryHeatmap - æº¢ä»·è®¢å•:",D.length,"ç­›é€‰å:",A.length),{basePoints:A,channelStats:C}},[u,P]),$=r.useMemo(()=>{if(!O.length)return 8.5;const k=Math.max(...O.map(D=>D.value[0]));return Math.max(2,Math.ceil(k)+.5)},[O]),I={ç¾å›¢:"#FFB800",é¥¿äº†ä¹ˆ:"#0096FF",æŠ–éŸ³:"#000000",äº¬ä¸œ:"#E4393C",å…¶ä»–:"#8B5CF6"},H=k=>{if(!k)return"#f43f5e";for(const[D,W]of Object.entries(I))if(k.includes(D))return W;return"#f43f5e"},K=r.useMemo(()=>{var k;return O.length?(console.log("ğŸ“¡ DeliveryHeatmap option - ç”Ÿæˆé…ç½®:",{pointsCount:O.length,maxDistance:$,firstPoint:(k=O[0])==null?void 0:k.value}),{polar:{radius:["5%","82%"],center:["50%","50%"]},angleAxis:{type:"value",min:0,max:24,interval:3,startAngle:90,clockwise:!0,axisLine:{lineStyle:{color:m}},axisLabel:{formatter:"{value}h",color:d,fontSize:10,fontFamily:"JetBrains Mono",fontWeight:"bold"},splitLine:{show:!0,lineStyle:{color:m,width:1}}},radiusAxis:{min:0,max:$,interval:$<=2?.5:$<=4?1:2,axisLine:{show:!1},axisLabel:{formatter:"{value}km",color:d,fontSize:9,verticalAlign:"bottom"},splitLine:{lineStyle:{color:m,type:"dashed"}}},tooltip:{backgroundColor:o?"rgba(2, 6, 23, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:o?"rgba(255, 255, 255, 0.2)":"rgba(0,0,0,0.1)",padding:12,textStyle:{fontFamily:"JetBrains Mono",color:o?"#fff":"#0f172a"},formatter:D=>{var U;const W=(U=D.data)==null?void 0:U.value;if(!W)return"";const[v,C,F,A,S,V]=W;return`
            <div style="font-weight:600;margin-bottom:6px;color:#f43f5e">âš ï¸ é…é€æº¢ä»·è®¢å•</div>
            <div>æ¸ é“: ${V||"æœªçŸ¥"}</div>
            <div>è·ç¦»: ${v.toFixed(1)}km</div>
            <div>æ—¶æ®µ: ${C}:00</div>
            <div>é…é€æˆæœ¬: <span style="color:#f43f5e;font-weight:bold">Â¥${F.toFixed(1)}</span></div>
            <div>å®¢å•ä»·: Â¥${A.toFixed(0)}</div>
            <div>åˆ©æ¶¦: <span style="color:${S>=0?"#22c55e":"#f43f5e"}">Â¥${S.toFixed(1)}</span></div>
            <div style="margin-top:4px;font-size:10px;color:#94a3b8">é…é€å‡€æˆæœ¬ > Â¥6</div>
          `}},series:[{name:"æº¢ä»·è®¢å•",type:"scatter",coordinateSystem:"polar",encode:{radius:0,angle:1},data:O.map(D=>{const W=D.value[5],v=H(W);return{value:D.value,itemStyle:{color:v,opacity:.85,shadowBlur:12,shadowColor:`${v}80`}}}),symbolSize:D=>Math.max(8,Math.min(D[2]*1.5,30)),itemStyle:{borderColor:o?"rgba(255,255,255,0.9)":"#fff",borderWidth:1.5},emphasis:{itemStyle:{opacity:1,shadowBlur:20,borderColor:"#fff",borderWidth:2},scale:1.3}}]}):(console.log("ğŸ“¡ DeliveryHeatmap option - æ— æ•°æ®ï¼Œè¿”å›ç©º series"),{series:[]})},[O,o,d,m,$]);return r.useEffect(()=>{if(!z.current||!p){console.log("ğŸ“¡ DeliveryHeatmap åˆå§‹åŒ– - è·³è¿‡: container=",!!z.current,"store=",p);return}let k=Qt(z.current);k||(k=$e(z.current,o?"dark":void 0),console.log("ğŸ“¡ DeliveryHeatmap - åˆ›å»ºæ–°çš„ ECharts å®ä¾‹")),w.current=k;const D=()=>{k==null||k.resize()};return window.addEventListener("resize",D),setTimeout(()=>{k==null||k.resize()},50),()=>{window.removeEventListener("resize",D)}},[o,p]),r.useEffect(()=>{const k=w.current;if(!k){console.log("ğŸ“¡ DeliveryHeatmap æ›´æ–° - å®ä¾‹ä¸å­˜åœ¨");return}if(!O.length){console.log("ğŸ“¡ DeliveryHeatmap æ›´æ–° - æ— æ•°æ®ï¼Œæ¸…ç©º series"),k.setOption({polar:{radius:["12%","75%"],center:["50%","50%"]},angleAxis:{type:"value",min:0,max:24,interval:3,startAngle:90,clockwise:!0,axisLine:{lineStyle:{color:m}},axisLabel:{formatter:"{value}h",color:d,fontSize:10},splitLine:{show:!0,lineStyle:{color:m,width:1}}},radiusAxis:{min:0,max:8.5,interval:2,axisLine:{show:!1},axisLabel:{formatter:"{value}km",color:d,fontSize:9},splitLine:{lineStyle:{color:m,type:"dashed"}}},series:[]},{notMerge:!0});return}k.setOption(K,{notMerge:!0}),console.log("ğŸ“¡ DeliveryHeatmap - setOption å®Œæˆ, æ•°æ®ç‚¹:",O.length),setTimeout(()=>{k==null||k.resize()},100)},[K,O,d,m]),r.useEffect(()=>()=>{w.current&&(w.current.dispose(),w.current=null)},[]),e.jsxs("div",{className:"glass-panel rounded-2xl p-4 h-full flex flex-col relative overflow-hidden group",children:[e.jsxs("div",{className:"shrink-0 relative z-20 flex justify-between items-center mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{size:16,className:"text-cyan-400 animate-pulse"}),e.jsx("h3",{className:"text-base font-bold",style:{color:x},children:M?M.includes("~")?`${M.split("~").map(k=>k.trim().slice(5)).join(" ~ ")} é…é€æº¢ä»·é›·è¾¾`:`${M.slice(5)} é…é€æº¢ä»·é›·è¾¾`:"é…é€æº¢ä»·é›·è¾¾"}),a&&e.jsxs("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded-full bg-cyan-500/20 text-cyan-400",children:[a.minDistance,"-",a.maxDistance,"km"]}),(s||n)&&e.jsx("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded-full bg-cyan-500/20 text-cyan-400 ml-1",children:"å·²è”åŠ¨"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[E.slice(0,4).map(k=>e.jsxs("button",{onClick:()=>T(P===k.name?null:k.name),className:`flex items-center gap-1 px-1.5 py-0.5 rounded transition-all cursor-pointer ${P===k.name?"bg-white/20 ring-1 ring-white/30":P?"opacity-40":"hover:bg-white/10"}`,children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:k.color}}),e.jsx("span",{className:"text-[10px]",style:{color:o?"#94a3b8":"#64748b"},children:k.name}),e.jsx("span",{className:"text-[10px] font-mono font-bold",style:{color:k.color},children:k.count})]},k.name)),P&&e.jsx("button",{onClick:()=>T(null),className:"text-[10px] text-cyan-400 hover:text-cyan-300 ml-1",children:"âœ•"})]})]}),e.jsx("div",{className:"flex-1 w-full relative z-10 flex items-center justify-center",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:z,className:"w-full h-full relative z-10",style:{visibility:j||!O.length?"hidden":"visible"}}),j&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",children:e.jsx("div",{className:"animate-pulse text-sm",style:{color:f},children:"åŠ è½½ä¸­..."})}),!j&&!O.length&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",children:e.jsx("div",{className:"text-sm text-center",style:{color:f},children:P?`${P} æ¸ é“æ— æº¢ä»·è®¢å•`:a?`${a.minDistance}-${a.maxDistance}km èŒƒå›´å†…æ— æº¢ä»·è®¢å•`:"æš‚æ— æº¢ä»·è®¢å•æ•°æ®"})}),O.length>0&&!j&&e.jsxs("div",{className:"absolute flex items-center justify-center pointer-events-none z-20 aspect-square h-[85%]",children:[e.jsx("div",{className:"w-full h-full rounded-full animate-spin opacity-50",style:{animationDuration:"6s",animationTimingFunction:"linear",background:"conic-gradient(from 0deg, transparent 0deg, transparent 300deg, rgba(34, 211, 238, 0.3) 360deg)"}}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-cyan-400 rounded-full shadow-[0_0_15px_#22d3ee] animate-ping"})]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm mb-2",style:{color:f},children:"è¯·å…ˆé€‰æ‹©é—¨åº—"}),e.jsx("div",{className:"text-xs opacity-60",style:{color:f},children:"é€‰æ‹©é—¨åº—åå°†æ˜¾ç¤ºé…é€æº¢ä»·åˆ†æ"})]})})]})},Es=[["delivery_discount","é…é€è´¹å‡å…"],["full_reduction","æ»¡å‡é‡‘é¢"],["product_discount","å•†å“å‡å…"],["merchant_voucher","å•†å®¶ä»£é‡‘åˆ¸"],["merchant_share","å•†å®¶æ‰¿æ‹…åˆ¸"],["gift_amount","æ»¡èµ é‡‘é¢"],["other_discount","å•†å®¶å…¶ä»–ä¼˜æƒ "],["new_customer_discount","æ–°å®¢å‡å…"]],Ts={é…é€è´¹å‡å…:"#f43f5e",æ»¡å‡é‡‘é¢:"#f59e0b",å•†å“å‡å…:"#eab308",å•†å®¶ä»£é‡‘åˆ¸:"#22c55e",å•†å®¶æ‰¿æ‹…åˆ¸:"#14b8a6",æ»¡èµ é‡‘é¢:"#3b82f6",å•†å®¶å…¶ä»–ä¼˜æƒ :"#8b5cf6",æ–°å®¢å‡å…:"#ec4899"};function Os(t){return Es.filter(([a])=>{const l=t[a];return l&&l.some(s=>s>0)})}function As(t,a){return t.map((l,s)=>{const n=a[s];return n===0?0:l/n*100})}function Rs(t,a,l){const{dates:s,series:n,totals:o}=t,d=Os(n),x=d.map(([c,i])=>{const p=n[c],u=a==="percentage"?As(p,o):p;return{name:i,type:"line",stack:"total",areaStyle:{opacity:.6},emphasis:{focus:"series"},data:u,itemStyle:{color:Ts[i]},lineStyle:{width:1},symbol:"none",smooth:.3}}),f=l?"#64748b":"#94a3b8",m=l?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)";return{grid:{top:40,right:20,bottom:60,left:50,containLabel:!1},tooltip:{trigger:"axis",backgroundColor:l?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:l?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:12,textStyle:{fontFamily:"JetBrains Mono",color:l?"#fff":"#0f172a",fontSize:11},axisPointer:{type:"cross",label:{backgroundColor:"#6366f1"}},formatter:c=>{if(!Array.isArray(c)||c.length===0)return"";const i=c[0].axisValue;let p=`<div style="font-weight:bold;margin-bottom:8px">${i}</div>`;const u=s.indexOf(i),h=u>=0?o[u]:0;return c.forEach(j=>{const b=j.value||0,M=h>0?b/(a==="percentage"?100:h)*100:0;a==="percentage"?p+=`<div style="display:flex;justify-content:space-between;gap:16px">
              <span>${j.marker}${j.seriesName}</span>
              <span style="font-weight:bold">${b.toFixed(1)}%</span>
            </div>`:p+=`<div style="display:flex;justify-content:space-between;gap:16px">
              <span>${j.marker}${j.seriesName}</span>
              <span style="font-weight:bold">Â¥${b.toLocaleString()} (${M.toFixed(1)}%)</span>
            </div>`}),a==="absolute"&&(p+=`<div style="margin-top:8px;padding-top:8px;border-top:1px solid ${l?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}">
            <span style="font-weight:bold">æ€»è®¡: Â¥${h.toLocaleString()}</span>
          </div>`),p}},legend:{data:d.map(([,c])=>c),bottom:0,textStyle:{color:f,fontSize:10},itemGap:12,icon:"roundRect",itemWidth:12,itemHeight:8},xAxis:{type:"category",data:s.map(c=>c.slice(5)),boundaryGap:!1,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:f,fontSize:10,fontFamily:"JetBrains Mono"}},yAxis:{type:"value",max:a==="percentage"?100:void 0,splitLine:{lineStyle:{color:m,type:"dashed"}},axisLabel:{color:f,fontSize:10,formatter:a==="percentage"?"{value}%":c=>`Â¥${c>=1e3?(c/1e3).toFixed(0)+"k":c}`}},series:x}}const Is=({data:t,theme:a,loading:l,error:s,selectedChannel:n,onChannelChange:o})=>{const[d,x]=r.useState("percentage"),{channelList:f}=ce();console.log("ğŸ“ˆ MarketingTrendChart channelList:",f);const m=a==="dark",c=m?"#fff":"#0f172a",i=m?"#94a3b8":"#64748b",p=r.useMemo(()=>{var j,b,M,L,P,T,w,z;if(console.log("ğŸ“ˆ MarketingTrendChart option è®¡ç®—, data:",t),!t||!t.dates||t.dates.length===0)return console.log("ğŸ“ˆ MarketingTrendChart - æ— æ•°æ®ï¼Œè¿”å›ç©º series"),{series:[]};const h=Rs(t,d,m);return console.log("ğŸ“ˆ MarketingTrendChart option ç»“æœ:",{seriesCount:(j=h.series)==null?void 0:j.length,xAxisData:(M=(b=h.xAxis)==null?void 0:b.data)==null?void 0:M.length,firstSeriesName:(P=(L=h.series)==null?void 0:L[0])==null?void 0:P.name,firstSeriesDataSample:(z=(w=(T=h.series)==null?void 0:T[0])==null?void 0:w.data)==null?void 0:z.slice(0,3)}),h},[t,d,m]),u=me(p,[],a);return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-24 bg-gradient-to-b from-pink-500/5 to-transparent pointer-events-none"}),e.jsxs("div",{className:"mb-2 flex justify-between items-start relative z-10",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:c},children:[e.jsx("span",{className:"w-1 h-5 bg-gradient-to-b from-pink-400 to-pink-600 rounded-full shadow-[0_0_10px_#ec4899]"}),"è¥é”€æˆæœ¬è¶‹åŠ¿"]}),e.jsx("p",{className:"text-xs mt-1 font-mono uppercase tracking-widest opacity-70",style:{color:i},children:"MARKETING COST TREND: TYPE RATIO OVER TIME"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ct,{selectedChannel:n,channelList:f,onSelect:o,isDark:m,accentColor:"pink"}),e.jsxs("div",{className:"flex items-center gap-1 bg-slate-800/50 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>x("percentage"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all duration-200 ${d==="percentage"?"bg-pink-500/20 text-pink-300 shadow-[0_0_10px_rgba(236,72,153,0.3)]":m?"text-slate-400 hover:text-white":"text-slate-600 hover:text-slate-900"}`,children:"ç™¾åˆ†æ¯”"}),e.jsx("button",{onClick:()=>x("absolute"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all duration-200 ${d==="absolute"?"bg-pink-500/20 text-pink-300 shadow-[0_0_10px_rgba(236,72,153,0.3)]":m?"text-slate-400 hover:text-white":"text-slate-600 hover:text-slate-900"}`,children:"ç»å¯¹å€¼"})]})]})]}),e.jsxs("div",{className:"flex-1 w-full min-h-[280px] relative",children:[e.jsx("div",{ref:u,className:"w-full h-full",style:{minHeight:"280px"}}),l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm rounded-lg",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"})}),s&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm rounded-lg",children:e.jsx("p",{className:"text-rose-400 text-sm",children:s})}),!l&&!s&&(!t||!t.dates||t.dates.length===0)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("p",{className:"text-slate-500 text-sm",children:"æš‚æ— æ•°æ®ï¼Œè¯·é€‰æ‹©é—¨åº—"})})]})]})};function xt(t,a){const[l,s]=r.useState(t);return r.useEffect(()=>{const n=setTimeout(()=>s(t),a);return()=>clearTimeout(n)},[t,a]),l}const ut=({label:t,value:a,onChange:l,min:s,max:n,leftLabel:o,rightLabel:d})=>{const x=(a-s)/(n-s)*100;return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex justify-between text-xs font-medium mb-3 items-end",children:[e.jsx("span",{className:"text-slate-300 font-mono tracking-wide",children:t}),e.jsxs("span",{className:`text-base font-bold font-mono transition-colors duration-300 ${a>0?"text-rose-400":a<0?"text-emerald-400":"text-slate-500"}`,children:[a>0?"+":"",a,"%"]})]}),e.jsxs("div",{className:"relative h-4 w-full flex items-center",children:[e.jsx("div",{className:"absolute w-full h-1.5 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-slate-600"})}),e.jsx("input",{type:"range",min:s,max:n,step:"5",value:a,onChange:f=>l(parseInt(f.target.value)),className:"absolute w-full h-full opacity-0 cursor-pointer z-20"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1.5 pointer-events-none transition-all duration-500 ease-out z-10 rounded-full opacity-80",style:{left:a>=0?"50%":`${x}%`,width:Math.abs(a)===0?"0%":`${Math.abs(x-50)}%`,backgroundColor:a>0?"#f43f5e":"#34d399"}}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-white rounded-full border-2 border-slate-900 shadow-lg transition-all duration-500 ease-[cubic-bezier(0.25,1,0.5,1)] z-10 pointer-events-none group-hover:scale-125",style:{left:`calc(${x}% - 8px)`}})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mt-2 font-mono uppercase",children:[e.jsx("span",{children:o}),e.jsx("span",{children:d})]})]})},Ps=({data:t})=>{const[a,l]=r.useState(0),[s,n]=r.useState(0),[o,d]=r.useState(!1),x=xt(a,200),f=xt(s,200),[m,c]=r.useState(t.totalProfit),[i,p]=r.useState(0),u=t.channels.reduce((L,P)=>L+P.costs.marketing,0),h=t.channels.reduce((L,P)=>L+P.costs.delivery,0),j=t.totalProfit;r.useEffect(()=>{const L=1+x/100,P=1+f/100,T=u*L,w=h*P,z=x*.5,O=t.totalRevenue*(1+z/100),$=(t.totalRevenue-j-u-h)*(1+z/100),I=O-$-T-w;c(I),p(I-j)},[x,f,t,u,h,j]);const b=()=>{l(0),n(0)},M=async()=>{d(!0),await new Promise(L=>setTimeout(L,1200)),l(-10),n(-5),d(!1)};return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 relative overflow-hidden flex flex-col justify-between h-full group",children:[e.jsx("div",{className:"absolute inset-0 bg-[size:20px_20px] pointer-events-none opacity-5",style:{backgroundImage:"linear-gradient(currentColor 1px, transparent 1px)"}}),e.jsxs("div",{className:"mb-6 relative z-10 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-neon-green rounded-full animate-pulse"}),"ç»è¥æ²™ç›˜æ¨æ¼”"]}),e.jsx("p",{className:"text-xs text-slate-400 mt-1 font-mono uppercase tracking-wider opacity-70",children:"AI SOLVER ENABLED"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:M,disabled:o,className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-bold transition-all ${o?"bg-indigo-500/20 text-indigo-300 border-indigo-500/50":"bg-indigo-600 hover:bg-indigo-500 text-white border-transparent shadow-[0_0_15px_rgba(99,102,241,0.4)]"}`,children:[e.jsx(Je,{size:14,className:o?"animate-spin":""}),o?"COMPUTING...":"AI æ±‚è§£"]}),e.jsx("button",{onClick:b,className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white transition-all border border-white/5",children:e.jsx(ts,{size:14})})]})]}),e.jsxs("div",{className:"space-y-8 relative z-10 flex-1 flex flex-col justify-center",children:[e.jsx(ut,{label:"è¥é”€é¢„ç®—æŠ•å…¥",value:a,onChange:l,min:-30,max:30,leftLabel:"èŠ‚æµä¿åˆ©",rightLabel:"æ¿€è¿›æ‰©å¼ "}),e.jsx(ut,{label:"å±¥çº¦æˆæœ¬æµ®åŠ¨",value:s,onChange:n,min:-20,max:20,leftLabel:"è¿åŠ›ææ•ˆ",rightLabel:"è¿åŠ›ç´§å¼ "})]}),e.jsx("div",{className:"mt-auto pt-6 border-t border-white/10 relative z-10",children:e.jsxs("div",{className:`p-5 rounded-xl border backdrop-blur-xl transition-all duration-500 relative overflow-hidden ${i>=0?"bg-emerald-500/10 border-emerald-500/30":"bg-rose-500/10 border-rose-500/30"}`,children:[e.jsxs("div",{className:"flex justify-between items-end mb-2 relative z-10",children:[e.jsx("span",{className:"text-xs text-slate-300 font-bold uppercase font-mono tracking-wider",children:"é¢„è®¡å‡€åˆ©æ¶¦"}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded-md text-xs font-bold border ${i>=0?"bg-emerald-500/20 text-emerald-300 border-emerald-500/20":"bg-rose-500/20 text-rose-300 border-rose-500/20"}`,children:[i>=0?e.jsx(Re,{size:12}):e.jsx(Ye,{size:12}),e.jsxs("span",{className:"font-mono",children:[i>=0?"+":"","Â¥",Math.abs(i).toLocaleString(void 0,{maximumFractionDigits:0})]})]})]}),e.jsxs("div",{className:"text-3xl font-bold text-white font-mono flex items-baseline gap-1 relative z-10 tabular-nums",children:[e.jsx("span",{className:"text-lg opacity-40 font-sans",children:"Â¥"}),m.toLocaleString(void 0,{maximumFractionDigits:0})]})]})})]})},Fs=({data:t,onLocate:a,activeFocus:l})=>{const[s,n]=r.useState(null),[o,d]=r.useState(!1);return r.useEffect(()=>{d(!0);const x=setTimeout(()=>{n({summary:"æ£€æµ‹åˆ°å¤–å–æ¸ é“è¥é”€æˆæœ¬è¿‡é«˜ï¼Œæ‹–ç´¯æ•´ä½“åˆ©æ¶¦ã€‚å»ºè®®ä¼˜åŒ–æ»¡å‡ç­–ç•¥ã€‚",costProblem:"é¥¿äº†ä¹ˆæ¸ é“è¥é”€è¡¥è´´å æ¯”è¾¾ 20%ï¼Œå»ºè®®ç¼©å‡æ»¡å‡åŠ›åº¦ã€‚",timeOpportunity:"åˆé«˜å³° (11:00-13:00) è®¢å•å¯†é›†ä½†è¶…æ—¶ä¸¥é‡ï¼Œå»ºè®®å¢åŠ è¿åŠ›è°ƒåº¦ã€‚",actionSuggestion:"ç«‹å³å¤ç›˜è·ç¦»åœ¨ 3km+ çš„è®¢å•æ¯›åˆ©ï¼Œè€ƒè™‘ç¼©å°é…é€èŒƒå›´ã€‚"}),d(!1)},1e3);return()=>clearTimeout(x)},[t.lastUpdated]),o?e.jsxs("div",{className:"w-full h-full glass-panel border-neon-purple/30 rounded-2xl flex flex-col items-center justify-center animate-pulse gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-neon-purple/30 border-t-neon-purple animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(ss,{size:20,className:"text-neon-purple animate-pulse"})})]}),e.jsx("p",{className:"text-neon-purple font-mono text-xs tracking-widest",children:"AI NEURAL ENGINE PROCESSING..."})]}):s?e.jsxs("div",{className:"w-full h-full glass-panel rounded-2xl p-[1px] relative overflow-hidden group flex flex-col shadow-[0_0_30px_rgba(124,58,237,0.1)]",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-neon-purple via-neon-cyan to-transparent opacity-30 group-hover:opacity-60 transition-opacity duration-1000 blur-lg"}),e.jsxs("div",{className:"bg-slate-950/90 backdrop-blur-xl rounded-xl p-6 relative z-10 flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 border-b border-white/10 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-1.5 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg shadow-lg shadow-purple-500/20",children:e.jsx(Je,{size:18,className:"text-white fill-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-white tracking-wide leading-tight",children:"AI å†³ç­–å¤§è„‘"}),e.jsx("p",{className:"text-[11px] text-slate-400 font-mono",children:"CLICK TO LOCATE ISSUES"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-neon-green font-mono",children:"ACTIVE"}),e.jsx("div",{className:"h-2 w-2 bg-neon-green rounded-full shadow-[0_0_10px_#4ade80] animate-pulse"})]})]}),e.jsxs("div",{className:"mb-6 relative",children:[e.jsx("div",{className:"absolute -left-2 top-0 bottom-0 w-1 bg-gradient-to-b from-neon-purple to-transparent rounded-full opacity-50"}),e.jsxs("p",{className:"pl-4 text-lg font-medium text-white leading-relaxed italic",children:['"',s.summary,'"']})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-3 overflow-y-auto pr-1 custom-scrollbar",children:[e.jsx(We,{icon:e.jsx(Me,{size:14,className:l==="cost"?"text-white":"text-neon-rose"}),tag:"æˆæœ¬æ£€æµ‹",value:s.costProblem,color:"rose",onClick:()=>a&&a("cost"),isActive:l==="cost"}),e.jsx(We,{icon:e.jsx(Nt,{size:14,className:l==="efficiency"?"text-white":"text-neon-yellow"}),tag:"æ•ˆç‡è¯Šæ–­",value:s.timeOpportunity,color:"yellow",onClick:()=>a&&a("efficiency"),isActive:l==="efficiency"}),e.jsx(We,{icon:e.jsx(qe,{size:14,className:l==="profit"?"text-white":"text-neon-green"}),tag:"å¢é•¿å»ºè®®",value:s.actionSuggestion,color:"green",onClick:()=>a&&a("profit"),isActive:l==="profit"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/5 flex justify-between items-center text-xs text-slate-400 group/btn cursor-pointer hover:text-white transition-colors",children:[e.jsx("span",{className:"font-mono",children:"GENERATE_REPORT.PDF"}),e.jsx(_e,{size:14,className:"group-hover/btn:translate-x-1 transition-transform"})]})]})]}):null},We=({icon:t,tag:a,value:l,color:s,onClick:n,isActive:o})=>{const d={rose:"hover:bg-rose-500/10 hover:border-rose-500/40",yellow:"hover:bg-yellow-500/10 hover:border-yellow-500/40",green:"hover:bg-emerald-500/10 hover:border-emerald-500/40"},x={rose:"text-rose-400 bg-rose-500/10 border-rose-500/20",yellow:"text-yellow-400 bg-yellow-500/10 border-yellow-500/20",green:"text-emerald-400 bg-emerald-500/10 border-emerald-500/20"},f={rose:"bg-rose-500 border-rose-400 shadow-[0_0_20px_rgba(244,63,94,0.3)]",yellow:"bg-yellow-500 border-yellow-400 shadow-[0_0_20px_rgba(250,204,21,0.3)]",green:"bg-emerald-500 border-emerald-400 shadow-[0_0_20px_rgba(16,185,129,0.3)]"};return e.jsxs("button",{onClick:n,className:`relative p-3.5 rounded-xl border text-left transition-all duration-300 group/item flex flex-col gap-2 outline-none
        ${o?`${f[s]} scale-[1.02] z-10 border-transparent`:`border-white/5 bg-white/[0.02] ${d[s]} hover:scale-[1.01]`}
      `,children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:`flex items-center gap-2 px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider border ${o?"bg-white/20 text-white border-transparent":x[s]}`,children:[t,a]}),o?e.jsx(He,{size:14,className:"text-white animate-pulse"}):e.jsx(as,{size:14,className:"text-slate-600 group-hover/item:text-white transition-colors opacity-0 group-hover/item:opacity-100"})]}),e.jsx("p",{className:`text-xs leading-relaxed transition-colors ${o?"text-white/95 font-medium":"text-slate-400 group-hover/item:text-slate-200"}`,children:l})]})},Bs=({data:t})=>{const[a,l]=r.useState(1),s=5,n=()=>{console.log("Exporting data...")},o=r.useMemo(()=>{const m=(a-1)*s;return t.slice(m,m+s)},[t,a]),d=Math.ceil(t.length/s),x=m=>{m>=1&&m<=d&&l(m)},f=({channel:m})=>{const c=m.marketingRate>.2;return e.jsxs("div",{className:"glass-panel p-4 mb-3 rounded-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 bg-indigo-500 rounded-full"}),e.jsx("h4",{className:"font-bold text-white",children:m.name})]}),e.jsxs("span",{className:"text-neon-green font-mono font-bold",children:["Â¥",m.profit.toLocaleString()]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-slate-400 items-center",children:[e.jsx("span",{children:"è¥æ”¶è´¡çŒ®"}),e.jsxs("span",{className:"text-slate-200 font-mono",children:["Â¥",m.revenue.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-slate-400 items-center",children:[e.jsx("span",{children:"è¥é”€å æ¯”"}),e.jsxs("div",{className:"flex items-center gap-2",children:[c&&e.jsx(wt,{size:12,className:"text-neon-rose"}),e.jsxs("span",{className:`${c?"text-neon-rose":"text-slate-200"} font-mono`,children:[(m.marketingRate*100).toFixed(1),"%"]})]})]}),e.jsx("div",{className:"w-full h-1 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${c?"bg-neon-rose":"bg-indigo-500"}`,style:{width:`${Math.min(m.marketingRate*100*2,100)}%`}})})]})]})};return e.jsxs("div",{className:"glass-panel rounded-2xl overflow-hidden flex flex-col h-full",children:[e.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-white/[0.02]",children:[e.jsx("div",{children:e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:["æ¸ é“æ•ˆç›ŠçŸ©é˜µ",e.jsx("span",{className:"text-[10px] bg-slate-800 text-slate-400 px-2 py-0.5 rounded border border-white/5",children:"LIVE"})]})}),e.jsxs("button",{onClick:n,className:"flex items-center gap-2 px-3 py-1.5 bg-white/5 hover:bg-white/10 text-slate-300 hover:text-white border border-white/5 rounded-lg text-xs font-medium transition-all",children:[e.jsx(rs,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:"å¯¼å‡ºæ•°æ®"})]})]}),e.jsx("div",{className:"md:hidden p-4",children:o.map(m=>e.jsx(f,{channel:m},m.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto flex-1",children:e.jsxs("table",{className:"min-w-full divide-y divide-white/5",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-950/30",children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-400 uppercase tracking-wider font-mono",children:"æ¸ é“åç§°"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono",children:"GMV è¥æ”¶"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-400 uppercase tracking-wider font-mono pl-10",children:"è¥é”€æ•ˆç‡ (Marketing %)"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono",children:"å±¥çº¦æˆæœ¬"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono",children:"å‡€åˆ©æ¶¦"}),e.jsx("th",{className:"px-4 py-4"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5 bg-slate-900/10",children:o.map(m=>{const c=m.marketingRate>.2,i=m.marketingRate*100,p=Math.min(i*3,100);return e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors group",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold bg-slate-800 border border-white/5 text-slate-300",children:m.name.charAt(0)}),e.jsx("span",{className:"text-sm font-medium text-slate-200",children:m.name})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("span",{className:"text-sm font-mono text-slate-300",children:["Â¥",m.revenue.toLocaleString()]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap pl-10",children:e.jsxs("div",{className:"flex flex-col gap-1.5 w-32",children:[e.jsx("div",{className:"flex justify-between items-center text-xs",children:e.jsxs("span",{className:`font-mono ${c?"text-neon-rose font-bold":"text-slate-400"}`,children:[i.toFixed(1),"%"]})}),e.jsx("div",{className:"w-full h-1.5 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{style:{width:`${p}%`},className:`h-full rounded-full transition-all duration-500 ${c?"bg-neon-rose shadow-[0_0_8px_rgba(244,63,94,0.5)]":"bg-indigo-500"}`})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("span",{className:"text-sm font-mono text-slate-300",children:["Â¥",m.costs.delivery.toLocaleString()]}),e.jsxs("span",{className:"text-[10px] text-slate-500 font-mono",children:["å•å‡ Â¥",m.avgDeliveryCost.toFixed(1)]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("span",{className:"text-sm font-bold font-mono text-neon-green",children:["Â¥",m.profit.toLocaleString()]})}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("button",{className:"text-slate-600 hover:text-white transition-colors",children:e.jsx(ns,{size:16})})})]},m.id)})})]})}),d>1&&e.jsxs("div",{className:"p-3 border-t border-white/5 bg-slate-900/20 flex items-center justify-end gap-3",children:[e.jsxs("span",{className:"text-xs text-slate-400 font-mono",children:["Page ",a," of ",d]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>x(a-1),disabled:a===1,className:"p-1 rounded hover:bg-white/5 disabled:opacity-30 text-slate-300 disabled:cursor-not-allowed",children:e.jsx(Oe,{size:16})}),e.jsx("button",{onClick:()=>x(a+1),disabled:a===d,className:"p-1 rounded hover:bg-white/5 disabled:opacity-30 text-slate-300 disabled:cursor-not-allowed",children:e.jsx(_e,{size:16})})]})]})]})},Ws=({onCommand:t,isProcessing:a})=>{const[l,s]=r.useState(""),[n,o]=r.useState(!1),d=x=>{x.preventDefault(),l.trim()&&(t(l),s(""))};return e.jsxs("div",{className:`relative w-full max-w-2xl mx-auto transition-all duration-300 z-50 ${n?"scale-105":"scale-100"}`,children:[e.jsx("div",{className:`absolute -inset-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-2xl blur opacity-25 transition-opacity duration-500 ${n?"opacity-75":"opacity-25"}`}),e.jsxs("form",{onSubmit:d,className:"relative glass-panel rounded-xl p-1 flex items-center gap-2 shadow-2xl",children:[e.jsx("div",{className:"pl-3 text-neon-purple",children:e.jsx(Je,{size:20,className:a?"animate-spin":""})}),e.jsx("input",{type:"text",value:l,onChange:x=>s(x.target.value),onFocus:()=>o(!0),onBlur:()=>o(!1),placeholder:a?"AI æ­£åœ¨åˆ†ææ•°æ®...":"Ask AI: 'Show me coffee sales from last weekend'...",className:"flex-1 bg-transparent border-none outline-none text-white placeholder-slate-400 h-10 px-2 font-mono text-sm",disabled:a}),e.jsxs("div",{className:"hidden md:flex items-center gap-1.5 px-2 py-1 bg-white/5 rounded text-[10px] text-slate-500 font-mono border border-white/5",children:[e.jsx(os,{size:10}),e.jsx("span",{children:"K"})]}),e.jsx("button",{type:"submit",disabled:!l.trim()||a,className:"p-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(ls,{size:16})})]})]})},Vs=({selectedDate:t,selectedDateRange:a,theme:l})=>{const[s,n]=r.useState(null),[o,d]=r.useState(!1),[x,f]=r.useState([]),{selectedStore:m,dateRange:c}=ce(),i=l==="dark",p=i?"#fff":"#0f172a",u=i?"#94a3b8":"#64748b";r.useEffect(()=>{(async()=>{if(!m){n(null);return}d(!0);try{const O={store_name:m};a?(O.start_date=a.start,O.end_date=a.end):t?O.date=t:c.type!=="all"&&c.start&&c.end&&(O.start_date=c.start,O.end_date=c.end);const E=await ie.getCategoryHourlyTrend(O);E.success&&E.data&&(n(E.data),f([]))}catch(O){console.error("è·å–å“ç±»è¶‹åŠ¿æ•°æ®å¤±è´¥:",O)}finally{d(!1)}})()},[m,t,a,c.type,c.start,c.end]);const h=r.useMemo(()=>!s||s.categories.length===0?[]:x.length>0?s.categories.filter(z=>x.includes(z)):s.categories.slice(0,5),[s,x]),j=r.useMemo(()=>s?s.series.filter(z=>h.includes(z.name)):[],[s,h]),b=r.useMemo(()=>{if(!s||s.labels.length===0||j.length===0)return{graphic:{type:"text",left:"center",top:"middle",style:{text:"æš‚æ— æ•°æ®",fill:u,fontSize:14}}};const z=["#8b5cf6","#3b82f6","#06b6d4","#10b981","#f59e0b","#ef4444","#ec4899","#6366f1"],O=j.map((E,$)=>({name:E.name,type:"line",stack:"Total",smooth:!0,areaStyle:{opacity:.8},emphasis:{focus:"series"},showSymbol:!1,data:E.data,itemStyle:{color:z[$%z.length]}}));return{color:z,graphic:[],grid:{left:10,right:10,top:40,bottom:10,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},backgroundColor:i?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",textStyle:{color:i?"#fff":"#0f172a"},borderWidth:0,formatter:E=>{if(!Array.isArray(E)||E.length===0)return"";const $=E[0].axisValue,I=E[0].dataIndex,H=s.series.map(C=>({name:C.name,value:C.data[I]||0})).filter(C=>C.value>0).sort((C,F)=>F.value-C.value),K=H.reduce((C,F)=>C+F.value,0),D=x.length>0?H.filter(C=>x.includes(C.name)):H.slice(0,5),W=D.reduce((C,F)=>C+F.value,0);let v=`<div style="font-size:12px;font-weight:bold;margin-bottom:8px;color:${u}">${$} åˆè®¡: Â¥${W.toLocaleString()}</div>`;return D.forEach((C,F)=>{const A=K>0?(C.value/K*100).toFixed(1):"0.0",S=z[F%z.length];v+=`
              <div style="display:flex;justify-content:space-between;align-items:center;gap:24px;font-size:12px;margin-bottom:4px">
                <div style="display:flex;align-items:center;gap:6px">
                  <span style="width:8px;height:8px;border-radius:50%;background:${S}"></span>
                  <span style="color:${i?"#e2e8f0":"#475569"}">${C.name}</span>
                </div>
                <div style="display:flex;align-items:center;gap:12px">
                  <span style="font-weight:bold;color:${i?"#fff":"#0f172a"}">Â¥${C.value.toLocaleString()}</span>
                  <span style="font-size:10px;width:40px;text-align:right;color:${u}">${A}%</span>
                </div>
              </div>
            `}),v}},legend:{data:h,top:0,textStyle:{color:u,fontSize:11},icon:"roundRect"},xAxis:{type:"category",boundaryGap:!1,data:s.labels,axisLabel:{color:u,fontSize:10},axisLine:{show:!1}},yAxis:{type:"value",splitLine:{lineStyle:{type:"dashed",color:i?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}},axisLabel:{color:u,fontSize:10,formatter:E=>`Â¥${E/1e3}k`}},series:O}},[s,j,h,i,u]),M=me(b,[s,l,x,h.length],l),L=z=>{f(O=>O.includes(z)?O.filter(E=>E!==z):[...O,z])},P=()=>{f([])},T=r.useMemo(()=>a?a.start===a.end?`${a.start.slice(5)} å“ç±»é”€å”®èµ°åŠ¿`:`${a.start.slice(5)} ~ ${a.end.slice(5)} å“ç±»é”€å”®èµ°åŠ¿`:t?`${t.slice(5)} åˆ†æ—¶æ®µå“ç±»èµ°åŠ¿`:c.type!=="all"&&c.start&&c.end?c.start===c.end?`${c.start.slice(5)} å“ç±»é”€å”®èµ°åŠ¿`:`${c.start.slice(5)} ~ ${c.end.slice(5)} å“ç±»é”€å”®èµ°åŠ¿`:"è¿‘7å¤©å“ç±»é”€å”®å æ¯”",[a,t,c]),w=r.useMemo(()=>a||c.type!=="all"&&c.start&&c.end?"DATE RANGE TREND":t?"HOURLY TREND & SHARE":"CATEGORY REVENUE COMPOSITION",[a,t,c]);return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col relative overflow-hidden transition-all duration-500",children:[o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 z-20 rounded-2xl",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-violet-500"})}),e.jsxs("div",{className:"mb-2 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:p},children:[e.jsx(ke,{size:18,className:"text-violet-400"}),T]}),e.jsxs("p",{className:"text-xs mt-1 font-mono uppercase tracking-wider opacity-70",style:{color:u},children:[w," Â·",x.length>0?` å·²é€‰ ${x.length} ä¸ªåˆ†ç±»`:` TOP ${h.length}`]})]}),e.jsx(Us,{categories:(s==null?void 0:s.categories)||[],selectedCategories:x,onToggle:L,onReset:P,isDark:i})]}),e.jsx("div",{className:"flex-1 w-full min-h-[250px]",children:e.jsx("div",{ref:M,className:"w-full h-full"})})]})},Us=({categories:t,selectedCategories:a,onToggle:l,onReset:s,isDark:n})=>{const[o,d]=r.useState(!1),[x,f]=r.useState(""),m=r.useRef(null),c=r.useRef(null),i=r.useRef(null);r.useEffect(()=>{const h=j=>{const b=j.target;o&&m.current&&!m.current.contains(b)&&c.current&&!c.current.contains(b)&&(d(!1),f(""))};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[o]),r.useEffect(()=>{o&&i.current&&setTimeout(()=>{var h;return(h=i.current)==null?void 0:h.focus()},100)},[o]);const p=r.useMemo(()=>{if(!x)return t;const h=x.toLowerCase();return t.filter(j=>j.toLowerCase().includes(h))},[t,x]),u=a.length>0?`å·²é€‰ ${a.length} é¡¹`:"TOP 5";return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:m,onClick:()=>d(!o),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-medium transition-all duration-200 ${n?"bg-white/5 hover:bg-white/10 border-white/10 text-slate-300":"bg-black/5 hover:bg-black/10 border-black/10 text-slate-600"} ${a.length>0?"border-violet-500/50 bg-violet-500/10":""}`,children:[e.jsx(ke,{size:12,className:"text-violet-400"}),e.jsx("span",{children:u}),e.jsx(Ce,{size:12,className:`text-slate-400 transition-transform ${o?"rotate-180":""}`})]}),o&&e.jsxs("div",{ref:c,className:`absolute top-full right-0 mt-2 w-56 rounded-xl border shadow-2xl z-50 overflow-hidden animate-fade-in-up ${n?"bg-slate-900 border-white/10":"bg-white border-black/10"}`,children:[e.jsx("div",{className:`p-2 border-b ${n?"border-white/10":"border-black/10"}`,children:e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${n?"bg-white/5":"bg-black/5"}`,children:[e.jsx(gt,{size:14,className:"text-slate-400"}),e.jsx("input",{ref:i,type:"text",value:x,onChange:h=>f(h.target.value),placeholder:"æœç´¢åˆ†ç±»...",className:`flex-1 bg-transparent text-xs outline-none ${n?"text-white placeholder-slate-500":"text-slate-900 placeholder-slate-400"}`}),x&&e.jsx("button",{onClick:()=>f(""),className:"text-slate-400 hover:text-slate-300",children:e.jsx(jt,{size:12})})]})}),e.jsxs("div",{className:`px-2 py-1.5 border-b flex justify-between items-center ${n?"border-white/10":"border-black/10"}`,children:[e.jsxs("span",{className:`text-[10px] ${n?"text-slate-500":"text-slate-400"}`,children:[p.length," ä¸ªåˆ†ç±»"]}),a.length>0&&e.jsx("button",{onClick:s,className:"text-[10px] text-violet-400 hover:text-violet-300",children:"é‡ç½®ä¸º TOP5"})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto custom-scrollbar",children:p.length===0?e.jsx("div",{className:`px-4 py-3 text-xs text-center ${n?"text-slate-500":"text-slate-400"}`,children:"æœªæ‰¾åˆ°åŒ¹é…çš„åˆ†ç±»"}):p.map(h=>{const j=a.includes(h),b=t.indexOf(h),M=!x&&a.length===0&&b<5&&b>=0;return e.jsxs("button",{onClick:()=>l(h),className:`w-full flex items-center justify-between px-4 py-2.5 text-xs transition-colors ${j||M?"bg-violet-500/20 text-violet-300":n?"text-slate-300 hover:bg-white/5":"text-slate-600 hover:bg-black/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${j||M?"bg-violet-400":n?"bg-slate-600":"bg-slate-300"}`}),e.jsx("span",{className:"truncate max-w-[140px]",children:h}),M&&e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-violet-500/30 text-violet-300",children:["TOP",b+1]})]}),j&&e.jsx(be,{size:12,className:"text-violet-400"})]},h)})})]})]})},Hs=({selectedDate:t,selectedDateRange:a,theme:l})=>{const[s,n]=r.useState("quantity"),[o,d]=r.useState(null),[x,f]=r.useState(!1),{selectedStore:m,dateRange:c}=ce(),i=l==="dark",p=i?"#fff":"#0f172a",u=i?"#94a3b8":"#64748b";r.useEffect(()=>{(async()=>{if(!m){d(null);return}f(!0);try{const w={store_name:m,sort_by:s,limit:15};a?(w.start_date=a.start,w.end_date=a.end):t?w.date=t:c.type!=="all"&&c.start&&c.end&&(w.start_date=c.start,w.end_date=c.end);const z=await ie.getTopProductsByDate(w);z.success&&z.data&&d(z.data)}catch(w){console.error("è·å–å•†å“æ’è¡Œæ•°æ®å¤±è´¥:",w)}finally{f(!1)}})()},[m,t,a,c.type,c.start,c.end,s]);const h=r.useMemo(()=>{switch(s){case"quantity":return{colorStart:"#34d399",colorEnd:"#059669",label:"é”€é‡",unit:"",valueKey:"quantity"};case"revenue":return{colorStart:"#818cf8",colorEnd:"#4f46e5",label:"è¥æ”¶",unit:"Â¥",valueKey:"revenue"};case"profit":return{colorStart:"#fbbf24",colorEnd:"#d97706",label:"æ¯›åˆ©",unit:"Â¥",valueKey:"profit"};case"loss":return{colorStart:"#f43f5e",colorEnd:"#be123c",label:"äºæŸ/ä½åˆ©",unit:"Â¥",valueKey:"profit"};default:return{colorStart:"#34d399",colorEnd:"#059669",label:"é”€é‡",unit:"",valueKey:"quantity"}}},[s]),j=r.useMemo(()=>{if(!o||o.products.length===0)return 100;const T=o.products.map(w=>Math.abs(w[h.valueKey]||0));return Math.max(...T)},[o,h.valueKey]),b=r.useMemo(()=>{if(!o||o.products.length===0)return{graphic:{type:"text",left:"center",top:"middle",style:{text:"æš‚æ— æ•°æ®",fill:u,fontSize:14}}};const T=o.products,w=T.map((E,$)=>{const I=$+1;let H=E.name;return H.length>20&&(H=H.slice(0,20)+"..."),`${I}. ${H}`}),z=T.map(E=>Math.abs(E[h.valueKey]||0)),O=T.map((E,$)=>$===0?"#fbbf24":$===1?"#94a3b8":$===2?"#cd7f32":new oe(0,0,1,0,[{offset:0,color:h.colorStart},{offset:1,color:h.colorEnd}]));return{graphic:[],grid:{left:0,right:35,top:5,bottom:5,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:i?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:i?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",textStyle:{color:i?"#fff":"#0f172a"},formatter:E=>{if(!Array.isArray(E)||E.length===0)return"";const $=E[0].dataIndex,I=T[$];if(!I)return"";const H=I.growth||0,K=H>0?"#34d399":H<0?"#f43f5e":"#94a3b8",k=H>0?"â–²":H<0?"â–¼":"-";return`
            <div style="font-weight:bold;margin-bottom:4px;display:flex;justify-content:space-between;gap:16px">
              <span>${I.name}</span>
              <span style="color:${K};font-family:monospace">${k} ${Math.abs(H)}%</span>
            </div>
            <div style="font-size:12px;color:${u};margin-bottom:8px">åˆ†ç±»: ${I.category}</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px 16px;font-size:12px">
              <span style="color:${u}">é”€é‡:</span>
              <span style="font-family:monospace;text-align:right;font-weight:bold;color:${i?"#fff":"#0f172a"}">${I.quantity}</span>
              <span style="color:${u}">è¥æ”¶:</span>
              <span style="font-family:monospace;text-align:right;font-weight:bold;color:#818cf8">Â¥${Math.round(I.revenue).toLocaleString()}</span>
              <span style="color:${u}">æ¯›åˆ©:</span>
              <span style="font-family:monospace;text-align:right;font-weight:bold;color:${I.profit>=0?"#34d399":"#f43f5e"}">Â¥${Math.round(I.profit).toLocaleString()}</span>
            </div>
          `}},xAxis:{type:"value",show:!1,max:j*1.05},yAxis:{type:"category",data:w,inverse:!0,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:i?"#cbd5e1":"#475569",fontSize:11,fontWeight:"normal",formatter:(E,$)=>{const I=String(E);return $===0?`{gold|${I}}`:$===1?`{silver|${I}}`:$===2?`{bronze|${I}}`:I},rich:{gold:{color:"#fbbf24",fontWeight:"bold",fontSize:11},silver:{color:"#94a3b8",fontWeight:"bold",fontSize:11},bronze:{color:"#cd7f32",fontWeight:"bold",fontSize:11}}}},series:[{type:"bar",data:T.map(()=>j*1.05),barWidth:12,barGap:"-100%",z:0,itemStyle:{color:i?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.03)",borderRadius:6},tooltip:{show:!1},animation:!1},{type:"bar",data:z.map((E,$)=>({value:E,itemStyle:{color:O[$],borderRadius:6}})),barWidth:12,label:{show:!0,position:"right",formatter:E=>{const $=Math.round(E.value);return`${h.unit}${$.toLocaleString()}`},color:i?"#e2e8f0":"#475569",fontSize:11,fontFamily:"JetBrains Mono, monospace",fontWeight:"bold"}}]}},[o,h,j,i,u]),M=me(b,[o,s,l],l),L=[{id:"quantity",label:"é”€é‡æ¦œ",icon:e.jsx(Qe,{size:12}),color:"emerald"},{id:"revenue",label:"è¥æ”¶æ¦œ",icon:e.jsx(Ae,{size:12}),color:"indigo"},{id:"profit",label:"æ¯›åˆ©æ¦œ",icon:e.jsx(Ke,{size:12}),color:"amber"},{id:"loss",label:"äºæŸæ¦œ",icon:e.jsx(Me,{size:12}),color:"rose"}],P=r.useMemo(()=>a?a.start===a.end?`${a.start.slice(5)} å•†å“${h.label}`:`${a.start.slice(5)}~${a.end.slice(5)} å•†å“${h.label}`:t?`${t.slice(5)} å•†å“${h.label}`:c.type!=="all"&&c.start&&c.end?c.start===c.end?`${c.start.slice(5)} å•†å“${h.label}`:`${c.start.slice(5)}~${c.end.slice(5)} å•†å“${h.label}`:`å•†å“${h.label} TOP 15`,[a,t,c,h.label]);return e.jsxs("div",{className:"glass-panel rounded-2xl p-4 h-full flex flex-col relative overflow-hidden",children:[x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 z-20 rounded-2xl",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"})}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s==="quantity"&&e.jsx(Qe,{size:16,className:"text-emerald-400"}),s==="revenue"&&e.jsx(Ae,{size:16,className:"text-indigo-400"}),s==="profit"&&e.jsx(Ke,{size:16,className:"text-amber-400"}),s==="loss"&&e.jsx(Me,{size:16,className:"text-rose-400"}),e.jsx("h3",{className:"text-base font-bold",style:{color:p},children:P})]}),e.jsxs("span",{className:"text-[10px] font-mono uppercase tracking-wider opacity-50",style:{color:u},children:["BY ",h.valueKey.toUpperCase()]})]}),e.jsx("div",{className:"flex p-0.5 bg-slate-900/50 rounded-lg border border-white/5 w-fit mb-3",children:L.map(T=>{const w=s===T.id;let z="";return w?(T.color==="emerald"&&(z="bg-emerald-500 text-white shadow-lg shadow-emerald-500/20"),T.color==="indigo"&&(z="bg-indigo-500 text-white shadow-lg shadow-indigo-500/20"),T.color==="amber"&&(z="bg-amber-500 text-white shadow-lg shadow-amber-500/20"),T.color==="rose"&&(z="bg-rose-500 text-white shadow-lg shadow-rose-500/20")):z="text-slate-400 hover:text-white hover:bg-white/5",e.jsxs("button",{onClick:()=>n(T.id),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-bold transition-all duration-300 ${z}`,children:[T.icon,T.label]},T.id)})}),e.jsx("div",{className:"flex-1 w-full min-h-0",children:e.jsx("div",{ref:M,className:"w-full h-full"})})]})},Gs={getHealth(t){return Q.get("/category/health",{params:t})}},Ks=()=>{const[t,a]=r.useState([]),[l,s]=r.useState(!1),[n,o]=r.useState("preset"),[d,x]=r.useState(7),[f,m]=r.useState(""),[c,i]=r.useState(""),[p,u]=r.useState(""),[h,j]=r.useState(!1),[b,M]=r.useState(!1),[L,P]=r.useState(),[T,w]=r.useState(null),[z,O]=r.useState("current_revenue"),[E,$]=r.useState("desc"),[I,H]=r.useState(null),K=r.useRef(null),k=r.useRef(null),D=r.useRef(null),W=r.useRef(null),{selectedStore:v,storeDateRange:C,channelList:F}=ce(),A=C!=null&&C.min_date?he(C.min_date,"yyyy-MM-dd",new Date):void 0,S=C!=null&&C.max_date?he(C.max_date,"yyyy-MM-dd",new Date):void 0;r.useEffect(()=>{p&&F.length>0&&!F.includes(p)&&u("")},[F,p]),r.useEffect(()=>{const _=J=>{const se=J.target;h&&K.current&&!K.current.contains(se)&&k.current&&!k.current.contains(se)&&j(!1),b&&D.current&&!D.current.contains(se)&&W.current&&!W.current.contains(se)&&M(!1)};return document.addEventListener("mousedown",_),()=>document.removeEventListener("mousedown",_)},[h,b]);const V=r.useCallback(_=>!!(A&&mt(_,A)||S&&pt(_,S)),[A,S]),U=r.useCallback(()=>{if(n==="custom"&&f&&c){const _=he(f,"yyyy-MM-dd",new Date),J=he(c,"yyyy-MM-dd",new Date);Te(_)&&Te(J)&&P({from:_,to:J})}else P(void 0);M(!0)},[n,f,c]),Y=r.useCallback(()=>{L!=null&&L.from&&(L!=null&&L.to)&&(m(ge(L.from,"yyyy-MM-dd")),i(ge(L.to,"yyyy-MM-dd")),o("custom"),M(!1))},[L]),G=r.useCallback(async()=>{s(!0);try{const _={store_name:v||void 0,channel:p||void 0,level:T?3:1,parent_category:T||void 0};n==="custom"&&f&&c?(_.start_date=f,_.end_date=c):_.period=d;const J=await Gs.getHealth(_);J.success&&(a(J.data),H({start:J.period.start,end:J.period.end}))}catch(_){console.error("è·å–å“ç±»å¥åº·åº¦æ•°æ®å¤±è´¥:",_),a([])}finally{s(!1)}},[v,p,n,d,f,c,T]),y=r.useCallback(()=>{O("current_revenue"),$("desc"),u(""),o("preset"),x(7),m(""),i(""),P(void 0),G()},[G]),g=_=>{o("preset"),x(_),m(""),i(""),P(void 0)},N=_=>{u(_),j(!1)};r.useEffect(()=>{G()},[G]);const R=r.useMemo(()=>[...t].sort((_,J)=>{const se=_[z],B=J[z],Z=se-B;return E==="desc"?-Z:Z}),[t,z,E]),q=_=>{z===_?$(J=>J==="desc"?"asc":"desc"):(O(_),$("desc"))},X=_=>{w(_)},re=()=>{w(null)},ne=_=>_>0?e.jsxs("span",{className:"flex items-center gap-1 text-emerald-400 font-mono",children:[e.jsx(Re,{size:14}),"+",_.toFixed(1),"%"]}):_<0?e.jsxs("span",{className:"flex items-center gap-1 text-rose-400 font-mono",children:[e.jsx(Ye,{size:14}),_.toFixed(1),"%"]}):e.jsxs("span",{className:"flex items-center gap-1 text-slate-400 font-mono",children:[e.jsx(cs,{size:14}),"0%"]}),xe=(_,J)=>{const se={ä½:"bg-emerald-500/20 text-emerald-400 border-emerald-500/30",ä¸­:"bg-amber-500/20 text-amber-400 border-amber-500/30",é«˜:"bg-rose-500/20 text-rose-400 border-rose-500/30"};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium border ${se[_]||se.ä¸­}`,children:_}),e.jsxs("span",{className:"text-slate-500 text-xs font-mono",children:[J.toFixed(1),"%"]})]})},ye=(_,J)=>{const se=_<8?"text-rose-400":_<9?"text-amber-400":"text-slate-300";let B=null;return Math.abs(J)>=.1&&(J>0?B=e.jsxs("span",{className:"text-emerald-400 text-xs ml-1",children:["â†‘",J.toFixed(1)]}):B=e.jsxs("span",{className:"text-rose-400 text-xs ml-1",children:["â†“",Math.abs(J).toFixed(1)]})),e.jsxs("span",{className:`font-mono ${se}`,children:[_.toFixed(1),"æŠ˜",B]})},de=_=>{const J=_>=40?"text-emerald-400":_>=25?"text-cyan-400":_>=10?"text-amber-400":"text-rose-400";return e.jsxs("span",{className:`font-mono font-medium ${J}`,children:[_.toFixed(1),"%"]})},ee=_=>{if(!_||_.length<2)return null;const J=Math.max(..._),se=Math.min(..._),B=J-se||1,Z=24,ae=60,le=_.map((Pe,zt)=>{const $t=zt/(_.length-1)*ae,Mt=Z-(Pe-se)/B*Z;return`${$t},${Mt}`}).join(" "),Ie=(_[_.length-1]>=_[0]?"up":"down")==="up"?"#34d399":"#f87171";return e.jsx("svg",{width:ae,height:Z,className:"opacity-70",children:e.jsx("polyline",{points:le,fill:"none",stroke:Ie,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})},te=({column:_})=>z!==_?e.jsx(is,{size:12,className:"text-slate-600"}):E==="desc"?e.jsx(Ce,{size:12,className:"text-indigo-400"}):e.jsx(_e,{size:12,className:"text-indigo-400 rotate-[-90deg]"});return e.jsxs("div",{className:"glass-panel rounded-2xl overflow-hidden flex flex-col h-full",children:[e.jsx("div",{className:"p-6 border-b border-white/5 bg-white/[0.02]",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(qe,{size:18,className:"text-violet-400"}),"å“ç±»å¥åº·åº¦åˆ†æ",T&&e.jsxs("span",{className:"text-sm font-normal text-slate-400 ml-2",children:["/ ",T]})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1 font-mono uppercase tracking-wider",children:["CATEGORY HEALTH METRICS Â· ",I?`${I.start} ~ ${I.end}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[T&&e.jsxs("button",{onClick:re,className:"flex items-center gap-1.5 px-3 py-1.5 bg-white/5 hover:bg-white/10 text-slate-300 hover:text-white border border-white/10 rounded-lg text-xs font-medium transition-all",children:[e.jsx(Oe,{size:14}),"è¿”å›ä¸Šçº§"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:K,onClick:()=>j(!h),className:"flex items-center gap-2 px-3 py-1.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-xs text-white transition-all",children:[e.jsx("span",{className:"text-cyan-400",children:"æ¸ é“:"}),e.jsx("span",{className:"max-w-[80px] truncate",children:p||"å…¨éƒ¨"}),e.jsx(Ce,{size:12,className:`text-slate-400 transition-transform ${h?"rotate-180":""}`})]}),h&&e.jsxs("div",{ref:k,className:"absolute top-full left-0 mt-2 w-36 bg-slate-900 border border-white/10 rounded-xl shadow-2xl z-50 overflow-hidden animate-fade-in-up",children:[e.jsxs("button",{onClick:()=>N(""),className:`w-full flex items-center justify-between px-4 py-2.5 text-xs transition-colors ${p===""?"bg-cyan-500/20 text-cyan-300":"text-slate-300 hover:bg-white/5"}`,children:[e.jsx("span",{children:"å…¨éƒ¨æ¸ é“"}),p===""&&e.jsx(be,{size:12,className:"text-cyan-400"})]}),F.map(_=>e.jsxs("button",{onClick:()=>N(_),className:`w-full flex items-center justify-between px-4 py-2.5 text-xs transition-colors ${p===_?"bg-cyan-500/20 text-cyan-300":"text-slate-300 hover:bg-white/5"}`,children:[e.jsx("span",{children:_}),p===_&&e.jsx(be,{size:12,className:"text-cyan-400"})]},_))]})]}),e.jsx("div",{className:"flex items-center bg-slate-800/50 rounded-lg p-0.5 border border-white/5",children:[7,14,30].map(_=>e.jsxs("button",{onClick:()=>g(_),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-all ${n==="preset"&&d===_?"bg-violet-500 text-white shadow-lg":"text-slate-400 hover:text-white"}`,children:[_,"å¤©"]},_))}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:D,onClick:U,className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border transition-all text-xs ${n==="custom"?"bg-indigo-500/20 border-indigo-500/50 text-indigo-300":"bg-white/5 border-white/10 text-slate-400 hover:bg-white/10 hover:text-white"}`,children:[e.jsx(Ue,{size:14}),e.jsx("span",{children:n==="custom"&&f&&c?`${f} ~ ${c}`:"è‡ªå®šä¹‰"})]}),b&&e.jsxs("div",{ref:W,className:"absolute top-full right-0 mt-2 p-5 rounded-xl border shadow-2xl bg-slate-900 border-white/10 z-50",style:{width:"580px"},children:[e.jsx("style",{children:`
                    .health-calendar .rdp-months {
                      display: flex !important;
                      flex-direction: row !important;
                      gap: 2rem !important;
                    }
                    .health-calendar .rdp-month {
                      margin: 0 !important;
                    }
                  `}),(C==null?void 0:C.min_date)&&(C==null?void 0:C.max_date)&&e.jsx("div",{className:"mb-4 px-3 py-2 bg-indigo-500/10 border border-indigo-500/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-indigo-300",children:["ğŸ“… å¯é€‰æ•°æ®èŒƒå›´: ",C.min_date," ~ ",C.max_date]})}),e.jsx("div",{className:"health-calendar",style:{display:"flex",justifyContent:"center"},children:e.jsx(bt,{mode:"range",numberOfMonths:2,selected:L,onSelect:P,locale:yt,disabled:V,defaultMonth:S?new Date(S.getFullYear(),S.getMonth()-1):new Date,startMonth:A,endMonth:S,showOutsideDays:!1,classNames:{months:"flex flex-row gap-8",month_caption:"flex justify-center items-center h-10 font-semibold text-sm text-slate-100",nav:"absolute top-0 left-0 right-0 flex justify-between px-2",button_previous:"w-8 h-8 rounded-lg bg-white/5 text-slate-400 flex items-center justify-center hover:bg-white/10 hover:text-slate-100",button_next:"w-8 h-8 rounded-lg bg-white/5 text-slate-400 flex items-center justify-center hover:bg-white/10 hover:text-slate-100",weekday:"text-slate-500 text-xs font-medium py-2",day:"w-9 h-9",day_button:"w-9 h-9 rounded-lg text-slate-300 text-sm hover:bg-white/10 hover:text-white transition-colors",today:"text-indigo-400 ring-1 ring-indigo-500 rounded-lg",selected:"bg-indigo-500 text-white rounded-lg",range_start:"bg-indigo-500 text-white rounded-l-lg rounded-r-none",range_end:"bg-indigo-500 text-white rounded-r-lg rounded-l-none",range_middle:"bg-indigo-500/20 text-indigo-300 rounded-none",disabled:"text-slate-600 opacity-40 cursor-not-allowed",outside:"text-slate-600 opacity-50"},components:{Chevron:({orientation:_})=>_==="left"?e.jsx(Oe,{size:18}):e.jsx(_e,{size:18})}})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:L!=null&&L.from&&(L!=null&&L.to)?e.jsxs("span",{className:"text-emerald-400 font-medium",children:["å·²é€‰: ",ge(L.from,"yyyy-MM-dd")," ~ ",ge(L.to,"yyyy-MM-dd")]}):L!=null&&L.from?e.jsx("span",{className:"text-amber-400",children:"è¯·é€‰æ‹©ç»“æŸæ—¥æœŸ"}):e.jsx("span",{children:"ç‚¹å‡»é€‰æ‹©å¼€å§‹æ—¥æœŸ"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>M(!1),className:"px-4 py-2 text-xs text-slate-400 hover:text-white transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:Y,disabled:!(L!=null&&L.from)||!(L!=null&&L.to),className:"px-5 py-2 bg-indigo-500 text-white rounded-lg text-xs font-medium hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"ç¡®è®¤é€‰æ‹©"})]})]})]})]}),e.jsx("button",{onClick:y,disabled:l,className:"p-2 bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white border border-white/5 rounded-lg transition-all",title:"åˆ·æ–°å¹¶é‡ç½®æ’åº",children:e.jsx(ue,{size:14,className:l?"animate-spin":""})})]})]})}),l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 z-10 rounded-2xl",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-violet-500"})}),e.jsx("div",{className:"overflow-auto flex-1 relative",children:e.jsxs("table",{className:"w-full divide-y divide-white/5 border-collapse",style:{tableLayout:"fixed"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"140px"}})," ",e.jsx("col",{style:{width:"110px"}})," ",e.jsx("col",{style:{width:"100px"}})," ",e.jsx("col",{style:{width:"80px"}}),"  ",e.jsx("col",{style:{width:"100px"}})," ",e.jsx("col",{style:{width:"110px"}})," ",e.jsx("col",{style:{width:"110px"}})," ",e.jsx("col",{style:{width:"80px"}}),"  ",e.jsx("col",{style:{width:"80px"}}),"  ",!T&&e.jsx("col",{style:{width:"60px"}})," "]}),e.jsx("thead",{className:"sticky top-0 z-20",children:e.jsxs("tr",{className:"bg-slate-900",children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-slate-400 uppercase tracking-wider font-mono sticky left-0 z-30 bg-slate-900 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.3)]",children:T?"ä¸‰çº§åˆ†ç±»":"ä¸€çº§åˆ†ç±»"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("current_revenue"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["é”€å”®é¢ ",e.jsx(te,{column:"current_revenue"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("growth_rate"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["é”€å”®ç¯æ¯” ",e.jsx(te,{column:"growth_rate"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("current_quantity"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["é”€é‡ ",e.jsx(te,{column:"current_quantity"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("quantity_growth_rate"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["é”€é‡ç¯æ¯” ",e.jsx(te,{column:"quantity_growth_rate"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("volatility"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["æ³¢åŠ¨ ",e.jsx(te,{column:"volatility"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("avg_discount"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["æŠ˜æ‰£ ",e.jsx(te,{column:"avg_discount"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("profit_margin"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["åˆ©æ¶¦ç‡ ",e.jsx(te,{column:"profit_margin"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-slate-400 uppercase tracking-wider font-mono bg-slate-900",children:"è¶‹åŠ¿"}),!T&&e.jsx("th",{className:"px-2 py-3 text-center text-xs font-bold text-slate-400 uppercase tracking-wider font-mono bg-slate-900",children:"æ“ä½œ"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:R.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:T?9:10,className:"px-4 py-12 text-center text-slate-500",children:"æš‚æ— æ•°æ®"})}):R.map((_,J)=>e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors group",style:{animationDelay:`${J*30}ms`},children:[e.jsx("td",{className:"px-3 py-3 whitespace-nowrap sticky left-0 z-10 bg-slate-900 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.3)] group-hover:bg-slate-800 overflow-hidden",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-xs font-bold bg-violet-500/20 border border-violet-500/30 text-violet-300 flex-shrink-0",children:J+1}),e.jsx("span",{className:"text-sm font-medium text-slate-200 truncate",children:_.name})]})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:e.jsxs("span",{className:"text-sm font-mono text-slate-300",children:["Â¥",_.current_revenue.toLocaleString()]})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:ne(_.growth_rate)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:e.jsx("span",{className:"text-sm font-mono text-slate-300",children:_.current_quantity.toLocaleString()})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:ne(_.quantity_growth_rate)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:xe(_.volatility_level,_.volatility)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:ye(_.avg_discount,_.discount_change)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:de(_.profit_margin)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:e.jsx("div",{className:"flex justify-center",children:ee(_.daily_revenue)})}),!T&&e.jsx("td",{className:"px-2 py-3 text-center",children:e.jsxs("button",{onClick:()=>X(_.name),className:"flex items-center gap-1 px-2 py-1 text-xs text-slate-400 hover:text-violet-400 hover:bg-violet-500/10 rounded transition-all mx-auto",children:[e.jsx(ke,{size:12}),"ä¸‹é’»"]})})]},_.name))})]})}),e.jsxs("div",{className:"p-3 border-t border-white/5 bg-slate-900/20 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-slate-500 font-mono",children:["å…± ",t.length," ä¸ª",T?"ä¸‰çº§":"ä¸€çº§","åˆ†ç±»"]}),e.jsx("span",{className:"text-xs text-slate-500",children:"ç‚¹å‡»è¡¨å¤´å¯æ’åº Â· ç‚¹å‡»ã€Œä¸‹é’»ã€æŸ¥çœ‹ä¸‰çº§åˆ†ç±»"})]})]})},qs=({storeName:t,channel:a,theme:l,selectedDate:s,selectedDateRange:n,onDistanceBandSelect:o})=>{var E;const[d,x]=r.useState(null),[f,m]=r.useState(!0),[c,i]=r.useState(null),p=r.useRef(null),u=r.useRef(null),{dateRange:h}=ce(),j=l==="dark",b=j?"#64748b":"#94a3b8",M=j?"#fff":"#0f172a",L=j?"#94a3b8":"#64748b",P=j?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",T=s||void 0;r.useEffect(()=>{if(!t){x(null),m(!1);return}(async()=>{var I,H;m(!0);try{const K={store_name:t,channel:a};T?K.target_date=T:n?(K.start_date=n.start,K.end_date=n.end):h.type!=="all"&&h.start&&h.end&&(K.start_date=h.start,K.end_date=h.end),console.log("ğŸ“Š DistanceAnalysisChart è¯·æ±‚å‚æ•°:",K);const k=await ie.getDistanceAnalysis(K);k.success&&k.data&&(console.log("ğŸ“Š DistanceAnalysisChart è¿”å›æ•°æ®:",{date:k.data.date,total_orders:(I=k.data.summary)==null?void 0:I.total_orders,bands:(H=k.data.distance_bands)==null?void 0:H.map(D=>`${D.band_label}: ${D.order_count}`)}),x(k.data))}catch(K){console.error("è·å–åˆ†è·ç¦»è®¢å•è¯Šæ–­æ•°æ®å¤±è´¥:",K)}finally{m(!1)}})()},[t,a,T,n,h.type,h.start,h.end]),r.useEffect(()=>{if(!p.current||!d)return;u.current||(u.current=$e(p.current,j?"dark":void 0));const{distance_bands:$,summary:I}=d,H=$.map(A=>A.band_label),K=$.map(A=>A.order_count),k=$.map(A=>A.profit),D=H.indexOf(I.optimal_distance),W=$.map((A,S)=>{const V=S===D;return S===c?new oe(0,0,0,1,[{offset:0,color:"rgba(34, 211, 238, 1)"},{offset:1,color:"rgba(34, 211, 238, 0.5)"}]):V?new oe(0,0,0,1,[{offset:0,color:"rgba(250, 204, 21, 0.9)"},{offset:1,color:"rgba(250, 204, 21, 0.3)"}]):new oe(0,0,0,1,[{offset:0,color:j?"rgba(139, 92, 246, 0.8)":"rgba(139, 92, 246, 0.7)"},{offset:1,color:j?"rgba(139, 92, 246, 0.2)":"rgba(139, 92, 246, 0.1)"}])}),v=D>=0?{silent:!0,data:[[{xAxis:H[D],itemStyle:{color:j?"rgba(250, 204, 21, 0.08)":"rgba(250, 204, 21, 0.1)"}},{xAxis:H[D]}]]}:void 0,C={backgroundColor:"transparent",grid:{top:35,right:45,bottom:25,left:40,containLabel:!0},tooltip:{trigger:"axis",backgroundColor:j?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:j?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:16,textStyle:{fontFamily:"JetBrains Mono",color:j?"#fff":"#0f172a",fontSize:12},axisPointer:{type:"shadow"},formatter:A=>{var g;const S=((g=A[0])==null?void 0:g.axisValue)||"",V=H.indexOf(S),U=$[V];if(!U)return"";const Y=S===I.optimal_distance;let G=`<div style="font-weight:600;margin-bottom:8px;font-size:13px">
            ${S}
            ${Y?'<span style="color:#facc15;margin-left:6px">â˜… æœ€ä¼˜åŒºé—´</span>':""}
          </div>`;G+=`<div style="display:flex;justify-content:space-between;align-items:center;margin:4px 0">
            <span style="display:flex;align-items:center;gap:6px">
              <span style="width:8px;height:8px;border-radius:50%;background:#8b5cf6"></span>
              è®¢å•æ•°
            </span>
            <span style="font-weight:600;margin-left:20px">${U.order_count}</span>
          </div>`;const y=U.profit>=0?"#22c55e":"#f43f5e";return G+=`<div style="display:flex;justify-content:space-between;align-items:center;margin:4px 0">
            <span style="display:flex;align-items:center;gap:6px">
              <span style="width:8px;height:8px;border-radius:50%;background:${y}"></span>
              åˆ©æ¶¦
            </span>
            <span style="font-weight:600;margin-left:20px;color:${y}">Â¥${U.profit.toFixed(2)}</span>
          </div>`,G+=`<div style="border-top:1px solid ${j?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"};margin:8px 0"></div>`,G+=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:11px">
            <div><span style="color:${j?"#94a3b8":"#64748b"}">é”€å”®é¢:</span> <span style="font-weight:600">Â¥${U.revenue.toFixed(0)}</span></div>
            <div><span style="color:${j?"#94a3b8":"#64748b"}">åˆ©æ¶¦ç‡:</span> <span style="font-weight:600;color:${U.profit_rate>=0?"#22c55e":"#f43f5e"}">${U.profit_rate.toFixed(1)}%</span></div>
            <div><span style="color:${j?"#94a3b8":"#64748b"}">é…é€æˆæœ¬:</span> <span style="font-weight:600">Â¥${U.delivery_cost.toFixed(0)}</span></div>
            <div><span style="color:${j?"#94a3b8":"#64748b"}">é…é€æˆæœ¬ç‡:</span> <span style="font-weight:600">${U.delivery_cost_rate.toFixed(1)}%</span></div>
            <div><span style="color:${j?"#94a3b8":"#64748b"}">å®¢å•ä»·:</span> <span style="font-weight:600">Â¥${U.avg_order_value.toFixed(0)}</span></div>
          </div>`,G}},legend:{data:["è®¢å•æ•°","åˆ©æ¶¦"],top:2,right:5,textStyle:{color:b,fontSize:10},itemWidth:10,itemHeight:10,itemGap:12},xAxis:{type:"category",data:H,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:b,fontSize:10,interval:0,rotate:0}},yAxis:[{type:"value",name:"",position:"left",splitLine:{lineStyle:{color:P,type:"dashed"}},axisLabel:{color:b,fontSize:10},nameTextStyle:{color:b,fontSize:10}},{type:"value",name:"",position:"right",splitLine:{show:!1},axisLabel:{color:b,fontSize:10,formatter:A=>`Â¥${A}`},nameTextStyle:{color:b,fontSize:10}}],series:[{name:"è®¢å•æ•°",type:"bar",z:10,data:K.map((A,S)=>({value:A,itemStyle:{color:W[S],borderRadius:[3,3,0,0],shadowBlur:S===c?15:0,shadowColor:S===c?"rgba(34, 211, 238, 0.6)":"transparent"}})),barWidth:28,barMaxWidth:40,markArea:v,animationDuration:300,animationEasing:"cubicOut"},{name:"åˆ©æ¶¦",type:"line",yAxisIndex:1,data:k,smooth:.3,symbol:"circle",symbolSize:6,z:1,silent:!0,itemStyle:{color:"#22c55e"},lineStyle:{width:2.5,color:"#22c55e",shadowColor:"rgba(34, 197, 94, 0.3)",shadowBlur:8},areaStyle:{color:new oe(0,0,0,1,[{offset:0,color:"rgba(34, 197, 94, 0.15)"},{offset:.5,color:"rgba(34, 197, 94, 0.03)"},{offset:1,color:"rgba(244, 63, 94, 0.08)"}]),opacity:.8},markLine:{silent:!0,symbol:"none",lineStyle:{color:j?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.1)",type:"dashed",width:1},data:[{yAxis:0}],label:{show:!1}}}]};u.current.setOption(C,!0),u.current.off("click"),u.current.on("click","series.bar",A=>{const S=A.dataIndex,V=$[S];V&&(console.log("ğŸ“Š æŸ±çŠ¶å›¾ç‚¹å‡»:",V.band_label,S),c===S?(i(null),o&&o(-1,"",0,0)):(i(S),o&&o(S,V.band_label,V.min_distance,V.max_distance)))});const F=()=>{var A;(A=u.current)==null||A.resize()};return window.addEventListener("resize",F),()=>{window.removeEventListener("resize",F)}},[d,j,b,P,c,o]),r.useEffect(()=>{u.current&&(u.current.dispose(),u.current=null)},[l]),r.useEffect(()=>()=>{u.current&&(u.current.dispose(),u.current=null)},[]);const w=d&&d.distance_bands&&d.distance_bands.some($=>$.order_count>0),z=r.useMemo(()=>{if(d!=null&&d.date){if(d.date.includes("~")){const $=d.date.split("~").map(I=>I.trim());return $.length===2&&$[0]&&$[1]?`${$[0].slice(5)} ~ ${$[1].slice(5)}`:d.date}return d.date.slice(5)}return null},[d==null?void 0:d.date]),O=n!=null;return e.jsxs("div",{className:"glass-panel rounded-2xl p-4 h-full flex flex-col relative",children:[e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-violet-500/5 to-transparent pointer-events-none rounded-b-2xl"}),e.jsxs("div",{className:"mb-2 relative z-10",children:[e.jsxs("h3",{className:"text-base font-bold flex items-center gap-2",style:{color:M},children:[e.jsx("span",{className:"w-1 h-4 bg-gradient-to-b from-violet-400 to-violet-600 rounded-full"}),z?`${z} åˆ†è·ç¦»è¯Šæ–­`:"åˆ†è·ç¦»è¯Šæ–­",(s||O)&&e.jsx("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded-full bg-violet-500/20 text-violet-400 ml-1",children:"å·²è”åŠ¨"}),c!==null&&(d==null?void 0:d.distance_bands[c])&&e.jsxs("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded-full bg-cyan-500/20 text-cyan-400 ml-1",children:["å·²é€‰: ",d.distance_bands[c].band_label]})]}),e.jsxs("p",{className:"text-[10px] mt-0.5 font-mono uppercase tracking-wider opacity-70",style:{color:L},children:["DISTANCE-BASED ORDER DIAGNOSIS",((E=d==null?void 0:d.summary)==null?void 0:E.optimal_distance)&&e.jsxs("span",{className:"ml-2 normal-case text-yellow-400",children:["(æœ€ä¼˜: ",d.summary.optimal_distance,")"]}),c!==null&&e.jsx("span",{className:"ml-2 normal-case text-cyan-400",children:"ç‚¹å‡»æŸ±å­å–æ¶ˆé€‰ä¸­"})]})]}),e.jsx("div",{className:"flex-1 w-full min-h-0",children:t?f?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-sm",style:{color:L},children:"åŠ è½½ä¸­..."})}):w?e.jsx("div",{ref:p,className:"w-full h-full"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"text-sm",style:{color:L},children:"æš‚æ— æ•°æ®"})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm mb-2",style:{color:L},children:"è¯·å…ˆé€‰æ‹©é—¨åº—"}),e.jsx("div",{className:"text-xs opacity-60",style:{color:L},children:"é€‰æ‹©é—¨åº—åå°†æ˜¾ç¤ºè¯¥é—¨åº—çš„é…é€è·ç¦»åˆ†æ"})]})})})]})},Ys=()=>{const[t,a]=r.useState(!1);return r.useEffect(()=>{let l=0,s=performance.now(),n=0,o;const d=()=>{const x=performance.now();if(l++,x-s>=1e3){if(l<35?n++:n=0,n>=3){a(!0);return}l=0,s=x}o=requestAnimationFrame(d)};return o=requestAnimationFrame(d),()=>cancelAnimationFrame(o)},[]),t};var Se=(t=>(t.MEITUAN="ç¾å›¢å¤–å–",t.ELEME="é¥¿äº†ä¹ˆ",t.DOUYIN="æŠ–éŸ³å›¢è´­",t.OFFLINE="çº¿ä¸‹é—¨åº—",t.PRIVATE_DOMAIN="ç§åŸŸå°ç¨‹åº",t))(Se||{});const Js=(t,a)=>Array.from({length:24},(s,n)=>`${n.toString().padStart(2,"0")}:00`).map((s,n)=>{let o=.5;n>=11&&n<=13&&(o=2.5),n>=17&&n<=19&&(o=2);const d=Math.floor(t/30*o*(.8+Math.random()*.4));return{hour:s,orders:d,revenue:d*45,deliveryCost:d*a*(n>=11&&n<=13?1.2:1)}}),Xs=t=>[{range:"0-1km",orders:Math.floor(t*.4),avgDeliveryCost:3.5},{range:"1-3km",orders:Math.floor(t*.45),avgDeliveryCost:5.8},{range:"3km+",orders:Math.floor(t*.15),avgDeliveryCost:9.2}],Zs=(t,a,l)=>{const s=[],n=new Date,o=t/30,d=a/30;for(let x=29;x>=0;x--){const f=new Date(n);f.setDate(f.getDate()-x);const c=f.getDay()===0||f.getDay()===6?1.2:.9,i=.8+Math.random()*.4,p=Math.floor(o*c*i),u=Math.floor(p*(l+(Math.random()-.5)*.1));s.push({date:f.toISOString().split("T")[0].slice(5),revenue:p,profit:u,orders:Math.floor(d*c*i)})}return s},Qs=t=>{const a=[{name:"ç°ç£¨å’–å•¡",items:["ç”Ÿæ¤°æ‹¿é“","å†°ç¾å¼","ç„¦ç³–ç›å¥‡æœµ","ç‡•éº¦æ‹¿é“","Dirtyè„å’–","å¡å¸ƒå¥‡è¯º","æ¾³ç™½","æ„å¼æµ“ç¼©"],baseMargin:.65},{name:"äººæ°”çƒ­é£Ÿ",items:["è€å›é…¸èœé±¼","å°ç‚’é»„ç‰›è‚‰","éº»å©†è±†è…","çº¢çƒ§è‚‰","å®«ä¿é¸¡ä¸","é±¼é¦™è‚‰ä¸","ç•ªèŒ„ç‚’è›‹","æ¢…èœæ‰£è‚‰","å¤§ç›˜é¸¡"],baseMargin:.35},{name:"è¶…å€¼å¥—é¤",items:["å•äººå·¥ä½œé¤","åŒäººåˆ†äº«æ¡¶","å…¨å®¶ç¦å¥—é¤","å•†åŠ¡ä¼šè®®é¤","æƒ…ä¾£çº¦ä¼šé¤"],baseMargin:.25},{name:"çƒ˜ç„™ç”œç‚¹",items:["ææ‹‰ç±³è‹","çº½çº¦èŠå£«","çº¢ä¸ç»’","é»‘æ£®æ—","æ¦´è²åƒå±‚","è›‹æŒ(3åª)","è èåŒ…"],baseMargin:.55}];let l=[];return a.forEach(s=>{s.items.forEach(n=>{const o=Math.random()*.1+.01,d=Math.floor(t*.25*o),x=s.baseMargin+(Math.random()*.2-.1),f=Math.floor(d*x),m=Math.floor(d/(30+Math.random()*20));l.push({name:`${s.name}|${n}`,revenue:d,cost:d-f,profit:f,grossMargin:x,orderCount:m,soldOutCount:0,slowMovingCount:0,inventoryTurnover:0})})}),l.sort((s,n)=>n.revenue-s.revenue).slice(0,50)},ea=(t,a)=>["0-20","20-40","40-60","60-80","80-100","100+"].map(s=>{let n=.1;return a<30&&s==="20-40"&&(n=.5),a>=30&&s==="40-60"&&(n=.4),{range:s,count:Math.floor(t*n*(.8+Math.random()*.4))}}),ta=t=>({itemDiscount:t*.3,thresholdDiscount:t*.4,vouchers:t*.2,other:t*.1}),sa=t=>{const a=t/30,l=[],s=new Date;for(let n=6;n>=0;n--){const o=new Date(s);o.setDate(o.getDate()-n);const x=o.getDay()===0||o.getDay()===6?1.3:.9,f=a*x*(.9+Math.random()*.2);l.push({date:o.toISOString().split("T")[0].slice(5),itemDiscount:Math.floor(f*.3),thresholdDiscount:Math.floor(f*.4),vouchers:Math.floor(f*.2),other:Math.floor(f*.1)})}return l},ze=(t,a,l,s,n,o,d,x)=>{const f=l*n,m=l*o,c=l*d,i=s*x,p=f+m+c+i,u=l-p,h=u/l;return{id:t,name:a,revenue:l,costs:{cogs:f,marketing:m,delivery:i,commission:c},marketingDetails:ta(m),marketingTrend:sa(m),totalCost:p,profit:u,marketingRate:m/l,profitMargin:h,orderCount:s,avgOrderValue:l/s,avgDeliveryCost:i/s,hourlyData:Js(s,x),distanceData:Xs(s),dailyTrend:Zs(l,s,h),categoryPerformance:Qs(l),aovDistribution:ea(s,l/s)}},aa=()=>{const t=[ze("1",Se.MEITUAN,45e4,11250,.35,.15,.18,6.5),ze("2",Se.ELEME,38e4,9500,.35,.2,.16,6.2),ze("3",Se.DOUYIN,6e5,15e3,.35,.25,.05,1.5),ze("4",Se.OFFLINE,55e4,13750,.35,.02,.01,0),ze("5",Se.PRIVATE_DOMAIN,2e5,4e3,.35,.05,.02,5)],a=t.reduce((n,o)=>n+o.revenue,0),l=t.reduce((n,o)=>n+o.profit,0),s=t.reduce((n,o)=>n+o.orderCount,0);return{totalRevenue:a,totalProfit:l,totalOrders:s,channels:t,lastUpdated:new Date().toLocaleString()}},ra=De.lazy(()=>Le(()=>import("./DataManagement-D5Hd_hDJ.js"),__vite__mapDeps([0,1,2]))),na=De.lazy(()=>Le(()=>import("./StoreComparisonView-BVgDpz5R.js"),__vite__mapDeps([3,1,2]))),Ee=({onExit:t})=>e.jsx("div",{className:"absolute top-4 right-4 z-[70] animate-fade-in-up",children:e.jsxs("button",{onClick:a=>{a.stopPropagation(),t()},className:"group flex items-center gap-2 pl-2 pr-2 py-1.5 bg-slate-800/80 backdrop-blur-md text-white border border-white/20 rounded-lg hover:bg-slate-700 transition-all duration-200 shadow-lg",children:[e.jsx("span",{className:"text-[10px] font-mono font-bold tracking-wider text-slate-300 group-hover:text-white",children:"MINIMIZE"}),e.jsx(St,{size:14,className:"text-indigo-400 group-hover:text-indigo-300"})]})}),oa=De.lazy(()=>Le(()=>import("./Skeleton-B00SeqEU.js"),__vite__mapDeps([4,1,2])).then(t=>({default:t.DashboardSkeleton}))),la=()=>e.jsxs("div",{className:"min-h-screen bg-slate-950 p-8 grid grid-cols-12 gap-6 animate-pulse",children:[e.jsx("div",{className:"col-span-12 h-20 bg-white/5 rounded-xl"}),[...Array(6)].map((t,a)=>e.jsx("div",{className:"col-span-6 lg:col-span-2 h-32 bg-white/5 rounded-2xl"},a)),e.jsx("div",{className:"col-span-12 xl:col-span-8 h-[550px] bg-white/5 rounded-2xl"}),e.jsx("div",{className:"col-span-12 xl:col-span-4 h-[550px] bg-white/5 rounded-2xl"})]});function ia({theme:t}){var xe,ye,de,ee,te,_,J,se;const[a,l]=r.useState(null),[s,n]=r.useState(null),[o,d]=r.useState(!1),[x,f]=r.useState([]),[m,c]=r.useState(!1),[i,p]=r.useState(null),[u,h]=r.useState(!1),[j,b]=r.useState(null),[M,L]=r.useState(null),[P,T]=r.useState(void 0),[w,z]=r.useState(null),[O,E]=r.useState(30),[$,I]=r.useState(null),[H,K]=r.useState("all"),{orderOverview:k,orderComparison:D,orderOverviewLoading:W,dateRange:v,selectedStore:C,selectedChannel:F}=ce(),A=Ys(),S=r.useRef(null),V=r.useRef(null),U=r.useRef(null),Y=r.useRef(null),G=r.useRef(null),y=r.useCallback(async()=>{if(!C){f([]);return}c(!0);try{const B={store_name:C};v.type!=="all"&&v.start&&v.end&&(B.start_date=v.start,B.end_date=v.end);const Z=await ie.getMarketingStructure(B);Z.success&&Z.data.channels.length>0?f(Z.data.channels):f([])}catch(B){console.error("è·å–è¥é”€æˆæœ¬ç»“æ„æ•°æ®å¤±è´¥:",B),f([])}finally{c(!1)}},[C,v.type,v.start,v.end]);r.useEffect(()=>{y()},[y]);const g=r.useCallback(async()=>{if(console.log("ğŸ“ˆ fetchMarketingTrend è°ƒç”¨, selectedStore:",C),!C){console.log("ğŸ“ˆ æœªé€‰æ‹©é—¨åº—ï¼Œè·³è¿‡è¥é”€è¶‹åŠ¿æ•°æ®åŠ è½½"),p(null);return}h(!0),b(null);try{const B={store_name:C};H&&H!=="all"&&(B.channel=H),v.type!=="all"&&v.start&&v.end&&(B.start_date=v.start,B.end_date=v.end),console.log("ğŸ“ˆ è¥é”€è¶‹åŠ¿è¯·æ±‚å‚æ•°:",B);const Z=await ie.getMarketingTrend(B);console.log("ğŸ“ˆ è¥é”€è¶‹åŠ¿APIå“åº”:",Z),Z.success&&Z.data.dates.length>0?(console.log("ğŸ“ˆ è¥é”€è¶‹åŠ¿æ•°æ®åŠ è½½æˆåŠŸ, æ—¥æœŸæ•°:",Z.data.dates.length),p(Z.data),b(null)):(console.log("ğŸ“ˆ è¥é”€è¶‹åŠ¿æ•°æ®ä¸ºç©º"),p(null))}catch(B){console.error("ğŸ“ˆ è·å–è¥é”€æˆæœ¬è¶‹åŠ¿æ•°æ®å¤±è´¥:",B),b("æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{h(!1)}},[C,H,v.type,v.start,v.end]);r.useEffect(()=>{g()},[g]),r.useEffect(()=>{const B=setTimeout(()=>{const Z=aa();l(Z)},100);return()=>clearTimeout(B)},[v]),r.useEffect(()=>{s?document.body.classList.add("has-focus"):document.body.classList.remove("has-focus")},[s]),r.useEffect(()=>{const B=Z=>{Z.key==="Escape"&&n(null)};return window.addEventListener("keydown",B),()=>window.removeEventListener("keydown",B)},[]);const N=r.useCallback((B,Z,ae)=>{if(ae!==void 0&&E(ae),B===null){L(null),T(void 0),z(null);return}if(w){z(null),L(B),T(Z);return}if(M&&Z!==void 0){if(M===B){L(null),T(void 0);return}const le=M<B?M:B,pe=M<B?B:M,Ie=M<B?P:Z,Pe=M<B?Z:P;z({start:le,end:pe,startIndex:Ie,endIndex:Pe}),L(null),T(void 0);return}L(B),T(Z)},[M,P,w]),R=r.useCallback((B,Z,ae,le)=>{console.log("ğŸ“Š è·ç¦»åŒºé—´é€‰ä¸­:",B,Z,ae,"-",le,"km"),I(B===-1?null:{minDistance:ae,maxDistance:le})},[]),q=async B=>{d(!0),await new Promise(Z=>setTimeout(Z,1500)),d(!1),console.log("AI Command:",B)},X=B=>{if(s===B){n(null);return}n(B);const ae={trend:S,efficiency:V,cost:U,profit:Y}[B];ae!=null&&ae.current&&setTimeout(()=>{var le;return(le=ae.current)==null?void 0:le.scrollIntoView({behavior:"smooth",block:"center"})},100)},re=B=>s===B?"is-focused relative":"",ne=r.useMemo(()=>a||null,[a]);return ne?e.jsxs("div",{className:"flex flex-col gap-6 relative z-10 w-full transition-all duration-500",children:[e.jsxs("div",{className:`flex flex-col xl:flex-row justify-between items-start xl:items-center gap-4 animate-fade-in-up transition-opacity duration-500 ${s?"opacity-20 blur-sm pointer-events-none":"opacity-100"}`,children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white flex items-center gap-2 tracking-tight",children:"è¿è¥è¯Šæ–­ä¸­å¿ƒ"}),e.jsxs("p",{className:"text-slate-400 text-xs mt-1 font-mono opacity-60 flex items-center gap-2",children:["SYSTEM: ONLINE",A&&e.jsxs("span",{className:"text-neon-yellow flex items-center gap-1",children:[e.jsx(vt,{size:10})," LITE"]})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center gap-4 w-full xl:w-auto",children:e.jsx("div",{className:"w-full sm:w-auto flex-1",children:e.jsx(Ws,{onCommand:q,isProcessing:o})})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6 w-full pb-12",children:[e.jsx("div",{className:"col-span-6 lg:col-span-2 animate-fade-in-up stagger-1",children:e.jsx(Ne,{title:"è®¢å•æ€»æ•°",value:k?k.total_orders.toLocaleString():"-",change:(xe=D==null?void 0:D.changes)==null?void 0:xe.order_count,subtext:"ç¯æ¯”",icon:e.jsx(xs,{size:18}),iconColor:"indigo",theme:t,loading:W,compact:!0})}),e.jsx("div",{className:"col-span-6 lg:col-span-2 animate-fade-in-up stagger-2",children:e.jsx(Ne,{title:"å•†å“å®æ”¶é¢",value:k?`Â¥${k.total_actual_sales.toLocaleString()}`:"-",change:(ye=D==null?void 0:D.changes)==null?void 0:ye.total_sales,subtext:"ç¯æ¯”",icon:e.jsx(Ae,{size:18}),iconColor:"cyan",theme:t,loading:W,compact:!0})}),e.jsx("div",{className:"col-span-6 lg:col-span-2 animate-fade-in-up stagger-3",children:e.jsx(Ne,{title:"æ€»åˆ©æ¶¦",value:k?`Â¥${k.total_profit.toLocaleString()}`:"-",change:(de=D==null?void 0:D.changes)==null?void 0:de.total_profit,subtext:"ç¯æ¯”",icon:e.jsx(Ke,{size:18}),iconColor:"emerald",trendColor:(((ee=D==null?void 0:D.changes)==null?void 0:ee.total_profit)??0)<0?"red":"green",theme:t,loading:W,compact:!0})}),e.jsx("div",{className:"col-span-6 lg:col-span-2 animate-fade-in-up stagger-4",children:e.jsx(Ne,{title:"å¹³å‡å®¢å•ä»·",value:k?`Â¥${k.avg_order_value.toFixed(1)}`:"-",change:(te=D==null?void 0:D.changes)==null?void 0:te.avg_order_value,subtext:"ç¯æ¯”",icon:e.jsx(Re,{size:18}),iconColor:"amber",theme:t,loading:W,compact:!0})}),e.jsx("div",{className:"col-span-6 lg:col-span-2 animate-fade-in-up stagger-5",children:e.jsx(Ne,{title:"æ€»åˆ©æ¶¦ç‡",value:k?`${k.profit_rate.toFixed(1)}%`:"-",change:(_=D==null?void 0:D.changes)==null?void 0:_.profit_rate,subtext:"ç¯æ¯”(ç™¾åˆ†ç‚¹)",icon:e.jsx(us,{size:18}),iconColor:"violet",trendColor:(((J=D==null?void 0:D.changes)==null?void 0:J.profit_rate)??0)<0?"red":"green",theme:t,loading:W,compact:!0,isPercentChange:!0})}),e.jsx("div",{className:"col-span-6 lg:col-span-2 animate-fade-in-up stagger-6",children:e.jsx(Ne,{title:"åŠ¨é”€å•†å“æ•°",value:k?k.active_products.toLocaleString():"-",change:(se=D==null?void 0:D.changes)==null?void 0:se.active_products,subtext:"ç¯æ¯”",icon:e.jsx(Ge,{size:18}),iconColor:"rose",theme:t,loading:W,compact:!0})}),e.jsxs("div",{ref:S,className:`col-span-12 xl:col-span-8 h-[550px] animate-fade-in-up stagger-7 ${re("trend")}`,children:[s==="trend"&&e.jsx(Ee,{onExit:()=>n(null)}),e.jsx(zs,{data:ne.channels,theme:t,onDateSelect:N,selectedDate:M,selectedDateRange:w?{start:w.start,end:w.end}:void 0})]}),e.jsx("div",{className:"col-span-12 xl:col-span-4 h-[550px] animate-fade-in-up stagger-8 z-30",children:e.jsx(Fs,{data:ne,onLocate:X,activeFocus:s})}),(M||w)&&e.jsxs("div",{className:"col-span-12 xl:col-span-8 relative h-10 -mt-4 -mb-2 z-0 animate-fade-in-up",children:[M&&!w&&e.jsxs("div",{className:"absolute flex flex-col items-center text-indigo-400 transition-all duration-300",style:{left:P!==void 0?`calc(50px + ${(P+.5)/O*85}%)`:"50%",transform:"translateX(-50%)"},children:[e.jsx("div",{className:"h-6 w-0.5 bg-gradient-to-b from-indigo-500/0 via-indigo-500 to-indigo-500"}),e.jsxs("div",{className:"px-3 py-1 bg-indigo-500/10 border border-indigo-500/30 rounded-full text-[10px] font-mono flex items-center gap-2 whitespace-nowrap",children:[e.jsx(et,{size:10})," ç‚¹å‡»å¦ä¸€æ—¥æœŸå½¢æˆèŒƒå›´ | ",M==null?void 0:M.slice(5)]})]}),w&&e.jsxs("div",{className:"absolute flex flex-col items-center text-emerald-400 transition-all duration-300",style:{left:`calc(50px + ${(w.startIndex+w.endIndex+1)/2/O*85}%)`,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"h-6 w-0.5 bg-gradient-to-b from-emerald-500/0 via-emerald-500 to-emerald-500"}),e.jsxs("div",{className:"px-3 py-1 bg-emerald-500/10 border border-emerald-500/30 rounded-full text-[10px] font-mono flex items-center gap-2 whitespace-nowrap",children:[e.jsx(et,{size:10})," æ—¥æœŸèŒƒå›´: ",w.start.slice(5)," ~ ",w.end.slice(5)]})]})]}),(M||w)&&e.jsx("div",{className:"hidden xl:block xl:col-span-4"}),e.jsxs("div",{ref:G,className:`col-span-12 grid grid-cols-12 gap-6 transition-all duration-500 ${M||w?"bg-indigo-900/5 p-4 rounded-3xl border border-indigo-500/10":""}`,children:[e.jsx("div",{className:"col-span-12 lg:col-span-6 h-[400px] animate-fade-in-up stagger-2",children:e.jsx(Vs,{selectedDate:M,selectedDateRange:w?{start:w.start,end:w.end}:void 0,theme:t})}),e.jsx("div",{className:"col-span-12 lg:col-span-6 h-[400px] animate-fade-in-up stagger-2",children:e.jsx(Hs,{selectedDate:M,selectedDateRange:w?{start:w.start,end:w.end}:void 0,theme:t})})]}),e.jsxs("div",{ref:V,className:`col-span-12 xl:col-span-6 h-[450px] animate-enter stagger-7 ${re("efficiency")}`,children:[s==="efficiency"&&e.jsx(Ee,{onExit:()=>n(null)}),e.jsx(Cs,{storeName:C||void 0,channel:F==="all"?void 0:F,theme:t,selectedDate:M,selectedDateRange:w?{start:w.start,end:w.end}:void 0})]}),e.jsx("div",{className:"col-span-12 xl:col-span-6 h-[450px] animate-enter stagger-8",children:e.jsx(qs,{storeName:C||void 0,channel:F==="all"?void 0:F,theme:t,selectedDate:M,selectedDateRange:w?{start:w.start,end:w.end}:void 0,onDistanceBandSelect:R})}),e.jsxs("div",{ref:U,className:`col-span-12 lg:col-span-6 h-[450px] animate-enter stagger-8 ${re("cost")}`,children:[s==="cost"&&e.jsx(Ee,{onExit:()=>n(null)}),m?e.jsx("div",{className:"glass-panel rounded-2xl p-6 h-full flex items-center justify-center",children:e.jsx("div",{className:"text-slate-400 text-sm",children:"åŠ è½½è¥é”€æˆæœ¬æ•°æ®ä¸­..."})}):e.jsx(ks,{data:x,theme:t})]}),e.jsx("div",{className:"col-span-12 lg:col-span-6 h-[450px] animate-enter stagger-9",children:e.jsx(Is,{data:i,theme:t,loading:u,error:j,selectedChannel:H,onChannelChange:K})}),e.jsx("div",{className:"col-span-12 h-[450px] animate-enter stagger-10",children:e.jsx(Ds,{theme:t,selectedDistanceBand:$,storeName:C||void 0,selectedDate:M,selectedDateRange:w?{start:w.start,end:w.end}:void 0})}),e.jsxs("div",{ref:Y,className:`col-span-12 h-[800px] animate-enter stagger-1 ${re("profit")}`,children:[s==="profit"&&e.jsx(Ee,{onExit:()=>n(null)}),e.jsx(Ms,{data:a.channels,theme:t})]}),e.jsx("div",{className:"col-span-12 h-[500px] animate-enter stagger-2",children:e.jsx(Ks,{theme:t})}),e.jsx("div",{className:"col-span-12 lg:col-span-6 h-[450px] animate-enter stagger-3",children:e.jsx(Ls,{data:ne.channels,theme:t})}),e.jsx("div",{className:"col-span-12 lg:col-span-6 h-[450px] animate-enter stagger-4",children:e.jsx(Ps,{data:ne})}),e.jsx("div",{className:`col-span-12 animate-enter stagger-5 ${s?"opacity-20 blur-sm pointer-events-none":"opacity-100"}`,children:e.jsx(Bs,{data:ne.channels})})]}),s&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 glass-panel text-white px-4 py-2 rounded-full shadow-2xl z-[100] animate-bounce",children:e.jsxs("p",{className:"text-xs font-mono font-bold tracking-widest flex items-center gap-2",children:[e.jsx(St,{size:12})," PRESS ESC TO EXIT"]})})]}):e.jsx(r.Suspense,{fallback:e.jsx(la,{}),children:e.jsx(oa,{})})}function ca(){const[t,a]=r.useState("dark");return r.useEffect(()=>{t==="light"?document.body.classList.add("light-mode"):document.body.classList.remove("light-mode")},[t]),e.jsx(js,{theme:t,onToggleTheme:()=>a(l=>l==="dark"?"light":"dark"),children:e.jsxs(ds,{children:[e.jsx(ve,{path:"/",element:e.jsx(ia,{theme:t})}),e.jsx(ve,{path:"/data",element:e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:e.jsx("div",{className:"text-slate-400",children:"åŠ è½½ä¸­..."})}),children:e.jsx(ra,{})})}),e.jsx(ve,{path:"/stores",element:e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:e.jsx("div",{className:"text-slate-400",children:"åŠ è½½ä¸­..."})}),children:e.jsx(na,{theme:t})})}),e.jsx(ve,{path:"/channels",element:e.jsx(Ve,{title:"æ¸ é“åˆ†æ"})}),e.jsx(ve,{path:"/trends",element:e.jsx(Ve,{title:"è¶‹åŠ¿æ´å¯Ÿ"})}),e.jsx(ve,{path:"/settings",element:e.jsx(Ve,{title:"ç³»ç»Ÿè®¾ç½®"})})]})})}const Ve=({title:t})=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh] text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸš§"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:t}),e.jsx("p",{className:"text-slate-400",children:"åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…..."})]});class da extends De.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,l){console.error("Uncaught error:",a,l)}render(){var a;return this.state.hasError?e.jsxs("div",{style:{padding:"40px",color:"#f87171",backgroundColor:"#1e293b",height:"100vh",fontFamily:"monospace"},children:[e.jsx("h1",{style:{fontSize:"24px",marginBottom:"20px"},children:"âš ï¸ System Malfunction"}),e.jsx("p",{style:{color:"#cbd5e1"},children:"The dashboard encountered a critical error while rendering."}),e.jsx("pre",{style:{marginTop:"20px",padding:"20px",backgroundColor:"#0f172a",borderRadius:"8px",overflow:"auto"},children:(a=this.state.error)==null?void 0:a.message}),e.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"20px",padding:"10px 20px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Reboot System"})]}):this.props.children}}const _t=document.getElementById("root");if(!_t)throw new Error("Could not find root element to mount to");const xa=fs.createRoot(_t);xa.render(e.jsx(De.StrictMode,{children:e.jsx(ms,{children:e.jsx(gs,{children:e.jsx(da,{children:e.jsx(ca,{})})})})}));export{Ne as S,fe as a,me as b,tt as d,ce as u};
