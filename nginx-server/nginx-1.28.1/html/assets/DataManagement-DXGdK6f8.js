import{ap as Y,r,j as e,V as L,R as d,aq as C,m as M,q as _,A as O,ar as S,as as U,X as Z,a0 as ee,e as se,n as W,C as te,l as ae,at as le}from"./react-vendor-BU-CX47b.js";import{u as ie,d as b}from"./index-DXeBvM4U.js";const k=c=>c==null?"0":c.toLocaleString(),de=()=>{const c=Y(),{stats:l,statsLoading:D,systemStatus:$,stores:q,refreshAll:u,refreshStats:G}=ie(),[o,x]=r.useState([]),[g,A]=r.useState(!1),[j,h]=r.useState([]),[f,P]=r.useState(""),[N,F]=r.useState(null),[m,v]=r.useState(null),[w,Q]=r.useState(!1),[y,R]=r.useState(!1),[z,E]=r.useState(!1),B=s=>{const t=Array.from(s.target.files||[]);x(a=>[...a,...t].slice(0,5)),h([])},H=s=>{s.preventDefault();const t=Array.from(s.dataTransfer.files).filter(a=>a.name.endsWith(".xlsx")||a.name.endsWith(".xls"));x(a=>[...a,...t].slice(0,5)),h([])},K=s=>{x(t=>t.filter((a,n)=>n!==s))},V=async()=>{if(o.length===0)return;A(!0),h([]);const s=[];let t=0;for(const a of o)try{const n=await b.uploadOrders(a,{mode:"replace"});n.success?(t++,s.push(`âœ… ${a.name}: æˆåŠŸå¯¼å…¥ ${n.rows_inserted} æ¡æ•°æ®`)):s.push(`âŒ ${a.name}: ä¸Šä¼ å¤±è´¥`)}catch(n){s.push(`âŒ ${a.name}: ${n.message||"ä¸Šä¼ å¤±è´¥"}`)}h(s),A(!1),t>0&&(x([]),u())},X=async s=>{F(s);try{(await b.deleteStoreData(s)).success&&(v(null),u())}catch{alert("åˆ é™¤å¤±è´¥")}finally{F(null)}},I=async()=>{E(!0);try{await b.clearCache(),alert("ç¼“å­˜å·²æ¸…é™¤")}catch{alert("æ¸…é™¤å¤±è´¥")}finally{E(!1)}},J=async()=>{R(!0);try{const s=await b.optimizeDatabase();alert(s.message||"ä¼˜åŒ–å®Œæˆ")}catch{alert("ä¼˜åŒ–å¤±è´¥")}finally{R(!1)}},T=q.filter(s=>s.label.toLowerCase().includes(f.toLowerCase())),i=$.database==="connected",p=$.redis==="connected";return e.jsxs("div",{className:"flex flex-col gap-6 w-full",children:[m&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-6 w-[400px] shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-rose-500/20 flex items-center justify-center",children:e.jsx(L,{size:20,className:"text-rose-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold",children:"ç¡®è®¤åˆ é™¤"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"æ­¤æ“ä½œä¸å¯æ’¤é”€"})]})]}),e.jsxs("p",{className:"text-slate-300 mb-6",children:["ç¡®å®šè¦åˆ é™¤é—¨åº— ",e.jsxs("span",{className:"text-rose-400 font-medium",children:['"',m.label,'"']})," çš„æ‰€æœ‰æ•°æ®å—ï¼Ÿ"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>v(null),className:"flex-1 px-4 py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg font-medium transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>X(m.value),disabled:N===m.value,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-rose-500 hover:bg-rose-600 disabled:bg-rose-500/50 text-white rounded-lg font-medium transition-colors",children:N===m.value?e.jsxs(e.Fragment,{children:[e.jsx(d,{size:16,className:"animate-spin"}),"åˆ é™¤ä¸­..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{size:16}),"ç¡®è®¤åˆ é™¤"]})})]})]})}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx(M,{size:24,className:"text-indigo-400"}),"æ•°æ®ç®¡ç†ä¸­å¿ƒ"]}),e.jsx("p",{className:"text-slate-400 text-xs mt-1 font-mono",children:"DATA MANAGEMENT CENTER"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-xl border ${i?"bg-emerald-500/10 border-emerald-500/30":"bg-rose-500/10 border-rose-500/30"}`,children:[i?e.jsx(_,{size:16,className:"text-emerald-400"}):e.jsx(O,{size:16,className:"text-rose-400"}),e.jsxs("span",{className:`text-sm font-medium ${i?"text-emerald-300":"text-rose-300"}`,children:["PostgreSQL ",i?"å·²è¿æ¥":"æœªè¿æ¥"]})]}),e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-xl border ${p?"bg-emerald-500/10 border-emerald-500/30":"bg-amber-500/10 border-amber-500/30"}`,children:[p?e.jsx(_,{size:16,className:"text-emerald-400"}):e.jsx(L,{size:16,className:"text-amber-400"}),e.jsxs("span",{className:`text-sm font-medium ${p?"text-emerald-300":"text-amber-300"}`,children:["Redis ",p?"å·²è¿æ¥":"æœªè¿æ¥"]})]})]})]}),!i&&e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-rose-500/10 border border-rose-500/30 rounded-xl",children:[e.jsx(O,{size:24,className:"text-rose-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-rose-300 font-medium",children:"æ•°æ®åº“è¿æ¥å¤±è´¥"}),e.jsx("div",{className:"text-rose-400/70 text-sm mt-1",children:"è¯·æ£€æŸ¥ PostgreSQL æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Œæˆ–è”ç³»ç®¡ç†å‘˜ã€‚æ•°æ®ç®¡ç†åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ã€‚"})]}),e.jsx("button",{onClick:()=>G(),className:"px-4 py-2 bg-rose-500/20 hover:bg-rose-500/30 text-rose-300 rounded-lg text-sm font-medium transition-colors",children:"é‡è¯•è¿æ¥"})]}),e.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:"ğŸ“Š æ•°æ®æ€»è§ˆ"}),e.jsxs("button",{onClick:()=>u(),disabled:D,className:"flex items-center gap-2 px-3 py-1.5 text-sm text-slate-400 hover:text-white transition-colors",children:[e.jsx(d,{size:14,className:D?"animate-spin":""}),"åˆ·æ–°"]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[{icon:"ğŸ“¦",label:"è®¢å•æ€»æ•°",value:k(l==null?void 0:l.total_orders),color:"text-indigo-400"},{icon:"ğŸª",label:"é—¨åº—æ•°é‡",value:(l==null?void 0:l.total_stores)||0,color:"text-emerald-400"},{icon:"ğŸ›’",label:"å•†å“ç§ç±»",value:k(l==null?void 0:l.total_products),color:"text-amber-400"},{icon:"ğŸ“…",label:"æ•°æ®æ–°é²œåº¦",value:(l==null?void 0:l.data_freshness)||"-",color:"text-cyan-400"}].map(({icon:s,label:t,value:a,color:n})=>e.jsx("div",{className:"bg-slate-800/50 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:s}),e.jsxs("div",{children:[e.jsx("div",{className:`text-xl font-bold ${n}`,children:a}),e.jsx("div",{className:"text-sm text-slate-500",children:t})]})]})},t))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2 mb-4",children:[e.jsx(S,{size:20,className:"text-indigo-400"}),"å¯¼å…¥æ•°æ®"]}),e.jsxs("div",{onDragOver:s=>s.preventDefault(),onDrop:H,className:"border-2 border-dashed border-white/20 hover:border-indigo-500/50 rounded-xl p-8 text-center transition-all cursor-pointer group",children:[e.jsx(U,{size:40,className:"mx-auto mb-3 text-slate-500 group-hover:text-indigo-400 transition-colors"}),e.jsx("div",{className:"text-white font-medium mb-1",children:"æ‹–æ‹½ Excel æ–‡ä»¶åˆ°è¿™é‡Œ"}),e.jsx("div",{className:"text-slate-500 text-sm mb-4",children:"æ”¯æŒ .xlsx / .xls æ ¼å¼"}),e.jsx("input",{type:"file",accept:".xlsx,.xls",multiple:!0,onChange:B,className:"hidden",id:"file-upload",disabled:!i}),e.jsxs("label",{htmlFor:"file-upload",className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all cursor-pointer ${i?"bg-indigo-500 hover:bg-indigo-600 text-white":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,children:[e.jsx(S,{size:16}),"é€‰æ‹©æ–‡ä»¶"]})]}),o.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[o.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{size:18,className:"text-emerald-400"}),e.jsx("span",{className:"text-white text-sm",children:s.name}),e.jsxs("span",{className:"text-slate-500 text-xs",children:["(",(s.size/1024).toFixed(1)," KB)"]})]}),e.jsx("button",{onClick:()=>K(t),className:"text-slate-500 hover:text-rose-400",children:e.jsx(Z,{size:16})})]},t)),e.jsxs("div",{className:"flex gap-3 mt-3",children:[e.jsxs("button",{onClick:V,disabled:g||!i,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-indigo-500 hover:bg-indigo-600 disabled:bg-indigo-500/50 text-white rounded-lg font-medium transition-all",children:[g?e.jsx(d,{size:16,className:"animate-spin"}):e.jsx(S,{size:16}),g?"ä¸Šä¼ ä¸­...":`ä¸Šä¼  ${o.length} ä¸ªæ–‡ä»¶`]}),e.jsx("button",{onClick:()=>x([]),className:"px-4 py-2.5 bg-white/5 hover:bg-white/10 text-slate-300 rounded-lg",children:"æ¸…ç©º"})]})]}),j.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-slate-800/50 rounded-xl space-y-1",children:[j.map((s,t)=>e.jsx("div",{className:`text-sm ${s.startsWith("âœ…")?"text-emerald-400":"text-rose-400"}`,children:s},t)),j.some(s=>s.startsWith("âœ…"))&&e.jsxs("button",{onClick:()=>c("/"),className:"mt-3 flex items-center gap-2 text-indigo-400 hover:text-indigo-300 text-sm",children:["å‰å¾€çœ‹æ¿æŸ¥çœ‹ ",e.jsx(ee,{size:14})]})]})]}),e.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-2xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white flex items-center gap-2 mb-4",children:"ğŸª é—¨åº—æ•°æ®"}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-800/50 rounded-lg mb-4",children:[e.jsx(se,{size:16,className:"text-slate-500"}),e.jsx("input",{type:"text",placeholder:"æœç´¢é—¨åº—...",value:f,onChange:s=>P(s.target.value),className:"flex-1 bg-transparent text-white text-sm placeholder-slate-500 outline-none"})]}),e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto custom-scrollbar pr-2",children:T.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:f?"æœªæ‰¾åˆ°åŒ¹é…çš„é—¨åº—":"æš‚æ— é—¨åº—æ•°æ®"}):T.map(s=>e.jsx("div",{className:"bg-slate-800/50 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:s.label}),e.jsxs("div",{className:"text-slate-500 text-sm mt-1",children:[k(s.order_count)," æ¡è®¢å•"]})]}),N===s.value?e.jsx(d,{size:16,className:"text-slate-400 animate-spin"}):e.jsxs("button",{onClick:()=>v({value:s.value,label:s.label}),disabled:!i,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm text-rose-400 hover:bg-rose-500/10 rounded-lg transition-colors disabled:opacity-50",children:[e.jsx(C,{size:14}),"åˆ é™¤"]})]})},s.value))})]})]}),e.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-2xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>Q(!w),className:"w-full flex items-center justify-between p-5 text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{size:20,className:"text-slate-400"}),e.jsx("span",{className:"text-white font-medium",children:"ç³»ç»Ÿç»´æŠ¤"}),e.jsx("span",{className:"text-slate-500 text-sm",children:"ç¼“å­˜ç®¡ç†ã€æ•°æ®åº“ä¼˜åŒ–"})]}),w?e.jsx(te,{size:20,className:"text-slate-400"}):e.jsx(ae,{size:20,className:"text-slate-400"})]}),w&&e.jsx("div",{className:"px-5 pb-5 border-t border-white/5 pt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-white font-medium mb-3",children:[e.jsx(le,{size:16,className:"text-amber-400"}),"ç¼“å­˜ç®¡ç†"]}),e.jsx("p",{className:"text-slate-500 text-sm mb-4",children:"æ¸…é™¤ç³»ç»Ÿç¼“å­˜ï¼Œè§£å†³æ•°æ®ä¸ä¸€è‡´é—®é¢˜"}),e.jsxs("button",{onClick:I,disabled:z,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-amber-500/20 hover:bg-amber-500/30 text-amber-300 rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:[z?e.jsx(d,{size:14,className:"animate-spin"}):e.jsx(C,{size:14}),z?"æ¸…é™¤ä¸­...":"æ¸…é™¤å…¨éƒ¨ç¼“å­˜"]})]}),e.jsxs("div",{className:"bg-slate-800/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-white font-medium mb-3",children:[e.jsx(M,{size:16,className:"text-emerald-400"}),"æ•°æ®åº“ä¼˜åŒ–"]}),e.jsx("p",{className:"text-slate-500 text-sm mb-4",children:"æ¸…ç†ç¢ç‰‡ã€é‡å»ºç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½"}),e.jsxs("button",{onClick:J,disabled:y||!i,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:[y?e.jsx(d,{size:14,className:"animate-spin"}):e.jsx(W,{size:14}),y?"ä¼˜åŒ–ä¸­...":"ä¼˜åŒ–æ•°æ®åº“"]})]})]})})]})]})};export{de as default};
