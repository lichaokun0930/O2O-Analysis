import{j as e,au as Ne,V as K,av as Le,al as $e,af as Oe,T as we,J as Re,r as c,S as te,p as U,aw as Fe,f as J,i as me,b as Te,c as We,d as pe,h as he,C as _e,g as Ee,D as Pe,z as Ie,k as Be,l as Se,R as ue,ax as ne,Q as ge,ay as Ae,az as Ue,x as fe,aA as Ge,a8 as be,G as je,X as ye,aj as qe,Y as He,W as Je,ak as Qe}from"./react-vendor-BdPbM3-2.js";import{a as G,b as ke,u as Ve,C as Ye,S as Q}from"./index-CdHGt825.js";const V={getComparison:async s=>(await G.get("/stores/comparison",{params:s})).data,getWeekOverWeek:async(s,n,v,f)=>(await G.get("/stores/comparison/week-over-week",{params:{end_date:s,previous_start:n,previous_end:v,channel:f}})).data,getRanking:async s=>(await G.get("/stores/comparison/ranking",{params:s})).data,getAvailableChannels:async s=>(await G.get("/stores/comparison/available-channels",{params:s})).data,exportData:async s=>(await G.get("/stores/comparison/export",{params:s})).data,getStoresByChannel:async s=>(await G.get("/stores/comparison/stores-by-channel",{params:s})).data,getGlobalInsights:async s=>(await G.get("/stores/comparison/global-insights",{params:s})).data},Xe=({stores:s,theme:n="dark",loading:v=!1,sortBy:f,sortOrder:x,onSort:N,onStoreClick:w})=>{const j=t=>{f===t?N(t,x==="asc"?"desc":"asc"):N(t,"desc")},S=t=>f!==t?null:x==="asc"?e.jsx(Le,{size:14}):e.jsx($e,{size:14}),u=(t,i=!0)=>{if(t===void 0||t===0)return e.jsxs("span",{className:"text-slate-600 flex items-center gap-1 text-[10px]",children:[e.jsx(Oe,{size:10})," -"]});const m=t>0,d=m?"text-emerald-400":"text-red-400",l=m?we:Re;return e.jsxs("span",{className:`${d} flex items-center gap-1 text-[10px] font-medium`,children:[e.jsx(l,{size:10}),m?"+":"",t.toFixed(1),i?"%":""]})},y=t=>{if(!t||t.length===0)return"";const i=t.some(d=>d.severity==="high"),m=t.some(d=>d.severity==="medium");return i?"border-l-2 border-l-red-500":m?"border-l-2 border-l-amber-500":"border-l-2 border-l-blue-500"};return v?e.jsx("div",{className:"glass-panel rounded-2xl p-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-slate-400",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-slate-600 border-t-slate-400 rounded-full animate-spin"}),"åŠ è½½ä¸­..."]})}):s.length===0?e.jsx("div",{className:"glass-panel rounded-2xl p-6",children:e.jsxs("div",{className:"text-slate-400 text-center py-8",children:[e.jsx(Ne,{size:32,className:"mx-auto mb-2 opacity-50"}),"æš‚æ— æ•°æ®"]})}):e.jsxs("div",{className:"glass-panel rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"é—¨åº—è¯¦ç»†æ•°æ®"}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"é«˜é£é™©"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full"}),"ä¸­é£é™©"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"æ­£å¸¸"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium",children:"æ’å"}),e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium",children:"é—¨åº—åç§°"}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium cursor-pointer hover:text-white transition-colors",onClick:()=>j("order_count"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["è®¢å•é‡ ",S("order_count")]})}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium cursor-pointer hover:text-white transition-colors",onClick:()=>j("revenue"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["é”€å”®é¢ ",S("revenue")]})}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium cursor-pointer hover:text-white transition-colors",onClick:()=>j("profit"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["åˆ©æ¶¦ ",S("profit")]})}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium cursor-pointer hover:text-white transition-colors",onClick:()=>j("profit_margin"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["åˆ©æ¶¦ç‡ ",S("profit_margin")]})}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium",children:"å®¢å•ä»·"}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium",children:"å•å‡é…é€è´¹"}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium",children:"å•å‡è¥é”€è´¹"})]})}),e.jsx("tbody",{children:s.map((t,i)=>{var m,d,l,h,r,_,b;return e.jsxs("tr",{className:`border-b border-white/5 hover:bg-white/5 transition-colors cursor-pointer
                           ${y(t.anomalies)}`,onClick:()=>w==null?void 0:w(t.store_name),children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"flex items-center gap-2",children:i<3?e.jsx("span",{className:`
                        w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold
                        ${i===0?"bg-amber-500/20 text-amber-400":""}
                        ${i===1?"bg-slate-400/20 text-slate-300":""}
                        ${i===2?"bg-orange-600/20 text-orange-400":""}
                      `,children:i+1}):e.jsx("span",{className:"text-slate-500 text-xs w-6 text-center",children:i+1})})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white font-medium",children:t.store_name}),t.anomalies&&t.anomalies.length>0&&e.jsx("span",{title:t.anomalies.map(C=>C.message).join(`
`),children:e.jsx(K,{size:14,className:t.anomalies.some(C=>C.severity==="high")?"text-red-400":t.anomalies.some(C=>C.severity==="medium")?"text-amber-400":"text-blue-400"})})]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsx("span",{className:"text-slate-300",children:t.order_count.toLocaleString()}),u((m=t.weekOverWeek)==null?void 0:m.order_count)]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:"text-slate-300",children:["Â¥",t.total_revenue.toLocaleString()]}),u((d=t.weekOverWeek)==null?void 0:d.revenue)]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:"text-slate-300",children:["Â¥",t.total_profit.toLocaleString()]}),u((l=t.weekOverWeek)==null?void 0:l.profit)]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:`
                      ${t.profit_margin>=30?"text-emerald-400":""}
                      ${t.profit_margin>=20&&t.profit_margin<30?"text-cyan-400":""}
                      ${t.profit_margin>=10&&t.profit_margin<20?"text-amber-400":""}
                      ${t.profit_margin<10?"text-red-400":""}
                    `,children:[t.profit_margin.toFixed(1),"%"]}),u((h=t.weekOverWeek)==null?void 0:h.profit_margin,!1)]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:"text-slate-300",children:["Â¥",t.aov.toFixed(1)]}),u((r=t.weekOverWeek)==null?void 0:r.aov)]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:"text-slate-300",children:["Â¥",t.avg_delivery_fee.toFixed(1)]}),u((_=t.weekOverWeek)==null?void 0:_.avg_delivery_fee)]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:"text-slate-300",children:["Â¥",t.avg_marketing_cost.toFixed(1)]}),u((b=t.weekOverWeek)==null?void 0:b.avg_marketing_cost)]})})]},t.store_name)})})]})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex items-center justify-between text-xs text-slate-400",children:[e.jsxs("span",{children:["å…± ",s.length," ä¸ªé—¨åº—"]}),e.jsxs("span",{children:["å¼‚å¸¸é—¨åº—: ",s.filter(t=>t.anomalies&&t.anomalies.length>0).length," ä¸ª"]})]})]})},Ke=({stores:s,metric:n,theme:v="dark",loading:f=!1})=>{const x=c.useMemo(()=>{if(s.length===0)return{names:[],values:[],colors:[]};const y=s.slice(0,10),t=y.map(d=>d.store_name),i=y.map(d=>{switch(n){case"revenue":return d.total_revenue;case"profit":return d.total_profit;case"profit_margin":return d.profit_margin;case"order_count":return d.order_count;default:return d.total_revenue}}),m=y.map(d=>d.profit_margin>=30?"#10b981":d.profit_margin>=20?"#06b6d4":d.profit_margin>=10?"#f59e0b":"#ef4444");return{names:t,values:i,colors:m}},[s,n]),N={revenue:"é”€å”®é¢",profit:"åˆ©æ¶¦",profit_margin:"åˆ©æ¶¦ç‡",order_count:"è®¢å•é‡"},w={revenue:"å…ƒ",profit:"å…ƒ",profit_margin:"%",order_count:"å•"},j=c.useMemo(()=>({title:{text:`é—¨åº—${N[n]}æ’è¡Œæ¦œ Top 10`,left:"center",top:10,textStyle:{color:v==="dark"?"#fff":"#1e293b",fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(0, 0, 0, 0.8)",borderColor:"rgba(255, 255, 255, 0.2)",textStyle:{color:"#fff"},formatter:y=>{const t=y[0],i=s.find(m=>m.store_name===t.name);return i?`
          <div style="padding: 8px;">
            <div style="font-weight: bold; margin-bottom: 8px;">${i.store_name}</div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>é”€å”®é¢:</span>
              <span style="font-weight: bold;">Â¥${i.total_revenue.toLocaleString()}</span>
            </div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>åˆ©æ¶¦:</span>
              <span style="font-weight: bold;">Â¥${i.total_profit.toLocaleString()}</span>
            </div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>åˆ©æ¶¦ç‡:</span>
              <span style="font-weight: bold;">${i.profit_margin.toFixed(1)}%</span>
            </div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>è®¢å•é‡:</span>
              <span style="font-weight: bold;">${i.order_count.toLocaleString()}å•</span>
            </div>
          </div>
        `:""}},grid:{left:"3%",right:"4%",bottom:"3%",top:60,containLabel:!0},xAxis:{type:"category",data:x.names,axisLabel:{color:v==="dark"?"#94a3b8":"#64748b",rotate:45,fontSize:11},axisLine:{lineStyle:{color:v==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}}},yAxis:{type:"value",name:w[n],nameTextStyle:{color:v==="dark"?"#94a3b8":"#64748b"},axisLabel:{color:v==="dark"?"#94a3b8":"#64748b",formatter:y=>n==="profit_margin"?y.toFixed(0):y>=1e4?(y/1e4).toFixed(1)+"w":y.toLocaleString()},splitLine:{lineStyle:{color:v==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)"}}},series:[{type:"bar",data:x.values.map((y,t)=>({value:y,itemStyle:{color:x.colors[t]}})),barWidth:"60%",label:{show:!0,position:"top",color:v==="dark"?"#fff":"#1e293b",fontSize:10,formatter:y=>{const t=y.value;return n==="profit_margin"?t.toFixed(1)+"%":t>=1e4?(t/1e4).toFixed(1)+"w":t.toLocaleString()}}}]}),[x,n,v,s,N,w]),S=ke(j,[x,n,v,s],v),u=!f&&s.length>0&&x.names.length>0;return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full",children:[e.jsx("div",{ref:S,className:"w-full h-full",style:{minHeight:"350px",visibility:u?"visible":"hidden",position:u?"relative":"absolute"}}),!u&&e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center",style:{minHeight:"350px"},children:f?e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-slate-600 border-t-slate-400 rounded-full animate-spin"}),"åŠ è½½ä¸­..."]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-3 bg-slate-800 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"ğŸ“Š"})}),e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"æš‚æ— æ’è¡Œæ¦œæ•°æ®"}),e.jsx("p",{className:"text-slate-500 text-xs",children:"è¯·è°ƒæ•´ç­›é€‰æ¡ä»¶åé‡è¯•"})]})})]})},Ze=({stores:s,theme:n="dark",loading:v=!1,selectedStore:f=null,onStoreClick:x})=>{const{chartData:N,axisRange:w,topStores:j,avgMarketingRate:S,avgProfitMargin:u}=c.useMemo(()=>{if(s.length===0)return{chartData:[],axisRange:{xMin:0,xMax:25,yMin:0,yMax:25},topStores:new Set,avgMarketingRate:0,avgProfitMargin:0};const d=s.reduce((p,O)=>p+O.marketing_cost_rate,0)/s.length,l=s.reduce((p,O)=>p+O.profit_margin,0)/s.length,h=s.map(p=>p.marketing_cost_rate),r=s.map(p=>p.profit_margin),_=Math.min(...h),b=Math.max(...h),C=Math.min(...r),W=Math.max(...r),T=(b-_)*.1||2,k=(W-C)*.1||2,P={xMin:Math.max(0,Math.floor(_-T)),xMax:Math.ceil(b+T),yMin:Math.max(0,Math.floor(C-k)),yMax:Math.ceil(W+k)},I=[...s].sort((p,O)=>O.total_revenue-p.total_revenue),Y=new Set(I.slice(0,5).map(p=>p.store_name)),A=new Set(s.filter(p=>p.anomalies&&p.anomalies.length>0).map(p=>p.store_name)),q=new Set([...Y,...A]);return{chartData:s.map(p=>({name:p.store_name,value:[p.marketing_cost_rate,p.profit_margin,p.total_revenue],showLabel:q.has(p.store_name)||p.store_name===f,itemStyle:{color:p.store_name===f?"#818cf8":p.profit_margin>=l&&p.marketing_cost_rate<=d?"#10b981":p.profit_margin>=l&&p.marketing_cost_rate>d?"#06b6d4":p.profit_margin<l&&p.marketing_cost_rate<=d?"#f59e0b":"#ef4444",borderColor:p.store_name===f?"#fff":"transparent",borderWidth:p.store_name===f?2:0,shadowBlur:p.store_name===f?10:0,shadowColor:p.store_name===f?"rgba(129, 140, 248, 0.5)":"transparent",opacity:.85}})),axisRange:P,topStores:q,avgMarketingRate:d,avgProfitMargin:l}},[s,f]),y=c.useMemo(()=>({title:{text:"é—¨åº—æ•ˆç‡åˆ†æï¼ˆè¥é”€æˆæœ¬ç‡ vs åˆ©æ¶¦ç‡ï¼‰",left:"center",top:10,textStyle:{color:n==="dark"?"#fff":"#1e293b",fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"item",backgroundColor:"rgba(0, 0, 0, 0.8)",borderColor:"rgba(255, 255, 255, 0.2)",textStyle:{color:"#fff"},formatter:d=>{const l=d.data,h=s.find(r=>r.store_name===l.name);return h?`
          <div style="padding: 8px;">
            <div style="font-weight: bold; margin-bottom: 8px;">${h.store_name}</div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>è¥é”€æˆæœ¬ç‡:</span>
              <span style="font-weight: bold;">${h.marketing_cost_rate.toFixed(1)}%</span>
            </div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>åˆ©æ¶¦ç‡:</span>
              <span style="font-weight: bold;">${h.profit_margin.toFixed(1)}%</span>
            </div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>é”€å”®é¢:</span>
              <span style="font-weight: bold;">Â¥${h.total_revenue.toLocaleString()}</span>
            </div>
          </div>
        `:""}},grid:{left:"3%",right:"7%",bottom:"3%",top:60,containLabel:!0},xAxis:{type:"value",name:"è¥é”€æˆæœ¬ç‡ (%)",nameLocation:"middle",nameGap:30,min:w.xMin,max:w.xMax,nameTextStyle:{color:n==="dark"?"#94a3b8":"#64748b",fontSize:12},axisLabel:{color:n==="dark"?"#94a3b8":"#64748b",formatter:"{value}%"},splitLine:{lineStyle:{color:n==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)"}}},yAxis:{type:"value",name:"åˆ©æ¶¦ç‡ (%)",nameLocation:"middle",nameGap:40,min:w.yMin,max:w.yMax,nameTextStyle:{color:n==="dark"?"#94a3b8":"#64748b",fontSize:12},axisLabel:{color:n==="dark"?"#94a3b8":"#64748b",formatter:"{value}%"},splitLine:{lineStyle:{color:n==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)"}}},series:[{type:"scatter",data:N,symbolSize:d=>{const l=Math.max(...s.map(_=>_.total_revenue)),h=8;return h+d[2]/l*(25-h)},label:{show:!0,position:"top",color:n==="dark"?"#fff":"#1e293b",fontSize:9,distance:5,formatter:d=>{if(d.data.showLabel){const l=d.data.name;return l.length>10?l.substring(0,10)+"...":l}return""}},emphasis:{focus:"self",label:{show:!0,fontSize:11,fontWeight:"bold",formatter:d=>d.data.name},itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.3)"}}},{type:"line",markLine:{silent:!0,symbol:"none",lineStyle:{type:"dashed",color:"#6366f1",width:1},label:{show:!0,position:"end",formatter:"å¹³å‡è¥é”€æˆæœ¬ç‡",color:"#6366f1",fontSize:10},data:[{xAxis:S}]}},{type:"line",markLine:{silent:!0,symbol:"none",lineStyle:{type:"dashed",color:"#6366f1",width:1},label:{show:!0,position:"end",formatter:"å¹³å‡åˆ©æ¶¦ç‡",color:"#6366f1",fontSize:10},data:[{yAxis:u}]}}]}),[N,n,s,S,u,w]),i=ke(y,[N,n,s,f],n,d=>{var l;(l=d.data)!=null&&l.name&&x&&x(d.data.name)}),m=!v&&s.length>0&&N.length>0;return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col",children:[e.jsx("div",{ref:i,className:"w-full flex-1",style:{minHeight:"300px",visibility:m?"visible":"hidden",position:m?"relative":"absolute"}}),!m&&e.jsx("div",{className:"w-full flex-1 flex flex-col items-center justify-center",style:{minHeight:"300px"},children:v?e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-slate-600 border-t-slate-400 rounded-full animate-spin"}),"åŠ è½½ä¸­..."]}):e.jsxs("div",{className:"text-center",children:[e.jsx(te,{size:40,className:"mx-auto text-slate-600 mb-3"}),e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"æš‚æ— é—¨åº—æ•ˆç‡æ•°æ®"}),e.jsx("p",{className:"text-slate-500 text-xs",children:"è¯·è°ƒæ•´ç­›é€‰æ¡ä»¶åé‡è¯•"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-slate-400",children:"ä¼˜è´¨é—¨åº—ï¼ˆé«˜åˆ©æ¶¦ä½è¥é”€ï¼‰"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-cyan-500"}),e.jsx("span",{className:"text-slate-400",children:"æ½œåŠ›é—¨åº—ï¼ˆé«˜åˆ©æ¶¦é«˜è¥é”€ï¼‰"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-slate-400",children:"æ”¹è¿›é—¨åº—ï¼ˆä½åˆ©æ¶¦ä½è¥é”€ï¼‰"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-slate-400",children:"äºæŸé—¨åº—ï¼ˆä½åˆ©æ¶¦é«˜è¥é”€ï¼‰"})]})]})]})},ve=[{days:1,label:"æ˜¨æ—¥"},{days:7,label:"è¿‘7å¤©"},{days:15,label:"è¿‘15å¤©"},{days:30,label:"è¿‘30å¤©"}],et=({currentStart:s,currentEnd:n,previousStart:v,previousEnd:f,minDate:x,maxDate:N,onApply:w,onReset:j})=>{var p,O;const[S,u]=c.useState(!1),[y,t]=c.useState(!1),[i,m]=c.useState(),d=c.useRef(null),l=c.useRef(null),h=c.useRef(null),r=c.useRef(null),_=x?U(x,"yyyy-MM-dd",new Date):void 0,b=N?U(N,"yyyy-MM-dd",new Date):void 0,C=s&&n?Fe(U(n,"yyyy-MM-dd",new Date),U(s,"yyyy-MM-dd",new Date))+1:0,W=ve.find(g=>g.days===C),T=!W&&s&&n;c.useEffect(()=>{const g=D=>{const E=D.target;S&&d.current&&!d.current.contains(E)&&h.current&&!h.current.contains(E)&&u(!1),y&&l.current&&!l.current.contains(E)&&r.current&&!r.current.contains(E)&&t(!1)};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[S,y]);const k=c.useCallback(g=>{if(!N)return;const D=U(N,"yyyy-MM-dd",new Date),E=new Date(D);E.setDate(E.getDate()-g+1),w(J(E,"yyyy-MM-dd"),J(D,"yyyy-MM-dd")),u(!1)},[N,w]),P=c.useCallback(g=>{m(g)},[]),I=c.useCallback(()=>{i!=null&&i.from&&(i!=null&&i.to)&&(w(J(i.from,"yyyy-MM-dd"),J(i.to,"yyyy-MM-dd")),t(!1))},[i,w]),Y=c.useCallback(()=>{if(s&&n){const g=U(s,"yyyy-MM-dd",new Date),D=U(n,"yyyy-MM-dd",new Date);me(g)&&me(D)&&m({from:g,to:D})}else m(void 0);t(!0)},[s,n]),A=c.useCallback(g=>!!(_&&Te(g,_)||b&&We(g,b)),[_,b]),q=g=>{if(!g.current)return{top:0,left:0};const D=g.current.getBoundingClientRect();return{top:D.bottom+8,left:D.left}},X=()=>W?W.label:T?`${s} ~ ${n}`:"é€‰æ‹©æ—¥æœŸ";return e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(he,{size:18,className:"text-indigo-400"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"å¯¹æ¯”å‘¨æœŸé€‰æ‹©"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("button",{ref:d,onClick:()=>u(!S),className:"w-full flex items-center justify-between gap-2 px-3 py-2 bg-slate-900 hover:bg-slate-800 border border-slate-600 rounded-lg text-sm text-white transition-all",children:[e.jsx("span",{className:"truncate",children:X()}),e.jsx(_e,{size:14,className:`text-slate-400 transition-transform flex-shrink-0 ${S?"rotate-180":""}`})]}),S&&pe.createPortal(e.jsx("div",{ref:h,style:q(d),className:"fixed w-40 bg-slate-900 border border-white/10 rounded-xl shadow-2xl z-[9999] overflow-hidden animate-fade-in-up",children:ve.map(({days:g,label:D})=>e.jsxs("button",{onClick:()=>k(g),className:`w-full flex items-center justify-between px-4 py-2.5 text-sm transition-colors ${C===g?"bg-emerald-500/20 text-emerald-300":"text-slate-300 hover:bg-white/5"}`,children:[e.jsx("span",{children:D}),C===g&&e.jsx(Ee,{size:14,className:"text-emerald-400"})]},g))}),document.body)]}),e.jsxs("button",{ref:l,onClick:Y,className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-all ${T?"bg-indigo-500/20 border-indigo-500/50 text-indigo-300":"bg-slate-900 border-slate-600 text-slate-400 hover:bg-slate-800 hover:text-white hover:border-slate-500"}`,children:[e.jsx(he,{size:16,className:T?"text-indigo-400":"text-slate-400"}),e.jsx("span",{className:"text-sm",children:"è‡ªå®šä¹‰"})]})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded p-3 text-xs space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"æœ¬æœŸï¼š"}),e.jsxs("span",{className:"text-indigo-300 font-mono",children:[s," ~ ",n]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"ä¸ŠæœŸï¼š"}),e.jsxs("span",{className:"text-emerald-300 font-mono",children:[v," ~ ",f]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:j,className:"flex-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white text-sm rounded transition-colors",children:"é‡ç½®"})})]}),y&&pe.createPortal(e.jsxs("div",{ref:r,style:{top:((p=l.current)==null?void 0:p.getBoundingClientRect().bottom)+8,left:Math.min(((O=l.current)==null?void 0:O.getBoundingClientRect().left)||0,window.innerWidth-620)},className:"fixed z-[9999] p-5 rounded-xl border shadow-2xl bg-slate-900 border-white/10",children:[x&&N&&e.jsx("div",{className:"mb-4 px-3 py-2 bg-indigo-500/10 border border-indigo-500/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-indigo-300",children:["ğŸ“… å¯é€‰æ•°æ®èŒƒå›´: ",x," ~ ",N]})}),e.jsx("style",{children:`
            .calendar-container .rdp-root {
              --rdp-accent-color: #6366f1;
              --rdp-accent-background-color: rgba(99, 102, 241, 0.2);
            }
            .calendar-container .rdp-months {
              display: flex;
              gap: 2rem;
            }
            .calendar-container .rdp-month_caption {
              display: flex;
              justify-content: center;
              align-items: center;
              height: 40px;
              font-weight: 600;
              font-size: 14px;
              color: #f1f5f9;
            }
            .calendar-container .rdp-nav {
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              display: flex;
              justify-content: space-between;
              padding: 0 8px;
            }
            .calendar-container .rdp-button_previous,
            .calendar-container .rdp-button_next {
              width: 32px;
              height: 32px;
              border-radius: 8px;
              background: rgba(255, 255, 255, 0.05);
              color: #94a3b8;
              display: flex;
              align-items: center;
              justify-content: center;
              border: none;
              cursor: pointer;
              transition: all 0.15s;
            }
            .calendar-container .rdp-button_previous:hover,
            .calendar-container .rdp-button_next:hover {
              background: rgba(255, 255, 255, 0.1);
              color: #f1f5f9;
            }
            .calendar-container .rdp-weekday {
              color: #64748b;
              font-size: 12px;
              font-weight: 500;
              padding: 8px 0;
            }
            .calendar-container .rdp-day {
              width: 36px;
              height: 36px;
            }
            .calendar-container .rdp-day button {
              width: 36px;
              height: 36px;
              border-radius: 8px;
              color: #cbd5e1;
              font-weight: 400;
              font-size: 13px;
              transition: all 0.15s;
              border: none;
              background: transparent;
              cursor: pointer;
            }
            .calendar-container .rdp-day button:hover:not(:disabled) {
              background: rgba(255, 255, 255, 0.08);
              color: #f1f5f9;
            }
            .calendar-container .rdp-today button {
              color: #818cf8;
              box-shadow: inset 0 0 0 1px #6366f1;
            }
            .calendar-container .rdp-selected button,
            .calendar-container .rdp-range_start button,
            .calendar-container .rdp-range_end button {
              background: #6366f1 !important;
              color: white !important;
            }
            .calendar-container .rdp-range_middle button {
              background: rgba(99, 102, 241, 0.2) !important;
              color: #a5b4fc !important;
              border-radius: 0 !important;
            }
            .calendar-container .rdp-range_start button {
              border-radius: 8px 0 0 8px !important;
            }
            .calendar-container .rdp-range_end button {
              border-radius: 0 8px 8px 0 !important;
            }
            .calendar-container .rdp-disabled button {
              color: #334155 !important;
              opacity: 0.4;
              cursor: not-allowed !important;
            }
            .calendar-container .rdp-disabled button:hover {
              background: transparent !important;
            }
            .calendar-container .rdp-outside button {
              color: #475569;
              opacity: 0.5;
            }
          `}),e.jsx("div",{className:"calendar-container",children:e.jsx(Pe,{mode:"range",numberOfMonths:2,selected:i,onSelect:P,locale:Ie,disabled:A,defaultMonth:b?new Date(b.getFullYear(),b.getMonth()-1):new Date,startMonth:_,endMonth:b,showOutsideDays:!1,components:{Chevron:({orientation:g})=>g==="left"?e.jsx(Be,{size:18}):e.jsx(Se,{size:18})}})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-slate-400",children:i!=null&&i.from&&(i!=null&&i.to)?e.jsxs("span",{className:"text-emerald-400 font-medium",children:["å·²é€‰: ",J(i.from,"yyyy-MM-dd")," ~ ",J(i.to,"yyyy-MM-dd")]}):i!=null&&i.from?e.jsx("span",{className:"text-amber-400",children:"è¯·é€‰æ‹©ç»“æŸæ—¥æœŸ"}):e.jsx("span",{children:"ç‚¹å‡»é€‰æ‹©å¼€å§‹æ—¥æœŸ"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>t(!1),className:"px-4 py-2 text-sm text-slate-400 hover:text-white transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:I,disabled:!(i!=null&&i.from)||!(i!=null&&i.to),className:"px-5 py-2 bg-indigo-500 text-white rounded-lg text-sm font-medium hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"ç¡®è®¤é€‰æ‹©"})]})]})]}),document.body)]})},tt=({startDate:s,endDate:n,channel:v,theme:f="dark"})=>{const[x,N]=c.useState(null),[w,j]=c.useState(!1),[S,u]=c.useState(null),[y,t]=c.useState(new Set(["overview","anomalies","recommendations"])),i=c.useCallback(async()=>{if(!(!s||!n)){j(!0),u(null);try{const r=await V.getGlobalInsights({start_date:s,end_date:n,channel:v==="all"?void 0:v,include_trends:!0});r.success&&r.data?N(r.data):u(r.message||"è·å–æ´å¯Ÿæ•°æ®å¤±è´¥")}catch(r){console.error("è·å–æ´å¯Ÿæ•°æ®å¤±è´¥:",r),u("è·å–æ´å¯Ÿæ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{j(!1)}}},[s,n,v]);c.useEffect(()=>{i()},[i]);const m=r=>{t(_=>{const b=new Set(_);return b.has(r)?b.delete(r):b.add(r),b})},d=r=>r.replace(/(\d+\.?\d*%)/g,'<span class="text-cyan-400 font-semibold">$1</span>').replace(/(Â¥[\d,]+\.?\d*)/g,'<span class="text-emerald-400 font-semibold">$1</span>').replace(/(\d{1,3}(,\d{3})*(\.\d+)?(?=\s*(å®¶|ç¬”|ä¸ª|æ¡)))/g,'<span class="text-amber-400 font-semibold">$1</span>'),l=({id:r,title:_,icon:b,iconColor:C,children:W})=>{const T=y.has(r);return e.jsxs("div",{className:"border border-slate-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>m(r),className:"w-full flex items-center justify-between p-4 bg-slate-800/50 hover:bg-slate-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:C,children:b}),e.jsx("span",{className:"font-medium text-white",children:_})]}),T?e.jsx(_e,{size:20,className:"text-slate-400"}):e.jsx(Se,{size:20,className:"text-slate-400"})]}),T&&e.jsx("div",{className:"p-4 bg-slate-900/30",children:W})]})},h=({text:r})=>e.jsx("div",{className:"text-slate-300 leading-relaxed whitespace-pre-line text-sm",dangerouslySetInnerHTML:{__html:d(r)}});return w?e.jsx("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-3 py-12",children:[e.jsx(ue,{size:24,className:"text-purple-400 animate-spin"}),e.jsx("span",{className:"text-slate-400",children:"æ­£åœ¨ç”Ÿæˆæ´å¯Ÿåˆ†ææŠ¥å‘Š..."})]})}):S?e.jsx("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-3 py-12 text-red-400",children:[e.jsx(K,{size:24}),e.jsx("span",{children:S})]})}):x?e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(ne,{size:24,className:"text-purple-400"}),"å…¨å±€é—¨åº—æ´å¯Ÿåˆ†æ"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-xs text-slate-500",children:["ç”Ÿæˆæ—¶é—´: ",x.generated_at]}),e.jsxs("button",{onClick:i,disabled:w,className:`flex items-center gap-1.5 px-3 py-1.5 bg-purple-600/20 hover:bg-purple-600/30 \r
                       text-purple-400 rounded-lg text-sm transition-colors disabled:opacity-50`,children:[e.jsx(ue,{size:14,className:w?"animate-spin":""}),"åˆ·æ–°"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{id:"overview",title:"æ•´ä½“æ¦‚å†µ",icon:e.jsx(ge,{size:18}),iconColor:"text-blue-400",children:e.jsx(h,{text:x.overview.summary_text})}),e.jsx(l,{id:"clustering",title:"é—¨åº—åˆ†ç¾¤",icon:e.jsx(Ae,{size:18}),iconColor:"text-green-400",children:e.jsx(h,{text:x.clustering.summary_text})}),e.jsx(l,{id:"anomalies",title:`å¼‚å¸¸æ£€æµ‹ (${x.anomalies.total_anomaly_stores}å®¶)`,icon:e.jsx(K,{size:18}),iconColor:x.anomalies.total_anomaly_stores>0?"text-amber-400":"text-emerald-400",children:e.jsx(h,{text:x.anomalies.summary_text})}),e.jsx(l,{id:"comparison",title:"å¤´å°¾å¯¹æ¯”",icon:e.jsx(Ue,{size:18}),iconColor:"text-indigo-400",children:e.jsx(h,{text:x.head_tail_comparison.summary_text})}),e.jsx(l,{id:"attribution",title:"å½’å› åˆ†æ",icon:e.jsx(fe,{size:18}),iconColor:"text-pink-400",children:e.jsx(h,{text:x.attribution.summary_text})}),e.jsx(l,{id:"trends",title:"è¶‹åŠ¿åˆ†æ",icon:e.jsx(we,{size:18}),iconColor:"text-cyan-400",children:e.jsx(h,{text:x.trends.summary_text})}),x.health_scores&&e.jsx(l,{id:"health",title:`å¥åº·åº¦è¯„åˆ† (å¹³å‡${x.health_scores.avg_score}åˆ†)`,icon:e.jsx(fe,{size:18}),iconColor:"text-emerald-400",children:e.jsx(h,{text:x.health_scores.summary_text})}),x.cost_structure&&e.jsx(l,{id:"cost",title:"æˆæœ¬ç»“æ„åˆ†æ",icon:e.jsx(ge,{size:18}),iconColor:"text-orange-400",children:e.jsx(h,{text:x.cost_structure.summary_text})}),e.jsxs(l,{id:"recommendations",title:`ç­–ç•¥å»ºè®® (${x.recommendations.urgent.length+x.recommendations.important.length+x.recommendations.general.length}æ¡)`,icon:e.jsx(Ge,{size:18}),iconColor:"text-yellow-400",children:[e.jsx(h,{text:x.recommendations.summary_text}),x.recommendations.urgent.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-red-400",children:"ğŸ”´ ç´§æ€¥å»ºè®®"}),x.recommendations.urgent.map((r,_)=>e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3",children:[e.jsx("div",{className:"font-medium text-white text-sm",children:r.title}),e.jsx("div",{className:"text-slate-400 text-xs mt-1",children:r.description}),r.action_items.length>0&&e.jsx("ul",{className:"mt-2 text-xs text-slate-300 list-disc list-inside",children:r.action_items.map((b,C)=>e.jsx("li",{children:b},C))}),r.affected_stores.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:["æ¶‰åŠé—¨åº—: ",r.affected_stores.join(", ")]})]},_))]}),x.recommendations.important.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-amber-400",children:"ğŸŸ  é‡è¦å»ºè®®"}),x.recommendations.important.map((r,_)=>e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/20 rounded-lg p-3",children:[e.jsx("div",{className:"font-medium text-white text-sm",children:r.title}),e.jsx("div",{className:"text-slate-400 text-xs mt-1",children:r.description}),r.action_items.length>0&&e.jsx("ul",{className:"mt-2 text-xs text-slate-300 list-disc list-inside",children:r.action_items.map((b,C)=>e.jsx("li",{children:b},C))})]},_))]})]})]})]}):e.jsx("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-3 py-12 text-slate-400",children:[e.jsx(ne,{size:24}),e.jsx("span",{children:"æš‚æ— æ´å¯Ÿæ•°æ®"})]})})},nt=({theme:s="dark"})=>{const{storeDateRange:n,selectedStore:v}=Ve(),[f,x]=c.useState([]),[N,w]=c.useState([]),[j,S]=c.useState(!1),[u,y]=c.useState("revenue"),[t,i]=c.useState("desc"),[m,d]=c.useState(""),[l,h]=c.useState(""),[r,_]=c.useState("all"),[b,C]=c.useState([]),[W,T]=c.useState(!1),[k,P]=c.useState(()=>{const a=sessionStorage.getItem("excludedStores");return a?JSON.parse(a):[]}),[I,Y]=c.useState(!1),[A,q]=c.useState([]),[X,p]=c.useState(!1),[O,g]=c.useState(null),[D,E]=c.useState(!1),H=c.useRef(""),re=c.useRef(!1);c.useEffect(()=>{if(n!=null&&n.max_date&&!re.current){const a=new Date(n.max_date),o=new Date(a);o.setDate(o.getDate()-6);const M=a.toISOString().split("T")[0],z=o.toISOString().split("T")[0];h(M),d(z),re.current=!0,console.log("ğŸ“… [é—¨åº—å¯¹æ¯”] æ—¥æœŸåˆå§‹åŒ–:",z,"-",M)}},[n==null?void 0:n.max_date]);const le=c.useMemo(()=>{if(!m||!l)return{start:"",end:""};const a=new Date(m),o=new Date(l),M=Math.ceil((o.getTime()-a.getTime())/(1e3*60*60*24))+1,z=new Date(a);z.setDate(z.getDate()-1);const F=new Date(z);return F.setDate(F.getDate()-M+1),{start:F.toISOString().split("T")[0],end:z.toISOString().split("T")[0]}},[m,l]);c.useEffect(()=>{if(!m||!l)return;(async()=>{T(!0);try{const o=await V.getAvailableChannels({start_date:m,end_date:l});o.success&&o.data&&C(o.data)}catch(o){console.error("è·å–å¯ç”¨æ¸ é“åˆ—è¡¨å¤±è´¥:",o)}finally{T(!1)}})()},[m,l]),c.useEffect(()=>{if(!m||!l)return;(async()=>{try{const o=await V.getStoresByChannel({start_date:m,end_date:l,channel:r==="all"?void 0:r});o.success&&o.data&&(q(o.data),P(M=>M.filter(z=>o.data.includes(z))))}catch(o){console.error("è·å–é—¨åº—åˆ—è¡¨å¤±è´¥:",o)}})()},[m,l,r]),c.useEffect(()=>{sessionStorage.setItem("excludedStores",JSON.stringify(k))},[k]);const R=c.useMemo(()=>f.filter(a=>!k.includes(a.store_name)),[f,k]),B=c.useMemo(()=>{if(R.length===0)return{total_stores:0,total_orders:0,total_revenue:0,total_profit:0,avg_profit_margin:0,anomaly_count:0};const a=R.reduce((L,$)=>L+$.order_count,0),o=R.reduce((L,$)=>L+$.total_revenue,0),M=R.reduce((L,$)=>L+$.total_profit,0),z=o>0?M/o*100:0,F=R.filter(L=>L.anomalies&&L.anomalies.length>0).length;return{total_stores:R.length,total_orders:a,total_revenue:o,total_profit:M,avg_profit_margin:z,anomaly_count:F}},[R]),ie=c.useCallback(async()=>{if(!m||!l){console.log("â³ [é—¨åº—å¯¹æ¯”] ç­‰å¾…æ—¥æœŸåˆå§‹åŒ–...");return}const a=new Date(m),o=new Date(l),M=Math.ceil((o.getTime()-a.getTime())/(1e3*60*60*24))+1,z=new Date(a);z.setDate(z.getDate()-1);const F=new Date(z);F.setDate(F.getDate()-M+1);const L=F.toISOString().split("T")[0],$=z.toISOString().split("T")[0],xe=`${m}-${l}-${u}-${t}-${r}`;if(H.current===xe){console.log("ğŸ“¦ [é—¨åº—å¯¹æ¯”] è·³è¿‡é‡å¤è¯·æ±‚");return}H.current=xe,S(!0),console.log("ğŸ”„ [é—¨åº—å¯¹æ¯”] å¼€å§‹åŠ è½½æ•°æ®...");try{const Z={sort_by:u,sort_order:t,start_date:m,end_date:l,channel:r==="all"?void 0:r};console.log("ğŸ” [é—¨åº—å¯¹æ¯”] è¯·æ±‚å‚æ•°:",Z);const[ee,ae]=await Promise.all([V.getComparison(Z),V.getWeekOverWeek(l,L,$,r==="all"?void 0:r)]);ee.success&&ee.data?(console.log("âœ… [é—¨åº—å¯¹æ¯”] é—¨åº—æ•°æ®:",ee.data.stores.length,"ä¸ªé—¨åº—"),x(ee.data.stores)):(console.warn("âš ï¸ [é—¨åº—å¯¹æ¯”] æ— é—¨åº—æ•°æ®"),x([])),ae.success&&ae.data&&w(ae.data.stores)}catch(Z){console.error("âŒ [é—¨åº—å¯¹æ¯”] è·å–æ•°æ®å¤±è´¥:",Z),x([])}finally{S(!1)}},[m,l,u,t,r]);c.useEffect(()=>{ie()},[ie]);const Ce=c.useMemo(()=>R.map(a=>{const o=N.find(M=>M.store_name===a.store_name);return{...a,weekOverWeek:o==null?void 0:o.changes}}),[R,N]),se=c.useMemo(()=>A.length>0?A:f.map(a=>a.store_name).sort(),[A,f]),oe=a=>{P(o=>o.includes(a)?o.filter(M=>M!==a):[...o,a])},Me=()=>{k.length===0?P(se):P([])},ze=(a,o)=>{d(a),h(o),H.current=""},ce=()=>{if(n!=null&&n.max_date){const a=new Date(n.max_date),o=new Date(a);o.setDate(o.getDate()-6),h(a.toISOString().split("T")[0]),d(o.toISOString().split("T")[0]),H.current=""}},de=async a=>{p(!0);try{const o=await V.exportData({start_date:m,end_date:l,channel:r==="all"?void 0:r,format:a});if(o.success&&o.data){const{content:M,filename:z}=o.data;if(a==="csv"){const F=new Blob([M],{type:"text/csv;charset=utf-8;"}),L=URL.createObjectURL(F),$=document.createElement("a");$.href=L,$.download=z,$.click(),URL.revokeObjectURL(L)}else{const F=new Blob([JSON.stringify(M,null,2)],{type:"application/json"}),L=URL.createObjectURL(F),$=document.createElement("a");$.href=L,$.download=z,$.click(),URL.revokeObjectURL(L)}}}catch(o){console.error("å¯¼å‡ºå¤±è´¥:",o)}finally{p(!1)}},De=a=>{g(o=>o===a?null:a)};return e.jsxs("div",{className:"flex flex-col gap-6 w-full",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(te,{size:24,className:"text-indigo-400"}),"å…¨é‡é—¨åº—å¯¹æ¯”åˆ†æ"]}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"å¯¹æ¯”æ‰€æœ‰é—¨åº—çš„å…³é”®æŒ‡æ ‡ï¼Œå‘ç°ä¼˜åŠ£åŠ¿é—¨åº—"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>E(!D),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm transition-colors ${D?"bg-purple-600 text-white":"bg-purple-600/20 hover:bg-purple-600/30 text-purple-400"}`,children:[e.jsx(ne,{size:14}),D?"æ”¶èµ·æ´å¯Ÿ":"ğŸ” å…¨å±€æ´å¯Ÿ"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>de("csv"),disabled:X||j||f.length===0,className:`flex items-center gap-1.5 px-3 py-1.5 bg-emerald-600/20 hover:bg-emerald-600/30 \r
                         text-emerald-400 rounded-lg text-sm transition-colors disabled:opacity-50`,children:[e.jsx(be,{size:14}),"å¯¼å‡ºCSV"]}),e.jsxs("button",{onClick:()=>de("json"),disabled:X||j||f.length===0,className:`flex items-center gap-1.5 px-3 py-1.5 bg-blue-600/20 hover:bg-blue-600/30 \r
                         text-blue-400 rounded-lg text-sm transition-colors disabled:opacity-50`,children:[e.jsx(be,{size:14}),"å¯¼å‡ºJSON"]})]}),v&&e.jsx("div",{className:"text-xs text-amber-400 bg-amber-500/10 px-3 py-2 rounded-lg border border-amber-500/20",children:"ğŸ’¡ å…¨é‡é—¨åº—å¯¹æ¯”æ˜¾ç¤ºæ‰€æœ‰é—¨åº—æ•°æ®ï¼Œä¸å—é¡¶éƒ¨é—¨åº—ç­›é€‰å½±å“"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(et,{currentStart:m,currentEnd:l,previousStart:le.start,previousEnd:le.end,minDate:(n==null?void 0:n.min_date)||void 0,maxDate:(n==null?void 0:n.max_date)||void 0,onApply:ze,onReset:ce}),e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(je,{size:18,className:"text-blue-400"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"æ¸ é“ç­›é€‰"}),W&&e.jsx("span",{className:"text-xs text-slate-500 animate-pulse",children:"åŠ è½½ä¸­..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{selectedChannel:r,channelList:b,onSelect:a=>{_(a),H.current=""},isDark:s==="dark",accentColor:"cyan"}),e.jsx("span",{className:"text-xs text-slate-400 flex-1",children:r==="all"?`æ˜¾ç¤ºæ‰€æœ‰æ¸ é“ (${b.length}ä¸ª)`:`ä»…æ˜¾ç¤º${r}æ¸ é“`})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"ğŸ’¡ åªæ˜¾ç¤ºå½“å‰æ—¥æœŸèŒƒå›´å†…æœ‰æ•°æ®çš„æ¸ é“"})]}),e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{size:18,className:"text-indigo-400"}),e.jsxs("h3",{className:"text-sm font-semibold text-white",children:["æ˜¾ç¤ºé—¨åº— (",R.length,"/",se.length,")"]})]}),e.jsx("button",{onClick:()=>Y(!I),className:"text-xs text-indigo-400 hover:text-indigo-300",children:I?"æ”¶èµ·":"å±•å¼€"})]}),I&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{onClick:Me,className:"text-xs px-3 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors",children:k.length===0?"å…¨éƒ¨å‰”é™¤":"å…¨éƒ¨æ¢å¤"}),k.length>0&&e.jsxs("span",{className:"text-xs text-amber-400 flex items-center",children:["å·²å‰”é™¤ ",k.length," ä¸ªé—¨åº—"]})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto space-y-1 bg-slate-900/50 rounded p-2",children:se.map(a=>e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 hover:bg-slate-800 rounded cursor-pointer text-sm",children:[e.jsx("input",{type:"checkbox",checked:!k.includes(a),onChange:()=>oe(a),className:"w-4 h-4 text-indigo-600 bg-slate-700 border-slate-600 rounded focus:ring-indigo-500"}),e.jsx("span",{className:k.includes(a)?"text-slate-500 line-through":"text-white",children:a})]},a))})]}),!I&&k.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[k.slice(0,3).map(a=>e.jsxs("span",{className:"text-xs px-2 py-1 bg-slate-700 text-slate-300 rounded flex items-center gap-1",children:[a,e.jsx(ye,{size:12,className:"cursor-pointer hover:text-white",onClick:()=>oe(a)})]},a)),k.length>3&&e.jsxs("span",{className:"text-xs px-2 py-1 text-slate-400",children:["+",k.length-3," æ›´å¤š"]})]})]})]}),j&&e.jsxs("div",{className:`fixed top-4 right-4 z-50 bg-indigo-600/90 text-white px-4 py-2 rounded-lg \r
                        flex items-center gap-2 shadow-lg animate-pulse`,children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"æ­£åœ¨åŠ è½½æ•°æ®..."]}),!m&&!l&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-indigo-500/30 border-t-indigo-500 rounded-full animate-spin mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-400 mb-2",children:"æ­£åœ¨åˆå§‹åŒ–..."}),e.jsx("p",{className:"text-sm text-slate-500",children:"æ­£åœ¨è·å–æ—¥æœŸèŒƒå›´"})]}),D&&m&&l&&e.jsx(tt,{startDate:m,endDate:l,channel:r,theme:s}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsx(Q,{title:"æ˜¾ç¤ºé—¨åº—æ•°",value:B.total_stores.toString(),subtext:k.length>0?`å·²å‰”é™¤ ${k.length} ä¸ª`:"å…¨éƒ¨é—¨åº—",icon:e.jsx(te,{size:18}),iconColor:"indigo",theme:s,loading:j,compact:!0}),e.jsx(Q,{title:"æ€»è®¢å•é‡",value:B.total_orders.toLocaleString(),subtext:"è®¢å•",icon:e.jsx(qe,{size:18}),iconColor:"cyan",theme:s,loading:j,compact:!0}),e.jsx(Q,{title:"æ€»é”€å”®é¢",value:`Â¥${B.total_revenue.toLocaleString()}`,subtext:"é”€å”®é¢",icon:e.jsx(He,{size:18}),iconColor:"emerald",theme:s,loading:j,compact:!0}),e.jsx(Q,{title:"æ€»åˆ©æ¶¦",value:`Â¥${B.total_profit.toLocaleString()}`,subtext:"åˆ©æ¶¦",icon:e.jsx(Je,{size:18}),iconColor:"amber",theme:s,loading:j,compact:!0}),e.jsx(Q,{title:"åŠ æƒåˆ©æ¶¦ç‡",value:`${B.avg_profit_margin.toFixed(1)}%`,subtext:"æ€»åˆ©æ¶¦/æ€»é”€å”®é¢",icon:e.jsx(Qe,{size:18}),iconColor:"violet",theme:s,loading:j,compact:!0}),e.jsx(Q,{title:"å¼‚å¸¸é—¨åº—",value:B.anomaly_count.toString(),subtext:B.anomaly_count>0?"éœ€å…³æ³¨":"è¿è¥æ­£å¸¸",icon:e.jsx(K,{size:18}),iconColor:B.anomaly_count>0?"rose":"emerald",theme:s,loading:j,compact:!0})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-[450px]",children:e.jsx(Ke,{stores:R,metric:u,theme:s,loading:j})}),e.jsx("div",{className:"h-[450px]",children:e.jsx(Ze,{stores:R,theme:s,loading:j,selectedStore:O,onStoreClick:De})})]}),O&&e.jsxs("div",{className:"bg-indigo-900/30 border border-indigo-500/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(Ne,{size:20,className:"text-indigo-400"}),O," è¯¦æƒ…"]}),e.jsx("button",{onClick:()=>g(null),className:"text-slate-400 hover:text-white",children:e.jsx(ye,{size:18})})]}),(()=>{const a=R.find(o=>o.store_name===O);return a?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"è®¢å•é‡"}),e.jsx("p",{className:"text-white font-medium",children:a.order_count.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"é”€å”®é¢"}),e.jsxs("p",{className:"text-white font-medium",children:["Â¥",a.total_revenue.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"åˆ©æ¶¦"}),e.jsxs("p",{className:"text-white font-medium",children:["Â¥",a.total_profit.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"åˆ©æ¶¦ç‡"}),e.jsxs("p",{className:`font-medium ${a.profit_margin>=30?"text-emerald-400":a.profit_margin>=20?"text-cyan-400":a.profit_margin>=10?"text-amber-400":"text-red-400"}`,children:[a.profit_margin.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"å®¢å•ä»·"}),e.jsxs("p",{className:"text-white font-medium",children:["Â¥",a.aov.toFixed(1)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"å•å‡é…é€è´¹"}),e.jsxs("p",{className:"text-white font-medium",children:["Â¥",a.avg_delivery_fee.toFixed(1)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"å•å‡è¥é”€è´¹"}),e.jsxs("p",{className:"text-white font-medium",children:["Â¥",a.avg_marketing_cost.toFixed(1)]})]}),a.anomalies&&a.anomalies.length>0&&e.jsx("div",{className:"col-span-full mt-2 space-y-1",children:a.anomalies.map((o,M)=>e.jsxs("div",{className:`text-xs px-3 py-1.5 rounded flex items-center gap-2 ${o.severity==="high"?"bg-red-500/20 text-red-400":o.severity==="medium"?"bg-amber-500/20 text-amber-400":"bg-blue-500/20 text-blue-400"}`,children:[e.jsx(K,{size:12}),o.message]},M))})]}):null})()]}),e.jsx("div",{children:e.jsx(Xe,{stores:Ce,theme:s,loading:j,sortBy:u,sortOrder:t,onSort:(a,o)=>{y(a),i(o),H.current=""},onStoreClick:g})}),!j&&f.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx(te,{size:48,className:"text-slate-600 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-400 mb-2",children:"æš‚æ— é—¨åº—æ•°æ®"}),e.jsx("p",{className:"text-sm text-slate-500 max-w-md",children:"å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ²¡æœ‰æ‰¾åˆ°é—¨åº—æ•°æ®ã€‚è¯·å°è¯•è°ƒæ•´æ—¥æœŸèŒƒå›´æˆ–æ¸ é“ç­›é€‰æ¡ä»¶ã€‚"}),e.jsx("button",{onClick:ce,className:"mt-4 px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-sm transition-colors",children:"é‡ç½®ç­›é€‰æ¡ä»¶"})]})]})};export{nt as default};
