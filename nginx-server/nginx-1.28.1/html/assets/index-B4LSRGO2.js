const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DataManagement-Br_m0sXh.js","assets/react-vendor-BD1vIgCn.js","assets/react-vendor-xiMy4gMA.css","assets/StoreComparisonView-Dtl4c47Z.js","assets/Skeleton-BdAGY13K.js"])))=>i.map(i=>d[i]);
import{a as mt,r as n,j as e,p as he,f as ge,i as Te,b as pt,c as ht,d as Fe,S as gt,C as Ce,e as bt,g as be,h as Ue,D as yt,z as vt,k as Oe,l as _e,u as Dt,Z as wt,L as Et,m as Tt,P as Ot,T as Re,n as At,M as Rt,o as It,U as Pt,q as Ft,A as jt,B as Bt,s as Wt,t as Vt,v as Ut,w as Ht,x as qe,y as ze,E as Ze,F as oe,G as Gt,H as He,I as Kt,J as Ye,X as Nt,R as ue,K as ke,N as qt,O as Yt,Q as Jt,V as Me,W as Ge,Y as Ae,_ as St,$ as Xt,a0 as Zt,a1 as Qt,a2 as es,a3 as ts,a4 as Je,a5 as ss,a6 as as,a7 as rs,a8 as ns,a9 as os,aa as ls,ab as is,ac as Qe,ad as Ke,ae as cs,af as ds,ag as De,ah as xs,ai as ve,aj as us,ak as fs,al as et,am as kt,an as ms,ao as ps}from"./react-vendor-BD1vIgCn.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function l(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=l(r);fetch(r.href,o)}})();const we={getSummary:async(t,a)=>{const l=new URLSearchParams;return t&&l.append("store_name",t),a&&l.append("category",a),(await fe.get(`/inventory-risk/summary?${l.toString()}`)).data.data},getSoldOutProducts:async(t,a,l=1,s=20)=>{const r=new URLSearchParams;t&&r.append("store_name",t),a&&r.append("category",a),r.append("page",l.toString()),r.append("page_size",s.toString());const o=await fe.get(`/inventory-risk/sold-out?${r.toString()}`);return{data:o.data.data,total:o.data.total}},getSlowMovingProducts:async(t,a,l,s=1,r=20)=>{const o=new URLSearchParams;t&&o.append("store_name",t),a&&o.append("category",a),l&&o.append("severity",l),o.append("page",s.toString()),o.append("page_size",r.toString());const i=await fe.get(`/inventory-risk/slow-moving?${o.toString()}`);return{data:i.data.data,total:i.data.total,by_severity:i.data.by_severity}},getCategoryRiskStats:async t=>{const a=new URLSearchParams;return t&&a.append("store_name",t),(await fe.get(`/inventory-risk/category-risk?${a.toString()}`)).data.data},getRiskTrend:async(t,a,l=30)=>{const s=new URLSearchParams;return t&&s.append("store_name",t),a&&s.append("category",a),s.append("days",l.toString()),(await fe.get(`/inventory-risk/trend?${s.toString()}`)).data},getSoldOutAnalysis:async(t,a,l=30)=>{const s=new URLSearchParams;return t&&s.append("store_name",t),a&&s.append("category",a),s.append("days",l.toString()),(await fe.get(`/inventory-risk/sold-out-analysis?${s.toString()}`)).data}},hs={async getPerformanceWithRisk(t){const a=new URLSearchParams;t.store_name&&a.append("store_name",t.store_name),t.parent_category&&a.append("parent_category",t.parent_category),t.channel&&a.append("channel",t.channel);const l=`/category-matrix/with-risk${a.toString()?"?"+a.toString():""}`;return(await fe.get(l)).data},async getPerformance(t){const a=new URLSearchParams;t.store_name&&a.append("store_name",t.store_name),t.parent_category&&a.append("parent_category",t.parent_category),t.channel&&a.append("channel",t.channel),t.start_date&&a.append("start_date",t.start_date),t.end_date&&a.append("end_date",t.end_date);const l=`/category-matrix/performance${a.toString()?"?"+a.toString():""}`;return(await fe.get(l)).data}},Xe="http://localhost:8080/api/v1";console.log("API Base URL:",Xe);const fe=mt.create({baseURL:Xe,timeout:12e4,headers:{"Content-Type":"application/json"}});fe.interceptors.response.use(t=>t,t=>{var a;return console.error("API Error:",t.message,(a=t.config)==null?void 0:a.url),Promise.reject(t)});const Q=mt.create({baseURL:Xe,timeout:12e4,headers:{"Content-Type":"application/json"}});Q.interceptors.response.use(t=>t.data,t=>{var a;return console.error("API Error:",t.message,(a=t.config)==null?void 0:a.url),Promise.reject(t)});const tt={getStats(){return Q.get("/data/stats")},getStores(){return Q.get("/data/stores")},loadFromDatabase(t){return Q.post("/data/database/load",null,{params:t})},uploadOrders(t,a){const l=new FormData;l.append("file",t);const s=new URLSearchParams;return a!=null&&a.mode&&s.append("mode",a.mode),fetch(`/api/v1/data/upload/orders?${s.toString()}`,{method:"POST",body:l}).then(async r=>{const o=await r.json();if(!r.ok)throw new Error(o.detail||"‰∏ä‰º†Â§±Ë¥•");return o})},getStoreStats(t){return Q.get(`/data/store/${encodeURIComponent(t)}/stats`)},deleteStoreData(t){return Q.delete(`/data/store/${encodeURIComponent(t)}`)},clearCache(t){return Q.post("/data/clear-cache",{level:t})},optimizeDatabase(){return Q.post("/data/database/optimize")}},ie={getOverview(t){return Q.get("/orders/overview",{params:t})},getComparison(t){return Q.get("/orders/comparison",{params:t})},getChannelStats(t){return Q.get("/orders/channels",{params:t})},getCostStructure(t){return Q.get("/orders/cost-structure",{params:t})},getTrend(t){return Q.get("/orders/trend",{params:t})},getStores(){return Q.get("/orders/stores")},getChannels(t){return Q.get("/orders/channel-list",{params:t})},getPriceDistribution(t){return Q.get("/orders/price-distribution",{params:t})},getProfitDistribution(t){return Q.get("/orders/profit-distribution",{params:t})},getChannelComparison(t){return Q.get("/orders/channel-comparison",{params:t})},getAnomalyDetection(t){return Q.get("/orders/anomaly-detection",{params:t})},getDateRange(t){return Q.get("/orders/date-range",{params:t})},getCategoryHourlyTrend(t){return Q.get("/orders/category-hourly-trend",{params:t})},getTopProductsByDate(t){return Q.get("/orders/top-products-by-date",{params:t})},getHourlyProfit(t){return Q.get("/orders/hourly-profit",{params:t})},getDistanceAnalysis(t){return Q.get("/orders/distance-analysis",{params:t})},getDeliveryRadar(t){return Q.get("/orders/delivery-radar",{params:t})},getMarketingStructure(t){return Q.get("/orders/marketing-structure",{params:t})},getMarketingTrend(t){return Q.get("/orders/marketing-trend",{params:t})}},Ct=n.createContext(null),gs=(t,a)=>{const l=a||new Date,s=r=>r.toISOString().split("T")[0];switch(t){case"today":return{start:s(l),end:s(l)};case"yesterday":{const r=new Date(l);return r.setDate(l.getDate()-1),{start:s(r),end:s(r)}}case"7days":{const r=new Date(l);return r.setDate(l.getDate()-6),{start:s(r),end:s(l)}}case"30days":{const r=new Date(l);return r.setDate(l.getDate()-29),{start:s(r),end:s(l)}}case"thisWeek":{const r=new Date(l);return r.setDate(l.getDate()-l.getDay()),{start:s(r),end:s(l)}}case"thisMonth":{const r=new Date(l.getFullYear(),l.getMonth(),1);return{start:s(r),end:s(l)}}case"all":return{start:"",end:""};default:return{start:s(l),end:s(l)}}},bs=({children:t})=>{const[a,l]=n.useState([]),[s,r]=n.useState(""),[o,i]=n.useState(!1),[u,p]=n.useState("all"),[f,d]=n.useState([]),[x,m]=n.useState(!1),[c,b]=n.useState({type:"all",start:"",end:""}),[w,h]=n.useState(null),[C,L]=n.useState(!1),[P,T]=n.useState(null),[j,z]=n.useState(!1),[O,E]=n.useState(null),[M,I]=n.useState(null),[H,K]=n.useState(!1),[k,D]=n.useState({database:"checking",redis:"checking",lastCheck:null}),W=n.useCallback(y=>{if(y==="all")b({type:"all",start:"",end:""});else{const g=w!=null&&w.max_date?new Date(w.max_date):new Date,{start:N,end:R}=gs(y,g);b({type:y,start:N,end:R}),console.log(`üìÖ Êó•ÊúüËåÉÂõ¥ËÆ°ÁÆó: ${y}, ÂèÇËÄÉÊó•Êúü: ${g.toISOString().split("T")[0]}, ÁªìÊûú: ${N} ~ ${R}`)}},[w]),v=n.useCallback(async()=>{if(!s){h(null);return}L(!0);try{const y={store_name:s},g=await ie.getDateRange(y);g.success&&(h(g.data),console.log("üìÖ Èó®Â∫óÊï∞ÊçÆÊó•ÊúüËåÉÂõ¥:",g.data))}catch(y){console.error("Ëé∑ÂèñÈó®Â∫óÊó•ÊúüËåÉÂõ¥Â§±Ë¥•:",y),h(null)}finally{L(!1)}},[s]),_=n.useCallback(async()=>{if(!s){d([]);return}m(!0);try{const y=await ie.getChannels({store_name:s});y.success&&y.data&&(d(y.data),u!=="all"&&!y.data.includes(u)&&p("all"),console.log("üì° Ê∏†ÈÅìÂàóË°®Â∑≤Êõ¥Êñ∞:",y.data.length,"‰∏™Ê∏†ÈÅì"))}catch(y){console.error("Ëé∑ÂèñÊ∏†ÈÅìÂàóË°®Â§±Ë¥•:",y),d([])}finally{m(!1)}},[s,u]),F=n.useCallback(y=>{r(y)},[]),A=n.useCallback(async()=>{i(!0);try{const y=await tt.getStores();y.success&&l(y.data)}catch(y){console.error("Ëé∑ÂèñÈó®Â∫óÂàóË°®Â§±Ë¥•:",y),l([])}finally{i(!1)}},[]),S=n.useCallback(async()=>{z(!0);try{const y=await tt.getStats();T(y),D({database:y.database_status==="Â∑≤ËøûÊé•"?"connected":"disconnected",redis:y.redis_status==="Â∑≤ËøûÊé•"?"connected":"disconnected",lastCheck:new Date})}catch(y){console.error("Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•:",y),D({database:"disconnected",redis:"disconnected",lastCheck:new Date})}finally{z(!1)}},[]),V=n.useCallback(async(y=3,g=2e3)=>{let N=null;for(let R=0;R<y;R++)try{await S();return}catch(q){N=q,console.log(`ÈáçËØï ${R+1}/${y} Â§±Ë¥•Ôºå${g}ms ÂêéÂÜçÊ¨°Â∞ùËØï...`),R<y-1&&await new Promise(X=>setTimeout(X,g))}console.error("ÊâÄÊúâÈáçËØïÂùáÂ§±Ë¥•:",N)},[S]),U=n.useCallback(async()=>{if(!s){E(null),I(null),K(!1),console.log("üìä Êú™ÈÄâÊã©Èó®Â∫óÔºå‰∏çÂä†ËΩΩÊï∞ÊçÆ");return}K(!0);try{const y={store_name:s};c.type!=="all"&&c.start&&c.end&&(y.start_date=c.start,y.end_date=c.end),console.log("üìä ËØ∑Ê±ÇËÆ¢ÂçïÊ¶ÇËßà, ÂèÇÊï∞:",y,"Êó•ÊúüÁ±ªÂûã:",c.type);const[g,N]=await Promise.all([ie.getOverview(y),ie.getComparison(y)]);if(g.success?E(g.data):(console.error("‚ùå ËÆ¢ÂçïÊ¶ÇËßàËé∑ÂèñÂ§±Ë¥•:",g),E(null)),N.success&&N.data){const R=N.data.previous;R&&(R.order_count>0||R.total_sales>0||R.total_profit!==0)?(I(N.data),console.log("üìä ÁéØÊØîÊï∞ÊçÆÊúâÊïà:",N.data.period)):(I(null),console.log("üìä ‰∏ä‰∏ÄÂë®ÊúüÊó†Êï∞ÊçÆÔºå‰∏çÊòæÁ§∫ÁéØÊØî"))}else I(null)}catch(y){console.error("‚ùå Ëé∑ÂèñËÆ¢ÂçïÊ¶ÇËßàÂ§±Ë¥•:",y),E(null),I(null)}finally{K(!1)}},[s,c.type,c.start,c.end]),Y=n.useCallback(async()=>{await Promise.all([A(),S(),v(),_()]),await U()},[A,S,v,_,U]);n.useEffect(()=>{A(),V(5,2e3)},[]),n.useEffect(()=>{const y=setInterval(()=>{S()},3e4);return()=>clearInterval(y)},[]),n.useEffect(()=>{v(),_()},[s]),n.useEffect(()=>{U()},[s,c.type,c.start,c.end]);const G={stores:a,selectedStore:s,setSelectedStore:F,storesLoading:o,selectedChannel:u,setSelectedChannel:p,channelList:f,channelListLoading:x,dateRange:c,setDateRange:b,setQuickDateRange:W,storeDateRange:w,storeDateRangeLoading:C,stats:P,statsLoading:j,orderOverview:O,orderComparison:M,orderOverviewLoading:H,systemStatus:k,refreshStores:A,refreshStats:S,refreshOrderOverview:U,refreshStoreDateRange:v,refreshChannelList:_,refreshAll:Y};return e.jsx(Ct.Provider,{value:G,children:t})},ce=()=>{const t=n.useContext(Ct);if(!t)throw new Error("useGlobalContext must be used within GlobalProvider");return t},ys="modulepreload",vs=function(t){return"/"+t},st={},Le=function(a,l,s){let r=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),u=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.allSettled(l.map(p=>{if(p=vs(p),p in st)return;st[p]=!0;const f=p.endsWith(".css"),d=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${d}`))return;const x=document.createElement("link");if(x.rel=f?"stylesheet":ys,f||(x.as="script"),x.crossOrigin="",x.href=p,u&&x.setAttribute("nonce",u),document.head.appendChild(x),f)return new Promise((m,c)=>{x.addEventListener("load",m),x.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(i){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=i,window.dispatchEvent(u),!u.defaultPrevented)throw i}return r.then(i=>{for(const u of i||[])u.status==="rejected"&&o(u.reason);return a().catch(o)})},at=[{type:"all",label:"ÂÖ®ÈÉ®Êó∂Èó¥"},{type:"yesterday",label:"Êò®Êó•"},{type:"7days",label:"Ëøë7Â§©"},{type:"30days",label:"Ëøë30Â§©"},{type:"thisWeek",label:"Êú¨Âë®"},{type:"thisMonth",label:"Êú¨Êúà"}],ws=()=>{var V,U,Y,G;const{stores:t,selectedStore:a,setSelectedStore:l,storesLoading:s,dateRange:r,setQuickDateRange:o,setDateRange:i,storeDateRange:u}=ce(),[p,f]=n.useState(!1),[d,x]=n.useState(!1),[m,c]=n.useState(!1),[b,w]=n.useState(""),[h,C]=n.useState(),L=n.useRef(null),P=n.useRef(null),T=n.useRef(null),j=n.useRef(null),z=n.useRef(null),O=n.useRef(null),E=u!=null&&u.min_date?he(u.min_date,"yyyy-MM-dd",new Date):void 0,M=u!=null&&u.max_date?he(u.max_date,"yyyy-MM-dd",new Date):void 0;n.useEffect(()=>{const y=g=>{const N=g.target;p&&L.current&&!L.current.contains(N)&&j.current&&!j.current.contains(N)&&f(!1),d&&P.current&&!P.current.contains(N)&&z.current&&!z.current.contains(N)&&x(!1),m&&T.current&&!T.current.contains(N)&&O.current&&!O.current.contains(N)&&c(!1)};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[p,d,m]);const I=y=>y.replace(/\s*\([0-9,]+Âçï\)\s*$/,"").trim(),H=t.filter(y=>I(y.label).toLowerCase().includes(b.toLowerCase())),K=a?I(((V=t.find(y=>y.value===a))==null?void 0:V.label)||a):"ÈÄâÊã©Èó®Â∫ó",k=r.type==="custom"?`${r.start} ~ ${r.end}`:((U=at.find(y=>y.type===r.type))==null?void 0:U.label)||"ÂÖ®ÈÉ®",D=n.useCallback(y=>{l(y),f(!1),w("")},[l]),W=n.useCallback(y=>{o(y),x(!1)},[o]),v=n.useCallback(y=>{C(y)},[]),_=n.useCallback(()=>{h!=null&&h.from&&(h!=null&&h.to)&&(i({type:"custom",start:ge(h.from,"yyyy-MM-dd"),end:ge(h.to,"yyyy-MM-dd")}),c(!1))},[h,i]),F=n.useCallback(()=>{if(r.type==="custom"&&r.start&&r.end){const y=he(r.start,"yyyy-MM-dd",new Date),g=he(r.end,"yyyy-MM-dd",new Date);Te(y)&&Te(g)&&C({from:y,to:g})}else C(void 0);c(!0)},[r]),A=n.useCallback(y=>!!(E&&pt(y,E)||M&&ht(y,M)),[E,M]),S=y=>{if(!y.current)return{top:0,left:0};const g=y.current.getBoundingClientRect();return{top:g.bottom+8,left:g.left}};return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:L,onClick:()=>f(!p),className:"flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-sm text-white transition-all",children:[e.jsx(gt,{size:16,className:"text-indigo-400"}),e.jsx("span",{className:"max-w-[120px] truncate",children:K}),e.jsx(Ce,{size:14,className:`text-slate-400 transition-transform ${p?"rotate-180":""}`})]}),p&&Fe.createPortal(e.jsxs("div",{ref:j,style:S(L),className:"fixed w-64 bg-slate-900 border border-white/10 rounded-xl shadow-2xl z-[9999] overflow-hidden animate-fade-in-up",children:[e.jsx("div",{className:"p-2 border-b border-white/10",children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white/5 rounded-lg",children:[e.jsx(bt,{size:14,className:"text-slate-400"}),e.jsx("input",{type:"text",placeholder:"ÊêúÁ¥¢Èó®Â∫ó...",value:b,onChange:y=>w(y.target.value),className:"flex-1 bg-transparent text-sm text-white placeholder-slate-500 outline-none",autoFocus:!0})]})}),e.jsxs("div",{className:"max-h-64 overflow-y-auto custom-scrollbar",children:[e.jsx("div",{className:"px-4 py-2 text-xs text-slate-500 border-b border-white/5",children:"ËØ∑ÈÄâÊã©‰∏Ä‰∏™Èó®Â∫óÊü•ÁúãÊï∞ÊçÆ"}),s?e.jsx("div",{className:"px-4 py-8 text-center text-slate-500 text-sm",children:"Âä†ËΩΩ‰∏≠..."}):H.length===0?e.jsx("div",{className:"px-4 py-8 text-center text-slate-500 text-sm",children:b?"Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÈó®Â∫ó":"ÊöÇÊó†Èó®Â∫óÊï∞ÊçÆ"}):H.map(y=>e.jsxs("button",{onClick:()=>D(y.value),className:`w-full flex items-center justify-between px-4 py-2.5 text-sm transition-colors ${a===y.value?"bg-indigo-500/20 text-indigo-300":"text-slate-300 hover:bg-white/5"}`,children:[e.jsx("span",{children:I(y.label)}),a===y.value&&e.jsx(be,{size:14,className:"text-indigo-400"})]},y.value))]})]}),document.body)]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:P,onClick:()=>x(!d),className:"flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-sm text-white transition-all",children:[e.jsx(Ue,{size:16,className:"text-emerald-400"}),e.jsx("span",{className:"max-w-[180px] truncate",children:k}),e.jsx(Ce,{size:14,className:`text-slate-400 transition-transform ${d?"rotate-180":""}`})]}),d&&Fe.createPortal(e.jsx("div",{ref:z,style:S(P),className:"fixed w-40 bg-slate-900 border border-white/10 rounded-xl shadow-2xl z-[9999] overflow-hidden animate-fade-in-up",children:at.map(({type:y,label:g})=>e.jsxs("button",{onClick:()=>W(y),className:`w-full flex items-center justify-between px-4 py-2.5 text-sm transition-colors ${r.type===y?"bg-emerald-500/20 text-emerald-300":"text-slate-300 hover:bg-white/5"}`,children:[e.jsx("span",{children:g}),r.type===y&&e.jsx(be,{size:14,className:"text-emerald-400"})]},y))}),document.body)]}),e.jsxs("button",{ref:T,onClick:F,className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-all ${r.type==="custom"?"bg-indigo-500/20 border-indigo-500/50 text-indigo-300":"bg-white/5 border-white/10 text-slate-400 hover:bg-white/10 hover:text-white hover:border-white/20"}`,children:[e.jsx(Ue,{size:16,className:r.type==="custom"?"text-indigo-400":"text-slate-400"}),e.jsx("span",{className:"text-sm",children:"Ëá™ÂÆö‰πâ"})]}),m&&Fe.createPortal(e.jsxs("div",{ref:O,style:{top:((Y=T.current)==null?void 0:Y.getBoundingClientRect().bottom)+8,left:Math.min(((G=T.current)==null?void 0:G.getBoundingClientRect().left)||0,window.innerWidth-620)},className:"fixed z-[9999] p-5 rounded-xl border shadow-2xl bg-slate-900 border-white/10",children:[(u==null?void 0:u.min_date)&&(u==null?void 0:u.max_date)&&e.jsx("div",{className:"mb-4 px-3 py-2 bg-indigo-500/10 border border-indigo-500/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-indigo-300",children:["üìÖ ÂèØÈÄâÊï∞ÊçÆËåÉÂõ¥: ",u.min_date," ~ ",u.max_date]})}),e.jsx("style",{children:`
            .calendar-container .rdp-root {
              --rdp-accent-color: #6366f1;
              --rdp-accent-background-color: rgba(99, 102, 241, 0.2);
            }
            .calendar-container .rdp-months {
              display: flex;
              gap: 2rem;
            }
            .calendar-container .rdp-month_caption {
              display: flex;
              justify-content: center;
              align-items: center;
              height: 40px;
              font-weight: 600;
              font-size: 14px;
              color: #f1f5f9;
            }
            .calendar-container .rdp-nav {
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              display: flex;
              justify-content: space-between;
              padding: 0 8px;
            }
            .calendar-container .rdp-button_previous,
            .calendar-container .rdp-button_next {
              width: 32px;
              height: 32px;
              border-radius: 8px;
              background: rgba(255, 255, 255, 0.05);
              color: #94a3b8;
              display: flex;
              align-items: center;
              justify-content: center;
              border: none;
              cursor: pointer;
              transition: all 0.15s;
            }
            .calendar-container .rdp-button_previous:hover,
            .calendar-container .rdp-button_next:hover {
              background: rgba(255, 255, 255, 0.1);
              color: #f1f5f9;
            }
            .calendar-container .rdp-weekday {
              color: #64748b;
              font-size: 12px;
              font-weight: 500;
              padding: 8px 0;
            }
            .calendar-container .rdp-day {
              width: 36px;
              height: 36px;
            }
            .calendar-container .rdp-day button {
              width: 36px;
              height: 36px;
              border-radius: 8px;
              color: #cbd5e1;
              font-weight: 400;
              font-size: 13px;
              transition: all 0.15s;
              border: none;
              background: transparent;
              cursor: pointer;
            }
            .calendar-container .rdp-day button:hover:not(:disabled) {
              background: rgba(255, 255, 255, 0.08);
              color: #f1f5f9;
            }
            .calendar-container .rdp-today button {
              color: #818cf8;
              box-shadow: inset 0 0 0 1px #6366f1;
            }
            .calendar-container .rdp-selected button,
            .calendar-container .rdp-range_start button,
            .calendar-container .rdp-range_end button {
              background: #6366f1 !important;
              color: white !important;
            }
            .calendar-container .rdp-range_middle button {
              background: rgba(99, 102, 241, 0.2) !important;
              color: #a5b4fc !important;
              border-radius: 0 !important;
            }
            .calendar-container .rdp-range_start button {
              border-radius: 8px 0 0 8px !important;
            }
            .calendar-container .rdp-range_end button {
              border-radius: 0 8px 8px 0 !important;
            }
            .calendar-container .rdp-disabled button {
              color: #334155 !important;
              opacity: 0.4;
              cursor: not-allowed !important;
            }
            .calendar-container .rdp-disabled button:hover {
              background: transparent !important;
            }
            .calendar-container .rdp-outside button {
              color: #475569;
              opacity: 0.5;
            }
          `}),e.jsx("div",{className:"calendar-container",children:e.jsx(yt,{mode:"range",numberOfMonths:2,selected:h,onSelect:v,locale:vt,disabled:A,defaultMonth:M?new Date(M.getFullYear(),M.getMonth()-1):new Date,startMonth:E,endMonth:M,showOutsideDays:!1,components:{Chevron:({orientation:y})=>y==="left"?e.jsx(Oe,{size:18}):e.jsx(_e,{size:18})}})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-slate-400",children:h!=null&&h.from&&(h!=null&&h.to)?e.jsxs("span",{className:"text-emerald-400 font-medium",children:["Â∑≤ÈÄâ: ",ge(h.from,"yyyy-MM-dd")," ~ ",ge(h.to,"yyyy-MM-dd")]}):h!=null&&h.from?e.jsx("span",{className:"text-amber-400",children:"ËØ∑ÈÄâÊã©ÁªìÊùüÊó•Êúü"}):e.jsx("span",{children:"ÁÇπÂáªÈÄâÊã©ÂºÄÂßãÊó•Êúü"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 text-sm text-slate-400 hover:text-white transition-colors",children:"ÂèñÊ∂à"}),e.jsx("button",{onClick:_,disabled:!(h!=null&&h.from)||!(h!=null&&h.to),className:"px-5 py-2 bg-indigo-500 text-white rounded-lg text-sm font-medium hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Á°ÆËÆ§ÈÄâÊã©"})]})]})]}),document.body)]})},rt=new Set,js=t=>{if(!rt.has(t))switch(rt.add(t),t){case"/data":Le(()=>import("./DataManagement-Br_m0sXh.js"),__vite__mapDeps([0,1,2]));break;case"/stores":Le(()=>import("./StoreComparisonView-Dtl4c47Z.js"),__vite__mapDeps([3,1,2]));break}},Ns=({children:t,theme:a,onToggleTheme:l})=>{const s=Dt(),{systemStatus:r}=ce(),[o,i]=n.useState(!1),u=()=>r.database==="checking"?"CHECKING...":r.database==="disconnected"?"DB OFFLINE":r.redis==="disconnected"?"CACHE OFFLINE":"ONLINE",p=r.database==="connected";return e.jsxs("div",{className:"flex min-h-screen font-sans selection:bg-neon-purple selection:text-white relative transition-colors duration-500",children:[e.jsxs("aside",{className:"hidden md:flex flex-col glass-panel border-r border-white/5 sticky top-0 h-screen z-40",style:{width:o?"80px":"256px",transition:"width 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsxs("div",{className:"h-20 flex items-center border-b border-white/5 overflow-hidden",style:{paddingLeft:o?"0":"24px",justifyContent:o?"center":"flex-start",transition:"padding 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsxs("div",{className:"relative group cursor-pointer flex-shrink-0",children:[e.jsx("div",{className:"absolute inset-0 bg-neon-purple blur-lg opacity-20 group-hover:opacity-40 transition-opacity"}),e.jsx("div",{className:"relative bg-gradient-to-br from-indigo-600 to-purple-700 w-9 h-9 rounded-xl flex items-center justify-center shadow-lg border border-white/10 group-hover:scale-105 transition-transform",children:e.jsx(wt,{size:20,className:"text-white fill-current"})})]}),e.jsxs("div",{className:"ml-3 overflow-hidden whitespace-nowrap",style:{opacity:o?0:1,width:o?0:"auto",transition:"opacity 0.25s ease, width 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsxs("span",{className:"font-bold text-xl tracking-tight text-white font-mono",children:["O2O",e.jsx("span",{className:"text-neon-purple",children:"Dashboard"})]}),e.jsx("div",{className:"text-[10px] text-slate-400 uppercase tracking-widest",children:"React v1.0"})]})]}),e.jsxs("nav",{className:"flex-1 py-8 space-y-2 px-3 overflow-hidden",children:[e.jsx(je,{to:"/",icon:e.jsx(Et,{size:20}),label:"ÁªèËê•ÊÄªËßà",active:s.pathname==="/",collapsed:o}),e.jsx(je,{to:"/stores",icon:e.jsx(gt,{size:20}),label:"ÂÖ®ÈáèÈó®Â∫óÂØπÊØî",active:s.pathname==="/stores",collapsed:o}),e.jsx(je,{to:"/data",icon:e.jsx(Tt,{size:20}),label:"Êï∞ÊçÆÁÆ°ÁêÜ",active:s.pathname==="/data",collapsed:o}),e.jsx(je,{to:"/channels",icon:e.jsx(Ot,{size:20}),label:"Ê∏†ÈÅìÂàÜÊûê",active:s.pathname==="/channels",collapsed:o}),e.jsx(je,{to:"/trends",icon:e.jsx(Re,{size:20}),label:"Ë∂ãÂäøÊ¥ûÂØü",active:s.pathname==="/trends",collapsed:o}),e.jsx("div",{className:"my-4 border-t border-white/5 mx-2"}),e.jsx(je,{to:"/settings",icon:e.jsx(At,{size:20}),label:"Á≥ªÁªüËÆæÁΩÆ",active:s.pathname==="/settings",collapsed:o})]}),e.jsxs("div",{className:"p-4 border-t border-white/5 bg-gradient-to-t from-slate-900/10 to-transparent overflow-hidden",children:[e.jsxs("button",{onClick:l,className:"w-full flex items-center gap-3 p-2 mb-4 rounded-lg bg-white/5 hover:bg-white/10 border border-white/5 transition-colors group",style:{justifyContent:o?"center":"flex-start"},children:[e.jsx("div",{className:`p-1.5 rounded-md flex-shrink-0 ${a==="dark"?"bg-indigo-500 text-white":"text-slate-400"}`,children:e.jsx(Rt,{size:14})}),e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden whitespace-nowrap",style:{opacity:o?0:1,width:o?0:"auto",transition:"opacity 0.25s ease, width 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsx("div",{className:`p-1.5 rounded-md ${a==="light"?"bg-amber-400 text-white":"text-slate-400"}`,children:e.jsx(It,{size:14})}),e.jsx("span",{className:"text-xs font-medium text-slate-400 group-hover:text-white",children:a==="dark"?"Presentation":"Workstation"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",style:{justifyContent:o?"center":"flex-start",paddingLeft:o?0:"8px"},children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-slate-800 flex items-center justify-center border border-white/10 shadow-inner ring-1 ring-white/5 flex-shrink-0",children:e.jsx(Pt,{size:16,className:"text-slate-300"})}),e.jsxs("div",{className:"overflow-hidden whitespace-nowrap",style:{opacity:o?0:1,width:o?0:"auto",transition:"opacity 0.25s ease, width 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsx("p",{className:"text-sm font-bold text-slate-100",children:"Admin User"}),e.jsx("p",{className:"text-xs text-neon-cyan font-mono",children:"OPERATOR_LVL_5"})]})]}),e.jsxs("button",{onClick:()=>i(!o),className:"w-full mt-4 flex items-center justify-center gap-2 p-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/5 text-slate-400 hover:text-white group",style:{transition:"all 0.2s ease"},children:[e.jsx("div",{style:{transform:o?"rotate(0deg)":"rotate(180deg)",transition:"transform 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:e.jsx(_e,{size:16})}),e.jsx("span",{className:"text-xs overflow-hidden whitespace-nowrap",style:{opacity:o?0:1,width:o?0:"auto",transition:"opacity 0.25s ease, width 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:"Êî∂Ëµ∑‰æßÊ†è"})]})]})]}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0 overflow-hidden relative z-10",children:[e.jsxs("header",{className:"h-20 bg-transparent flex items-center justify-between px-6 md:px-8 sticky top-0 z-30 backdrop-blur-sm",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-white tracking-wide",children:"ÂÖ®Ê∏†ÈÅìÁªèËê•Â§çÁõòÁúãÊùø"}),e.jsxs("p",{className:`text-xs font-mono mt-0.5 opacity-70 flex items-center gap-1.5 ${p?"text-slate-400":"text-amber-400"}`,children:[p?e.jsx(Ft,{size:10,className:"text-emerald-400"}):e.jsx(jt,{size:10,className:"text-amber-400"}),"SYSTEM: ",u()]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ws,{}),e.jsxs("div",{className:`hidden sm:flex items-center gap-2 glass-panel px-4 py-1.5 rounded-full border text-xs shadow-lg ${p?"border-white/10 text-neon-cyan":"border-amber-500/30 text-amber-400"}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full animate-pulse ${p?"bg-neon-cyan":"bg-amber-400"}`}),e.jsx("span",{className:"font-mono",children:p?"LIVE_DATA":"OFFLINE"})]}),e.jsxs("button",{className:"relative p-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-full text-slate-300 hover:text-white transition-all hover:shadow-[0_0_15px_rgba(255,255,255,0.1)] group",children:[e.jsx(Bt,{size:20,className:"group-hover:rotate-12 transition-transform"}),e.jsx("span",{className:"absolute top-0 right-0 w-2.5 h-2.5 bg-neon-rose rounded-full border-2 border-slate-900"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 md:p-8 z-10 custom-scrollbar",children:e.jsx("div",{className:"w-full h-full flex flex-col gap-8 pb-10",children:t})})]})]})},je=({to:t,icon:a,label:l,active:s=!1,collapsed:r=!1})=>{const o=n.useCallback(()=>{js(t)},[t]);return e.jsxs(Wt,{to:t,className:`relative group w-full flex items-center gap-3 px-3 py-3 rounded-xl overflow-hidden ${s?"text-white shadow-[0_0_20px_rgba(139,92,246,0.15)] bg-white/5":"text-slate-400 hover:text-white"}`,style:{justifyContent:r?"center":"flex-start",transition:"all 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},title:r?l:void 0,onMouseEnter:o,children:[s&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-neon-purple rounded-full shadow-[0_0_10px_#a78bfa]"}),!s&&e.jsx("div",{className:"absolute inset-0 bg-white/0 group-hover:bg-white/5 transition-colors"}),e.jsx("div",{className:`relative z-10 flex-shrink-0 transition-transform group-hover:scale-110 ${s?"text-neon-purple":"group-hover:text-slate-200"}`,children:a}),e.jsx("span",{className:"relative z-10 text-sm font-medium tracking-wide whitespace-nowrap overflow-hidden",style:{opacity:r?0:1,width:r?0:"auto",transition:"opacity 0.25s ease, width 0.35s cubic-bezier(0.4, 0, 0.2, 1)"},children:l}),r&&e.jsxs("div",{className:"absolute left-full ml-2 px-3 py-1.5 bg-slate-800 text-white text-xs font-medium rounded-lg shadow-xl border border-white/10 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50",children:[l,e.jsx("div",{className:"absolute left-0 top-1/2 -translate-x-1 -translate-y-1/2 w-2 h-2 bg-slate-800 rotate-45 border-l border-b border-white/10"})]})]})},Ss=(t,a=1500)=>{const[l,s]=n.useState(t);return n.useEffect(()=>{if(t==="-"||t==="0"||!t){s(t);return}const r=parseFloat(t.replace(/[^0-9.-]/g,""));if(isNaN(r)){s(t);return}const o=t.includes("¬•")?"¬•":"",i=t.includes("k")?"k":"",u=t.includes("."),p=r<0;let f=null,d,x=!1;const m=w=>{if(x)return;f||(f=w);const h=Math.min((w-f)/a,1),C=1-Math.pow(1-h,5),L=Math.abs(r)*C,P=u?L.toFixed(1):Math.round(L).toLocaleString();s(`${o}${p?"-":""}${P}${i}`),h<1?d=requestAnimationFrame(m):s(t)},c=`${o}${p?"-":""}0${i}`;s(c);const b=setTimeout(()=>{d=requestAnimationFrame(m)},16);return()=>{x=!0,clearTimeout(b),d&&cancelAnimationFrame(d)}},[t,a]),l},nt={emerald:"bg-emerald-500/10 text-emerald-400 border-emerald-500/20",indigo:"bg-indigo-500/10 text-indigo-400 border-indigo-500/20",violet:"bg-violet-500/10 text-violet-400 border-violet-500/20",amber:"bg-amber-500/10 text-amber-400 border-amber-500/20",cyan:"bg-cyan-500/10 text-cyan-400 border-cyan-500/20",rose:"bg-rose-500/10 text-rose-400 border-rose-500/20"},ot={emerald:"bg-emerald-600",indigo:"bg-indigo-600",violet:"bg-violet-600",amber:"bg-amber-600",cyan:"bg-cyan-600",rose:"bg-rose-600"},Ne=({title:t,value:a,change:l,subtext:s,icon:r,trendColor:o="green",iconColor:i,theme:u="dark",loading:p=!1,compact:f=!1,isPercentChange:d=!1})=>{const x=l!==void 0,m=x?l>=0:!0,b=Ss(p?"-":a),w=u==="dark",h=i||(o==="red"?"rose":"emerald"),C=nt[h]||nt.emerald,L=ot[h]||ot.emerald,P=w?"text-white":"text-slate-900",T=w?"text-slate-400":"text-slate-500",j=f?"p-4":"p-6",z=f?"text-[10px]":"text-[11px]",O=f?"text-xl":"text-3xl",E=f?"p-2":"p-3",M=()=>x?d?`${l>=0?"+":""}${l.toFixed(1)}pp`:`${l>=0?"+":""}${l.toFixed(1)}%`:"";return e.jsx("div",{className:"relative group rounded-2xl transition-all duration-500 hover:shadow-[0_10px_40px_-10px_rgba(0,0,0,0.5)]",children:e.jsxs("div",{className:`glass-panel rounded-2xl ${j} h-full relative overflow-hidden transition-colors ${w?"group-hover:border-white/10":"group-hover:border-black/5"}`,children:[e.jsx("div",{className:`absolute top-0 bottom-0 left-0 w-1/2 bg-gradient-to-r from-transparent ${w?"via-white/5":"via-black/5"} to-transparent skew-x-[-15deg] animate-shimmer pointer-events-none`}),e.jsx("div",{className:`absolute -top-10 -right-10 w-32 h-32 rounded-full blur-[60px] opacity-0 transition-all duration-700 group-hover:opacity-15 group-hover:scale-110 ${L}`}),e.jsxs("div",{className:"flex justify-between items-start mb-3 relative z-10",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`${z} font-bold uppercase tracking-widest mb-1 font-mono ${T} truncate`,children:t}),p?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Vt,{size:f?16:24,className:`animate-spin ${T}`})}):e.jsx("h3",{className:`${O} font-bold font-mono tracking-tight drop-shadow-lg tabular-nums ${P} truncate`,children:b})]}),e.jsx("div",{className:`${E} rounded-xl border backdrop-blur-md transition-transform duration-300 group-hover:rotate-6 ${C} flex-shrink-0`,children:r})]}),e.jsxs("div",{className:"flex items-center justify-between relative z-10 mt-2",children:[x?e.jsxs("div",{className:`flex items-center text-[10px] font-bold px-2 py-0.5 rounded-md border backdrop-blur-sm ${m?"bg-emerald-500/5 text-emerald-400 border-emerald-500/20":"bg-rose-500/5 text-rose-400 border-rose-500/20"}`,children:[m?e.jsx(Ut,{size:12,className:"mr-0.5"}):e.jsx(Ht,{size:12,className:"mr-0.5"}),e.jsx("span",{className:"font-mono",children:M()})]}):e.jsx("div",{className:`flex items-center text-[10px] font-medium px-2 py-0.5 rounded-md border backdrop-blur-sm ${w?"bg-slate-500/5 text-slate-400 border-slate-500/20":"bg-slate-100 text-slate-500 border-slate-200"}`,children:e.jsx("span",{className:"font-mono",children:"Êó†Êï∞ÊçÆ"})}),e.jsxs("div",{className:`flex items-center gap-1 text-[10px] font-medium tracking-wide ${T}`,children:[e.jsx(qe,{size:10,className:"opacity-50"}),s]})]})]})})};function ks(t,a=100,l="date"){if(!t||t.length<=a)return t;const s=Math.ceil(t.length/a),r=[];for(let o=0;o<t.length;o+=s){const i=t.slice(o,Math.min(o+s,t.length)),u=Math.floor(i.length/2);r.push(i[u])}return r[0]!==t[0]&&r.unshift(t[0]),r[r.length-1]!==t[t.length-1]&&r.push(t[t.length-1]),console.log(`üìä Êï∞ÊçÆÈááÊ†∑: ${t.length} -> ${r.length} ÁÇπ (${((1-r.length/t.length)*100).toFixed(1)}% ÂáèÂ∞ë)`),r}function Cs(t,a=1e3){if(!t||t.length<=a)return t;const l=[],s=t.length/a;for(let r=0;r<a;r++){const o=Math.floor(r*s);l.push(t[o])}return console.log(`üìä Êï£ÁÇπÂõæÈááÊ†∑: ${t.length} -> ${l.length} ÁÇπ`),l}function lt(t,a=100){return t>a}let it=!1;const ct=()=>{it||(Ze("neon-cyber",{backgroundColor:"transparent",textStyle:{fontFamily:"JetBrains Mono, Inter, sans-serif"},title:{textStyle:{color:"#f8fafc"},subtextStyle:{color:"#94a3b8"}},line:{itemStyle:{borderWidth:2},lineStyle:{width:3},symbolSize:8,symbol:"circle",smooth:!0},categoryAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#94a3b8",fontSize:11},splitLine:{show:!1}},valueAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#64748b",fontSize:10},splitLine:{show:!0,lineStyle:{color:"rgba(255,255,255,0.05)",type:"dashed"}}},tooltip:{backgroundColor:"rgba(15, 23, 42, 0.95)",borderColor:"rgba(255, 255, 255, 0.1)",textStyle:{color:"#f8fafc"},padding:12,extraCssText:"backdrop-filter: blur(10px); border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);"}}),Ze("clean-light",{backgroundColor:"transparent",textStyle:{fontFamily:"JetBrains Mono, Inter, sans-serif"},title:{textStyle:{color:"#0f172a"},subtextStyle:{color:"#64748b"}},line:{itemStyle:{borderWidth:2},lineStyle:{width:3},symbolSize:8,symbol:"circle",smooth:!0},categoryAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#64748b",fontSize:11},splitLine:{show:!1}},valueAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#64748b",fontSize:10},splitLine:{show:!0,lineStyle:{color:"rgba(0,0,0,0.06)",type:"dashed"}}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"rgba(0, 0, 0, 0.1)",textStyle:{color:"#0f172a"},padding:12,extraCssText:"backdrop-filter: blur(10px); border-radius: 8px; box-shadow: 0 10px 20px rgba(0,0,0,0.1);"}}),it=!0)};function dt(t,a){let l=null;return(...s)=>{l&&clearTimeout(l),l=setTimeout(()=>t(...s),a)}}const me=(t,a,l="dark",s,r=!0)=>{const o=n.useRef(null),i=n.useRef(null),u=n.useRef(!1),p=n.useRef(null),f=n.useRef(null),d=n.useCallback(m=>{if(!r)return m;const c={...m},b=c.series;return Array.isArray(b)&&(c.series=b.map(w=>{if(!Array.isArray(w.data)||w.data.length===0)return w;const h=w.data.length;return w.type==="line"&&lt(h,100)?{...w,data:ks(w.data,100)}:w.type==="scatter"&&lt(h,1e3)?{...w,data:Cs(w.data,1e3)}:w})),c},[r]),x=n.useCallback(()=>{if(!(u.current||!i.current))try{if(!o.current||!document.body.contains(o.current))return;i.current.resize({animation:{duration:200,easing:"cubicOut"}})}catch(m){console.debug("[useChart] Resize skipped:",m)}},[]);return n.useEffect(()=>{if(!o.current)return;ct();const m=l==="light"?"clean-light":"neon-cyber";if(i.current){try{i.current.dispose()}catch(c){console.debug("[useChart] Dispose error:",c)}i.current=null}return u.current=!1,i.current=ze(o.current,m,{renderer:"canvas",useDirtyRect:!0}),s&&i.current.on("click",s),f.current=dt(x,100),p.current=new ResizeObserver(()=>{var c;(c=f.current)==null||c.call(f)}),p.current.observe(o.current),()=>{if(u.current=!0,p.current&&(p.current.disconnect(),p.current=null),i.current){try{i.current.off("click"),i.current.dispose()}catch(c){console.debug("[useChart] Cleanup error:",c)}i.current=null}}},[l,x]),n.useEffect(()=>{if(console.log("[useChart] Êõ¥Êñ∞ effect Ëß¶Âèë, chartRef:",!!o.current,"chartInstance:",!!i.current),o.current&&!i.current&&!u.current){console.log("[useChart] Âª∂ËøüÂàõÂª∫ÂõæË°®ÂÆû‰æã"),ct();const h=l==="light"?"clean-light":"neon-cyber";i.current=ze(o.current,h,{renderer:"canvas",useDirtyRect:!0}),p.current||(f.current=dt(x,100),p.current=new ResizeObserver(()=>{var C;(C=f.current)==null||C.call(f)}),p.current.observe(o.current)),s&&i.current.on("click",s)}if(u.current||!i.current){console.log("[useChart] Ë∑≥ËøáÊõ¥Êñ∞: isDisposed=",u.current,"chartInstance=",!!i.current);return}const m=Object.keys(t||{});if(m.length===0){console.log("[useChart] Ë∑≥ËøáÊõ¥Êñ∞: Á©∫ÂØπË±°");return}const c=t==null?void 0:t.series;if(Array.isArray(c)&&c.length===0){console.log("[useChart] Ë∑≥ËøáÊõ¥Êñ∞: Á©∫ series Êï∞ÁªÑ");return}const b=m.some(h=>h!=="series"&&t[h]!==void 0);if(!Array.isArray(c)&&!b){console.log("[useChart] Ë∑≥ËøáÊõ¥Êñ∞: Êó† series ‰∏îÊó†ÂÖ∂‰ªñÈÖçÁΩÆ");return}const w=Array.isArray(c)&&c.some(h=>{if(!Array.isArray(h.data)||h.data.length===0)return!1;const C=h.data[0];return C==null?!1:typeof C=="object"&&"value"in C?C.value!==void 0&&C.value!==null:!0});if(console.log("[useChart] Êï∞ÊçÆÊ£ÄÊü•: seriesCount=",c==null?void 0:c.length,"hasData=",w),Array.isArray(c)&&c.length>0&&!w){console.log("[useChart] Ë∑≥ËøáÊõ¥Êñ∞: Êúâ series ‰ΩÜÊó†Êï∞ÊçÆ");return}try{console.log("[useChart] ÊâßË°å setOption, seriesCount:",c==null?void 0:c.length);const h=d(t);i.current.setOption(h,{notMerge:!0,lazyUpdate:!1,silent:!1}),console.log("[useChart] setOption ÂÆåÊàê")}catch(h){console.error("[useChart] setOption error:",h)}requestAnimationFrame(()=>{if(!u.current&&i.current)try{i.current.resize()}catch(h){console.debug("[useChart] resize error:",h)}})},[t,l,x,d,...a]),n.useEffect(()=>{if(!(u.current||!i.current))return i.current.off("click"),s&&i.current.on("click",s),()=>{i.current&&i.current.off("click")}},[s]),o},xt={ÈÖçÈÄÅË¥πÂáèÂÖç:"#f43f5e",Êª°ÂáèÈáëÈ¢ù:"#f59e0b",ÂïÜÂìÅÂáèÂÖç:"#eab308",ÂïÜÂÆ∂‰ª£ÈáëÂà∏:"#22c55e",ÂïÜÂÆ∂ÊâøÊãÖÂà∏:"#14b8a6",Êª°Ëµ†ÈáëÈ¢ù:"#3b82f6",ÂïÜÂÆ∂ÂÖ∂‰ªñ‰ºòÊÉ†:"#8b5cf6",Êñ∞ÂÆ¢ÂáèÂÖç:"#ec4899"},Be=[["delivery_discount","ÈÖçÈÄÅË¥πÂáèÂÖç"],["full_reduction","Êª°ÂáèÈáëÈ¢ù"],["product_discount","ÂïÜÂìÅÂáèÂÖç"],["merchant_voucher","ÂïÜÂÆ∂‰ª£ÈáëÂà∏"],["merchant_share","ÂïÜÂÆ∂ÊâøÊãÖÂà∏"],["gift_amount","Êª°Ëµ†ÈáëÈ¢ù"],["other_discount","ÂïÜÂÆ∂ÂÖ∂‰ªñ‰ºòÊÉ†"],["new_customer_discount","Êñ∞ÂÆ¢ÂáèÂÖç"]];function _s(t,a,l){const s=[],r=[],o="#6366f1",i=new Set,u=new Set;return t.forEach(p=>{const f=p.marketing_costs;let d=!1;Be.forEach(([x,m])=>{f[x]>0&&(d=!0,u.add(m))}),d&&i.add(p.channel)}),t.forEach(p=>{i.has(p.channel)&&s.push({name:p.channel,itemStyle:{color:o,opacity:1,borderColor:l,shadowBlur:10,shadowColor:o},label:{position:"left"}})}),Be.forEach(([,p])=>{if(u.has(p)){const f=xt[p];s.push({name:p,itemStyle:{color:f,borderColor:"#fff",borderWidth:1,shadowBlur:15,shadowColor:f},label:{position:"right"}})}}),t.forEach(p=>{if(!i.has(p.channel))return;const f=p.marketing_costs;Be.forEach(([d,x])=>{const m=f[d];if(m>0){const c=xt[x];r.push({source:p.channel,target:x,value:m,lineStyle:{color:new oe(0,0,1,0,[{offset:0,color:o},{offset:1,color:c}]),opacity:.4,curveness:.5}})}})}),{nodes:s,links:r}}const $s=({data:t,theme:a})=>{const l=a==="dark",s=l?"#cbd5e1":"#475569",r=l?"#fff":"#0f172a",o=l?"#a5b4fc":"#6366f1",{nodes:i,links:u}=n.useMemo(()=>_s(t,l,o),[t,l,o]),p=n.useMemo(()=>!i.length||!u.length?{series:[]}:{backgroundColor:"transparent",tooltip:{trigger:"item",triggerOn:"mousemove",backgroundColor:l?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:l?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",padding:12,extraCssText:"backdrop-filter: blur(10px);",textStyle:{color:l?"#f8fafc":"#0f172a",fontFamily:"JetBrains Mono",fontSize:12},formatter:d=>{var x;return!d||!d.data?"":d.dataType==="node"?`<b>${d.data.name}</b>`:d.dataType==="edge"?`${d.data.source} ‚Üí ${d.data.target}<br/>¬•${((x=d.data.value)==null?void 0:x.toLocaleString())||0}`:""}},series:[{type:"sankey",left:120,right:100,top:20,bottom:20,nodeAlign:"justify",draggable:!1,data:i,links:u,emphasis:{focus:"adjacency"},label:{color:s,fontSize:11,fontFamily:"Inter"},lineStyle:{color:"source",curveness:.5},itemStyle:{borderWidth:0}}]},[i,u,l,s]),f=me(p,[i,u,a],a);return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col relative group",children:[e.jsxs("div",{className:"mb-2 shrink-0 relative z-10 pointer-events-none",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:r},children:[e.jsx("span",{className:"w-1 h-5 bg-neon-blue rounded-full shadow-[0_0_10px_#60a5fa]"}),"Ëê•ÈîÄÊàêÊú¨ÁªìÊûÑ"]}),e.jsx("p",{className:"text-xs mt-1 font-mono uppercase tracking-wider opacity-70",style:{color:s},children:"MARKETING COST FLOW: CHANNEL ‚Üí TYPE"})]}),e.jsx("div",{className:"flex-1 w-full min-h-[300px] relative z-0",children:e.jsx("div",{ref:f,className:"w-full h-full"})})]})},zs=({storeName:t,channel:a,theme:l,selectedDate:s,selectedDateRange:r})=>{const[o,i]=n.useState(null),[u,p]=n.useState(!0),f=n.useRef(null),d=n.useRef(null),{dateRange:x}=ce(),m=l==="dark",c=m?"#64748b":"#94a3b8",b=m?"#fff":"#0f172a",w=m?"#94a3b8":"#64748b",h=m?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",C=s||void 0;n.useEffect(()=>{(async()=>{p(!0);try{const z={store_name:t,channel:a};C?z.target_date=C:r?(z.start_date=r.start,z.end_date=r.end):x.type!=="all"&&x.start&&x.end&&(z.start_date=x.start,z.end_date=x.end),console.log("üìä ÂàÜÊó∂ÊÆµËØäÊñ≠ËØ∑Ê±ÇÂèÇÊï∞:",z,"| dateRange:",x);const O=await ie.getHourlyProfit(z);O.success&&O.data&&(i(O.data),console.log("üìä ÂàÜÊó∂ÊÆµËØäÊñ≠ËøîÂõûÊï∞ÊçÆ:",O.data.date))}catch(z){console.error("Ëé∑ÂèñÂàÜÊó∂Âà©Ê∂¶Êï∞ÊçÆÂ§±Ë¥•:",z)}finally{p(!1)}})()},[t,a,C,r,x.type,x.start,x.end]),n.useEffect(()=>{if(!f.current||!o)return;d.current||(d.current=ze(f.current,m?"dark":void 0));const{hours:j,orders:z,profits:O,avg_profits:E,peak_periods:M}=o,I=M&&M.length>0?M.map(k=>[{xAxis:j[k.start_hour]||`${k.start_hour}:00`,itemStyle:{color:m?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.03)"}},{xAxis:j[Math.min(k.end_hour+1,23)]||`${k.end_hour+1}:00`}]):[],H={backgroundColor:"transparent",grid:{top:35,right:45,bottom:25,left:40,containLabel:!0},tooltip:{trigger:"axis",backgroundColor:m?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:m?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:16,textStyle:{fontFamily:"JetBrains Mono",color:m?"#fff":"#0f172a",fontSize:12},axisPointer:{type:"shadow"},formatter:k=>{var _;const D=((_=k[0])==null?void 0:_.axisValue)||"";let W=`<div style="font-weight:600;margin-bottom:8px;font-size:13px">${D}</div>`;k.forEach(F=>{const A=F.value,S=F.seriesName==="ÂáÄÂà©Ê∂¶"?A>=0?"#22c55e":"#f43f5e":F.color;W+=`<div style="display:flex;justify-content:space-between;align-items:center;margin:4px 0">
              <span style="display:flex;align-items:center;gap:6px">
                <span style="width:8px;height:8px;border-radius:50%;background:${S}"></span>
                ${F.seriesName}
              </span>
              <span style="font-weight:600;margin-left:20px">${F.seriesName==="ÂáÄÂà©Ê∂¶"?`¬•${A.toFixed(2)}`:A}</span>
            </div>`});const v=j.indexOf(D);if(v>=0&&z[v]>0){const F=E[v],A=F>=0?"#22c55e":"#f43f5e";W+=`<div style="border-top:1px solid ${m?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"};margin-top:8px;padding-top:8px">
              <span style="color:${m?"#94a3b8":"#64748b"}">ÂçïÂùáÂà©Ê∂¶:</span>
              <span style="font-weight:600;color:${A};margin-left:8px">¬•${F.toFixed(2)}</span>
            </div>`}return W}},legend:{data:["ËÆ¢ÂçïÊï∞","ÂáÄÂà©Ê∂¶"],top:2,right:5,textStyle:{color:c,fontSize:10},itemWidth:10,itemHeight:10,itemGap:12,itemStyle:{}},xAxis:{type:"category",data:j,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:c,fontSize:10,interval:2,formatter:k=>k.replace(":00","")}},yAxis:[{type:"value",name:"",position:"left",splitLine:{lineStyle:{color:h,type:"dashed"}},axisLabel:{color:c,fontSize:10},nameTextStyle:{color:c,fontSize:10}},{type:"value",name:"",position:"right",splitLine:{show:!1},axisLabel:{color:c,fontSize:10,formatter:k=>`¬•${k}`},nameTextStyle:{color:c,fontSize:10}}],series:[{name:"ËÆ¢ÂçïÊï∞",type:"bar",data:z,barWidth:12,itemStyle:{borderRadius:[3,3,0,0],color:new oe(0,0,0,1,[{offset:0,color:m?"rgba(139, 92, 246, 0.8)":"rgba(139, 92, 246, 0.7)"},{offset:1,color:m?"rgba(139, 92, 246, 0.2)":"rgba(139, 92, 246, 0.1)"}])},markArea:I.length>0?{silent:!0,data:I}:void 0},{name:"ÂáÄÂà©Ê∂¶",type:"line",yAxisIndex:1,data:O,smooth:.3,symbol:"circle",symbolSize:6,itemStyle:{color:"#22c55e"},lineStyle:{width:2.5,color:"#22c55e",shadowColor:"rgba(34, 197, 94, 0.3)",shadowBlur:8},areaStyle:{color:new oe(0,0,0,1,[{offset:0,color:"rgba(34, 197, 94, 0.25)"},{offset:.5,color:"rgba(34, 197, 94, 0.05)"},{offset:1,color:"rgba(244, 63, 94, 0.15)"}])},markLine:{silent:!0,symbol:"none",lineStyle:{color:m?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.1)",type:"dashed",width:1},data:[{yAxis:0}],label:{show:!1}}}]};d.current.setOption(H,!0);const K=()=>{var k;(k=d.current)==null||k.resize()};return window.addEventListener("resize",K),()=>{window.removeEventListener("resize",K)}},[o,m,c,h]),n.useEffect(()=>{d.current&&(d.current.dispose(),d.current=null)},[l]),n.useEffect(()=>()=>{d.current&&(d.current.dispose(),d.current=null)},[]);const L=n.useMemo(()=>{if(o!=null&&o.date){if(o.date.includes("~")){const j=o.date.split("~").map(z=>z.trim());return j.length===2&&j[0]&&j[1]?`${j[0].slice(5)} ~ ${j[1].slice(5)}`:o.date}return o.date.slice(5)}return null},[o==null?void 0:o.date]),P=o&&o.orders&&o.orders.some(j=>j>0),T=r!=null;return e.jsxs("div",{className:"glass-panel rounded-2xl p-4 h-full flex flex-col relative",children:[e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-emerald-500/5 to-transparent pointer-events-none rounded-b-2xl"}),e.jsxs("div",{className:"mb-2 relative z-10",children:[e.jsxs("h3",{className:"text-base font-bold flex items-center gap-2",style:{color:b},children:[e.jsx("span",{className:"w-1 h-4 bg-gradient-to-b from-emerald-400 to-emerald-600 rounded-full"}),L?`${L} ÂàÜÊó∂ÊÆµËØäÊñ≠`:"ÂàÜÊó∂ÊÆµËØäÊñ≠",(s||T)&&e.jsx("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded-full bg-emerald-500/20 text-emerald-400 ml-1",children:"Â∑≤ËÅîÂä®"})]}),e.jsx("p",{className:"text-[10px] mt-0.5 font-mono uppercase tracking-wider opacity-70",style:{color:w},children:"HOURLY PROFIT ANALYSIS"})]}),e.jsx("div",{className:"flex-1 w-full min-h-0",children:u?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-sm",style:{color:w},children:"Âä†ËΩΩ‰∏≠..."})}):P?e.jsx("div",{ref:f,className:"w-full h-full"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"text-sm",style:{color:w},children:"ÊöÇÊó†Êï∞ÊçÆ"})})})]})},Ms={indigo:{bg:"bg-indigo-500/20",text:"text-indigo-300",icon:"text-indigo-400"},pink:{bg:"bg-pink-500/20",text:"text-pink-300",icon:"text-pink-400"},cyan:{bg:"bg-cyan-500/20",text:"text-cyan-300",icon:"text-cyan-400"},emerald:{bg:"bg-emerald-500/20",text:"text-emerald-300",icon:"text-emerald-400"}},_t=({selectedChannel:t,channelList:a,onSelect:l,isDark:s,accentColor:r="indigo"})=>{const[o,i]=n.useState(!1),u=n.useRef(null),p=n.useRef(null),f=Ms[r];n.useEffect(()=>{const x=m=>{const c=m.target;o&&u.current&&!u.current.contains(c)&&p.current&&!p.current.contains(c)&&i(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[o]);const d=t==="all"?"ÂÖ®ÈÉ®Ê∏†ÈÅì":t;return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:u,onClick:()=>i(!o),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-medium transition-all duration-200 ${s?"bg-white/5 hover:bg-white/10 border-white/10 text-slate-300":"bg-black/5 hover:bg-black/10 border-black/10 text-slate-600"}`,children:[e.jsx(Gt,{size:12,className:f.icon}),e.jsx("span",{className:"max-w-[80px] truncate",children:d}),e.jsx(Ce,{size:12,className:`text-slate-400 transition-transform ${o?"rotate-180":""}`})]}),o&&e.jsx("div",{ref:p,className:`absolute top-full right-0 mt-2 w-40 rounded-xl border shadow-2xl z-50 overflow-hidden animate-fade-in-up ${s?"bg-slate-900 border-white/10":"bg-white border-black/10"}`,children:e.jsxs("div",{className:"max-h-64 overflow-y-auto custom-scrollbar",children:[e.jsxs("button",{onClick:()=>{l("all"),i(!1)},className:`w-full flex items-center justify-between px-4 py-2.5 text-xs transition-colors ${t==="all"?`${f.bg} ${f.text}`:s?"text-slate-300 hover:bg-white/5":"text-slate-600 hover:bg-black/5"}`,children:[e.jsx("span",{children:"ÂÖ®ÈÉ®Ê∏†ÈÅì"}),t==="all"&&e.jsx(be,{size:12,className:f.icon})]}),a.map(x=>e.jsxs("button",{onClick:()=>{l(x),i(!1)},className:`w-full flex items-center justify-between px-4 py-2.5 text-xs transition-colors ${t===x?`${f.bg} ${f.text}`:s?"text-slate-300 hover:bg-white/5":"text-slate-600 hover:bg-black/5"}`,children:[e.jsx("span",{children:x}),t===x&&e.jsx(be,{size:12,className:f.icon})]},x))]})})]})},Ls=({data:t,theme:a,onDateSelect:l,selectedDate:s,selectedDateRange:r})=>{const[o,i]=n.useState(!1),[u,p]=n.useState(null),[f,d]=n.useState(!1),{selectedStore:x,dateRange:m,selectedChannel:c,setSelectedChannel:b,channelList:w}=ce(),h=a==="dark",C=h?"#64748b":"#94a3b8",L=h?"#fff":"#0f172a",P=h?"#94a3b8":"#64748b",T=h?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)";n.useEffect(()=>{(async()=>{if(!x){p(null);return}d(!0);try{const _={store_name:x,channel:c==="all"?void 0:c,granularity:"day"};m.type!=="all"&&m.start&&m.end?(_.start_date=m.start,_.end_date=m.end):_.days=30;const F=await ie.getTrend(_);F.success&&F.data&&p(F.data)}catch(_){console.error("Ëé∑ÂèñË∂ãÂäøÊï∞ÊçÆÂ§±Ë¥•:",_)}finally{d(!1)}})()},[x,c,m.type,m.start,m.end]);const j=(v,_,F)=>{if(v.length===0)return[];const A=v.filter(y=>y>0);if(A.length===0)return[];const S=A.reduce((y,g)=>y+g,0)/A.length,V=A.reduce((y,g)=>y+Math.pow(g-S,2),0)/A.length,U=Math.sqrt(V),Y=S-U,G=[];return v.forEach((y,g)=>{y<Y&&y>0&&G.push({name:"Profit Rate Low",xAxis:_[g],yAxis:F[g],value:`${y.toFixed(1)}%`,itemStyle:{color:"#f43f5e"}})}),G},{categories:z,fullDates:O,values:E,anomalies:M,profitRates:I,avgValues:H}=n.useMemo(()=>{if(u&&u.dates.length>0){const Y=u.dates.map((X,re)=>{var ne,xe;return{date:X.slice(5),fullDate:X,revenue:u.amounts[re]||0,profit:u.profits[re]||0,orders:u.order_counts[re]||0,profitRate:((ne=u.profit_rates)==null?void 0:ne[re])||0,avgValue:((xe=u.avg_values)==null?void 0:xe[re])||0}}),G=Y.map(X=>X.profitRate),y=Y.map(X=>X.avgValue),g=Y.map(X=>X.date),N=Y.map(X=>X.fullDate),R=Y.map(X=>X.revenue),q=j(G,g,R);return{categories:g,fullDates:N,values:Y,anomalies:q,profitRates:G,avgValues:y}}let v=[];t.length>0&&(v=t[0].dailyTrend.map(G=>({date:G.date,fullDate:G.date,revenue:0,profit:0,orders:0,profitRate:0,avgValue:0})),t.forEach(G=>{G.dailyTrend.forEach((y,g)=>{v[g]&&(v[g].revenue+=y.revenue,v[g].profit+=y.profit,v[g].orders+=y.orders)})}),v.forEach(G=>{G.profitRate=G.revenue>0?G.profit/G.revenue*100:0,G.avgValue=G.orders>0?G.revenue/G.orders:0}));const _=v.map(Y=>Y.profitRate),F=v.map(Y=>Y.avgValue),A=v.map(Y=>Y.date),S=v.map(Y=>Y.fullDate),V=v.map(Y=>Y.revenue),U=j(_,A,V);return{categories:A,fullDates:S,values:v,anomalies:U,profitRates:_,avgValues:F}},[t,u]),K=n.useCallback(v=>{if(l&&v.dataIndex!==void 0){const _=z.length,F=O[v.dataIndex];s===F?l(null,void 0,_):l(F,v.dataIndex,_)}},[l,s,z.length,O]);n.useMemo(()=>Math.max(...E.map(v=>v.revenue),1e3),[E]);const k=n.useMemo(()=>{const v=E.map(N=>N.revenue),_=E.map(N=>N.profit),F=E.map(N=>N.orders),A=I,S=Math.max(...v,1e3),V=Math.max(..._,100),U=Math.ceil(V*3/100)*100,Y=Math.max(...F,10),G=Math.ceil(Y*1.3/10)*10,y=Math.max(...A,10),g=Math.ceil(y*2.2/10)*10;return{revenueMax:S,profitMax:U,ordersMax:G,rateMax:Math.max(g,100)}},[E,I]),D={grid:{top:30,right:50,bottom:40,left:50,containLabel:!1},tooltip:{trigger:"axis",backgroundColor:h?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:h?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:16,textStyle:{fontFamily:"JetBrains Mono",color:h?"#fff":"#0f172a"},axisPointer:{type:"cross",label:{backgroundColor:"#6366f1"},lineStyle:{type:"dashed",color:"#6366f1"}},formatter:v=>{var A;if(!Array.isArray(v))return"";const _=v.filter(S=>S.seriesName!=="HitBox");if(_.length===0)return"";let F=`<div style="font-weight:bold;margin-bottom:8px">${(A=_[0])==null?void 0:A.axisValue}</div>`;return _.forEach(S=>{var U;let V="";S.seriesName==="Âà©Ê∂¶Áéá"?V=`${(U=S.value)==null?void 0:U.toFixed(1)}%`:S.seriesName==="ËÆ¢ÂçïÊï∞"?V=`${S.value}`:V=`¬•${(S.value||0).toLocaleString()}`,F+=`<div style="display:flex;justify-content:space-between;gap:16px">
            <span>${S.marker}${S.seriesName}</span>
            <span style="font-weight:bold">${V}</span>
          </div>`}),F}},legend:{data:["ÈîÄÂîÆÈ¢ù","ÊÄªÂà©Ê∂¶","Âà©Ê∂¶Áéá","ËÆ¢ÂçïÊï∞"],bottom:0,textStyle:{color:C,fontSize:10},itemGap:16,icon:"circle",itemWidth:10,itemHeight:10},xAxis:{type:"category",data:z,boundaryGap:!0,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:C,fontSize:10,fontFamily:"JetBrains Mono"}},yAxis:[{type:"value",name:"",splitLine:{lineStyle:{color:T,type:"dashed"}},axisLabel:{color:C,fontSize:10,formatter:v=>`¬•${v/1e3}k`}},{type:"value",name:"",position:"right",min:0,max:k.rateMax,splitLine:{show:!1},axisLabel:{color:C,fontSize:10,formatter:"{value}%"}},{type:"value",name:"",position:"left",show:!1,splitLine:{show:!1},min:0,max:100},{type:"value",name:"",position:"left",show:!1,splitLine:{show:!1},min:0,max:k.profitMax},{type:"value",name:"",position:"left",show:!1,splitLine:{show:!1},min:0,max:k.ordersMax}],series:[{name:"HitBox",type:"bar",yAxisIndex:2,data:E.map(()=>100),barWidth:"80%",barGap:"-100%",z:10,itemStyle:{color:"transparent"},tooltip:{show:!1},silent:!1},{name:"ËÆ¢ÂçïÊï∞",type:"bar",yAxisIndex:4,data:E.map(v=>{const _=r?v.fullDate>=r.start&&v.fullDate<=r.end:!1,F=s&&v.fullDate===s,A=_||F;return{value:v.orders,itemStyle:s||r?{borderRadius:[2,2,0,0],color:A?new oe(0,0,0,1,[{offset:0,color:_?"#34d399":"#818cf8"},{offset:1,color:_?"#059669":"#6366f1"}]):new oe(0,0,0,1,[{offset:0,color:h?"rgba(71, 85, 105, 0.2)":"rgba(71, 85, 105, 0.15)"},{offset:1,color:h?"rgba(51, 65, 85, 0.05)":"rgba(71, 85, 105, 0.02)"}]),shadowBlur:A?15:0,shadowColor:A?_?"rgba(52, 211, 153, 0.5)":"rgba(99, 102, 241, 0.5)":"transparent"}:{borderRadius:[2,2,0,0],color:new oe(0,0,0,1,[{offset:0,color:h?"rgba(71, 85, 105, 0.55)":"rgba(71, 85, 105, 0.35)"},{offset:1,color:h?"rgba(51, 65, 85, 0.15)":"rgba(71, 85, 105, 0.05)"}])}}}),emphasis:{itemStyle:{color:new oe(0,0,0,1,[{offset:0,color:h?"rgba(148, 163, 184, 0.95)":"rgba(100, 116, 139, 0.7)"},{offset:1,color:h?"rgba(100, 116, 139, 0.4)":"rgba(100, 116, 139, 0.2)"}]),shadowColor:h?"rgba(148, 163, 184, 0.4)":"rgba(100, 116, 139, 0.3)",shadowBlur:12}},barWidth:"60%",barGap:"-100%",z:1},{name:"ÊÄªÂà©Ê∂¶",type:"line",smooth:.4,symbol:"none",showSymbol:!1,yAxisIndex:3,itemStyle:{color:"#22c55e"},lineStyle:{width:2.5,color:"#22c55e",opacity:s?.3:1,shadowColor:"rgba(34, 197, 94, 0.7)",shadowBlur:10,shadowOffsetY:-4},emphasis:{focus:"series",itemStyle:{color:"#22c55e",borderColor:"#fff",borderWidth:2},lineStyle:{width:3,shadowBlur:14,shadowOffsetY:-5}},data:E.map(v=>v.profit),z:2},{name:"Âà©Ê∂¶Áéá",type:"line",smooth:.4,symbol:"none",showSymbol:!1,yAxisIndex:1,itemStyle:{color:"#fbbf24"},lineStyle:{width:2,color:"#fbbf24",type:[5,5],opacity:s?.3:1},emphasis:{focus:"series",itemStyle:{color:"#fbbf24",borderColor:"#fff",borderWidth:2},lineStyle:{width:2.5,type:"solid"}},data:I,z:3},{name:"ÈîÄÂîÆÈ¢ù",type:"line",smooth:.4,symbol:"none",showSymbol:!1,yAxisIndex:0,itemStyle:{color:h?"#f8fafc":"#334155"},lineStyle:{width:3,color:h?"#f8fafc":"#334155",opacity:s?.3:1,shadowColor:h?"rgba(255, 255, 255, 0.8)":"rgba(51, 65, 85, 0.5)",shadowBlur:20,shadowOffsetY:0},areaStyle:{opacity:s?.05:.2,color:new oe(0,0,0,1,[{offset:0,color:"rgba(74, 144, 226, 0.3)"},{offset:1,color:"rgba(74, 144, 226, 0.05)"}])},emphasis:{focus:"series",itemStyle:{color:"#fff",borderColor:"#818cf8",borderWidth:2,shadowColor:"rgba(129, 140, 248, 0.5)",shadowBlur:10},lineStyle:{width:4}},data:E.map(v=>v.revenue),markPoint:o&&M.length>0?{data:M.filter(v=>v.xAxis!==void 0&&v.yAxis!==void 0&&!isNaN(v.yAxis)).map(v=>({name:v.name,coord:[v.xAxis,v.yAxis],itemStyle:v.itemStyle})),symbol:"pin",symbolSize:40,label:{show:!0,fontSize:8,formatter:"!"},animation:!0,animationDuration:800,animationEasing:"elasticOut"}:void 0,z:3}]},W=me(D,[t,o,a,u,c,s,r,k],a,K);return e.jsxs("div",{className:`glass-panel rounded-2xl p-6 h-full flex flex-col relative overflow-hidden group transition-all duration-300 ${s?"border-indigo-500/50 shadow-[0_0_30px_rgba(99,102,241,0.15)]":""}`,children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-24 bg-gradient-to-b from-indigo-500/5 to-transparent pointer-events-none"}),e.jsxs("div",{className:"mb-2 flex justify-between items-start relative z-10",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:L},children:[e.jsx("span",{className:"w-1 h-5 bg-gradient-to-b from-indigo-400 to-indigo-600 rounded-full shadow-[0_0_10px_#818cf8]"}),"ÈîÄÂîÆË∂ãÂäøÂàÜÊûê",s&&e.jsx("span",{className:"text-xs bg-indigo-500 text-white px-2 py-0.5 rounded-md font-mono ml-2",children:s.slice(5)})]}),e.jsxs("p",{className:"text-xs mt-1 font-mono uppercase tracking-widest opacity-70 flex items-center gap-1",style:{color:P},children:[c==="all"?"ÂÖ®ÈÉ®Ê∏†ÈÅì":c," ¬∑ Âê´Âà©Ê∂¶Áéá",l&&e.jsx("span",{className:"ml-2 text-indigo-400",children:"| ÁÇπÂáªÊü±Â≠ê‰∏ãÈíª"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_t,{selectedChannel:c,channelList:w,onSelect:b,isDark:h}),e.jsxs("button",{onClick:()=>i(!o),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-medium transition-all duration-300 ${o?"bg-rose-500/10 border-rose-500/30 text-rose-300 shadow-[0_0_15px_rgba(244,63,94,0.2)]":h?"bg-slate-800/50 border-white/5 text-slate-400 hover:text-white":"bg-white/50 border-black/5 text-slate-600 hover:text-slate-900"}`,children:[o?e.jsx(He,{size:14,className:"animate-pulse"}):e.jsx(He,{size:14}),o?"ÂºÇÂ∏∏ ON":"ÂºÇÂ∏∏ OFF"]})]})]}),f&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 z-20 rounded-2xl",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"})}),e.jsx("div",{className:"flex-1 w-full min-h-[350px] relative cursor-pointer",children:e.jsx("div",{ref:W,className:"absolute inset-0 w-full h-full"})})]})},Ds=({isOpen:t,onClose:a,itemName:l,riskType:s,data:r,loading:o=!1})=>{const[i,u]=n.useState(!1);if(n.useEffect(()=>{if(t)u(!0);else{const m=setTimeout(()=>u(!1),200);return()=>clearTimeout(m)}},[t]),!i&&!t)return null;const p=s==="OUT_OF_STOCK",f=r.reduce((m,c)=>m+(c.impactValue||0),0),d={light:{label:"ËΩªÂ∫¶",color:"text-yellow-400",bg:"bg-yellow-500/10",border:"border-yellow-500/30"},medium:{label:"‰∏≠Â∫¶",color:"text-orange-400",bg:"bg-orange-500/10",border:"border-orange-500/30"},heavy:{label:"ÈáçÂ∫¶",color:"text-rose-400",bg:"bg-rose-500/10",border:"border-rose-500/30"},critical:{label:"Ë∂ÖÈáçÂ∫¶",color:"text-red-500",bg:"bg-red-500/10",border:"border-red-500/30"}},x=p?null:{light:r.filter(m=>m.severity==="light"),medium:r.filter(m=>m.severity==="medium"),heavy:r.filter(m=>m.severity==="heavy"),critical:r.filter(m=>m.severity==="critical")};return e.jsxs("div",{className:"fixed inset-0 z-[60] flex justify-end",children:[e.jsx("div",{className:`absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity duration-200 ${t?"opacity-100":"opacity-0"}`,onClick:a}),e.jsxs("div",{className:`relative w-full max-w-lg h-full bg-slate-900 border-l border-white/10 shadow-2xl transform transition-transform duration-200 ease-out flex flex-col ${t?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:`px-5 py-4 border-b flex items-center justify-between ${p?"border-rose-500/20 bg-rose-500/5":"border-orange-500/20 bg-orange-500/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${p?"bg-rose-500/20":"bg-orange-500/20"}`,children:p?e.jsx(Kt,{size:18,className:"text-rose-400"}):e.jsx(Ye,{size:18,className:"text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-bold text-white",children:l}),e.jsx("p",{className:`text-xs ${p?"text-rose-400":"text-orange-400"}`,children:p?"ÂîÆÁΩÑÂìÅÊòéÁªÜ":"ÊªûÈîÄÂìÅÊòéÁªÜ"})]})]}),e.jsx("button",{onClick:a,className:"p-2 rounded-lg hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:e.jsx(Nt,{size:18})})]}),e.jsxs("div",{className:"px-5 py-3 border-b border-white/5 flex items-center justify-between bg-slate-800/30",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-500 uppercase",children:"ÂïÜÂìÅÊï∞"}),e.jsx("p",{className:"text-lg font-bold text-white font-mono",children:r.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-500 uppercase",children:p?"ÊΩúÂú®ÊçüÂ§±":"ÁßØÂéãËµÑÈáë"}),e.jsxs("p",{className:`text-lg font-bold font-mono ${p?"text-rose-400":"text-orange-400"}`,children:["¬•",f.toLocaleString()]})]})]}),o&&e.jsx(ue,{size:16,className:"text-indigo-400 animate-spin"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:o?e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx(ue,{size:24,className:"text-indigo-400 animate-spin"})}):r.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-40 text-slate-500",children:e.jsx("span",{className:"text-sm",children:"ÊöÇÊó†Êï∞ÊçÆ"})}):p?e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-slate-800/95 z-10",children:e.jsxs("tr",{className:"border-b border-white/5",children:[e.jsx("th",{className:"text-left py-3 px-4 text-[10px] text-slate-500 font-medium uppercase",children:"ÂïÜÂìÅÂêçÁß∞"}),e.jsx("th",{className:"text-right py-3 px-4 text-[10px] text-slate-500 font-medium uppercase w-24",children:"ÂΩ±ÂìçÈáëÈ¢ù"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:r.map((m,c)=>e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors",children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"text-slate-200 font-medium truncate max-w-[280px]",title:m.skuName,children:m.skuName}),e.jsx("div",{className:"text-[10px] text-slate-500 mt-0.5",children:m.reason})]}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-rose-400 font-mono font-medium",children:["¬•",(m.impactValue||0).toLocaleString()]})})]},m.id||c))})]}):e.jsx("div",{className:"space-y-4 p-4",children:["critical","heavy","medium","light"].map(m=>{const c=(x==null?void 0:x[m])||[];if(c.length===0)return null;const b=d[m],w=c.reduce((h,C)=>h+(C.impactValue||0),0);return e.jsxs("div",{className:`rounded-lg border ${b.border} ${b.bg} overflow-hidden`,children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-xs font-bold ${b.color}`,children:[b.label,"ÊªûÈîÄ"]}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:[m==="light"&&"(7Â§©)",m==="medium"&&"(8-15Â§©)",m==="heavy"&&"(16-30Â§©)",m==="critical"&&"(>30Â§©)"]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("span",{className:"text-slate-400",children:[c.length,"‰ª∂"]}),e.jsxs("span",{className:`font-mono ${b.color}`,children:["¬•",w.toLocaleString()]})]})]}),e.jsx("table",{className:"w-full text-sm",children:e.jsx("tbody",{className:"divide-y divide-white/5",children:c.map((h,C)=>e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors",children:[e.jsx("td",{className:"py-2.5 px-4",children:e.jsx("div",{className:"text-slate-200 text-xs truncate max-w-[240px]",title:h.skuName,children:h.skuName})}),e.jsx("td",{className:"py-2.5 px-4 text-right whitespace-nowrap",children:e.jsx("span",{className:`text-xs font-mono ${b.color}`,children:h.duration})}),e.jsx("td",{className:"py-2.5 px-4 text-right whitespace-nowrap",children:e.jsxs("span",{className:"text-xs text-slate-400 font-mono",children:["¬•",(h.impactValue||0).toLocaleString()]})})]},h.id||C))})})]},m)})})})]})]})},Es=({theme:t="dark"})=>{const a=t==="dark",{selectedStore:l}=ce(),[s,r]=n.useState([]),[o,i]=n.useState(!1),[u,p]=n.useState(null),[f,d]=n.useState(null),[x,m]=n.useState(null),[c,b]=n.useState([]),[w,h]=n.useState(!1),[C,L]=n.useState(null),[P,T]=n.useState(!1),[j,z]=n.useState({isOpen:!1,date:"",type:null,data:[],loading:!1,total:0}),[O,E]=n.useState({isOpen:!1,itemName:"",type:null,data:[],loading:!1});n.useEffect(()=>{(async()=>{i(!0),p(null);try{const N=await hs.getPerformanceWithRisk({store_name:l||void 0,parent_category:f||void 0});N.success&&N.data&&N.data.length>0?r(N.data):(r([]),N.error&&p(N.error))}catch(N){r([]),p((N==null?void 0:N.message)||"Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•")}finally{i(!1)}})()},[l,f]);const M=x||f;n.useEffect(()=>{(async()=>{if(!l){b([]);return}console.log("[TrendFetch] currentFilterCategory:",M),h(!0);try{const N=await we.getRiskTrend(l,M||void 0,30);console.log("[TrendFetch] APIÂìçÂ∫î:",N),N.success&&N.data?b(N.data):b([])}catch(N){console.error("[TrendFetch] ÈîôËØØ:",N),b([])}finally{h(!1)}})()},[l,M]),n.useEffect(()=>{(async()=>{if(!l){L(null);return}T(!0);try{const N=await we.getSoldOutAnalysis(l,M||void 0,30);N.success&&N.data?L(N.data):L(null)}catch{L(null)}finally{T(!1)}})()},[l,M]);const I=n.useCallback(async(g,N)=>{if(j.isOpen&&j.date===g&&j.type===N){z(R=>({...R,isOpen:!1}));return}z({isOpen:!0,date:g,type:N,data:[],loading:!0,total:0});try{let R=[],q=0;if(N==="OUT_OF_STOCK"){const X=await we.getSoldOutProducts(l||void 0,void 0,1,5);R=X.data||[],q=X.total||0}else{const X=await we.getSlowMovingProducts(l||void 0,void 0,void 0,1,5);R=X.data||[],q=X.total||0}z(X=>({...X,data:R,loading:!1,total:q}))}catch{z(q=>({...q,data:[],loading:!1,total:0}))}},[j,l]),H=n.useCallback(()=>{if(!j.type)return;E({isOpen:!0,itemName:j.date,type:j.type,data:[],loading:!0}),(async()=>{try{let N=[];j.type==="OUT_OF_STOCK"?N=(await we.getSoldOutProducts(l||void 0,void 0,1,100)).data||[]:N=(await we.getSlowMovingProducts(l||void 0,void 0,void 0,1,100)).data||[],E(R=>({...R,data:N,loading:!1}))}catch{E(R=>({...R,data:[],loading:!1}))}})()},[j,l]),K=()=>E(g=>({...g,isOpen:!1})),k=g=>g>=.55?"#22d3ee":g>=.45?"#34d399":g>=.35?"#818cf8":g>=.25?"#a78bfa":g>=.15?"#fbbf24":"#f43f5e",D=n.useMemo(()=>!s||s.length===0?[]:s.map(g=>{const N=g.name.split("|"),R=N.length>1?N[1]:g.name,q=(g.grossMargin||0)/100;return{name:R,fullName:g.name,value:g.revenue||0,profit:g.profit||0,orderCount:g.orderCount||0,margin:g.grossMargin||0,marginDecimal:q,soldOut:g.soldOutCount||0,slowMoving:g.slowMovingCount||0,turnover:g.inventoryTurnover||0,itemStyle:{color:k(q),borderColor:a?"#0f172a":"#fff",borderWidth:2,gapWidth:1}}}),[s,a]),W=n.useMemo(()=>D.length>0&&D.some(g=>g.value>0),[D]),v=n.useMemo(()=>{if(c.length===0)return null;const g=c[c.length-1],N=c[0];return{latestSoldOut:g.soldOutCount,latestSlowMoving:g.slowMovingCount,latestSlowMovingRate:g.slowMovingRate||0,soldOutChange:g.soldOutCount-N.soldOutCount,slowMovingChange:g.slowMovingCount-N.slowMovingCount,slowMovingRateChange:(g.slowMovingRate||0)-(N.slowMovingRate||0),totalSkuWithStock:g.totalSkuWithStock||0}},[c]),_=n.useCallback(g=>{var R,q;const N=g;if(N.name)if(console.log("[TreemapClick] params:",{name:N.name,fullName:(R=N.data)==null?void 0:R.fullName,selectedCategory:f}),!f)d(N.name),m(null);else{const X=((q=N.data)==null?void 0:q.fullName)||N.name;console.log("[TreemapClick] ÈÄâ‰∏≠‰∏âÁ∫ßÂàÜÁ±ª:",X),m(x===X?null:X)}},[f,x]),F=n.useMemo(()=>{if(!W)return{series:[]};const g=D.map(N=>({...N,itemStyle:{...N.itemStyle,borderColor:x===N.fullName?"#a855f7":a?"#0f172a":"#fff",borderWidth:x===N.fullName?3:2}}));return{animation:!0,animationDuration:500,animationEasing:"cubicOut",animationDurationUpdate:500,animationEasingUpdate:"cubicOut",tooltip:{backgroundColor:a?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:a?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",textStyle:{fontFamily:"JetBrains Mono",color:a?"#fff":"#0f172a"},padding:12,formatter:N=>{const R=N.data;return R?`
            <div style="font-weight: bold; margin-bottom: 8px;">${R.name}</div>
            <div>ÈîÄÂîÆÈ¢ù: ¬•${(R.value||0).toLocaleString()}</div>
            <div>Âà©Ê∂¶: ¬•${(R.profit||0).toLocaleString()}</div>
            <div>Âà©Ê∂¶Áéá: ${(R.margin||0).toFixed(1)}%</div>
            <div>ËÆ¢ÂçïÊï∞: ${R.orderCount||0}</div>
            ${R.soldOut>0?`<div style="color:#f43f5e">ÂîÆÁΩÑ: ${R.soldOut}‰∏™</div>`:""}
            ${R.slowMoving>0?`<div style="color:#f97316">ÊªûÈîÄ: ${R.slowMoving}‰∏™</div>`:""}
            ${f?'<div style="color:#a855f7;margin-top:4px;font-size:10px">ÁÇπÂáªÁ≠õÈÄâË∂ãÂäøÂõæ</div>':""}
          `:""}},series:[{type:"treemap",data:g,left:0,right:0,top:0,bottom:0,roam:!1,nodeClick:!1,breadcrumb:{show:!1},animation:!0,animationDurationUpdate:500,animationEasingUpdate:"cubicOut",label:{show:!0,formatter:N=>{const R=N.data;let q=`${R.name}
¬•${(R.value/1e3).toFixed(0)}k`;return(R.soldOut>0||R.slowMoving>0)&&(q+=`
‚ö†Ô∏è`),x===R.fullName&&(q+=`
‚úì`),q},fontSize:10,color:"#fff",textShadowBlur:2,textShadowColor:"rgba(0,0,0,0.5)"},itemStyle:{borderRadius:4,borderColor:a?"#1e293b":"#fff",borderWidth:2}}]}},[D,a,W,x,f]),A=me(F,[D,a,f,x],t,_),S=n.useMemo(()=>{if(c.length===0)return{series:[]};const g=c.map(R=>R.date.slice(5)),N=c.map(R=>R.soldOutCount);return{backgroundColor:"transparent",tooltip:{trigger:"axis",backgroundColor:"rgba(15, 23, 42, 0.95)",borderColor:"rgba(244, 63, 94, 0.3)",textStyle:{color:"#e2e8f0",fontSize:11},formatter:R=>{const q=R[0];return`<div class="font-mono text-xs">
            <div class="text-slate-400">${q.axisValue}</div>
            <div class="text-rose-400 font-bold mt-1">ÂîÆÁΩÑÂìÅ: ${q.value} ‰∏™</div>
            <div class="text-slate-500 text-[10px] mt-1">ÁÇπÂáªÊü•ÁúãËØ¶ÊÉÖ</div>
          </div>`}},grid:{top:10,left:35,right:10,bottom:25},xAxis:{type:"category",data:g,axisLine:{lineStyle:{color:"rgba(148, 163, 184, 0.2)"}},axisTick:{show:!1},axisLabel:{color:"#64748b",fontSize:9,interval:Math.floor(g.length/5)}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgba(148, 163, 184, 0.08)"}},axisLabel:{color:"#64748b",fontSize:9}},series:[{type:"line",data:N,smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{color:"#f43f5e",width:2},itemStyle:{color:"#f43f5e"},emphasis:{itemStyle:{borderColor:"#fff",borderWidth:2,shadowBlur:10,shadowColor:"rgba(244,63,94,0.5)"}},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(244, 63, 94, 0.3)"},{offset:1,color:"rgba(244, 63, 94, 0)"}]}}}]}},[c]),V=n.useCallback(g=>{if(g.dataIndex!==void 0&&c[g.dataIndex]){const N=c[g.dataIndex].date;I(N,"OUT_OF_STOCK")}},[c,I]),U=me(S,[c],t,V),Y=n.useMemo(()=>{if(c.length===0)return{series:[]};const g=c.map(ee=>ee.date.slice(5)),N=c.map(ee=>{var te;return((te=ee.slowMovingByLevel)==null?void 0:te.watch)||0}),R=c.map(ee=>{var te;return((te=ee.slowMovingByLevel)==null?void 0:te.light)||0}),q=c.map(ee=>{var te;return((te=ee.slowMovingByLevel)==null?void 0:te.medium)||0}),X=c.map(ee=>{var te;return((te=ee.slowMovingByLevel)==null?void 0:te.heavy)||0}),re=N.some(ee=>ee>0),ne=R.some(ee=>ee>0),xe=q.some(ee=>ee>0),ye=X.some(ee=>ee>0),de=[];return ye&&de.push({name:"ÈáçÂ∫¶(30Â§©)",type:"bar",stack:"total",data:X,itemStyle:{color:"#dc2626"},barWidth:"60%"}),xe&&de.push({name:"‰∏≠Â∫¶(15Â§©)",type:"bar",stack:"total",data:q,itemStyle:{color:"#f97316"}}),ne&&de.push({name:"ËΩªÂ∫¶(7Â§©)",type:"bar",stack:"total",data:R,itemStyle:{color:"#fbbf24"}}),re&&de.push({name:"ÂÖ≥Ê≥®(3Â§©)",type:"bar",stack:"total",data:N,itemStyle:{color:"#a3e635",borderRadius:[2,2,0,0]}}),de.length===0?{series:[]}:{backgroundColor:"transparent",tooltip:{trigger:"axis",backgroundColor:"rgba(15, 23, 42, 0.95)",borderColor:"rgba(249, 115, 22, 0.3)",textStyle:{color:"#e2e8f0",fontSize:11},formatter:ee=>{var ae,le;const te=((ae=ee[0])==null?void 0:ae.axisValue)||"",$=(le=ee[0])==null?void 0:le.dataIndex,J=c[$];let se=0,B=`<div class="font-mono text-xs"><div class="text-slate-400 mb-1">${te}</div>`;ee.forEach(pe=>{se+=pe.value||0,B+=`<div style="display:flex;align-items:center;gap:4px;padding:2px 0">
              <span style="background:${pe.color};width:6px;height:6px;border-radius:1px;"></span>
              <span style="color:#94a3b8">${pe.seriesName}:</span>
              <span style="color:${pe.color};font-weight:bold">${pe.value}</span>
            </div>`});const Z=(J==null?void 0:J.slowMovingRate)||0;return B+=`<div style="border-top:1px solid rgba(255,255,255,0.1);margin-top:4px;padding-top:4px;color:#f97316;font-weight:bold">ÂêàËÆ°: ${se} (${Z}%)</div>`,B+='<div style="color:#64748b;font-size:10px;margin-top:4px">ÁÇπÂáªÊü•ÁúãËØ¶ÊÉÖ</div></div>',B}},legend:{show:!1},grid:{top:10,left:35,right:10,bottom:25},xAxis:{type:"category",data:g,axisLine:{lineStyle:{color:"rgba(148, 163, 184, 0.2)"}},axisTick:{show:!1},axisLabel:{color:"#64748b",fontSize:9,interval:Math.floor(g.length/5)}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgba(148, 163, 184, 0.08)"}},axisLabel:{color:"#64748b",fontSize:9}},series:de}},[c]),G=n.useCallback(g=>{if(g.dataIndex!==void 0&&c[g.dataIndex]){const N=c[g.dataIndex].date;I(N,"SLOW_MOVING")}},[c,I]),y=me(Y,[c],t,G);return e.jsxs("div",{className:`glass-panel rounded-2xl p-4 h-full flex flex-col relative overflow-hidden transition-all duration-300 ${f?"border-purple-500/50 shadow-[0_0_30px_rgba(168,85,247,0.15)]":""}`,children:[e.jsx(Ds,{isOpen:O.isOpen,onClose:K,itemName:O.itemName,riskType:O.type,data:O.data,loading:O.loading}),e.jsxs("div",{className:"mb-3 shrink-0 flex justify-between items-start z-20 relative",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("h3",{className:"text-base font-bold text-white flex items-center gap-2",children:[e.jsx(ke,{size:16,className:"text-purple-400"}),"ÂìÅÁ±ªÊïàÁõäÁü©ÈòµÂ∑•‰ΩúÂè∞"]}),e.jsx("div",{className:"flex items-center gap-2 mt-0.5 h-5",children:o?e.jsxs("p",{className:"text-[10px] text-indigo-400 font-mono flex items-center gap-1 animate-pulse",children:[e.jsx(ue,{size:10,className:"animate-spin"})," Âä†ËΩΩ‰∏≠..."]}):f?e.jsxs("div",{className:"flex items-center gap-2 animate-fade-in-up",children:[e.jsx("span",{className:"text-[10px] text-slate-500",children:"ROOT /"}),e.jsx("span",{className:"text-[10px] font-bold text-purple-300 px-1.5 py-0.5 bg-purple-500/10 rounded border border-purple-500/20",children:f})]}):e.jsxs("p",{className:"text-[10px] text-slate-400 font-mono uppercase tracking-wider opacity-70 flex items-center gap-1",children:[e.jsx(qt,{size:10})," ÁÇπÂáªÊ†ëÁä∂Âõæ‰∏ãÈíª ¬∑ ÁÇπÂáªË∂ãÂäøÂõæÊü•ÁúãËØ¶ÊÉÖ"]})})]}),f&&e.jsxs("button",{onClick:g=>{g.stopPropagation(),d(null),m(null)},className:"group flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-white/10 hover:bg-white/20 text-white text-[10px] font-bold transition-all border border-white/10",children:[e.jsx(Yt,{size:12,className:"group-hover:-translate-x-1 transition-transform"}),"ËøîÂõû"]})]}),u&&e.jsxs("div",{className:"mb-2 px-2 py-1.5 bg-rose-500/10 border border-rose-500/20 rounded-lg text-rose-400 text-[10px] flex items-center gap-2",children:[e.jsx("span",{children:"‚ö†Ô∏è"}),e.jsx("span",{children:u})]}),e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col gap-3 relative z-10",children:[e.jsxs("div",{className:"h-[60%] relative rounded-xl overflow-hidden border border-white/5 bg-slate-950/20 transition-all duration-300",children:[e.jsxs("div",{className:"absolute top-2 left-2 z-10 flex items-center gap-1.5 px-1.5 py-0.5 bg-black/40 backdrop-blur-md rounded text-[9px] text-slate-300 font-mono pointer-events-none",children:[e.jsx(Jt,{size:9}),"ÂÆèËßÇËßÜÂõæ"]}),e.jsx("div",{ref:A,className:`absolute inset-0 transition-opacity duration-300 ${W&&!o?"opacity-100":"opacity-0"}`}),o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(ue,{size:20,className:"text-indigo-400 animate-spin"})}),!o&&!W&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-slate-500 text-xs gap-1 p-4",children:[e.jsx(ke,{size:24,className:"text-slate-600"}),e.jsx("span",{children:D.length===0?"ÊöÇÊó†ÂìÅÁ±ªÊï∞ÊçÆ":"ÈîÄÂîÆÈ¢ù‰∏∫0"})]})]}),e.jsxs("div",{className:"h-[40%] grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"h-full flex flex-col bg-slate-950/20 rounded-xl border border-white/5 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-2.5 py-1.5 border-b border-white/5 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Me,{size:11,className:"text-rose-400"}),e.jsx("span",{className:"text-[11px] font-medium text-white",children:"ÂîÆÁΩÑË∂ãÂäø"}),M&&e.jsx("span",{className:"text-[8px] px-1 py-0.5 rounded bg-purple-500/20 text-purple-300 border border-purple-500/30 max-w-[80px] truncate",title:M,children:M.includes("|")?M.split("|").pop():M}),e.jsx("span",{className:"text-[8px] text-slate-500 ml-1",title:"Â∫ìÂ≠ò=0 ‰∏î Ëøë7Â§©ÊúâÈîÄÈáè",children:"(Â∫ìÂ≠ò=0‰∏îËøë7Â§©ÊúâÈîÄ)"})]}),v&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-bold text-rose-400",children:v.latestSoldOut}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"‰∏™"}),v.soldOutChange!==0&&e.jsxs("span",{className:`text-[9px] px-1 py-0.5 rounded ${v.soldOutChange>0?"bg-rose-500/20 text-rose-400":"bg-emerald-500/20 text-emerald-400"}`,children:[v.soldOutChange>0?"‚Üë":"‚Üì",Math.abs(v.soldOutChange)]})]})]}),e.jsxs("div",{className:"flex-1 relative",children:[w&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 z-10",children:e.jsx(ue,{size:16,className:"text-indigo-400 animate-spin"})}),e.jsx("div",{ref:U,className:"absolute inset-0"})]})]}),e.jsxs("div",{className:"h-full flex flex-col bg-slate-950/20 rounded-xl border border-white/5 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-2.5 py-1.5 border-b border-white/5 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ge,{size:11,className:"text-orange-400"}),e.jsx("span",{className:"text-[11px] font-medium text-white",children:"ÊªûÈîÄË∂ãÂäø"}),M&&e.jsx("span",{className:"text-[8px] px-1 py-0.5 rounded bg-purple-500/20 text-purple-300 border border-purple-500/30 max-w-[80px] truncate",title:M,children:M.includes("|")?M.split("|").pop():M}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-lime-400"}),e.jsx("span",{className:"text-[8px] text-slate-500",children:"ÂÖ≥Ê≥®"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-yellow-400"}),e.jsx("span",{className:"text-[8px] text-slate-500",children:"ËΩª"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-orange-500"}),e.jsx("span",{className:"text-[8px] text-slate-500",children:"‰∏≠"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-red-600"}),e.jsx("span",{className:"text-[8px] text-slate-500",children:"Èáç"})]})]}),v&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-bold text-orange-400",children:v.latestSlowMoving}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"‰∏™"}),v.slowMovingChange!==0&&e.jsxs("span",{className:`text-[9px] px-1 py-0.5 rounded ${v.slowMovingChange>0?"bg-rose-500/20 text-rose-400":"bg-emerald-500/20 text-emerald-400"}`,children:[v.slowMovingChange>0?"‚Üë":"‚Üì",Math.abs(v.slowMovingChange)]})]})]}),e.jsxs("div",{className:"flex-1 relative",children:[w&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 z-10",children:e.jsx(ue,{size:16,className:"text-indigo-400 animate-spin"})}),e.jsx("div",{ref:y,className:"absolute inset-0"})]})]})]})]}),C&&e.jsxs("div",{className:"mt-3 grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"bg-slate-900/50 rounded-lg border border-white/5 p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(Ae,{size:12,className:"text-rose-400"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"È¢Ñ‰º∞ÊçüÂ§±"})]}),e.jsxs("div",{className:"text-lg font-bold text-rose-400",children:["¬•",C.estimatedLoss.toLocaleString()]}),e.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5",children:"Âü∫‰∫éÊó•ÂùáÈîÄÂîÆÈ¢ù"})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg border border-white/5 p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(St,{size:12,className:"text-amber-400"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"Âπ≥ÂùáÊÅ¢Â§ç"})]}),e.jsxs("div",{className:"text-lg font-bold text-amber-400",children:[C.avgRecoveryDays," ",e.jsx("span",{className:"text-xs font-normal",children:"Â§©"})]}),e.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5",children:"‰ªéÂîÆÁΩÑÂà∞Ë°•Ë¥ß"})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg border border-white/5 p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(ke,{size:12,className:"text-indigo-400"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"ÂìÅÁ±ªÂàÜÂ∏É"})]}),e.jsxs("div",{className:"space-y-1",children:[C.byCategory.slice(0,3).map((g,N)=>e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsxs("span",{className:"text-slate-300 truncate max-w-[80px]",title:g.category,children:[N+1,". ",g.category]}),e.jsxs("span",{className:"text-rose-400 font-mono",children:[g.count,"‰∏™"]})]},g.category)),C.byCategory.length===0&&e.jsx("div",{className:"text-[10px] text-slate-500",children:"ÊöÇÊó†Êï∞ÊçÆ"})]})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg border border-white/5 p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(Xt,{size:12,className:"text-purple-400"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"È´òÈ¢ëÂîÆÁΩÑ"})]}),e.jsxs("div",{className:"space-y-1",children:[C.frequentSoldOut.slice(0,3).map((g,N)=>e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsxs("span",{className:"text-slate-300 truncate max-w-[80px]",title:g.name,children:[N+1,". ",g.name]}),e.jsxs("span",{className:"text-purple-400 font-mono",children:[g.times,"Ê¨°"]})]},g.name)),C.frequentSoldOut.length===0&&e.jsx("div",{className:"text-[10px] text-slate-500",children:"ÊöÇÊó†È´òÈ¢ëÂîÆÁΩÑ"})]})]})]}),P&&!C&&e.jsxs("div",{className:"mt-3 flex items-center justify-center py-4 bg-slate-900/30 rounded-lg border border-white/5",children:[e.jsx(ue,{size:14,className:"text-indigo-400 animate-spin mr-2"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"Âä†ËΩΩÂîÆÁΩÑÂàÜÊûê..."})]}),j.isOpen&&e.jsx("div",{className:"mt-3 animate-fade-in-up",children:e.jsxs("div",{className:"bg-slate-900/50 rounded-xl border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/5 bg-slate-800/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[j.type==="OUT_OF_STOCK"?e.jsx(Me,{size:14,className:"text-rose-400"}):e.jsx(Ge,{size:14,className:"text-orange-400"}),e.jsx("span",{className:"text-xs font-bold text-white",children:j.type==="OUT_OF_STOCK"?"ÂîÆÁΩÑÂìÅËØ¶ÊÉÖ":"ÊªûÈîÄÂìÅËØ¶ÊÉÖ"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:[j.date," ¬∑ ÂÖ± ",j.total," ‰∏™"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j.total>5&&e.jsxs("button",{onClick:H,className:"flex items-center gap-1 px-2 py-1 rounded text-[10px] font-bold bg-indigo-500/20 text-indigo-400 border border-indigo-500/30 hover:bg-indigo-500 hover:text-white transition-all",children:["Êü•ÁúãÂÖ®ÈÉ® ",e.jsx(Zt,{size:10})]}),e.jsx("button",{onClick:()=>z(g=>({...g,isOpen:!1})),className:"p-1 rounded hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:e.jsx(Qt,{size:14})})]})]}),e.jsx("div",{className:"p-2",children:j.loading?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(ue,{size:16,className:"text-indigo-400 animate-spin"})}):j.data.length===0?e.jsx("div",{className:"text-center py-4 text-slate-500 text-xs",children:"ÊöÇÊó†Êï∞ÊçÆ"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-2",children:j.data.slice(0,5).map((g,N)=>e.jsxs("div",{className:"flex items-center gap-2 px-2.5 py-2 bg-slate-800/50 rounded-lg border border-white/5 hover:border-white/10 transition-colors",children:[e.jsx("div",{className:`w-1.5 h-8 rounded-full ${j.type==="OUT_OF_STOCK"?"bg-rose-500":"bg-orange-500"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-white truncate",title:g.skuName,children:g.skuName}),e.jsx("div",{className:"text-[10px] text-slate-500",children:g.reason})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-[10px] font-mono text-slate-400",children:["¬•",(g.impactValue||0).toFixed(0)]}),e.jsx("div",{className:"text-[9px] text-slate-600",children:g.duration||g.action})]})]},g.id||N))})})]})})]})},Ts=({data:t,theme:a})=>{const l=a==="dark",s=l?"#64748b":"#94a3b8",r=l?"#fff":"#0f172a",o=l?"#94a3b8":"#64748b",i=l?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",{categories:u,series:p}=n.useMemo(()=>{const x={},m=t;m.length>0&&m[0].marketingTrend&&m[0].marketingTrend.forEach(b=>{x[b.date]={date:b.date,itemDiscount:0,thresholdDiscount:0,vouchers:0,other:0}}),m.forEach(b=>{var w;(w=b.marketingTrend)==null||w.forEach(h=>{x[h.date]&&(x[h.date].itemDiscount+=h.itemDiscount,x[h.date].thresholdDiscount+=h.thresholdDiscount,x[h.date].vouchers+=h.vouchers,x[h.date].other+=h.other)})});const c=Object.keys(x);return{categories:c,series:[{name:"ÂçïÂìÅÁõ¥Èôç",data:c.map(b=>x[b].itemDiscount),color:"#f43f5e"},{name:"Êª°ÂáèÊ¥ªÂä®",data:c.map(b=>x[b].thresholdDiscount),color:"#f59e0b"},{name:"Á∫¢ÂåÖ/Âà∏",data:c.map(b=>x[b].vouchers),color:"#3b82f6"},{name:"Êé®Âπø/ÂπøÂëä",data:c.map(b=>x[b].other),color:"#8b5cf6"}]}},[t]),f={grid:{top:30,right:10,bottom:0,left:10,containLabel:!0},tooltip:{trigger:"axis",backgroundColor:l?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:l?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:12,textStyle:{fontFamily:"JetBrains Mono",color:l?"#fff":"#0f172a"},axisPointer:{type:"shadow"}},legend:{data:["ÂçïÂìÅÁõ¥Èôç","Êª°ÂáèÊ¥ªÂä®","Á∫¢ÂåÖ/Âà∏","Êé®Âπø/ÂπøÂëä"],textStyle:{color:s,fontSize:10},bottom:0,itemWidth:10,itemHeight:10},xAxis:{type:"category",data:u,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:s,fontSize:10}},yAxis:{type:"value",splitLine:{lineStyle:{color:i,type:"dashed"}},axisLabel:{color:s,fontSize:10,formatter:x=>`¬•${x/1e3}k`}},series:p.map(x=>({name:x.name,type:"bar",stack:"total",data:x.data,itemStyle:{color:x.color},barWidth:"40%"}))},d=me(f,[t,a],a);return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col relative overflow-hidden",children:[e.jsxs("div",{className:"mb-4 relative z-10",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:r},children:[e.jsx("span",{className:"w-1 h-4 bg-gradient-to-b from-rose-400 to-rose-600 rounded-sm"}),"Ëê•ÈîÄÊàêÊú¨Ë∂ãÂäø"]}),e.jsx("p",{className:"text-xs mt-1 font-mono uppercase tracking-wider opacity-70",style:{color:o},children:"7-DAY COST BREAKDOWN"})]}),e.jsx("div",{className:"flex-1 w-full min-h-[250px]",children:e.jsx("div",{ref:d,className:"w-full h-full"})})]})},Os=({theme:t,selectedDistanceBand:a,storeName:l,selectedDate:s,selectedDateRange:r})=>{const o=t==="dark",i=o?"#94a3b8":"#64748b",u=o?"#fff":"#0f172a",p=o?"#94a3b8":"#64748b",f=o?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",{selectedStore:d,dateRange:x}=ce(),m=l||d,[c,b]=n.useState([]),[w,h]=n.useState(!1),[C,L]=n.useState(null),[P,T]=n.useState(null),j=n.useRef(null),z=n.useRef(null);n.useEffect(()=>{if(console.log("üì° DeliveryHeatmap - selectedStore:",m,"selectedDate:",s,"selectedDateRange:",r),!m){b([]),L(null);return}(async()=>{var D;h(!0);try{const W={store_name:m};s?W.target_date=s:r?(W.start_date=r.start,W.end_date=r.end):x.type!=="all"&&x.start&&x.end&&(W.start_date=x.start,W.end_date=x.end),a&&(W.min_distance=a.minDistance,W.max_distance=a.maxDistance),console.log("üì° ÈÖçÈÄÅÊ∫¢‰ª∑Èõ∑ËææËØ∑Ê±ÇÂèÇÊï∞:",W);const v=await ie.getDeliveryRadar(W);v.success&&(console.log("üì° ÈÖçÈÄÅÊ∫¢‰ª∑Èõ∑ËææÊï∞ÊçÆ:",(D=v.data)==null?void 0:D.length,"Êù°, Êó•Êúü:",v.date),b(v.data||[]),L(v.date||null))}catch(W){console.error("Ëé∑ÂèñÈÖçÈÄÅÊ∫¢‰ª∑Èõ∑ËææÊï∞ÊçÆÂ§±Ë¥•:",W)}finally{h(!1)}})()},[m,s,r,x.type,x.start,x.end,a]);const{basePoints:O,channelStats:E}=n.useMemo(()=>{if(!c.length)return console.log("üì° DeliveryHeatmap basePoints - Êó†Êï∞ÊçÆ"),{basePoints:[],channelStats:[]};const D=c.filter(S=>typeof S.distance=="number"&&!isNaN(S.distance)&&typeof S.hour=="number"&&!isNaN(S.hour)&&typeof S.delivery_cost=="number"&&!isNaN(S.delivery_cost)&&typeof S.order_value=="number"&&!isNaN(S.order_value)&&typeof S.profit=="number"&&!isNaN(S.profit)).filter(S=>S.is_premium),W={};D.forEach(S=>{const V=S.channel||"ÂÖ∂‰ªñ";let U="ÂÖ∂‰ªñ";V.includes("ÁæéÂõ¢")?U="ÁæéÂõ¢":V.includes("È•ø‰∫Ü‰πà")?U="È•ø‰∫Ü‰πà":V.includes("ÊäñÈü≥")?U="ÊäñÈü≥":V.includes("‰∫¨‰∏ú")&&(U="‰∫¨‰∏ú"),W[U]=(W[U]||0)+1});const v={ÁæéÂõ¢:"#FFB800",È•ø‰∫Ü‰πà:"#0096FF",ÊäñÈü≥:"#1a1a1a",‰∫¨‰∏ú:"#E4393C",ÂÖ∂‰ªñ:"#8B5CF6"},_=Object.entries(W).map(([S,V])=>({name:S,count:V,color:v[S]||"#8B5CF6"})).sort((S,V)=>V.count-S.count);let F=D;P&&(F=D.filter(S=>{const V=S.channel||"ÂÖ∂‰ªñ";return P==="ÁæéÂõ¢"?V.includes("ÁæéÂõ¢"):P==="È•ø‰∫Ü‰πà"?V.includes("È•ø‰∫Ü‰πà"):P==="ÊäñÈü≥"?V.includes("ÊäñÈü≥"):P==="‰∫¨‰∏ú"?V.includes("‰∫¨‰∏ú"):P==="ÂÖ∂‰ªñ"?!V.includes("ÁæéÂõ¢")&&!V.includes("È•ø‰∫Ü‰πà")&&!V.includes("ÊäñÈü≥")&&!V.includes("‰∫¨‰∏ú"):!0}));const A=F.map(S=>({value:[S.distance,S.hour,S.delivery_cost,S.order_value,S.profit,S.channel||""],originalAngle:S.hour,isPremium:S.is_premium}));return console.log("üì° DeliveryHeatmap - Ê∫¢‰ª∑ËÆ¢Âçï:",D.length,"Á≠õÈÄâÂêé:",A.length),{basePoints:A,channelStats:_}},[c,P]),M=n.useMemo(()=>{if(!O.length)return 8.5;const k=Math.max(...O.map(D=>D.value[0]));return Math.max(2,Math.ceil(k)+.5)},[O]),I={ÁæéÂõ¢:"#FFB800",È•ø‰∫Ü‰πà:"#0096FF",ÊäñÈü≥:"#000000",‰∫¨‰∏ú:"#E4393C",ÂÖ∂‰ªñ:"#8B5CF6"},H=k=>{if(!k)return"#f43f5e";for(const[D,W]of Object.entries(I))if(k.includes(D))return W;return"#f43f5e"},K=n.useMemo(()=>{var k;return O.length?(console.log("üì° DeliveryHeatmap option - ÁîüÊàêÈÖçÁΩÆ:",{pointsCount:O.length,maxDistance:M,firstPoint:(k=O[0])==null?void 0:k.value}),{polar:{radius:["5%","82%"],center:["50%","50%"]},angleAxis:{type:"value",min:0,max:24,interval:3,startAngle:90,clockwise:!0,axisLine:{lineStyle:{color:f}},axisLabel:{formatter:"{value}h",color:i,fontSize:10,fontFamily:"JetBrains Mono",fontWeight:"bold"},splitLine:{show:!0,lineStyle:{color:f,width:1}}},radiusAxis:{min:0,max:M,interval:M<=2?.5:M<=4?1:2,axisLine:{show:!1},axisLabel:{formatter:"{value}km",color:i,fontSize:9,verticalAlign:"bottom"},splitLine:{lineStyle:{color:f,type:"dashed"}}},tooltip:{backgroundColor:o?"rgba(2, 6, 23, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:o?"rgba(255, 255, 255, 0.2)":"rgba(0,0,0,0.1)",padding:12,textStyle:{fontFamily:"JetBrains Mono",color:o?"#fff":"#0f172a"},formatter:D=>{var U;const W=(U=D.data)==null?void 0:U.value;if(!W)return"";const[v,_,F,A,S,V]=W;return`
            <div style="font-weight:600;margin-bottom:6px;color:#f43f5e">‚ö†Ô∏è ÈÖçÈÄÅÊ∫¢‰ª∑ËÆ¢Âçï</div>
            <div>Ê∏†ÈÅì: ${V||"Êú™Áü•"}</div>
            <div>Ë∑ùÁ¶ª: ${v.toFixed(1)}km</div>
            <div>Êó∂ÊÆµ: ${_}:00</div>
            <div>ÈÖçÈÄÅÊàêÊú¨: <span style="color:#f43f5e;font-weight:bold">¬•${F.toFixed(1)}</span></div>
            <div>ÂÆ¢Âçï‰ª∑: ¬•${A.toFixed(0)}</div>
            <div>Âà©Ê∂¶: <span style="color:${S>=0?"#22c55e":"#f43f5e"}">¬•${S.toFixed(1)}</span></div>
            <div style="margin-top:4px;font-size:10px;color:#94a3b8">ÈÖçÈÄÅÂáÄÊàêÊú¨ > ¬•6</div>
          `}},series:[{name:"Ê∫¢‰ª∑ËÆ¢Âçï",type:"scatter",coordinateSystem:"polar",encode:{radius:0,angle:1},data:O.map(D=>{const W=D.value[5],v=H(W);return{value:D.value,itemStyle:{color:v,opacity:.85,shadowBlur:12,shadowColor:`${v}80`}}}),symbolSize:D=>Math.max(8,Math.min(D[2]*1.5,30)),itemStyle:{borderColor:o?"rgba(255,255,255,0.9)":"#fff",borderWidth:1.5},emphasis:{itemStyle:{opacity:1,shadowBlur:20,borderColor:"#fff",borderWidth:2},scale:1.3}}]}):(console.log("üì° DeliveryHeatmap option - Êó†Êï∞ÊçÆÔºåËøîÂõûÁ©∫ series"),{series:[]})},[O,o,i,f,M]);return n.useEffect(()=>{if(!z.current||!m){console.log("üì° DeliveryHeatmap ÂàùÂßãÂåñ - Ë∑≥Ëøá: container=",!!z.current,"store=",m);return}let k=es(z.current);k||(k=ze(z.current,o?"dark":void 0),console.log("üì° DeliveryHeatmap - ÂàõÂª∫Êñ∞ÁöÑ ECharts ÂÆû‰æã")),j.current=k;const D=()=>{k==null||k.resize()};return window.addEventListener("resize",D),setTimeout(()=>{k==null||k.resize()},50),()=>{window.removeEventListener("resize",D)}},[o,m]),n.useEffect(()=>{const k=j.current;if(!k){console.log("üì° DeliveryHeatmap Êõ¥Êñ∞ - ÂÆû‰æã‰∏çÂ≠òÂú®");return}if(!O.length){console.log("üì° DeliveryHeatmap Êõ¥Êñ∞ - Êó†Êï∞ÊçÆÔºåÊ∏ÖÁ©∫ series"),k.setOption({polar:{radius:["12%","75%"],center:["50%","50%"]},angleAxis:{type:"value",min:0,max:24,interval:3,startAngle:90,clockwise:!0,axisLine:{lineStyle:{color:f}},axisLabel:{formatter:"{value}h",color:i,fontSize:10},splitLine:{show:!0,lineStyle:{color:f,width:1}}},radiusAxis:{min:0,max:8.5,interval:2,axisLine:{show:!1},axisLabel:{formatter:"{value}km",color:i,fontSize:9},splitLine:{lineStyle:{color:f,type:"dashed"}}},series:[]},{notMerge:!0});return}k.setOption(K,{notMerge:!0}),console.log("üì° DeliveryHeatmap - setOption ÂÆåÊàê, Êï∞ÊçÆÁÇπ:",O.length),setTimeout(()=>{k==null||k.resize()},100)},[K,O,i,f]),n.useEffect(()=>()=>{j.current&&(j.current.dispose(),j.current=null)},[]),e.jsxs("div",{className:"glass-panel rounded-2xl p-4 h-full flex flex-col relative overflow-hidden group",children:[e.jsxs("div",{className:"shrink-0 relative z-20 flex justify-between items-center mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{size:16,className:"text-cyan-400 animate-pulse"}),e.jsx("h3",{className:"text-base font-bold",style:{color:u},children:C?C.includes("~")?`${C.split("~").map(k=>k.trim().slice(5)).join(" ~ ")} ÈÖçÈÄÅÊ∫¢‰ª∑Èõ∑Ëææ`:`${C.slice(5)} ÈÖçÈÄÅÊ∫¢‰ª∑Èõ∑Ëææ`:"ÈÖçÈÄÅÊ∫¢‰ª∑Èõ∑Ëææ"}),a&&e.jsxs("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded-full bg-cyan-500/20 text-cyan-400",children:[a.minDistance,"-",a.maxDistance,"km"]}),(s||r)&&e.jsx("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded-full bg-cyan-500/20 text-cyan-400 ml-1",children:"Â∑≤ËÅîÂä®"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[E.slice(0,4).map(k=>e.jsxs("button",{onClick:()=>T(P===k.name?null:k.name),className:`flex items-center gap-1 px-1.5 py-0.5 rounded transition-all cursor-pointer ${P===k.name?"bg-white/20 ring-1 ring-white/30":P?"opacity-40":"hover:bg-white/10"}`,children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:k.color}}),e.jsx("span",{className:"text-[10px]",style:{color:o?"#94a3b8":"#64748b"},children:k.name}),e.jsx("span",{className:"text-[10px] font-mono font-bold",style:{color:k.color},children:k.count})]},k.name)),P&&e.jsx("button",{onClick:()=>T(null),className:"text-[10px] text-cyan-400 hover:text-cyan-300 ml-1",children:"‚úï"})]})]}),e.jsx("div",{className:"flex-1 w-full relative z-10 flex items-center justify-center",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:z,className:"w-full h-full relative z-10",style:{visibility:w||!O.length?"hidden":"visible"}}),w&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",children:e.jsx("div",{className:"animate-pulse text-sm",style:{color:p},children:"Âä†ËΩΩ‰∏≠..."})}),!w&&!O.length&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",children:e.jsx("div",{className:"text-sm text-center",style:{color:p},children:P?`${P} Ê∏†ÈÅìÊó†Ê∫¢‰ª∑ËÆ¢Âçï`:a?`${a.minDistance}-${a.maxDistance}km ËåÉÂõ¥ÂÜÖÊó†Ê∫¢‰ª∑ËÆ¢Âçï`:"ÊöÇÊó†Ê∫¢‰ª∑ËÆ¢ÂçïÊï∞ÊçÆ"})}),O.length>0&&!w&&e.jsxs("div",{className:"absolute flex items-center justify-center pointer-events-none z-20 aspect-square h-[85%]",children:[e.jsx("div",{className:"w-full h-full rounded-full animate-spin opacity-50",style:{animationDuration:"6s",animationTimingFunction:"linear",background:"conic-gradient(from 0deg, transparent 0deg, transparent 300deg, rgba(34, 211, 238, 0.3) 360deg)"}}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-cyan-400 rounded-full shadow-[0_0_15px_#22d3ee] animate-ping"})]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm mb-2",style:{color:p},children:"ËØ∑ÂÖàÈÄâÊã©Èó®Â∫ó"}),e.jsx("div",{className:"text-xs opacity-60",style:{color:p},children:"ÈÄâÊã©Èó®Â∫óÂêéÂ∞ÜÊòæÁ§∫ÈÖçÈÄÅÊ∫¢‰ª∑ÂàÜÊûê"})]})})]})},As=[["delivery_discount","ÈÖçÈÄÅË¥πÂáèÂÖç"],["full_reduction","Êª°ÂáèÈáëÈ¢ù"],["product_discount","ÂïÜÂìÅÂáèÂÖç"],["merchant_voucher","ÂïÜÂÆ∂‰ª£ÈáëÂà∏"],["merchant_share","ÂïÜÂÆ∂ÊâøÊãÖÂà∏"],["gift_amount","Êª°Ëµ†ÈáëÈ¢ù"],["other_discount","ÂïÜÂÆ∂ÂÖ∂‰ªñ‰ºòÊÉ†"],["new_customer_discount","Êñ∞ÂÆ¢ÂáèÂÖç"]],Rs={ÈÖçÈÄÅË¥πÂáèÂÖç:"#f43f5e",Êª°ÂáèÈáëÈ¢ù:"#f59e0b",ÂïÜÂìÅÂáèÂÖç:"#eab308",ÂïÜÂÆ∂‰ª£ÈáëÂà∏:"#22c55e",ÂïÜÂÆ∂ÊâøÊãÖÂà∏:"#14b8a6",Êª°Ëµ†ÈáëÈ¢ù:"#3b82f6",ÂïÜÂÆ∂ÂÖ∂‰ªñ‰ºòÊÉ†:"#8b5cf6",Êñ∞ÂÆ¢ÂáèÂÖç:"#ec4899"};function Is(t){return As.filter(([a])=>{const l=t[a];return l&&l.some(s=>s>0)})}function Ps(t,a){return t.map((l,s)=>{const r=a[s];return r===0?0:l/r*100})}function Fs(t,a,l){const{dates:s,series:r,totals:o}=t,i=Is(r),u=i.map(([d,x])=>{const m=r[d],c=a==="percentage"?Ps(m,o):m;return{name:x,type:"line",stack:"total",areaStyle:{opacity:.6},emphasis:{focus:"series"},data:c,itemStyle:{color:Rs[x]},lineStyle:{width:1},symbol:"none",smooth:.3}}),p=l?"#64748b":"#94a3b8",f=l?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)";return{grid:{top:40,right:20,bottom:60,left:50,containLabel:!1},tooltip:{trigger:"axis",backgroundColor:l?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:l?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:12,textStyle:{fontFamily:"JetBrains Mono",color:l?"#fff":"#0f172a",fontSize:11},axisPointer:{type:"cross",label:{backgroundColor:"#6366f1"}},formatter:d=>{if(!Array.isArray(d)||d.length===0)return"";const x=d[0].axisValue;let m=`<div style="font-weight:bold;margin-bottom:8px">${x}</div>`;const c=s.indexOf(x),b=c>=0?o[c]:0;return d.forEach(w=>{const h=w.value||0,C=b>0?h/(a==="percentage"?100:b)*100:0;a==="percentage"?m+=`<div style="display:flex;justify-content:space-between;gap:16px">
              <span>${w.marker}${w.seriesName}</span>
              <span style="font-weight:bold">${h.toFixed(1)}%</span>
            </div>`:m+=`<div style="display:flex;justify-content:space-between;gap:16px">
              <span>${w.marker}${w.seriesName}</span>
              <span style="font-weight:bold">¬•${h.toLocaleString()} (${C.toFixed(1)}%)</span>
            </div>`}),a==="absolute"&&(m+=`<div style="margin-top:8px;padding-top:8px;border-top:1px solid ${l?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}">
            <span style="font-weight:bold">ÊÄªËÆ°: ¬•${b.toLocaleString()}</span>
          </div>`),m}},legend:{data:i.map(([,d])=>d),bottom:0,textStyle:{color:p,fontSize:10},itemGap:12,icon:"roundRect",itemWidth:12,itemHeight:8},xAxis:{type:"category",data:s.map(d=>d.slice(5)),boundaryGap:!1,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:p,fontSize:10,fontFamily:"JetBrains Mono"}},yAxis:{type:"value",max:a==="percentage"?100:void 0,splitLine:{lineStyle:{color:f,type:"dashed"}},axisLabel:{color:p,fontSize:10,formatter:a==="percentage"?"{value}%":d=>`¬•${d>=1e3?(d/1e3).toFixed(0)+"k":d}`}},series:u}}const Bs=({data:t,theme:a,loading:l,error:s,selectedChannel:r,onChannelChange:o})=>{const[i,u]=n.useState("percentage"),{channelList:p}=ce();console.log("üìà MarketingTrendChart channelList:",p);const f=a==="dark",d=f?"#fff":"#0f172a",x=f?"#94a3b8":"#64748b",m=n.useMemo(()=>{var w,h,C,L,P,T,j,z;if(console.log("üìà MarketingTrendChart option ËÆ°ÁÆó, data:",t),!t||!t.dates||t.dates.length===0)return console.log("üìà MarketingTrendChart - Êó†Êï∞ÊçÆÔºåËøîÂõûÁ©∫ series"),{series:[]};const b=Fs(t,i,f);return console.log("üìà MarketingTrendChart option ÁªìÊûú:",{seriesCount:(w=b.series)==null?void 0:w.length,xAxisData:(C=(h=b.xAxis)==null?void 0:h.data)==null?void 0:C.length,firstSeriesName:(P=(L=b.series)==null?void 0:L[0])==null?void 0:P.name,firstSeriesDataSample:(z=(j=(T=b.series)==null?void 0:T[0])==null?void 0:j.data)==null?void 0:z.slice(0,3)}),b},[t,i,f]),c=me(m,[],a);return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-24 bg-gradient-to-b from-pink-500/5 to-transparent pointer-events-none"}),e.jsxs("div",{className:"mb-2 flex justify-between items-start relative z-10",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:d},children:[e.jsx("span",{className:"w-1 h-5 bg-gradient-to-b from-pink-400 to-pink-600 rounded-full shadow-[0_0_10px_#ec4899]"}),"Ëê•ÈîÄÊàêÊú¨Ë∂ãÂäø"]}),e.jsx("p",{className:"text-xs mt-1 font-mono uppercase tracking-widest opacity-70",style:{color:x},children:"MARKETING COST TREND: TYPE RATIO OVER TIME"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_t,{selectedChannel:r,channelList:p,onSelect:o,isDark:f,accentColor:"pink"}),e.jsxs("div",{className:"flex items-center gap-1 bg-slate-800/50 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>u("percentage"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all duration-200 ${i==="percentage"?"bg-pink-500/20 text-pink-300 shadow-[0_0_10px_rgba(236,72,153,0.3)]":f?"text-slate-400 hover:text-white":"text-slate-600 hover:text-slate-900"}`,children:"ÁôæÂàÜÊØî"}),e.jsx("button",{onClick:()=>u("absolute"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all duration-200 ${i==="absolute"?"bg-pink-500/20 text-pink-300 shadow-[0_0_10px_rgba(236,72,153,0.3)]":f?"text-slate-400 hover:text-white":"text-slate-600 hover:text-slate-900"}`,children:"ÁªùÂØπÂÄº"})]})]})]}),e.jsxs("div",{className:"flex-1 w-full min-h-[280px] relative",children:[e.jsx("div",{ref:c,className:"w-full h-full",style:{minHeight:"280px"}}),l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm rounded-lg",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"})}),s&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm rounded-lg",children:e.jsx("p",{className:"text-rose-400 text-sm",children:s})}),!l&&!s&&(!t||!t.dates||t.dates.length===0)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("p",{className:"text-slate-500 text-sm",children:"ÊöÇÊó†Êï∞ÊçÆÔºåËØ∑ÈÄâÊã©Èó®Â∫ó"})})]})]})};function ut(t,a){const[l,s]=n.useState(t);return n.useEffect(()=>{const r=setTimeout(()=>s(t),a);return()=>clearTimeout(r)},[t,a]),l}const ft=({label:t,value:a,onChange:l,min:s,max:r,leftLabel:o,rightLabel:i})=>{const u=(a-s)/(r-s)*100;return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex justify-between text-xs font-medium mb-3 items-end",children:[e.jsx("span",{className:"text-slate-300 font-mono tracking-wide",children:t}),e.jsxs("span",{className:`text-base font-bold font-mono transition-colors duration-300 ${a>0?"text-rose-400":a<0?"text-emerald-400":"text-slate-500"}`,children:[a>0?"+":"",a,"%"]})]}),e.jsxs("div",{className:"relative h-4 w-full flex items-center",children:[e.jsx("div",{className:"absolute w-full h-1.5 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-slate-600"})}),e.jsx("input",{type:"range",min:s,max:r,step:"5",value:a,onChange:p=>l(parseInt(p.target.value)),className:"absolute w-full h-full opacity-0 cursor-pointer z-20"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1.5 pointer-events-none transition-all duration-500 ease-out z-10 rounded-full opacity-80",style:{left:a>=0?"50%":`${u}%`,width:Math.abs(a)===0?"0%":`${Math.abs(u-50)}%`,backgroundColor:a>0?"#f43f5e":"#34d399"}}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-white rounded-full border-2 border-slate-900 shadow-lg transition-all duration-500 ease-[cubic-bezier(0.25,1,0.5,1)] z-10 pointer-events-none group-hover:scale-125",style:{left:`calc(${u}% - 8px)`}})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mt-2 font-mono uppercase",children:[e.jsx("span",{children:o}),e.jsx("span",{children:i})]})]})},Ws=({data:t})=>{const[a,l]=n.useState(0),[s,r]=n.useState(0),[o,i]=n.useState(!1),u=ut(a,200),p=ut(s,200),[f,d]=n.useState(t.totalProfit),[x,m]=n.useState(0),c=t.channels.reduce((L,P)=>L+P.costs.marketing,0),b=t.channels.reduce((L,P)=>L+P.costs.delivery,0),w=t.totalProfit;n.useEffect(()=>{const L=1+u/100,P=1+p/100,T=c*L,j=b*P,z=u*.5,O=t.totalRevenue*(1+z/100),M=(t.totalRevenue-w-c-b)*(1+z/100),I=O-M-T-j;d(I),m(I-w)},[u,p,t,c,b,w]);const h=()=>{l(0),r(0)},C=async()=>{i(!0),await new Promise(L=>setTimeout(L,1200)),l(-10),r(-5),i(!1)};return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 relative overflow-hidden flex flex-col justify-between h-full group",children:[e.jsx("div",{className:"absolute inset-0 bg-[size:20px_20px] pointer-events-none opacity-5",style:{backgroundImage:"linear-gradient(currentColor 1px, transparent 1px)"}}),e.jsxs("div",{className:"mb-6 relative z-10 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-neon-green rounded-full animate-pulse"}),"ÁªèËê•Ê≤ôÁõòÊé®Êºî"]}),e.jsx("p",{className:"text-xs text-slate-400 mt-1 font-mono uppercase tracking-wider opacity-70",children:"AI SOLVER ENABLED"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:C,disabled:o,className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-bold transition-all ${o?"bg-indigo-500/20 text-indigo-300 border-indigo-500/50":"bg-indigo-600 hover:bg-indigo-500 text-white border-transparent shadow-[0_0_15px_rgba(99,102,241,0.4)]"}`,children:[e.jsx(Je,{size:14,className:o?"animate-spin":""}),o?"COMPUTING...":"AI Ê±ÇËß£"]}),e.jsx("button",{onClick:h,className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white transition-all border border-white/5",children:e.jsx(ss,{size:14})})]})]}),e.jsxs("div",{className:"space-y-8 relative z-10 flex-1 flex flex-col justify-center",children:[e.jsx(ft,{label:"Ëê•ÈîÄÈ¢ÑÁÆóÊäïÂÖ•",value:a,onChange:l,min:-30,max:30,leftLabel:"ËäÇÊµÅ‰øùÂà©",rightLabel:"ÊøÄËøõÊâ©Âº†"}),e.jsx(ft,{label:"Â±•Á∫¶ÊàêÊú¨ÊµÆÂä®",value:s,onChange:r,min:-20,max:20,leftLabel:"ËøêÂäõÊèêÊïà",rightLabel:"ËøêÂäõÁ¥ßÂº†"})]}),e.jsx("div",{className:"mt-auto pt-6 border-t border-white/10 relative z-10",children:e.jsxs("div",{className:`p-5 rounded-xl border backdrop-blur-xl transition-all duration-500 relative overflow-hidden ${x>=0?"bg-emerald-500/10 border-emerald-500/30":"bg-rose-500/10 border-rose-500/30"}`,children:[e.jsxs("div",{className:"flex justify-between items-end mb-2 relative z-10",children:[e.jsx("span",{className:"text-xs text-slate-300 font-bold uppercase font-mono tracking-wider",children:"È¢ÑËÆ°ÂáÄÂà©Ê∂¶"}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded-md text-xs font-bold border ${x>=0?"bg-emerald-500/20 text-emerald-300 border-emerald-500/20":"bg-rose-500/20 text-rose-300 border-rose-500/20"}`,children:[x>=0?e.jsx(Re,{size:12}):e.jsx(Ye,{size:12}),e.jsxs("span",{className:"font-mono",children:[x>=0?"+":"","¬•",Math.abs(x).toLocaleString(void 0,{maximumFractionDigits:0})]})]})]}),e.jsxs("div",{className:"text-3xl font-bold text-white font-mono flex items-baseline gap-1 relative z-10 tabular-nums",children:[e.jsx("span",{className:"text-lg opacity-40 font-sans",children:"¬•"}),f.toLocaleString(void 0,{maximumFractionDigits:0})]})]})})]})},Vs=({data:t,onLocate:a,activeFocus:l})=>{const[s,r]=n.useState(null),[o,i]=n.useState(!1);return n.useEffect(()=>{i(!0);const u=setTimeout(()=>{r({summary:"Ê£ÄÊµãÂà∞Â§ñÂçñÊ∏†ÈÅìËê•ÈîÄÊàêÊú¨ËøáÈ´òÔºåÊãñÁ¥ØÊï¥‰ΩìÂà©Ê∂¶„ÄÇÂª∫ËÆÆ‰ºòÂåñÊª°ÂáèÁ≠ñÁï•„ÄÇ",costProblem:"È•ø‰∫Ü‰πàÊ∏†ÈÅìËê•ÈîÄË°•Ë¥¥Âç†ÊØîËææ 20%ÔºåÂª∫ËÆÆÁº©ÂáèÊª°ÂáèÂäõÂ∫¶„ÄÇ",timeOpportunity:"ÂçàÈ´òÂ≥∞ (11:00-13:00) ËÆ¢ÂçïÂØÜÈõÜ‰ΩÜË∂ÖÊó∂‰∏•ÈáçÔºåÂª∫ËÆÆÂ¢ûÂä†ËøêÂäõË∞ÉÂ∫¶„ÄÇ",actionSuggestion:"Á´ãÂç≥Â§çÁõòË∑ùÁ¶ªÂú® 3km+ ÁöÑËÆ¢ÂçïÊØõÂà©ÔºåËÄÉËôëÁº©Â∞èÈÖçÈÄÅËåÉÂõ¥„ÄÇ"}),i(!1)},1e3);return()=>clearTimeout(u)},[t.lastUpdated]),o?e.jsxs("div",{className:"w-full h-full glass-panel border-neon-purple/30 rounded-2xl flex flex-col items-center justify-center animate-pulse gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-neon-purple/30 border-t-neon-purple animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(as,{size:20,className:"text-neon-purple animate-pulse"})})]}),e.jsx("p",{className:"text-neon-purple font-mono text-xs tracking-widest",children:"AI NEURAL ENGINE PROCESSING..."})]}):s?e.jsxs("div",{className:"w-full h-full glass-panel rounded-2xl p-[1px] relative overflow-hidden group flex flex-col shadow-[0_0_30px_rgba(124,58,237,0.1)]",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-neon-purple via-neon-cyan to-transparent opacity-30 group-hover:opacity-60 transition-opacity duration-1000 blur-lg"}),e.jsxs("div",{className:"bg-slate-950/90 backdrop-blur-xl rounded-xl p-6 relative z-10 flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 border-b border-white/10 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-1.5 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg shadow-lg shadow-purple-500/20",children:e.jsx(Je,{size:18,className:"text-white fill-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-white tracking-wide leading-tight",children:"AI ÂÜ≥Á≠ñÂ§ßËÑë"}),e.jsx("p",{className:"text-[11px] text-slate-400 font-mono",children:"CLICK TO LOCATE ISSUES"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-neon-green font-mono",children:"ACTIVE"}),e.jsx("div",{className:"h-2 w-2 bg-neon-green rounded-full shadow-[0_0_10px_#4ade80] animate-pulse"})]})]}),e.jsxs("div",{className:"mb-6 relative",children:[e.jsx("div",{className:"absolute -left-2 top-0 bottom-0 w-1 bg-gradient-to-b from-neon-purple to-transparent rounded-full opacity-50"}),e.jsxs("p",{className:"pl-4 text-lg font-medium text-white leading-relaxed italic",children:['"',s.summary,'"']})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-3 overflow-y-auto pr-1 custom-scrollbar",children:[e.jsx(We,{icon:e.jsx(Me,{size:14,className:l==="cost"?"text-white":"text-neon-rose"}),tag:"ÊàêÊú¨Ê£ÄÊµã",value:s.costProblem,color:"rose",onClick:()=>a&&a("cost"),isActive:l==="cost"}),e.jsx(We,{icon:e.jsx(St,{size:14,className:l==="efficiency"?"text-white":"text-neon-yellow"}),tag:"ÊïàÁéáËØäÊñ≠",value:s.timeOpportunity,color:"yellow",onClick:()=>a&&a("efficiency"),isActive:l==="efficiency"}),e.jsx(We,{icon:e.jsx(qe,{size:14,className:l==="profit"?"text-white":"text-neon-green"}),tag:"Â¢ûÈïøÂª∫ËÆÆ",value:s.actionSuggestion,color:"green",onClick:()=>a&&a("profit"),isActive:l==="profit"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/5 flex justify-between items-center text-xs text-slate-400 group/btn cursor-pointer hover:text-white transition-colors",children:[e.jsx("span",{className:"font-mono",children:"GENERATE_REPORT.PDF"}),e.jsx(_e,{size:14,className:"group-hover/btn:translate-x-1 transition-transform"})]})]})]}):null},We=({icon:t,tag:a,value:l,color:s,onClick:r,isActive:o})=>{const i={rose:"hover:bg-rose-500/10 hover:border-rose-500/40",yellow:"hover:bg-yellow-500/10 hover:border-yellow-500/40",green:"hover:bg-emerald-500/10 hover:border-emerald-500/40"},u={rose:"text-rose-400 bg-rose-500/10 border-rose-500/20",yellow:"text-yellow-400 bg-yellow-500/10 border-yellow-500/20",green:"text-emerald-400 bg-emerald-500/10 border-emerald-500/20"},p={rose:"bg-rose-500 border-rose-400 shadow-[0_0_20px_rgba(244,63,94,0.3)]",yellow:"bg-yellow-500 border-yellow-400 shadow-[0_0_20px_rgba(250,204,21,0.3)]",green:"bg-emerald-500 border-emerald-400 shadow-[0_0_20px_rgba(16,185,129,0.3)]"};return e.jsxs("button",{onClick:r,className:`relative p-3.5 rounded-xl border text-left transition-all duration-300 group/item flex flex-col gap-2 outline-none
        ${o?`${p[s]} scale-[1.02] z-10 border-transparent`:`border-white/5 bg-white/[0.02] ${i[s]} hover:scale-[1.01]`}
      `,children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:`flex items-center gap-2 px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider border ${o?"bg-white/20 text-white border-transparent":u[s]}`,children:[t,a]}),o?e.jsx(He,{size:14,className:"text-white animate-pulse"}):e.jsx(rs,{size:14,className:"text-slate-600 group-hover/item:text-white transition-colors opacity-0 group-hover/item:opacity-100"})]}),e.jsx("p",{className:`text-xs leading-relaxed transition-colors ${o?"text-white/95 font-medium":"text-slate-400 group-hover/item:text-slate-200"}`,children:l})]})},Us=({data:t})=>{const[a,l]=n.useState(1),s=5,r=()=>{console.log("Exporting data...")},o=n.useMemo(()=>{const f=(a-1)*s;return t.slice(f,f+s)},[t,a]),i=Math.ceil(t.length/s),u=f=>{f>=1&&f<=i&&l(f)},p=({channel:f})=>{const d=f.marketingRate>.2;return e.jsxs("div",{className:"glass-panel p-4 mb-3 rounded-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 bg-indigo-500 rounded-full"}),e.jsx("h4",{className:"font-bold text-white",children:f.name})]}),e.jsxs("span",{className:"text-neon-green font-mono font-bold",children:["¬•",f.profit.toLocaleString()]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-slate-400 items-center",children:[e.jsx("span",{children:"Ëê•Êî∂Ë¥°ÁåÆ"}),e.jsxs("span",{className:"text-slate-200 font-mono",children:["¬•",f.revenue.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-slate-400 items-center",children:[e.jsx("span",{children:"Ëê•ÈîÄÂç†ÊØî"}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx(jt,{size:12,className:"text-neon-rose"}),e.jsxs("span",{className:`${d?"text-neon-rose":"text-slate-200"} font-mono`,children:[(f.marketingRate*100).toFixed(1),"%"]})]})]}),e.jsx("div",{className:"w-full h-1 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${d?"bg-neon-rose":"bg-indigo-500"}`,style:{width:`${Math.min(f.marketingRate*100*2,100)}%`}})})]})]})};return e.jsxs("div",{className:"glass-panel rounded-2xl overflow-hidden flex flex-col h-full",children:[e.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-white/[0.02]",children:[e.jsx("div",{children:e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:["Ê∏†ÈÅìÊïàÁõäÁü©Èòµ",e.jsx("span",{className:"text-[10px] bg-slate-800 text-slate-400 px-2 py-0.5 rounded border border-white/5",children:"LIVE"})]})}),e.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-3 py-1.5 bg-white/5 hover:bg-white/10 text-slate-300 hover:text-white border border-white/5 rounded-lg text-xs font-medium transition-all",children:[e.jsx(ns,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:"ÂØºÂá∫Êï∞ÊçÆ"})]})]}),e.jsx("div",{className:"md:hidden p-4",children:o.map(f=>e.jsx(p,{channel:f},f.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto flex-1",children:e.jsxs("table",{className:"min-w-full divide-y divide-white/5",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-950/30",children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-400 uppercase tracking-wider font-mono",children:"Ê∏†ÈÅìÂêçÁß∞"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono",children:"GMV Ëê•Êî∂"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-400 uppercase tracking-wider font-mono pl-10",children:"Ëê•ÈîÄÊïàÁéá (Marketing %)"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono",children:"Â±•Á∫¶ÊàêÊú¨"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono",children:"ÂáÄÂà©Ê∂¶"}),e.jsx("th",{className:"px-4 py-4"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5 bg-slate-900/10",children:o.map(f=>{const d=f.marketingRate>.2,x=f.marketingRate*100,m=Math.min(x*3,100);return e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors group",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold bg-slate-800 border border-white/5 text-slate-300",children:f.name.charAt(0)}),e.jsx("span",{className:"text-sm font-medium text-slate-200",children:f.name})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("span",{className:"text-sm font-mono text-slate-300",children:["¬•",f.revenue.toLocaleString()]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap pl-10",children:e.jsxs("div",{className:"flex flex-col gap-1.5 w-32",children:[e.jsx("div",{className:"flex justify-between items-center text-xs",children:e.jsxs("span",{className:`font-mono ${d?"text-neon-rose font-bold":"text-slate-400"}`,children:[x.toFixed(1),"%"]})}),e.jsx("div",{className:"w-full h-1.5 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{style:{width:`${m}%`},className:`h-full rounded-full transition-all duration-500 ${d?"bg-neon-rose shadow-[0_0_8px_rgba(244,63,94,0.5)]":"bg-indigo-500"}`})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("span",{className:"text-sm font-mono text-slate-300",children:["¬•",f.costs.delivery.toLocaleString()]}),e.jsxs("span",{className:"text-[10px] text-slate-500 font-mono",children:["ÂçïÂùá ¬•",f.avgDeliveryCost.toFixed(1)]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("span",{className:"text-sm font-bold font-mono text-neon-green",children:["¬•",f.profit.toLocaleString()]})}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("button",{className:"text-slate-600 hover:text-white transition-colors",children:e.jsx(os,{size:16})})})]},f.id)})})]})}),i>1&&e.jsxs("div",{className:"p-3 border-t border-white/5 bg-slate-900/20 flex items-center justify-end gap-3",children:[e.jsxs("span",{className:"text-xs text-slate-400 font-mono",children:["Page ",a," of ",i]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>u(a-1),disabled:a===1,className:"p-1 rounded hover:bg-white/5 disabled:opacity-30 text-slate-300 disabled:cursor-not-allowed",children:e.jsx(Oe,{size:16})}),e.jsx("button",{onClick:()=>u(a+1),disabled:a===i,className:"p-1 rounded hover:bg-white/5 disabled:opacity-30 text-slate-300 disabled:cursor-not-allowed",children:e.jsx(_e,{size:16})})]})]})]})},Hs=({onCommand:t,isProcessing:a})=>{const[l,s]=n.useState(""),[r,o]=n.useState(!1),i=u=>{u.preventDefault(),l.trim()&&(t(l),s(""))};return e.jsxs("div",{className:`relative w-full max-w-2xl mx-auto transition-all duration-300 z-50 ${r?"scale-105":"scale-100"}`,children:[e.jsx("div",{className:`absolute -inset-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-2xl blur opacity-25 transition-opacity duration-500 ${r?"opacity-75":"opacity-25"}`}),e.jsxs("form",{onSubmit:i,className:"relative glass-panel rounded-xl p-1 flex items-center gap-2 shadow-2xl",children:[e.jsx("div",{className:"pl-3 text-neon-purple",children:e.jsx(Je,{size:20,className:a?"animate-spin":""})}),e.jsx("input",{type:"text",value:l,onChange:u=>s(u.target.value),onFocus:()=>o(!0),onBlur:()=>o(!1),placeholder:a?"AI Ê≠£Âú®ÂàÜÊûêÊï∞ÊçÆ...":"Ask AI: 'Show me coffee sales from last weekend'...",className:"flex-1 bg-transparent border-none outline-none text-white placeholder-slate-400 h-10 px-2 font-mono text-sm",disabled:a}),e.jsxs("div",{className:"hidden md:flex items-center gap-1.5 px-2 py-1 bg-white/5 rounded text-[10px] text-slate-500 font-mono border border-white/5",children:[e.jsx(ls,{size:10}),e.jsx("span",{children:"K"})]}),e.jsx("button",{type:"submit",disabled:!l.trim()||a,className:"p-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(is,{size:16})})]})]})},Gs=({selectedDate:t,selectedDateRange:a,theme:l})=>{const[s,r]=n.useState(null),[o,i]=n.useState(!1),[u,p]=n.useState([]),{selectedStore:f,dateRange:d}=ce(),x=l==="dark",m=x?"#fff":"#0f172a",c=x?"#94a3b8":"#64748b";n.useEffect(()=>{(async()=>{if(!f){r(null);return}i(!0);try{const O={store_name:f};a?(O.start_date=a.start,O.end_date=a.end):t?O.date=t:d.type!=="all"&&d.start&&d.end&&(O.start_date=d.start,O.end_date=d.end);const E=await ie.getCategoryHourlyTrend(O);E.success&&E.data&&(r(E.data),p([]))}catch(O){console.error("Ëé∑ÂèñÂìÅÁ±ªË∂ãÂäøÊï∞ÊçÆÂ§±Ë¥•:",O)}finally{i(!1)}})()},[f,t,a,d.type,d.start,d.end]);const b=n.useMemo(()=>!s||s.categories.length===0?[]:u.length>0?s.categories.filter(z=>u.includes(z)):s.categories.slice(0,5),[s,u]),w=n.useMemo(()=>s?s.series.filter(z=>b.includes(z.name)):[],[s,b]),h=n.useMemo(()=>{if(!s||s.labels.length===0||w.length===0)return{graphic:{type:"text",left:"center",top:"middle",style:{text:"ÊöÇÊó†Êï∞ÊçÆ",fill:c,fontSize:14}}};const z=["#8b5cf6","#3b82f6","#06b6d4","#10b981","#f59e0b","#ef4444","#ec4899","#6366f1"],O=w.map((E,M)=>({name:E.name,type:"line",stack:"Total",smooth:!0,areaStyle:{opacity:.8},emphasis:{focus:"series"},showSymbol:!1,data:E.data,itemStyle:{color:z[M%z.length]}}));return{color:z,graphic:[],grid:{left:10,right:10,top:40,bottom:10,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},backgroundColor:x?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",textStyle:{color:x?"#fff":"#0f172a"},borderWidth:0,formatter:E=>{if(!Array.isArray(E)||E.length===0)return"";const M=E[0].axisValue,I=E[0].dataIndex,H=s.series.map(_=>({name:_.name,value:_.data[I]||0})).filter(_=>_.value>0).sort((_,F)=>F.value-_.value),K=H.reduce((_,F)=>_+F.value,0),D=u.length>0?H.filter(_=>u.includes(_.name)):H.slice(0,5),W=D.reduce((_,F)=>_+F.value,0);let v=`<div style="font-size:12px;font-weight:bold;margin-bottom:8px;color:${c}">${M} ÂêàËÆ°: ¬•${W.toLocaleString()}</div>`;return D.forEach((_,F)=>{const A=K>0?(_.value/K*100).toFixed(1):"0.0",S=z[F%z.length];v+=`
              <div style="display:flex;justify-content:space-between;align-items:center;gap:24px;font-size:12px;margin-bottom:4px">
                <div style="display:flex;align-items:center;gap:6px">
                  <span style="width:8px;height:8px;border-radius:50%;background:${S}"></span>
                  <span style="color:${x?"#e2e8f0":"#475569"}">${_.name}</span>
                </div>
                <div style="display:flex;align-items:center;gap:12px">
                  <span style="font-weight:bold;color:${x?"#fff":"#0f172a"}">¬•${_.value.toLocaleString()}</span>
                  <span style="font-size:10px;width:40px;text-align:right;color:${c}">${A}%</span>
                </div>
              </div>
            `}),v}},legend:{data:b,top:0,textStyle:{color:c,fontSize:11},icon:"roundRect"},xAxis:{type:"category",boundaryGap:!1,data:s.labels,axisLabel:{color:c,fontSize:10},axisLine:{show:!1}},yAxis:{type:"value",splitLine:{lineStyle:{type:"dashed",color:x?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}},axisLabel:{color:c,fontSize:10,formatter:E=>`¬•${E/1e3}k`}},series:O}},[s,w,b,x,c]),C=me(h,[s,l,u,b.length],l),L=z=>{p(O=>O.includes(z)?O.filter(E=>E!==z):[...O,z])},P=()=>{p([])},T=n.useMemo(()=>a?a.start===a.end?`${a.start.slice(5)} ÂìÅÁ±ªÈîÄÂîÆËµ∞Âäø`:`${a.start.slice(5)} ~ ${a.end.slice(5)} ÂìÅÁ±ªÈîÄÂîÆËµ∞Âäø`:t?`${t.slice(5)} ÂàÜÊó∂ÊÆµÂìÅÁ±ªËµ∞Âäø`:d.type!=="all"&&d.start&&d.end?d.start===d.end?`${d.start.slice(5)} ÂìÅÁ±ªÈîÄÂîÆËµ∞Âäø`:`${d.start.slice(5)} ~ ${d.end.slice(5)} ÂìÅÁ±ªÈîÄÂîÆËµ∞Âäø`:"Ëøë7Â§©ÂìÅÁ±ªÈîÄÂîÆÂç†ÊØî",[a,t,d]),j=n.useMemo(()=>a||d.type!=="all"&&d.start&&d.end?"DATE RANGE TREND":t?"HOURLY TREND & SHARE":"CATEGORY REVENUE COMPOSITION",[a,t,d]);return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col relative overflow-hidden transition-all duration-500",children:[o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 z-20 rounded-2xl",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-violet-500"})}),e.jsxs("div",{className:"mb-2 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:m},children:[e.jsx(ke,{size:18,className:"text-violet-400"}),T]}),e.jsxs("p",{className:"text-xs mt-1 font-mono uppercase tracking-wider opacity-70",style:{color:c},children:[j," ¬∑",u.length>0?` Â∑≤ÈÄâ ${u.length} ‰∏™ÂàÜÁ±ª`:` TOP ${b.length}`]})]}),e.jsx(Ks,{categories:(s==null?void 0:s.categories)||[],selectedCategories:u,onToggle:L,onReset:P,isDark:x})]}),e.jsx("div",{className:"flex-1 w-full min-h-[250px]",children:e.jsx("div",{ref:C,className:"w-full h-full"})})]})},Ks=({categories:t,selectedCategories:a,onToggle:l,onReset:s,isDark:r})=>{const[o,i]=n.useState(!1),[u,p]=n.useState(""),f=n.useRef(null),d=n.useRef(null),x=n.useRef(null);n.useEffect(()=>{const b=w=>{const h=w.target;o&&f.current&&!f.current.contains(h)&&d.current&&!d.current.contains(h)&&(i(!1),p(""))};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[o]),n.useEffect(()=>{o&&x.current&&setTimeout(()=>{var b;return(b=x.current)==null?void 0:b.focus()},100)},[o]);const m=n.useMemo(()=>{if(!u)return t;const b=u.toLowerCase();return t.filter(w=>w.toLowerCase().includes(b))},[t,u]),c=a.length>0?`Â∑≤ÈÄâ ${a.length} È°π`:"TOP 5";return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:f,onClick:()=>i(!o),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-medium transition-all duration-200 ${r?"bg-white/5 hover:bg-white/10 border-white/10 text-slate-300":"bg-black/5 hover:bg-black/10 border-black/10 text-slate-600"} ${a.length>0?"border-violet-500/50 bg-violet-500/10":""}`,children:[e.jsx(ke,{size:12,className:"text-violet-400"}),e.jsx("span",{children:c}),e.jsx(Ce,{size:12,className:`text-slate-400 transition-transform ${o?"rotate-180":""}`})]}),o&&e.jsxs("div",{ref:d,className:`absolute top-full right-0 mt-2 w-56 rounded-xl border shadow-2xl z-50 overflow-hidden animate-fade-in-up ${r?"bg-slate-900 border-white/10":"bg-white border-black/10"}`,children:[e.jsx("div",{className:`p-2 border-b ${r?"border-white/10":"border-black/10"}`,children:e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${r?"bg-white/5":"bg-black/5"}`,children:[e.jsx(bt,{size:14,className:"text-slate-400"}),e.jsx("input",{ref:x,type:"text",value:u,onChange:b=>p(b.target.value),placeholder:"ÊêúÁ¥¢ÂàÜÁ±ª...",className:`flex-1 bg-transparent text-xs outline-none ${r?"text-white placeholder-slate-500":"text-slate-900 placeholder-slate-400"}`}),u&&e.jsx("button",{onClick:()=>p(""),className:"text-slate-400 hover:text-slate-300",children:e.jsx(Nt,{size:12})})]})}),e.jsxs("div",{className:`px-2 py-1.5 border-b flex justify-between items-center ${r?"border-white/10":"border-black/10"}`,children:[e.jsxs("span",{className:`text-[10px] ${r?"text-slate-500":"text-slate-400"}`,children:[m.length," ‰∏™ÂàÜÁ±ª"]}),a.length>0&&e.jsx("button",{onClick:s,className:"text-[10px] text-violet-400 hover:text-violet-300",children:"ÈáçÁΩÆ‰∏∫ TOP5"})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto custom-scrollbar",children:m.length===0?e.jsx("div",{className:`px-4 py-3 text-xs text-center ${r?"text-slate-500":"text-slate-400"}`,children:"Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÂàÜÁ±ª"}):m.map(b=>{const w=a.includes(b),h=t.indexOf(b),C=!u&&a.length===0&&h<5&&h>=0;return e.jsxs("button",{onClick:()=>l(b),className:`w-full flex items-center justify-between px-4 py-2.5 text-xs transition-colors ${w||C?"bg-violet-500/20 text-violet-300":r?"text-slate-300 hover:bg-white/5":"text-slate-600 hover:bg-black/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${w||C?"bg-violet-400":r?"bg-slate-600":"bg-slate-300"}`}),e.jsx("span",{className:"truncate max-w-[140px]",children:b}),C&&e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-violet-500/30 text-violet-300",children:["TOP",h+1]})]}),w&&e.jsx(be,{size:12,className:"text-violet-400"})]},b)})})]})]})},qs=({selectedDate:t,selectedDateRange:a,theme:l})=>{const[s,r]=n.useState("quantity"),[o,i]=n.useState(null),[u,p]=n.useState(!1),{selectedStore:f,dateRange:d}=ce(),x=l==="dark",m=x?"#fff":"#0f172a",c=x?"#94a3b8":"#64748b";n.useEffect(()=>{(async()=>{if(!f){i(null);return}p(!0);try{const j={store_name:f,sort_by:s,limit:15};a?(j.start_date=a.start,j.end_date=a.end):t?j.date=t:d.type!=="all"&&d.start&&d.end&&(j.start_date=d.start,j.end_date=d.end);const z=await ie.getTopProductsByDate(j);z.success&&z.data&&i(z.data)}catch(j){console.error("Ëé∑ÂèñÂïÜÂìÅÊéíË°åÊï∞ÊçÆÂ§±Ë¥•:",j)}finally{p(!1)}})()},[f,t,a,d.type,d.start,d.end,s]);const b=n.useMemo(()=>{switch(s){case"quantity":return{colorStart:"#34d399",colorEnd:"#059669",label:"ÈîÄÈáè",unit:"",valueKey:"quantity"};case"revenue":return{colorStart:"#818cf8",colorEnd:"#4f46e5",label:"Ëê•Êî∂",unit:"¬•",valueKey:"revenue"};case"profit":return{colorStart:"#fbbf24",colorEnd:"#d97706",label:"ÊØõÂà©",unit:"¬•",valueKey:"profit"};case"loss":return{colorStart:"#f43f5e",colorEnd:"#be123c",label:"‰∫èÊçü/‰ΩéÂà©",unit:"¬•",valueKey:"profit"};default:return{colorStart:"#34d399",colorEnd:"#059669",label:"ÈîÄÈáè",unit:"",valueKey:"quantity"}}},[s]),w=n.useMemo(()=>{if(!o||o.products.length===0)return 100;const T=o.products.map(j=>Math.abs(j[b.valueKey]||0));return Math.max(...T)},[o,b.valueKey]),h=n.useMemo(()=>{if(!o||o.products.length===0)return{graphic:{type:"text",left:"center",top:"middle",style:{text:"ÊöÇÊó†Êï∞ÊçÆ",fill:c,fontSize:14}}};const T=o.products,j=T.map((E,M)=>{const I=M+1;let H=E.name;return H.length>20&&(H=H.slice(0,20)+"..."),`${I}. ${H}`}),z=T.map(E=>Math.abs(E[b.valueKey]||0)),O=T.map((E,M)=>M===0?"#fbbf24":M===1?"#94a3b8":M===2?"#cd7f32":new oe(0,0,1,0,[{offset:0,color:b.colorStart},{offset:1,color:b.colorEnd}]));return{graphic:[],grid:{left:0,right:35,top:5,bottom:5,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:x?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:x?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",textStyle:{color:x?"#fff":"#0f172a"},formatter:E=>{if(!Array.isArray(E)||E.length===0)return"";const M=E[0].dataIndex,I=T[M];if(!I)return"";const H=I.growth||0,K=H>0?"#34d399":H<0?"#f43f5e":"#94a3b8",k=H>0?"‚ñ≤":H<0?"‚ñº":"-";return`
            <div style="font-weight:bold;margin-bottom:4px;display:flex;justify-content:space-between;gap:16px">
              <span>${I.name}</span>
              <span style="color:${K};font-family:monospace">${k} ${Math.abs(H)}%</span>
            </div>
            <div style="font-size:12px;color:${c};margin-bottom:8px">ÂàÜÁ±ª: ${I.category}</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px 16px;font-size:12px">
              <span style="color:${c}">ÈîÄÈáè:</span>
              <span style="font-family:monospace;text-align:right;font-weight:bold;color:${x?"#fff":"#0f172a"}">${I.quantity}</span>
              <span style="color:${c}">Ëê•Êî∂:</span>
              <span style="font-family:monospace;text-align:right;font-weight:bold;color:#818cf8">¬•${Math.round(I.revenue).toLocaleString()}</span>
              <span style="color:${c}">ÊØõÂà©:</span>
              <span style="font-family:monospace;text-align:right;font-weight:bold;color:${I.profit>=0?"#34d399":"#f43f5e"}">¬•${Math.round(I.profit).toLocaleString()}</span>
            </div>
          `}},xAxis:{type:"value",show:!1,max:w*1.05},yAxis:{type:"category",data:j,inverse:!0,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:x?"#cbd5e1":"#475569",fontSize:11,fontWeight:"normal",formatter:(E,M)=>{const I=String(E);return M===0?`{gold|${I}}`:M===1?`{silver|${I}}`:M===2?`{bronze|${I}}`:I},rich:{gold:{color:"#fbbf24",fontWeight:"bold",fontSize:11},silver:{color:"#94a3b8",fontWeight:"bold",fontSize:11},bronze:{color:"#cd7f32",fontWeight:"bold",fontSize:11}}}},series:[{type:"bar",data:T.map(()=>w*1.05),barWidth:12,barGap:"-100%",z:0,itemStyle:{color:x?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.03)",borderRadius:6},tooltip:{show:!1},animation:!1},{type:"bar",data:z.map((E,M)=>({value:E,itemStyle:{color:O[M],borderRadius:6}})),barWidth:12,label:{show:!0,position:"right",formatter:E=>{const M=Math.round(E.value);return`${b.unit}${M.toLocaleString()}`},color:x?"#e2e8f0":"#475569",fontSize:11,fontFamily:"JetBrains Mono, monospace",fontWeight:"bold"}}]}},[o,b,w,x,c]),C=me(h,[o,s,l],l),L=[{id:"quantity",label:"ÈîÄÈáèÊ¶ú",icon:e.jsx(Qe,{size:12}),color:"emerald"},{id:"revenue",label:"Ëê•Êî∂Ê¶ú",icon:e.jsx(Ae,{size:12}),color:"indigo"},{id:"profit",label:"ÊØõÂà©Ê¶ú",icon:e.jsx(Ke,{size:12}),color:"amber"},{id:"loss",label:"‰∫èÊçüÊ¶ú",icon:e.jsx(Me,{size:12}),color:"rose"}],P=n.useMemo(()=>a?a.start===a.end?`${a.start.slice(5)} ÂïÜÂìÅ${b.label}`:`${a.start.slice(5)}~${a.end.slice(5)} ÂïÜÂìÅ${b.label}`:t?`${t.slice(5)} ÂïÜÂìÅ${b.label}`:d.type!=="all"&&d.start&&d.end?d.start===d.end?`${d.start.slice(5)} ÂïÜÂìÅ${b.label}`:`${d.start.slice(5)}~${d.end.slice(5)} ÂïÜÂìÅ${b.label}`:`ÂïÜÂìÅ${b.label} TOP 15`,[a,t,d,b.label]);return e.jsxs("div",{className:"glass-panel rounded-2xl p-4 h-full flex flex-col relative overflow-hidden",children:[u&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 z-20 rounded-2xl",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"})}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s==="quantity"&&e.jsx(Qe,{size:16,className:"text-emerald-400"}),s==="revenue"&&e.jsx(Ae,{size:16,className:"text-indigo-400"}),s==="profit"&&e.jsx(Ke,{size:16,className:"text-amber-400"}),s==="loss"&&e.jsx(Me,{size:16,className:"text-rose-400"}),e.jsx("h3",{className:"text-base font-bold",style:{color:m},children:P})]}),e.jsxs("span",{className:"text-[10px] font-mono uppercase tracking-wider opacity-50",style:{color:c},children:["BY ",b.valueKey.toUpperCase()]})]}),e.jsx("div",{className:"flex p-0.5 bg-slate-900/50 rounded-lg border border-white/5 w-fit mb-3",children:L.map(T=>{const j=s===T.id;let z="";return j?(T.color==="emerald"&&(z="bg-emerald-500 text-white shadow-lg shadow-emerald-500/20"),T.color==="indigo"&&(z="bg-indigo-500 text-white shadow-lg shadow-indigo-500/20"),T.color==="amber"&&(z="bg-amber-500 text-white shadow-lg shadow-amber-500/20"),T.color==="rose"&&(z="bg-rose-500 text-white shadow-lg shadow-rose-500/20")):z="text-slate-400 hover:text-white hover:bg-white/5",e.jsxs("button",{onClick:()=>r(T.id),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-bold transition-all duration-300 ${z}`,children:[T.icon,T.label]},T.id)})}),e.jsx("div",{className:"flex-1 w-full min-h-0",children:e.jsx("div",{ref:C,className:"w-full h-full"})})]})},Ys={getHealth(t){return Q.get("/category/health",{params:t})}},Js=()=>{const[t,a]=n.useState([]),[l,s]=n.useState(!1),[r,o]=n.useState("preset"),[i,u]=n.useState(7),[p,f]=n.useState(""),[d,x]=n.useState(""),[m,c]=n.useState(""),[b,w]=n.useState(!1),[h,C]=n.useState(!1),[L,P]=n.useState(),[T,j]=n.useState(null),[z,O]=n.useState("current_revenue"),[E,M]=n.useState("desc"),[I,H]=n.useState(null),K=n.useRef(null),k=n.useRef(null),D=n.useRef(null),W=n.useRef(null),{selectedStore:v,storeDateRange:_,channelList:F}=ce(),A=_!=null&&_.min_date?he(_.min_date,"yyyy-MM-dd",new Date):void 0,S=_!=null&&_.max_date?he(_.max_date,"yyyy-MM-dd",new Date):void 0;n.useEffect(()=>{m&&F.length>0&&!F.includes(m)&&c("")},[F,m]),n.useEffect(()=>{const $=J=>{const se=J.target;b&&K.current&&!K.current.contains(se)&&k.current&&!k.current.contains(se)&&w(!1),h&&D.current&&!D.current.contains(se)&&W.current&&!W.current.contains(se)&&C(!1)};return document.addEventListener("mousedown",$),()=>document.removeEventListener("mousedown",$)},[b,h]);const V=n.useCallback($=>!!(A&&pt($,A)||S&&ht($,S)),[A,S]),U=n.useCallback(()=>{if(r==="custom"&&p&&d){const $=he(p,"yyyy-MM-dd",new Date),J=he(d,"yyyy-MM-dd",new Date);Te($)&&Te(J)&&P({from:$,to:J})}else P(void 0);C(!0)},[r,p,d]),Y=n.useCallback(()=>{L!=null&&L.from&&(L!=null&&L.to)&&(f(ge(L.from,"yyyy-MM-dd")),x(ge(L.to,"yyyy-MM-dd")),o("custom"),C(!1))},[L]),G=n.useCallback(async()=>{s(!0);try{const $={store_name:v||void 0,channel:m||void 0,level:T?3:1,parent_category:T||void 0};r==="custom"&&p&&d?($.start_date=p,$.end_date=d):$.period=i;const J=await Ys.getHealth($);J.success&&(a(J.data),H({start:J.period.start,end:J.period.end}))}catch($){console.error("Ëé∑ÂèñÂìÅÁ±ªÂÅ•Â∫∑Â∫¶Êï∞ÊçÆÂ§±Ë¥•:",$),a([])}finally{s(!1)}},[v,m,r,i,p,d,T]),y=n.useCallback(()=>{O("current_revenue"),M("desc"),c(""),o("preset"),u(7),f(""),x(""),P(void 0),G()},[G]),g=$=>{o("preset"),u($),f(""),x(""),P(void 0)},N=$=>{c($),w(!1)};n.useEffect(()=>{G()},[G]);const R=n.useMemo(()=>[...t].sort(($,J)=>{const se=$[z],B=J[z],Z=se-B;return E==="desc"?-Z:Z}),[t,z,E]),q=$=>{z===$?M(J=>J==="desc"?"asc":"desc"):(O($),M("desc"))},X=$=>{j($)},re=()=>{j(null)},ne=$=>$>0?e.jsxs("span",{className:"flex items-center gap-1 text-emerald-400 font-mono",children:[e.jsx(Re,{size:14}),"+",$.toFixed(1),"%"]}):$<0?e.jsxs("span",{className:"flex items-center gap-1 text-rose-400 font-mono",children:[e.jsx(Ye,{size:14}),$.toFixed(1),"%"]}):e.jsxs("span",{className:"flex items-center gap-1 text-slate-400 font-mono",children:[e.jsx(ds,{size:14}),"0%"]}),xe=($,J)=>{const se={‰Ωé:"bg-emerald-500/20 text-emerald-400 border-emerald-500/30",‰∏≠:"bg-amber-500/20 text-amber-400 border-amber-500/30",È´ò:"bg-rose-500/20 text-rose-400 border-rose-500/30"};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium border ${se[$]||se.‰∏≠}`,children:$}),e.jsxs("span",{className:"text-slate-500 text-xs font-mono",children:[J.toFixed(1),"%"]})]})},ye=($,J)=>{const se=$<8?"text-rose-400":$<9?"text-amber-400":"text-slate-300";let B=null;return Math.abs(J)>=.1&&(J>0?B=e.jsxs("span",{className:"text-emerald-400 text-xs ml-1",children:["‚Üë",J.toFixed(1)]}):B=e.jsxs("span",{className:"text-rose-400 text-xs ml-1",children:["‚Üì",Math.abs(J).toFixed(1)]})),e.jsxs("span",{className:`font-mono ${se}`,children:[$.toFixed(1),"Êäò",B]})},de=$=>{const J=$>=40?"text-emerald-400":$>=25?"text-cyan-400":$>=10?"text-amber-400":"text-rose-400";return e.jsxs("span",{className:`font-mono font-medium ${J}`,children:[$.toFixed(1),"%"]})},ee=$=>{if(!$||$.length<2)return null;const J=Math.max(...$),se=Math.min(...$),B=J-se||1,Z=24,ae=60,le=$.map((Pe,zt)=>{const Mt=zt/($.length-1)*ae,Lt=Z-(Pe-se)/B*Z;return`${Mt},${Lt}`}).join(" "),Ie=($[$.length-1]>=$[0]?"up":"down")==="up"?"#34d399":"#f87171";return e.jsx("svg",{width:ae,height:Z,className:"opacity-70",children:e.jsx("polyline",{points:le,fill:"none",stroke:Ie,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})},te=({column:$})=>z!==$?e.jsx(cs,{size:12,className:"text-slate-600"}):E==="desc"?e.jsx(Ce,{size:12,className:"text-indigo-400"}):e.jsx(_e,{size:12,className:"text-indigo-400 rotate-[-90deg]"});return e.jsxs("div",{className:"glass-panel rounded-2xl overflow-hidden flex flex-col h-full",children:[e.jsx("div",{className:"p-6 border-b border-white/5 bg-white/[0.02]",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(qe,{size:18,className:"text-violet-400"}),"ÂìÅÁ±ªÂÅ•Â∫∑Â∫¶ÂàÜÊûê",T&&e.jsxs("span",{className:"text-sm font-normal text-slate-400 ml-2",children:["/ ",T]})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1 font-mono uppercase tracking-wider",children:["CATEGORY HEALTH METRICS ¬∑ ",I?`${I.start} ~ ${I.end}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[T&&e.jsxs("button",{onClick:re,className:"flex items-center gap-1.5 px-3 py-1.5 bg-white/5 hover:bg-white/10 text-slate-300 hover:text-white border border-white/10 rounded-lg text-xs font-medium transition-all",children:[e.jsx(Oe,{size:14}),"ËøîÂõû‰∏äÁ∫ß"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:K,onClick:()=>w(!b),className:"flex items-center gap-2 px-3 py-1.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-xs text-white transition-all",children:[e.jsx("span",{className:"text-cyan-400",children:"Ê∏†ÈÅì:"}),e.jsx("span",{className:"max-w-[80px] truncate",children:m||"ÂÖ®ÈÉ®"}),e.jsx(Ce,{size:12,className:`text-slate-400 transition-transform ${b?"rotate-180":""}`})]}),b&&e.jsxs("div",{ref:k,className:"absolute top-full left-0 mt-2 w-36 bg-slate-900 border border-white/10 rounded-xl shadow-2xl z-50 overflow-hidden animate-fade-in-up",children:[e.jsxs("button",{onClick:()=>N(""),className:`w-full flex items-center justify-between px-4 py-2.5 text-xs transition-colors ${m===""?"bg-cyan-500/20 text-cyan-300":"text-slate-300 hover:bg-white/5"}`,children:[e.jsx("span",{children:"ÂÖ®ÈÉ®Ê∏†ÈÅì"}),m===""&&e.jsx(be,{size:12,className:"text-cyan-400"})]}),F.map($=>e.jsxs("button",{onClick:()=>N($),className:`w-full flex items-center justify-between px-4 py-2.5 text-xs transition-colors ${m===$?"bg-cyan-500/20 text-cyan-300":"text-slate-300 hover:bg-white/5"}`,children:[e.jsx("span",{children:$}),m===$&&e.jsx(be,{size:12,className:"text-cyan-400"})]},$))]})]}),e.jsx("div",{className:"flex items-center bg-slate-800/50 rounded-lg p-0.5 border border-white/5",children:[7,14,30].map($=>e.jsxs("button",{onClick:()=>g($),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-all ${r==="preset"&&i===$?"bg-violet-500 text-white shadow-lg":"text-slate-400 hover:text-white"}`,children:[$,"Â§©"]},$))}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:D,onClick:U,className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border transition-all text-xs ${r==="custom"?"bg-indigo-500/20 border-indigo-500/50 text-indigo-300":"bg-white/5 border-white/10 text-slate-400 hover:bg-white/10 hover:text-white"}`,children:[e.jsx(Ue,{size:14}),e.jsx("span",{children:r==="custom"&&p&&d?`${p} ~ ${d}`:"Ëá™ÂÆö‰πâ"})]}),h&&e.jsxs("div",{ref:W,className:"absolute top-full right-0 mt-2 p-5 rounded-xl border shadow-2xl bg-slate-900 border-white/10 z-50",style:{width:"580px"},children:[e.jsx("style",{children:`
                    .health-calendar .rdp-months {
                      display: flex !important;
                      flex-direction: row !important;
                      gap: 2rem !important;
                    }
                    .health-calendar .rdp-month {
                      margin: 0 !important;
                    }
                  `}),(_==null?void 0:_.min_date)&&(_==null?void 0:_.max_date)&&e.jsx("div",{className:"mb-4 px-3 py-2 bg-indigo-500/10 border border-indigo-500/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-indigo-300",children:["üìÖ ÂèØÈÄâÊï∞ÊçÆËåÉÂõ¥: ",_.min_date," ~ ",_.max_date]})}),e.jsx("div",{className:"health-calendar",style:{display:"flex",justifyContent:"center"},children:e.jsx(yt,{mode:"range",numberOfMonths:2,selected:L,onSelect:P,locale:vt,disabled:V,defaultMonth:S?new Date(S.getFullYear(),S.getMonth()-1):new Date,startMonth:A,endMonth:S,showOutsideDays:!1,classNames:{months:"flex flex-row gap-8",month_caption:"flex justify-center items-center h-10 font-semibold text-sm text-slate-100",nav:"absolute top-0 left-0 right-0 flex justify-between px-2",button_previous:"w-8 h-8 rounded-lg bg-white/5 text-slate-400 flex items-center justify-center hover:bg-white/10 hover:text-slate-100",button_next:"w-8 h-8 rounded-lg bg-white/5 text-slate-400 flex items-center justify-center hover:bg-white/10 hover:text-slate-100",weekday:"text-slate-500 text-xs font-medium py-2",day:"w-9 h-9",day_button:"w-9 h-9 rounded-lg text-slate-300 text-sm hover:bg-white/10 hover:text-white transition-colors",today:"text-indigo-400 ring-1 ring-indigo-500 rounded-lg",selected:"bg-indigo-500 text-white rounded-lg",range_start:"bg-indigo-500 text-white rounded-l-lg rounded-r-none",range_end:"bg-indigo-500 text-white rounded-r-lg rounded-l-none",range_middle:"bg-indigo-500/20 text-indigo-300 rounded-none",disabled:"text-slate-600 opacity-40 cursor-not-allowed",outside:"text-slate-600 opacity-50"},components:{Chevron:({orientation:$})=>$==="left"?e.jsx(Oe,{size:18}):e.jsx(_e,{size:18})}})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:L!=null&&L.from&&(L!=null&&L.to)?e.jsxs("span",{className:"text-emerald-400 font-medium",children:["Â∑≤ÈÄâ: ",ge(L.from,"yyyy-MM-dd")," ~ ",ge(L.to,"yyyy-MM-dd")]}):L!=null&&L.from?e.jsx("span",{className:"text-amber-400",children:"ËØ∑ÈÄâÊã©ÁªìÊùüÊó•Êúü"}):e.jsx("span",{children:"ÁÇπÂáªÈÄâÊã©ÂºÄÂßãÊó•Êúü"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>C(!1),className:"px-4 py-2 text-xs text-slate-400 hover:text-white transition-colors",children:"ÂèñÊ∂à"}),e.jsx("button",{onClick:Y,disabled:!(L!=null&&L.from)||!(L!=null&&L.to),className:"px-5 py-2 bg-indigo-500 text-white rounded-lg text-xs font-medium hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Á°ÆËÆ§ÈÄâÊã©"})]})]})]})]}),e.jsx("button",{onClick:y,disabled:l,className:"p-2 bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white border border-white/5 rounded-lg transition-all",title:"Âà∑Êñ∞Âπ∂ÈáçÁΩÆÊéíÂ∫è",children:e.jsx(ue,{size:14,className:l?"animate-spin":""})})]})]})}),l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 z-10 rounded-2xl",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-violet-500"})}),e.jsx("div",{className:"overflow-auto flex-1 relative",children:e.jsxs("table",{className:"w-full divide-y divide-white/5 border-collapse",style:{tableLayout:"fixed"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"140px"}})," ",e.jsx("col",{style:{width:"110px"}})," ",e.jsx("col",{style:{width:"100px"}})," ",e.jsx("col",{style:{width:"80px"}}),"  ",e.jsx("col",{style:{width:"100px"}})," ",e.jsx("col",{style:{width:"110px"}})," ",e.jsx("col",{style:{width:"110px"}})," ",e.jsx("col",{style:{width:"80px"}}),"  ",e.jsx("col",{style:{width:"80px"}}),"  ",!T&&e.jsx("col",{style:{width:"60px"}})," "]}),e.jsx("thead",{className:"sticky top-0 z-20",children:e.jsxs("tr",{className:"bg-slate-900",children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-slate-400 uppercase tracking-wider font-mono sticky left-0 z-30 bg-slate-900 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.3)]",children:T?"‰∏âÁ∫ßÂàÜÁ±ª":"‰∏ÄÁ∫ßÂàÜÁ±ª"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("current_revenue"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["ÈîÄÂîÆÈ¢ù ",e.jsx(te,{column:"current_revenue"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("growth_rate"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["ÈîÄÂîÆÁéØÊØî ",e.jsx(te,{column:"growth_rate"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("current_quantity"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["ÈîÄÈáè ",e.jsx(te,{column:"current_quantity"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("quantity_growth_rate"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["ÈîÄÈáèÁéØÊØî ",e.jsx(te,{column:"quantity_growth_rate"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("volatility"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Ê≥¢Âä® ",e.jsx(te,{column:"volatility"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("avg_discount"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["ÊäòÊâ£ ",e.jsx(te,{column:"avg_discount"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>q("profit_margin"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["Âà©Ê∂¶Áéá ",e.jsx(te,{column:"profit_margin"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-slate-400 uppercase tracking-wider font-mono bg-slate-900",children:"Ë∂ãÂäø"}),!T&&e.jsx("th",{className:"px-2 py-3 text-center text-xs font-bold text-slate-400 uppercase tracking-wider font-mono bg-slate-900",children:"Êìç‰Ωú"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:R.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:T?9:10,className:"px-4 py-12 text-center text-slate-500",children:"ÊöÇÊó†Êï∞ÊçÆ"})}):R.map(($,J)=>e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors group",style:{animationDelay:`${J*30}ms`},children:[e.jsx("td",{className:"px-3 py-3 whitespace-nowrap sticky left-0 z-10 bg-slate-900 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.3)] group-hover:bg-slate-800 overflow-hidden",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-xs font-bold bg-violet-500/20 border border-violet-500/30 text-violet-300 flex-shrink-0",children:J+1}),e.jsx("span",{className:"text-sm font-medium text-slate-200 truncate",children:$.name})]})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:e.jsxs("span",{className:"text-sm font-mono text-slate-300",children:["¬•",$.current_revenue.toLocaleString()]})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:ne($.growth_rate)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:e.jsx("span",{className:"text-sm font-mono text-slate-300",children:$.current_quantity.toLocaleString()})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:ne($.quantity_growth_rate)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:xe($.volatility_level,$.volatility)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:ye($.avg_discount,$.discount_change)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:de($.profit_margin)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:e.jsx("div",{className:"flex justify-center",children:ee($.daily_revenue)})}),!T&&e.jsx("td",{className:"px-2 py-3 text-center",children:e.jsxs("button",{onClick:()=>X($.name),className:"flex items-center gap-1 px-2 py-1 text-xs text-slate-400 hover:text-violet-400 hover:bg-violet-500/10 rounded transition-all mx-auto",children:[e.jsx(ke,{size:12}),"‰∏ãÈíª"]})})]},$.name))})]})}),e.jsxs("div",{className:"p-3 border-t border-white/5 bg-slate-900/20 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-slate-500 font-mono",children:["ÂÖ± ",t.length," ‰∏™",T?"‰∏âÁ∫ß":"‰∏ÄÁ∫ß","ÂàÜÁ±ª"]}),e.jsx("span",{className:"text-xs text-slate-500",children:"ÁÇπÂáªË°®Â§¥ÂèØÊéíÂ∫è ¬∑ ÁÇπÂáª„Äå‰∏ãÈíª„ÄçÊü•Áúã‰∏âÁ∫ßÂàÜÁ±ª"})]})]})},Xs=({storeName:t,channel:a,theme:l,selectedDate:s,selectedDateRange:r,onDistanceBandSelect:o})=>{var E;const[i,u]=n.useState(null),[p,f]=n.useState(!0),[d,x]=n.useState(null),m=n.useRef(null),c=n.useRef(null),{dateRange:b}=ce(),w=l==="dark",h=w?"#64748b":"#94a3b8",C=w?"#fff":"#0f172a",L=w?"#94a3b8":"#64748b",P=w?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",T=s||void 0;n.useEffect(()=>{if(!t){u(null),f(!1);return}(async()=>{var I,H;f(!0);try{const K={store_name:t,channel:a};T?K.target_date=T:r?(K.start_date=r.start,K.end_date=r.end):b.type!=="all"&&b.start&&b.end&&(K.start_date=b.start,K.end_date=b.end),console.log("üìä DistanceAnalysisChart ËØ∑Ê±ÇÂèÇÊï∞:",K);const k=await ie.getDistanceAnalysis(K);k.success&&k.data&&(console.log("üìä DistanceAnalysisChart ËøîÂõûÊï∞ÊçÆ:",{date:k.data.date,total_orders:(I=k.data.summary)==null?void 0:I.total_orders,bands:(H=k.data.distance_bands)==null?void 0:H.map(D=>`${D.band_label}: ${D.order_count}`)}),u(k.data))}catch(K){console.error("Ëé∑ÂèñÂàÜË∑ùÁ¶ªËÆ¢ÂçïËØäÊñ≠Êï∞ÊçÆÂ§±Ë¥•:",K)}finally{f(!1)}})()},[t,a,T,r,b.type,b.start,b.end]),n.useEffect(()=>{if(!m.current||!i)return;c.current||(c.current=ze(m.current,w?"dark":void 0));const{distance_bands:M,summary:I}=i,H=M.map(A=>A.band_label),K=M.map(A=>A.order_count),k=M.map(A=>A.profit),D=H.indexOf(I.optimal_distance),W=M.map((A,S)=>{const V=S===D;return S===d?new oe(0,0,0,1,[{offset:0,color:"rgba(34, 211, 238, 1)"},{offset:1,color:"rgba(34, 211, 238, 0.5)"}]):V?new oe(0,0,0,1,[{offset:0,color:"rgba(250, 204, 21, 0.9)"},{offset:1,color:"rgba(250, 204, 21, 0.3)"}]):new oe(0,0,0,1,[{offset:0,color:w?"rgba(139, 92, 246, 0.8)":"rgba(139, 92, 246, 0.7)"},{offset:1,color:w?"rgba(139, 92, 246, 0.2)":"rgba(139, 92, 246, 0.1)"}])}),v=D>=0?{silent:!0,data:[[{xAxis:H[D],itemStyle:{color:w?"rgba(250, 204, 21, 0.08)":"rgba(250, 204, 21, 0.1)"}},{xAxis:H[D]}]]}:void 0,_={backgroundColor:"transparent",grid:{top:35,right:45,bottom:25,left:40,containLabel:!0},tooltip:{trigger:"axis",backgroundColor:w?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:w?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:16,textStyle:{fontFamily:"JetBrains Mono",color:w?"#fff":"#0f172a",fontSize:12},axisPointer:{type:"shadow"},formatter:A=>{var g;const S=((g=A[0])==null?void 0:g.axisValue)||"",V=H.indexOf(S),U=M[V];if(!U)return"";const Y=S===I.optimal_distance;let G=`<div style="font-weight:600;margin-bottom:8px;font-size:13px">
            ${S}
            ${Y?'<span style="color:#facc15;margin-left:6px">‚òÖ ÊúÄ‰ºòÂå∫Èó¥</span>':""}
          </div>`;G+=`<div style="display:flex;justify-content:space-between;align-items:center;margin:4px 0">
            <span style="display:flex;align-items:center;gap:6px">
              <span style="width:8px;height:8px;border-radius:50%;background:#8b5cf6"></span>
              ËÆ¢ÂçïÊï∞
            </span>
            <span style="font-weight:600;margin-left:20px">${U.order_count}</span>
          </div>`;const y=U.profit>=0?"#22c55e":"#f43f5e";return G+=`<div style="display:flex;justify-content:space-between;align-items:center;margin:4px 0">
            <span style="display:flex;align-items:center;gap:6px">
              <span style="width:8px;height:8px;border-radius:50%;background:${y}"></span>
              Âà©Ê∂¶
            </span>
            <span style="font-weight:600;margin-left:20px;color:${y}">¬•${U.profit.toFixed(2)}</span>
          </div>`,G+=`<div style="border-top:1px solid ${w?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"};margin:8px 0"></div>`,G+=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:11px">
            <div><span style="color:${w?"#94a3b8":"#64748b"}">ÈîÄÂîÆÈ¢ù:</span> <span style="font-weight:600">¬•${U.revenue.toFixed(0)}</span></div>
            <div><span style="color:${w?"#94a3b8":"#64748b"}">Âà©Ê∂¶Áéá:</span> <span style="font-weight:600;color:${U.profit_rate>=0?"#22c55e":"#f43f5e"}">${U.profit_rate.toFixed(1)}%</span></div>
            <div><span style="color:${w?"#94a3b8":"#64748b"}">ÈÖçÈÄÅÊàêÊú¨:</span> <span style="font-weight:600">¬•${U.delivery_cost.toFixed(0)}</span></div>
            <div><span style="color:${w?"#94a3b8":"#64748b"}">ÈÖçÈÄÅÊàêÊú¨Áéá:</span> <span style="font-weight:600">${U.delivery_cost_rate.toFixed(1)}%</span></div>
            <div><span style="color:${w?"#94a3b8":"#64748b"}">ÂÆ¢Âçï‰ª∑:</span> <span style="font-weight:600">¬•${U.avg_order_value.toFixed(0)}</span></div>
          </div>`,G}},legend:{data:["ËÆ¢ÂçïÊï∞","Âà©Ê∂¶"],top:2,right:5,textStyle:{color:h,fontSize:10},itemWidth:10,itemHeight:10,itemGap:12},xAxis:{type:"category",data:H,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:h,fontSize:10,interval:0,rotate:0}},yAxis:[{type:"value",name:"",position:"left",splitLine:{lineStyle:{color:P,type:"dashed"}},axisLabel:{color:h,fontSize:10},nameTextStyle:{color:h,fontSize:10}},{type:"value",name:"",position:"right",splitLine:{show:!1},axisLabel:{color:h,fontSize:10,formatter:A=>`¬•${A}`},nameTextStyle:{color:h,fontSize:10}}],series:[{name:"ËÆ¢ÂçïÊï∞",type:"bar",z:10,data:K.map((A,S)=>({value:A,itemStyle:{color:W[S],borderRadius:[3,3,0,0],shadowBlur:S===d?15:0,shadowColor:S===d?"rgba(34, 211, 238, 0.6)":"transparent"}})),barWidth:28,barMaxWidth:40,markArea:v,animationDuration:300,animationEasing:"cubicOut"},{name:"Âà©Ê∂¶",type:"line",yAxisIndex:1,data:k,smooth:.3,symbol:"circle",symbolSize:6,z:1,silent:!0,itemStyle:{color:"#22c55e"},lineStyle:{width:2.5,color:"#22c55e",shadowColor:"rgba(34, 197, 94, 0.3)",shadowBlur:8},areaStyle:{color:new oe(0,0,0,1,[{offset:0,color:"rgba(34, 197, 94, 0.15)"},{offset:.5,color:"rgba(34, 197, 94, 0.03)"},{offset:1,color:"rgba(244, 63, 94, 0.08)"}]),opacity:.8},markLine:{silent:!0,symbol:"none",lineStyle:{color:w?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.1)",type:"dashed",width:1},data:[{yAxis:0}],label:{show:!1}}}]};c.current.setOption(_,!0),c.current.off("click"),c.current.on("click","series.bar",A=>{const S=A.dataIndex,V=M[S];V&&(console.log("üìä Êü±Áä∂ÂõæÁÇπÂáª:",V.band_label,S),d===S?(x(null),o&&o(-1,"",0,0)):(x(S),o&&o(S,V.band_label,V.min_distance,V.max_distance)))});const F=()=>{var A;(A=c.current)==null||A.resize()};return window.addEventListener("resize",F),()=>{window.removeEventListener("resize",F)}},[i,w,h,P,d,o]),n.useEffect(()=>{c.current&&(c.current.dispose(),c.current=null)},[l]),n.useEffect(()=>()=>{c.current&&(c.current.dispose(),c.current=null)},[]);const j=i&&i.distance_bands&&i.distance_bands.some(M=>M.order_count>0),z=n.useMemo(()=>{if(i!=null&&i.date){if(i.date.includes("~")){const M=i.date.split("~").map(I=>I.trim());return M.length===2&&M[0]&&M[1]?`${M[0].slice(5)} ~ ${M[1].slice(5)}`:i.date}return i.date.slice(5)}return null},[i==null?void 0:i.date]),O=r!=null;return e.jsxs("div",{className:"glass-panel rounded-2xl p-4 h-full flex flex-col relative",children:[e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-violet-500/5 to-transparent pointer-events-none rounded-b-2xl"}),e.jsxs("div",{className:"mb-2 relative z-10",children:[e.jsxs("h3",{className:"text-base font-bold flex items-center gap-2",style:{color:C},children:[e.jsx("span",{className:"w-1 h-4 bg-gradient-to-b from-violet-400 to-violet-600 rounded-full"}),z?`${z} ÂàÜË∑ùÁ¶ªËØäÊñ≠`:"ÂàÜË∑ùÁ¶ªËØäÊñ≠",(s||O)&&e.jsx("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded-full bg-violet-500/20 text-violet-400 ml-1",children:"Â∑≤ËÅîÂä®"}),d!==null&&(i==null?void 0:i.distance_bands[d])&&e.jsxs("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded-full bg-cyan-500/20 text-cyan-400 ml-1",children:["Â∑≤ÈÄâ: ",i.distance_bands[d].band_label]})]}),e.jsxs("p",{className:"text-[10px] mt-0.5 font-mono uppercase tracking-wider opacity-70",style:{color:L},children:["DISTANCE-BASED ORDER DIAGNOSIS",((E=i==null?void 0:i.summary)==null?void 0:E.optimal_distance)&&e.jsxs("span",{className:"ml-2 normal-case text-yellow-400",children:["(ÊúÄ‰ºò: ",i.summary.optimal_distance,")"]}),d!==null&&e.jsx("span",{className:"ml-2 normal-case text-cyan-400",children:"ÁÇπÂáªÊü±Â≠êÂèñÊ∂àÈÄâ‰∏≠"})]})]}),e.jsx("div",{className:"flex-1 w-full min-h-0",children:t?p?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-sm",style:{color:L},children:"Âä†ËΩΩ‰∏≠..."})}):j?e.jsx("div",{ref:m,className:"w-full h-full"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"text-sm",style:{color:L},children:"ÊöÇÊó†Êï∞ÊçÆ"})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm mb-2",style:{color:L},children:"ËØ∑ÂÖàÈÄâÊã©Èó®Â∫ó"}),e.jsx("div",{className:"text-xs opacity-60",style:{color:L},children:"ÈÄâÊã©Èó®Â∫óÂêéÂ∞ÜÊòæÁ§∫ËØ•Èó®Â∫óÁöÑÈÖçÈÄÅË∑ùÁ¶ªÂàÜÊûê"})]})})})]})},Zs=()=>{const[t,a]=n.useState(!1);return n.useEffect(()=>{let l=0,s=performance.now(),r=0,o;const i=()=>{const u=performance.now();if(l++,u-s>=1e3){if(l<35?r++:r=0,r>=3){a(!0);return}l=0,s=u}o=requestAnimationFrame(i)};return o=requestAnimationFrame(i),()=>cancelAnimationFrame(o)},[]),t};var Se=(t=>(t.MEITUAN="ÁæéÂõ¢Â§ñÂçñ",t.ELEME="È•ø‰∫Ü‰πà",t.DOUYIN="ÊäñÈü≥Âõ¢Ë¥≠",t.OFFLINE="Á∫ø‰∏ãÈó®Â∫ó",t.PRIVATE_DOMAIN="ÁßÅÂüüÂ∞èÁ®ãÂ∫è",t))(Se||{});const Qs=(t,a)=>Array.from({length:24},(s,r)=>`${r.toString().padStart(2,"0")}:00`).map((s,r)=>{let o=.5;r>=11&&r<=13&&(o=2.5),r>=17&&r<=19&&(o=2);const i=Math.floor(t/30*o*(.8+Math.random()*.4));return{hour:s,orders:i,revenue:i*45,deliveryCost:i*a*(r>=11&&r<=13?1.2:1)}}),ea=t=>[{range:"0-1km",orders:Math.floor(t*.4),avgDeliveryCost:3.5},{range:"1-3km",orders:Math.floor(t*.45),avgDeliveryCost:5.8},{range:"3km+",orders:Math.floor(t*.15),avgDeliveryCost:9.2}],ta=(t,a,l)=>{const s=[],r=new Date,o=t/30,i=a/30;for(let u=29;u>=0;u--){const p=new Date(r);p.setDate(p.getDate()-u);const d=p.getDay()===0||p.getDay()===6?1.2:.9,x=.8+Math.random()*.4,m=Math.floor(o*d*x),c=Math.floor(m*(l+(Math.random()-.5)*.1));s.push({date:p.toISOString().split("T")[0].slice(5),revenue:m,profit:c,orders:Math.floor(i*d*x)})}return s},sa=t=>{const a=[{name:"Áé∞Á£®ÂíñÂï°",items:["ÁîüÊ§∞ÊãøÈìÅ","ÂÜ∞ÁæéÂºè","ÁÑ¶Á≥ñÁéõÂ•áÊúµ","ÁáïÈ∫¶ÊãøÈìÅ","DirtyËÑèÂíñ","Âç°Â∏ÉÂ•áËØ∫","Êæ≥ÁôΩ","ÊÑèÂºèÊµìÁº©"],baseMargin:.65},{name:"‰∫∫Ê∞îÁÉ≠È£ü",items:["ËÄÅÂùõÈÖ∏ËèúÈ±º","Â∞èÁÇíÈªÑÁâõËÇâ","È∫ªÂ©ÜË±ÜËÖê","Á∫¢ÁÉßËÇâ","ÂÆ´‰øùÈ∏°‰∏Å","È±ºÈ¶ôËÇâ‰∏ù","Áï™ËåÑÁÇíËõã","Ê¢ÖËèúÊâ£ËÇâ","Â§ßÁõòÈ∏°"],baseMargin:.35},{name:"Ë∂ÖÂÄºÂ•óÈ§ê",items:["Âçï‰∫∫Â∑•‰ΩúÈ§ê","Âèå‰∫∫ÂàÜ‰∫´Ê°∂","ÂÖ®ÂÆ∂Á¶èÂ•óÈ§ê","ÂïÜÂä°‰ºöËÆÆÈ§ê","ÊÉÖ‰æ£Á∫¶‰ºöÈ§ê"],baseMargin:.25},{name:"ÁÉòÁÑôÁîúÁÇπ",items:["ÊèêÊãâÁ±≥Ëãè","Á∫ΩÁ∫¶ËäùÂ£´","Á∫¢‰∏ùÁªí","ÈªëÊ£ÆÊûó","Ê¶¥Ëé≤ÂçÉÂ±Ç","ËõãÊåû(3Âè™)","Ëè†ËêùÂåÖ"],baseMargin:.55}];let l=[];return a.forEach(s=>{s.items.forEach(r=>{const o=Math.random()*.1+.01,i=Math.floor(t*.25*o),u=s.baseMargin+(Math.random()*.2-.1),p=Math.floor(i*u),f=Math.floor(i/(30+Math.random()*20));l.push({name:`${s.name}|${r}`,revenue:i,cost:i-p,profit:p,grossMargin:u,orderCount:f,soldOutCount:0,slowMovingCount:0,inventoryTurnover:0})})}),l.sort((s,r)=>r.revenue-s.revenue).slice(0,50)},aa=(t,a)=>["0-20","20-40","40-60","60-80","80-100","100+"].map(s=>{let r=.1;return a<30&&s==="20-40"&&(r=.5),a>=30&&s==="40-60"&&(r=.4),{range:s,count:Math.floor(t*r*(.8+Math.random()*.4))}}),ra=t=>({itemDiscount:t*.3,thresholdDiscount:t*.4,vouchers:t*.2,other:t*.1}),na=t=>{const a=t/30,l=[],s=new Date;for(let r=6;r>=0;r--){const o=new Date(s);o.setDate(o.getDate()-r);const u=o.getDay()===0||o.getDay()===6?1.3:.9,p=a*u*(.9+Math.random()*.2);l.push({date:o.toISOString().split("T")[0].slice(5),itemDiscount:Math.floor(p*.3),thresholdDiscount:Math.floor(p*.4),vouchers:Math.floor(p*.2),other:Math.floor(p*.1)})}return l},$e=(t,a,l,s,r,o,i,u)=>{const p=l*r,f=l*o,d=l*i,x=s*u,m=p+f+d+x,c=l-m,b=c/l;return{id:t,name:a,revenue:l,costs:{cogs:p,marketing:f,delivery:x,commission:d},marketingDetails:ra(f),marketingTrend:na(f),totalCost:m,profit:c,marketingRate:f/l,profitMargin:b,orderCount:s,avgOrderValue:l/s,avgDeliveryCost:x/s,hourlyData:Qs(s,u),distanceData:ea(s),dailyTrend:ta(l,s,b),categoryPerformance:sa(l),aovDistribution:aa(s,l/s)}},oa=()=>{const t=[$e("1",Se.MEITUAN,45e4,11250,.35,.15,.18,6.5),$e("2",Se.ELEME,38e4,9500,.35,.2,.16,6.2),$e("3",Se.DOUYIN,6e5,15e3,.35,.25,.05,1.5),$e("4",Se.OFFLINE,55e4,13750,.35,.02,.01,0),$e("5",Se.PRIVATE_DOMAIN,2e5,4e3,.35,.05,.02,5)],a=t.reduce((r,o)=>r+o.revenue,0),l=t.reduce((r,o)=>r+o.profit,0),s=t.reduce((r,o)=>r+o.orderCount,0);return{totalRevenue:a,totalProfit:l,totalOrders:s,channels:t,lastUpdated:new Date().toLocaleString()}},la=De.lazy(()=>Le(()=>import("./DataManagement-Br_m0sXh.js"),__vite__mapDeps([0,1,2]))),ia=De.lazy(()=>Le(()=>import("./StoreComparisonView-Dtl4c47Z.js"),__vite__mapDeps([3,1,2]))),Ee=({onExit:t})=>e.jsx("div",{className:"absolute top-4 right-4 z-[70] animate-fade-in-up",children:e.jsxs("button",{onClick:a=>{a.stopPropagation(),t()},className:"group flex items-center gap-2 pl-2 pr-2 py-1.5 bg-slate-800/80 backdrop-blur-md text-white border border-white/20 rounded-lg hover:bg-slate-700 transition-all duration-200 shadow-lg",children:[e.jsx("span",{className:"text-[10px] font-mono font-bold tracking-wider text-slate-300 group-hover:text-white",children:"MINIMIZE"}),e.jsx(kt,{size:14,className:"text-indigo-400 group-hover:text-indigo-300"})]})}),ca=De.lazy(()=>Le(()=>import("./Skeleton-BdAGY13K.js"),__vite__mapDeps([4,1,2])).then(t=>({default:t.DashboardSkeleton}))),da=()=>e.jsxs("div",{className:"min-h-screen bg-slate-950 p-8 grid grid-cols-12 gap-6 animate-pulse",children:[e.jsx("div",{className:"col-span-12 h-20 bg-white/5 rounded-xl"}),[...Array(6)].map((t,a)=>e.jsx("div",{className:"col-span-6 lg:col-span-2 h-32 bg-white/5 rounded-2xl"},a)),e.jsx("div",{className:"col-span-12 xl:col-span-8 h-[550px] bg-white/5 rounded-2xl"}),e.jsx("div",{className:"col-span-12 xl:col-span-4 h-[550px] bg-white/5 rounded-2xl"})]});function xa({theme:t}){var xe,ye,de,ee,te,$,J,se;const[a,l]=n.useState(null),[s,r]=n.useState(null),[o,i]=n.useState(!1),[u,p]=n.useState([]),[f,d]=n.useState(!1),[x,m]=n.useState(null),[c,b]=n.useState(!1),[w,h]=n.useState(null),[C,L]=n.useState(null),[P,T]=n.useState(void 0),[j,z]=n.useState(null),[O,E]=n.useState(30),[M,I]=n.useState(null),[H,K]=n.useState("all"),{orderOverview:k,orderComparison:D,orderOverviewLoading:W,dateRange:v,selectedStore:_,selectedChannel:F}=ce(),A=Zs(),S=n.useRef(null),V=n.useRef(null),U=n.useRef(null),Y=n.useRef(null),G=n.useRef(null),y=n.useCallback(async()=>{if(!_){p([]);return}d(!0);try{const B={store_name:_};v.type!=="all"&&v.start&&v.end&&(B.start_date=v.start,B.end_date=v.end);const Z=await ie.getMarketingStructure(B);Z.success&&Z.data.channels.length>0?p(Z.data.channels):p([])}catch(B){console.error("Ëé∑ÂèñËê•ÈîÄÊàêÊú¨ÁªìÊûÑÊï∞ÊçÆÂ§±Ë¥•:",B),p([])}finally{d(!1)}},[_,v.type,v.start,v.end]);n.useEffect(()=>{y()},[y]);const g=n.useCallback(async()=>{if(console.log("üìà fetchMarketingTrend Ë∞ÉÁî®, selectedStore:",_),!_){console.log("üìà Êú™ÈÄâÊã©Èó®Â∫óÔºåË∑≥ËøáËê•ÈîÄË∂ãÂäøÊï∞ÊçÆÂä†ËΩΩ"),m(null);return}b(!0),h(null);try{const B={store_name:_};H&&H!=="all"&&(B.channel=H),v.type!=="all"&&v.start&&v.end&&(B.start_date=v.start,B.end_date=v.end),console.log("üìà Ëê•ÈîÄË∂ãÂäøËØ∑Ê±ÇÂèÇÊï∞:",B);const Z=await ie.getMarketingTrend(B);console.log("üìà Ëê•ÈîÄË∂ãÂäøAPIÂìçÂ∫î:",Z),Z.success&&Z.data.dates.length>0?(console.log("üìà Ëê•ÈîÄË∂ãÂäøÊï∞ÊçÆÂä†ËΩΩÊàêÂäü, Êó•ÊúüÊï∞:",Z.data.dates.length),m(Z.data),h(null)):(console.log("üìà Ëê•ÈîÄË∂ãÂäøÊï∞ÊçÆ‰∏∫Á©∫"),m(null))}catch(B){console.error("üìà Ëé∑ÂèñËê•ÈîÄÊàêÊú¨Ë∂ãÂäøÊï∞ÊçÆÂ§±Ë¥•:",B),h("Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï")}finally{b(!1)}},[_,H,v.type,v.start,v.end]);n.useEffect(()=>{g()},[g]),n.useEffect(()=>{const B=setTimeout(()=>{const Z=oa();l(Z)},100);return()=>clearTimeout(B)},[v]),n.useEffect(()=>{s?document.body.classList.add("has-focus"):document.body.classList.remove("has-focus")},[s]),n.useEffect(()=>{const B=Z=>{Z.key==="Escape"&&r(null)};return window.addEventListener("keydown",B),()=>window.removeEventListener("keydown",B)},[]);const N=n.useCallback((B,Z,ae)=>{if(ae!==void 0&&E(ae),B===null){L(null),T(void 0),z(null);return}if(j){z(null),L(B),T(Z);return}if(C&&Z!==void 0){if(C===B){L(null),T(void 0);return}const le=C<B?C:B,pe=C<B?B:C,Ie=C<B?P:Z,Pe=C<B?Z:P;z({start:le,end:pe,startIndex:Ie,endIndex:Pe}),L(null),T(void 0);return}L(B),T(Z)},[C,P,j]),R=n.useCallback((B,Z,ae,le)=>{console.log("üìä Ë∑ùÁ¶ªÂå∫Èó¥ÈÄâ‰∏≠:",B,Z,ae,"-",le,"km"),I(B===-1?null:{minDistance:ae,maxDistance:le})},[]),q=async B=>{i(!0),await new Promise(Z=>setTimeout(Z,1500)),i(!1),console.log("AI Command:",B)},X=B=>{if(s===B){r(null);return}r(B);const ae={trend:S,efficiency:V,cost:U,profit:Y}[B];ae!=null&&ae.current&&setTimeout(()=>{var le;return(le=ae.current)==null?void 0:le.scrollIntoView({behavior:"smooth",block:"center"})},100)},re=B=>s===B?"is-focused relative":"",ne=n.useMemo(()=>a||null,[a]);return ne?e.jsxs("div",{className:"flex flex-col gap-6 relative z-10 w-full transition-all duration-500",children:[e.jsxs("div",{className:`flex flex-col xl:flex-row justify-between items-start xl:items-center gap-4 animate-fade-in-up transition-opacity duration-500 ${s?"opacity-20 blur-sm pointer-events-none":"opacity-100"}`,children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white flex items-center gap-2 tracking-tight",children:"ËøêËê•ËØäÊñ≠‰∏≠ÂøÉ"}),e.jsxs("p",{className:"text-slate-400 text-xs mt-1 font-mono opacity-60 flex items-center gap-2",children:["SYSTEM: ONLINE",A&&e.jsxs("span",{className:"text-neon-yellow flex items-center gap-1",children:[e.jsx(wt,{size:10})," LITE"]})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center gap-4 w-full xl:w-auto",children:e.jsx("div",{className:"w-full sm:w-auto flex-1",children:e.jsx(Hs,{onCommand:q,isProcessing:o})})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6 w-full pb-12",children:[e.jsx("div",{className:"col-span-6 lg:col-span-2 animate-fade-in-up stagger-1",children:e.jsx(Ne,{title:"ËÆ¢ÂçïÊÄªÊï∞",value:k?k.total_orders.toLocaleString():"-",change:(xe=D==null?void 0:D.changes)==null?void 0:xe.order_count,subtext:"ÁéØÊØî",icon:e.jsx(us,{size:18}),iconColor:"indigo",theme:t,loading:W,compact:!0})}),e.jsx("div",{className:"col-span-6 lg:col-span-2 animate-fade-in-up stagger-2",children:e.jsx(Ne,{title:"ÂïÜÂìÅÂÆûÊî∂È¢ù",value:k?`¬•${k.total_actual_sales.toLocaleString()}`:"-",change:(ye=D==null?void 0:D.changes)==null?void 0:ye.total_sales,subtext:"ÁéØÊØî",icon:e.jsx(Ae,{size:18}),iconColor:"cyan",theme:t,loading:W,compact:!0})}),e.jsx("div",{className:"col-span-6 lg:col-span-2 animate-fade-in-up stagger-3",children:e.jsx(Ne,{title:"ÊÄªÂà©Ê∂¶",value:k?`¬•${k.total_profit.toLocaleString()}`:"-",change:(de=D==null?void 0:D.changes)==null?void 0:de.total_profit,subtext:"ÁéØÊØî",icon:e.jsx(Ke,{size:18}),iconColor:"emerald",trendColor:(((ee=D==null?void 0:D.changes)==null?void 0:ee.total_profit)??0)<0?"red":"green",theme:t,loading:W,compact:!0})}),e.jsx("div",{className:"col-span-6 lg:col-span-2 animate-fade-in-up stagger-4",children:e.jsx(Ne,{title:"Âπ≥ÂùáÂÆ¢Âçï‰ª∑",value:k?`¬•${k.avg_order_value.toFixed(1)}`:"-",change:(te=D==null?void 0:D.changes)==null?void 0:te.avg_order_value,subtext:"ÁéØÊØî",icon:e.jsx(Re,{size:18}),iconColor:"amber",theme:t,loading:W,compact:!0})}),e.jsx("div",{className:"col-span-6 lg:col-span-2 animate-fade-in-up stagger-5",children:e.jsx(Ne,{title:"ÊÄªÂà©Ê∂¶Áéá",value:k?`${k.profit_rate.toFixed(1)}%`:"-",change:($=D==null?void 0:D.changes)==null?void 0:$.profit_rate,subtext:"ÁéØÊØî(ÁôæÂàÜÁÇπ)",icon:e.jsx(fs,{size:18}),iconColor:"violet",trendColor:(((J=D==null?void 0:D.changes)==null?void 0:J.profit_rate)??0)<0?"red":"green",theme:t,loading:W,compact:!0,isPercentChange:!0})}),e.jsx("div",{className:"col-span-6 lg:col-span-2 animate-fade-in-up stagger-6",children:e.jsx(Ne,{title:"Âä®ÈîÄÂïÜÂìÅÊï∞",value:k?k.active_products.toLocaleString():"-",change:(se=D==null?void 0:D.changes)==null?void 0:se.active_products,subtext:"ÁéØÊØî",icon:e.jsx(Ge,{size:18}),iconColor:"rose",theme:t,loading:W,compact:!0})}),e.jsxs("div",{ref:S,className:`col-span-12 xl:col-span-8 h-[550px] animate-fade-in-up stagger-7 ${re("trend")}`,children:[s==="trend"&&e.jsx(Ee,{onExit:()=>r(null)}),e.jsx(Ls,{data:ne.channels,theme:t,onDateSelect:N,selectedDate:C,selectedDateRange:j?{start:j.start,end:j.end}:void 0})]}),e.jsx("div",{className:"col-span-12 xl:col-span-4 h-[550px] animate-fade-in-up stagger-8 z-30",children:e.jsx(Vs,{data:ne,onLocate:X,activeFocus:s})}),(C||j)&&e.jsxs("div",{className:"col-span-12 xl:col-span-8 relative h-10 -mt-4 -mb-2 z-0 animate-fade-in-up",children:[C&&!j&&e.jsxs("div",{className:"absolute flex flex-col items-center text-indigo-400 transition-all duration-300",style:{left:P!==void 0?`calc(50px + ${(P+.5)/O*85}%)`:"50%",transform:"translateX(-50%)"},children:[e.jsx("div",{className:"h-6 w-0.5 bg-gradient-to-b from-indigo-500/0 via-indigo-500 to-indigo-500"}),e.jsxs("div",{className:"px-3 py-1 bg-indigo-500/10 border border-indigo-500/30 rounded-full text-[10px] font-mono flex items-center gap-2 whitespace-nowrap",children:[e.jsx(et,{size:10})," ÁÇπÂáªÂè¶‰∏ÄÊó•ÊúüÂΩ¢ÊàêËåÉÂõ¥ | ",C==null?void 0:C.slice(5)]})]}),j&&e.jsxs("div",{className:"absolute flex flex-col items-center text-emerald-400 transition-all duration-300",style:{left:`calc(50px + ${(j.startIndex+j.endIndex+1)/2/O*85}%)`,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"h-6 w-0.5 bg-gradient-to-b from-emerald-500/0 via-emerald-500 to-emerald-500"}),e.jsxs("div",{className:"px-3 py-1 bg-emerald-500/10 border border-emerald-500/30 rounded-full text-[10px] font-mono flex items-center gap-2 whitespace-nowrap",children:[e.jsx(et,{size:10})," Êó•ÊúüËåÉÂõ¥: ",j.start.slice(5)," ~ ",j.end.slice(5)]})]})]}),(C||j)&&e.jsx("div",{className:"hidden xl:block xl:col-span-4"}),e.jsxs("div",{ref:G,className:`col-span-12 grid grid-cols-12 gap-6 transition-all duration-500 ${C||j?"bg-indigo-900/5 p-4 rounded-3xl border border-indigo-500/10":""}`,children:[e.jsx("div",{className:"col-span-12 lg:col-span-6 h-[400px] animate-fade-in-up stagger-2",children:e.jsx(Gs,{selectedDate:C,selectedDateRange:j?{start:j.start,end:j.end}:void 0,theme:t})}),e.jsx("div",{className:"col-span-12 lg:col-span-6 h-[400px] animate-fade-in-up stagger-2",children:e.jsx(qs,{selectedDate:C,selectedDateRange:j?{start:j.start,end:j.end}:void 0,theme:t})})]}),e.jsxs("div",{ref:V,className:`col-span-12 xl:col-span-6 h-[450px] animate-enter stagger-7 ${re("efficiency")}`,children:[s==="efficiency"&&e.jsx(Ee,{onExit:()=>r(null)}),e.jsx(zs,{storeName:_||void 0,channel:F==="all"?void 0:F,theme:t,selectedDate:C,selectedDateRange:j?{start:j.start,end:j.end}:void 0})]}),e.jsx("div",{className:"col-span-12 xl:col-span-6 h-[450px] animate-enter stagger-8",children:e.jsx(Xs,{storeName:_||void 0,channel:F==="all"?void 0:F,theme:t,selectedDate:C,selectedDateRange:j?{start:j.start,end:j.end}:void 0,onDistanceBandSelect:R})}),e.jsxs("div",{ref:U,className:`col-span-12 lg:col-span-6 h-[450px] animate-enter stagger-8 ${re("cost")}`,children:[s==="cost"&&e.jsx(Ee,{onExit:()=>r(null)}),f?e.jsx("div",{className:"glass-panel rounded-2xl p-6 h-full flex items-center justify-center",children:e.jsx("div",{className:"text-slate-400 text-sm",children:"Âä†ËΩΩËê•ÈîÄÊàêÊú¨Êï∞ÊçÆ‰∏≠..."})}):e.jsx($s,{data:u,theme:t})]}),e.jsx("div",{className:"col-span-12 lg:col-span-6 h-[450px] animate-enter stagger-9",children:e.jsx(Bs,{data:x,theme:t,loading:c,error:w,selectedChannel:H,onChannelChange:K})}),e.jsx("div",{className:"col-span-12 h-[450px] animate-enter stagger-10",children:e.jsx(Os,{theme:t,selectedDistanceBand:M,storeName:_||void 0,selectedDate:C,selectedDateRange:j?{start:j.start,end:j.end}:void 0})}),e.jsxs("div",{ref:Y,className:`col-span-12 h-[800px] animate-enter stagger-1 ${re("profit")}`,children:[s==="profit"&&e.jsx(Ee,{onExit:()=>r(null)}),e.jsx(Es,{data:a.channels,theme:t})]}),e.jsx("div",{className:"col-span-12 h-[500px] animate-enter stagger-2",children:e.jsx(Js,{theme:t})}),e.jsx("div",{className:"col-span-12 lg:col-span-6 h-[450px] animate-enter stagger-3",children:e.jsx(Ts,{data:ne.channels,theme:t})}),e.jsx("div",{className:"col-span-12 lg:col-span-6 h-[450px] animate-enter stagger-4",children:e.jsx(Ws,{data:ne})}),e.jsx("div",{className:`col-span-12 animate-enter stagger-5 ${s?"opacity-20 blur-sm pointer-events-none":"opacity-100"}`,children:e.jsx(Us,{data:ne.channels})})]}),s&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 glass-panel text-white px-4 py-2 rounded-full shadow-2xl z-[100] animate-bounce",children:e.jsxs("p",{className:"text-xs font-mono font-bold tracking-widest flex items-center gap-2",children:[e.jsx(kt,{size:12})," PRESS ESC TO EXIT"]})})]}):e.jsx(n.Suspense,{fallback:e.jsx(da,{}),children:e.jsx(ca,{})})}function ua(){const[t,a]=n.useState("dark");return n.useEffect(()=>{t==="light"?document.body.classList.add("light-mode"):document.body.classList.remove("light-mode")},[t]),e.jsx(Ns,{theme:t,onToggleTheme:()=>a(l=>l==="dark"?"light":"dark"),children:e.jsxs(xs,{children:[e.jsx(ve,{path:"/",element:e.jsx(xa,{theme:t})}),e.jsx(ve,{path:"/data",element:e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:e.jsx("div",{className:"text-slate-400",children:"Âä†ËΩΩ‰∏≠..."})}),children:e.jsx(la,{})})}),e.jsx(ve,{path:"/stores",element:e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:e.jsx("div",{className:"text-slate-400",children:"Âä†ËΩΩ‰∏≠..."})}),children:e.jsx(ia,{theme:t})})}),e.jsx(ve,{path:"/channels",element:e.jsx(Ve,{title:"Ê∏†ÈÅìÂàÜÊûê"})}),e.jsx(ve,{path:"/trends",element:e.jsx(Ve,{title:"Ë∂ãÂäøÊ¥ûÂØü"})}),e.jsx(ve,{path:"/settings",element:e.jsx(Ve,{title:"Á≥ªÁªüËÆæÁΩÆ"})})]})})}const Ve=({title:t})=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh] text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üöß"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:t}),e.jsx("p",{className:"text-slate-400",children:"ÂäüËÉΩÂºÄÂèë‰∏≠ÔºåÊï¨ËØ∑ÊúüÂæÖ..."})]});class fa extends De.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,l){console.error("Uncaught error:",a,l)}render(){var a;return this.state.hasError?e.jsxs("div",{style:{padding:"40px",color:"#f87171",backgroundColor:"#1e293b",height:"100vh",fontFamily:"monospace"},children:[e.jsx("h1",{style:{fontSize:"24px",marginBottom:"20px"},children:"‚ö†Ô∏è System Malfunction"}),e.jsx("p",{style:{color:"#cbd5e1"},children:"The dashboard encountered a critical error while rendering."}),e.jsx("pre",{style:{marginTop:"20px",padding:"20px",backgroundColor:"#0f172a",borderRadius:"8px",overflow:"auto"},children:(a=this.state.error)==null?void 0:a.message}),e.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"20px",padding:"10px 20px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Reboot System"})]}):this.props.children}}const $t=document.getElementById("root");if(!$t)throw new Error("Could not find root element to mount to");const ma=ms.createRoot($t);ma.render(e.jsx(De.StrictMode,{children:e.jsx(ps,{children:e.jsx(bs,{children:e.jsx(fa,{children:e.jsx(ua,{})})})})}));export{_t as C,Ne as S,fe as a,me as b,tt as d,ce as u};
