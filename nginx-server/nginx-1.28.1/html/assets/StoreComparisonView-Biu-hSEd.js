import{j as e,au as xe,V as Z,av as ge,al as be,af as je,T as ve,J as ye,r as i,S as Q,p as R,aw as Ne,f as E,i as ne,b as we,c as _e,d as re,h as le,C as ke,g as Se,D as Ce,z as Me,k as De,l as ze,a8 as ie,G as oe,X as ce,aj as Le,Y as Oe,W as $e,ak as Fe}from"./react-vendor-BD1vIgCn.js";import{a as I,b as me,u as We,C as Pe,S as U}from"./index-D-PGhX_H.js";const G={getComparison:async a=>(await I.get("/stores/comparison",{params:a})).data,getWeekOverWeek:async(a,r,v,f)=>(await I.get("/stores/comparison/week-over-week",{params:{end_date:a,previous_start:r,previous_end:v,channel:f}})).data,getRanking:async a=>(await I.get("/stores/comparison/ranking",{params:a})).data,getAvailableChannels:async a=>(await I.get("/stores/comparison/available-channels",{params:a})).data,exportData:async a=>(await I.get("/stores/comparison/export",{params:a})).data,getStoresByChannel:async a=>(await I.get("/stores/comparison/stores-by-channel",{params:a})).data},Re=({stores:a,theme:r="dark",loading:v=!1,sortBy:f,sortOrder:b,onSort:g,onStoreClick:k})=>{const u=t=>{f===t?g(t,b==="asc"?"desc":"asc"):g(t,"desc")},_=t=>f!==t?null:b==="asc"?e.jsx(ge,{size:14}):e.jsx(be,{size:14}),j=(t,l=!0)=>{if(t===void 0||t===0)return e.jsxs("span",{className:"text-slate-600 flex items-center gap-1 text-[10px]",children:[e.jsx(je,{size:10})," -"]});const x=t>0,o=x?"text-emerald-400":"text-red-400",c=x?ve:ye;return e.jsxs("span",{className:`${o} flex items-center gap-1 text-[10px] font-medium`,children:[e.jsx(c,{size:10}),x?"+":"",t.toFixed(1),l?"%":""]})},h=t=>{if(!t||t.length===0)return"";const l=t.some(o=>o.severity==="high"),x=t.some(o=>o.severity==="medium");return l?"border-l-2 border-l-red-500":x?"border-l-2 border-l-amber-500":"border-l-2 border-l-blue-500"};return v?e.jsx("div",{className:"glass-panel rounded-2xl p-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-slate-400",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-slate-600 border-t-slate-400 rounded-full animate-spin"}),"åŠ è½½ä¸­..."]})}):a.length===0?e.jsx("div",{className:"glass-panel rounded-2xl p-6",children:e.jsxs("div",{className:"text-slate-400 text-center py-8",children:[e.jsx(xe,{size:32,className:"mx-auto mb-2 opacity-50"}),"æš‚æ— æ•°æ®"]})}):e.jsxs("div",{className:"glass-panel rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"é—¨åº—è¯¦ç»†æ•°æ®"}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"é«˜é£é™©"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full"}),"ä¸­é£é™©"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"æ­£å¸¸"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium",children:"æ’å"}),e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium",children:"é—¨åº—åç§°"}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium cursor-pointer hover:text-white transition-colors",onClick:()=>u("order_count"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["è®¢å•é‡ ",_("order_count")]})}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium cursor-pointer hover:text-white transition-colors",onClick:()=>u("revenue"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["é”€å”®é¢ ",_("revenue")]})}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium cursor-pointer hover:text-white transition-colors",onClick:()=>u("profit"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["åˆ©æ¶¦ ",_("profit")]})}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium cursor-pointer hover:text-white transition-colors",onClick:()=>u("profit_margin"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["åˆ©æ¶¦ç‡ ",_("profit_margin")]})}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium",children:"å®¢å•ä»·"}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium",children:"å•å‡é…é€è´¹"}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium",children:"å•å‡è¥é”€è´¹"})]})}),e.jsx("tbody",{children:a.map((t,l)=>{var x,o,c,d,m,O,D;return e.jsxs("tr",{className:`border-b border-white/5 hover:bg-white/5 transition-colors cursor-pointer
                           ${h(t.anomalies)}`,onClick:()=>k==null?void 0:k(t.store_name),children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"flex items-center gap-2",children:l<3?e.jsx("span",{className:`
                        w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold
                        ${l===0?"bg-amber-500/20 text-amber-400":""}
                        ${l===1?"bg-slate-400/20 text-slate-300":""}
                        ${l===2?"bg-orange-600/20 text-orange-400":""}
                      `,children:l+1}):e.jsx("span",{className:"text-slate-500 text-xs w-6 text-center",children:l+1})})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white font-medium",children:t.store_name}),t.anomalies&&t.anomalies.length>0&&e.jsx("span",{title:t.anomalies.map($=>$.message).join(`
`),children:e.jsx(Z,{size:14,className:t.anomalies.some($=>$.severity==="high")?"text-red-400":t.anomalies.some($=>$.severity==="medium")?"text-amber-400":"text-blue-400"})})]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsx("span",{className:"text-slate-300",children:t.order_count.toLocaleString()}),j((x=t.weekOverWeek)==null?void 0:x.order_count)]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:"text-slate-300",children:["Â¥",t.total_revenue.toLocaleString()]}),j((o=t.weekOverWeek)==null?void 0:o.revenue)]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:"text-slate-300",children:["Â¥",t.total_profit.toLocaleString()]}),j((c=t.weekOverWeek)==null?void 0:c.profit)]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:`
                      ${t.profit_margin>=30?"text-emerald-400":""}
                      ${t.profit_margin>=20&&t.profit_margin<30?"text-cyan-400":""}
                      ${t.profit_margin>=10&&t.profit_margin<20?"text-amber-400":""}
                      ${t.profit_margin<10?"text-red-400":""}
                    `,children:[t.profit_margin.toFixed(1),"%"]}),j((d=t.weekOverWeek)==null?void 0:d.profit_margin,!1)]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:"text-slate-300",children:["Â¥",t.aov.toFixed(1)]}),j((m=t.weekOverWeek)==null?void 0:m.aov)]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:"text-slate-300",children:["Â¥",t.avg_delivery_fee.toFixed(1)]}),j((O=t.weekOverWeek)==null?void 0:O.avg_delivery_fee)]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:"text-slate-300",children:["Â¥",t.avg_marketing_cost.toFixed(1)]}),j((D=t.weekOverWeek)==null?void 0:D.avg_marketing_cost)]})})]},t.store_name)})})]})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex items-center justify-between text-xs text-slate-400",children:[e.jsxs("span",{children:["å…± ",a.length," ä¸ªé—¨åº—"]}),e.jsxs("span",{children:["å¼‚å¸¸é—¨åº—: ",a.filter(t=>t.anomalies&&t.anomalies.length>0).length," ä¸ª"]})]})]})},Te=({stores:a,metric:r,theme:v="dark",loading:f=!1})=>{const b=i.useMemo(()=>{if(a.length===0)return{names:[],values:[],colors:[]};const h=a.slice(0,10),t=h.map(o=>o.store_name),l=h.map(o=>{switch(r){case"revenue":return o.total_revenue;case"profit":return o.total_profit;case"profit_margin":return o.profit_margin;case"order_count":return o.order_count;default:return o.total_revenue}}),x=h.map(o=>o.profit_margin>=30?"#10b981":o.profit_margin>=20?"#06b6d4":o.profit_margin>=10?"#f59e0b":"#ef4444");return{names:t,values:l,colors:x}},[a,r]),g={revenue:"é”€å”®é¢",profit:"åˆ©æ¶¦",profit_margin:"åˆ©æ¶¦ç‡",order_count:"è®¢å•é‡"},k={revenue:"å…ƒ",profit:"å…ƒ",profit_margin:"%",order_count:"å•"},u=i.useMemo(()=>({title:{text:`é—¨åº—${g[r]}æ’è¡Œæ¦œ Top 10`,left:"center",top:10,textStyle:{color:v==="dark"?"#fff":"#1e293b",fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(0, 0, 0, 0.8)",borderColor:"rgba(255, 255, 255, 0.2)",textStyle:{color:"#fff"},formatter:h=>{const t=h[0],l=a.find(x=>x.store_name===t.name);return l?`
          <div style="padding: 8px;">
            <div style="font-weight: bold; margin-bottom: 8px;">${l.store_name}</div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>é”€å”®é¢:</span>
              <span style="font-weight: bold;">Â¥${l.total_revenue.toLocaleString()}</span>
            </div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>åˆ©æ¶¦:</span>
              <span style="font-weight: bold;">Â¥${l.total_profit.toLocaleString()}</span>
            </div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>åˆ©æ¶¦ç‡:</span>
              <span style="font-weight: bold;">${l.profit_margin.toFixed(1)}%</span>
            </div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>è®¢å•é‡:</span>
              <span style="font-weight: bold;">${l.order_count.toLocaleString()}å•</span>
            </div>
          </div>
        `:""}},grid:{left:"3%",right:"4%",bottom:"3%",top:60,containLabel:!0},xAxis:{type:"category",data:b.names,axisLabel:{color:v==="dark"?"#94a3b8":"#64748b",rotate:45,fontSize:11},axisLine:{lineStyle:{color:v==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}}},yAxis:{type:"value",name:k[r],nameTextStyle:{color:v==="dark"?"#94a3b8":"#64748b"},axisLabel:{color:v==="dark"?"#94a3b8":"#64748b",formatter:h=>r==="profit_margin"?h.toFixed(0):h>=1e4?(h/1e4).toFixed(1)+"w":h.toLocaleString()},splitLine:{lineStyle:{color:v==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)"}}},series:[{type:"bar",data:b.values.map((h,t)=>({value:h,itemStyle:{color:b.colors[t]}})),barWidth:"60%",label:{show:!0,position:"top",color:v==="dark"?"#fff":"#1e293b",fontSize:10,formatter:h=>{const t=h.value;return r==="profit_margin"?t.toFixed(1)+"%":t>=1e4?(t/1e4).toFixed(1)+"w":t.toLocaleString()}}}]}),[b,r,v,a,g,k]),_=me(u,[b,r,v,a],v),j=!f&&a.length>0&&b.names.length>0;return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full",children:[e.jsx("div",{ref:_,className:"w-full h-full",style:{minHeight:"350px",visibility:j?"visible":"hidden",position:j?"relative":"absolute"}}),!j&&e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center",style:{minHeight:"350px"},children:f?e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-slate-600 border-t-slate-400 rounded-full animate-spin"}),"åŠ è½½ä¸­..."]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-3 bg-slate-800 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"ğŸ“Š"})}),e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"æš‚æ— æ’è¡Œæ¦œæ•°æ®"}),e.jsx("p",{className:"text-slate-500 text-xs",children:"è¯·è°ƒæ•´ç­›é€‰æ¡ä»¶åé‡è¯•"})]})})]})},Ae=({stores:a,theme:r="dark",loading:v=!1,selectedStore:f=null,onStoreClick:b})=>{var l,x;const g=i.useMemo(()=>{if(a.length===0)return[];const o=a.reduce((d,m)=>d+m.marketing_cost_rate,0)/a.length,c=a.reduce((d,m)=>d+m.profit_margin,0)/a.length;return a.map(d=>({name:d.store_name,value:[d.marketing_cost_rate,d.profit_margin,d.total_revenue],itemStyle:{color:d.store_name===f?"#818cf8":d.profit_margin>=c&&d.marketing_cost_rate<=o?"#10b981":d.profit_margin>=c&&d.marketing_cost_rate>o?"#06b6d4":d.profit_margin<c&&d.marketing_cost_rate<=o?"#f59e0b":"#ef4444",borderColor:d.store_name===f?"#fff":"transparent",borderWidth:d.store_name===f?2:0,shadowBlur:d.store_name===f?10:0,shadowColor:d.store_name===f?"rgba(129, 140, 248, 0.5)":"transparent"},avgMarketingRate:o,avgProfitMargin:c}))},[a,f]),k=((l=g[0])==null?void 0:l.avgMarketingRate)||0,u=((x=g[0])==null?void 0:x.avgProfitMargin)||0,_=i.useMemo(()=>({title:{text:"é—¨åº—æ•ˆç‡åˆ†æï¼ˆè¥é”€æˆæœ¬ç‡ vs åˆ©æ¶¦ç‡ï¼‰",left:"center",top:10,textStyle:{color:r==="dark"?"#fff":"#1e293b",fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"item",backgroundColor:"rgba(0, 0, 0, 0.8)",borderColor:"rgba(255, 255, 255, 0.2)",textStyle:{color:"#fff"},formatter:o=>{const c=o.data,d=a.find(m=>m.store_name===c.name);return d?`
          <div style="padding: 8px;">
            <div style="font-weight: bold; margin-bottom: 8px;">${d.store_name}</div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>è¥é”€æˆæœ¬ç‡:</span>
              <span style="font-weight: bold;">${d.marketing_cost_rate.toFixed(1)}%</span>
            </div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>åˆ©æ¶¦ç‡:</span>
              <span style="font-weight: bold;">${d.profit_margin.toFixed(1)}%</span>
            </div>
            <div style="display: flex; justify-content: space-between; gap: 16px;">
              <span>é”€å”®é¢:</span>
              <span style="font-weight: bold;">Â¥${d.total_revenue.toLocaleString()}</span>
            </div>
          </div>
        `:""}},grid:{left:"3%",right:"7%",bottom:"3%",top:60,containLabel:!0},xAxis:{type:"value",name:"è¥é”€æˆæœ¬ç‡ (%)",nameLocation:"middle",nameGap:30,nameTextStyle:{color:r==="dark"?"#94a3b8":"#64748b",fontSize:12},axisLabel:{color:r==="dark"?"#94a3b8":"#64748b",formatter:"{value}%"},splitLine:{lineStyle:{color:r==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)"}}},yAxis:{type:"value",name:"åˆ©æ¶¦ç‡ (%)",nameLocation:"middle",nameGap:40,nameTextStyle:{color:r==="dark"?"#94a3b8":"#64748b",fontSize:12},axisLabel:{color:r==="dark"?"#94a3b8":"#64748b",formatter:"{value}%"},splitLine:{lineStyle:{color:r==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)"}}},series:[{type:"scatter",data:g,symbolSize:o=>{const c=Math.max(...a.map(O=>O.total_revenue)),d=10;return d+o[2]/c*(40-d)},label:{show:!0,position:"top",color:r==="dark"?"#fff":"#1e293b",fontSize:10,formatter:o=>o.data.name},emphasis:{focus:"self",label:{show:!0,fontSize:12,fontWeight:"bold"}}},{type:"line",markLine:{silent:!0,symbol:"none",lineStyle:{type:"dashed",color:"#6366f1",width:1},label:{show:!0,position:"end",formatter:"å¹³å‡è¥é”€æˆæœ¬ç‡",color:"#6366f1",fontSize:10},data:[{xAxis:k}]}},{type:"line",markLine:{silent:!0,symbol:"none",lineStyle:{type:"dashed",color:"#6366f1",width:1},label:{show:!0,position:"end",formatter:"å¹³å‡åˆ©æ¶¦ç‡",color:"#6366f1",fontSize:10},data:[{yAxis:u}]}}]}),[g,r,a,k,u]),h=me(_,[g,r,a,f],r,o=>{var c;(c=o.data)!=null&&c.name&&b&&b(o.data.name)}),t=!v&&a.length>0&&g.length>0;return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col",children:[e.jsx("div",{ref:h,className:"w-full flex-1",style:{minHeight:"300px",visibility:t?"visible":"hidden",position:t?"relative":"absolute"}}),!t&&e.jsx("div",{className:"w-full flex-1 flex flex-col items-center justify-center",style:{minHeight:"300px"},children:v?e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-slate-600 border-t-slate-400 rounded-full animate-spin"}),"åŠ è½½ä¸­..."]}):e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{size:40,className:"mx-auto text-slate-600 mb-3"}),e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"æš‚æ— é—¨åº—æ•ˆç‡æ•°æ®"}),e.jsx("p",{className:"text-slate-500 text-xs",children:"è¯·è°ƒæ•´ç­›é€‰æ¡ä»¶åé‡è¯•"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-slate-400",children:"ä¼˜è´¨é—¨åº—ï¼ˆé«˜åˆ©æ¶¦ä½è¥é”€ï¼‰"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-cyan-500"}),e.jsx("span",{className:"text-slate-400",children:"æ½œåŠ›é—¨åº—ï¼ˆé«˜åˆ©æ¶¦é«˜è¥é”€ï¼‰"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-slate-400",children:"æ”¹è¿›é—¨åº—ï¼ˆä½åˆ©æ¶¦ä½è¥é”€ï¼‰"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-slate-400",children:"äºæŸé—¨åº—ï¼ˆä½åˆ©æ¶¦é«˜è¥é”€ï¼‰"})]})]})]})},de=[{days:1,label:"æ˜¨æ—¥"},{days:7,label:"è¿‘7å¤©"},{days:15,label:"è¿‘15å¤©"},{days:30,label:"è¿‘30å¤©"}],Be=({currentStart:a,currentEnd:r,previousStart:v,previousEnd:f,minDate:b,maxDate:g,onApply:k,onReset:u})=>{var J,P;const[_,j]=i.useState(!1),[h,t]=i.useState(!1),[l,x]=i.useState(),o=i.useRef(null),c=i.useRef(null),d=i.useRef(null),m=i.useRef(null),O=b?R(b,"yyyy-MM-dd",new Date):void 0,D=g?R(g,"yyyy-MM-dd",new Date):void 0,$=a&&r?Ne(R(r,"yyyy-MM-dd",new Date),R(a,"yyyy-MM-dd",new Date))+1:0,q=de.find(p=>p.days===$),T=!q&&a&&r;i.useEffect(()=>{const p=N=>{const S=N.target;_&&o.current&&!o.current.contains(S)&&d.current&&!d.current.contains(S)&&j(!1),h&&c.current&&!c.current.contains(S)&&m.current&&!m.current.contains(S)&&t(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[_,h]);const w=i.useCallback(p=>{if(!g)return;const N=R(g,"yyyy-MM-dd",new Date),S=new Date(N);S.setDate(S.getDate()-p+1),k(E(S,"yyyy-MM-dd"),E(N,"yyyy-MM-dd")),j(!1)},[g,k]),A=i.useCallback(p=>{x(p)},[]),B=i.useCallback(()=>{l!=null&&l.from&&(l!=null&&l.to)&&(k(E(l.from,"yyyy-MM-dd"),E(l.to,"yyyy-MM-dd")),t(!1))},[l,k]),Y=i.useCallback(()=>{if(a&&r){const p=R(a,"yyyy-MM-dd",new Date),N=R(r,"yyyy-MM-dd",new Date);ne(p)&&ne(N)&&x({from:p,to:N})}else x(void 0);t(!0)},[a,r]),H=i.useCallback(p=>!!(O&&we(p,O)||D&&_e(p,D)),[O,D]),K=p=>{if(!p.current)return{top:0,left:0};const N=p.current.getBoundingClientRect();return{top:N.bottom+8,left:N.left}},V=()=>q?q.label:T?`${a} ~ ${r}`:"é€‰æ‹©æ—¥æœŸ";return e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(le,{size:18,className:"text-indigo-400"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"å¯¹æ¯”å‘¨æœŸé€‰æ‹©"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("button",{ref:o,onClick:()=>j(!_),className:"w-full flex items-center justify-between gap-2 px-3 py-2 bg-slate-900 hover:bg-slate-800 border border-slate-600 rounded-lg text-sm text-white transition-all",children:[e.jsx("span",{className:"truncate",children:V()}),e.jsx(ke,{size:14,className:`text-slate-400 transition-transform flex-shrink-0 ${_?"rotate-180":""}`})]}),_&&re.createPortal(e.jsx("div",{ref:d,style:K(o),className:"fixed w-40 bg-slate-900 border border-white/10 rounded-xl shadow-2xl z-[9999] overflow-hidden animate-fade-in-up",children:de.map(({days:p,label:N})=>e.jsxs("button",{onClick:()=>w(p),className:`w-full flex items-center justify-between px-4 py-2.5 text-sm transition-colors ${$===p?"bg-emerald-500/20 text-emerald-300":"text-slate-300 hover:bg-white/5"}`,children:[e.jsx("span",{children:N}),$===p&&e.jsx(Se,{size:14,className:"text-emerald-400"})]},p))}),document.body)]}),e.jsxs("button",{ref:c,onClick:Y,className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-all ${T?"bg-indigo-500/20 border-indigo-500/50 text-indigo-300":"bg-slate-900 border-slate-600 text-slate-400 hover:bg-slate-800 hover:text-white hover:border-slate-500"}`,children:[e.jsx(le,{size:16,className:T?"text-indigo-400":"text-slate-400"}),e.jsx("span",{className:"text-sm",children:"è‡ªå®šä¹‰"})]})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded p-3 text-xs space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"æœ¬æœŸï¼š"}),e.jsxs("span",{className:"text-indigo-300 font-mono",children:[a," ~ ",r]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"ä¸ŠæœŸï¼š"}),e.jsxs("span",{className:"text-emerald-300 font-mono",children:[v," ~ ",f]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:u,className:"flex-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white text-sm rounded transition-colors",children:"é‡ç½®"})})]}),h&&re.createPortal(e.jsxs("div",{ref:m,style:{top:((J=c.current)==null?void 0:J.getBoundingClientRect().bottom)+8,left:Math.min(((P=c.current)==null?void 0:P.getBoundingClientRect().left)||0,window.innerWidth-620)},className:"fixed z-[9999] p-5 rounded-xl border shadow-2xl bg-slate-900 border-white/10",children:[b&&g&&e.jsx("div",{className:"mb-4 px-3 py-2 bg-indigo-500/10 border border-indigo-500/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-indigo-300",children:["ğŸ“… å¯é€‰æ•°æ®èŒƒå›´: ",b," ~ ",g]})}),e.jsx("style",{children:`
            .calendar-container .rdp-root {
              --rdp-accent-color: #6366f1;
              --rdp-accent-background-color: rgba(99, 102, 241, 0.2);
            }
            .calendar-container .rdp-months {
              display: flex;
              gap: 2rem;
            }
            .calendar-container .rdp-month_caption {
              display: flex;
              justify-content: center;
              align-items: center;
              height: 40px;
              font-weight: 600;
              font-size: 14px;
              color: #f1f5f9;
            }
            .calendar-container .rdp-nav {
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              display: flex;
              justify-content: space-between;
              padding: 0 8px;
            }
            .calendar-container .rdp-button_previous,
            .calendar-container .rdp-button_next {
              width: 32px;
              height: 32px;
              border-radius: 8px;
              background: rgba(255, 255, 255, 0.05);
              color: #94a3b8;
              display: flex;
              align-items: center;
              justify-content: center;
              border: none;
              cursor: pointer;
              transition: all 0.15s;
            }
            .calendar-container .rdp-button_previous:hover,
            .calendar-container .rdp-button_next:hover {
              background: rgba(255, 255, 255, 0.1);
              color: #f1f5f9;
            }
            .calendar-container .rdp-weekday {
              color: #64748b;
              font-size: 12px;
              font-weight: 500;
              padding: 8px 0;
            }
            .calendar-container .rdp-day {
              width: 36px;
              height: 36px;
            }
            .calendar-container .rdp-day button {
              width: 36px;
              height: 36px;
              border-radius: 8px;
              color: #cbd5e1;
              font-weight: 400;
              font-size: 13px;
              transition: all 0.15s;
              border: none;
              background: transparent;
              cursor: pointer;
            }
            .calendar-container .rdp-day button:hover:not(:disabled) {
              background: rgba(255, 255, 255, 0.08);
              color: #f1f5f9;
            }
            .calendar-container .rdp-today button {
              color: #818cf8;
              box-shadow: inset 0 0 0 1px #6366f1;
            }
            .calendar-container .rdp-selected button,
            .calendar-container .rdp-range_start button,
            .calendar-container .rdp-range_end button {
              background: #6366f1 !important;
              color: white !important;
            }
            .calendar-container .rdp-range_middle button {
              background: rgba(99, 102, 241, 0.2) !important;
              color: #a5b4fc !important;
              border-radius: 0 !important;
            }
            .calendar-container .rdp-range_start button {
              border-radius: 8px 0 0 8px !important;
            }
            .calendar-container .rdp-range_end button {
              border-radius: 0 8px 8px 0 !important;
            }
            .calendar-container .rdp-disabled button {
              color: #334155 !important;
              opacity: 0.4;
              cursor: not-allowed !important;
            }
            .calendar-container .rdp-disabled button:hover {
              background: transparent !important;
            }
            .calendar-container .rdp-outside button {
              color: #475569;
              opacity: 0.5;
            }
          `}),e.jsx("div",{className:"calendar-container",children:e.jsx(Ce,{mode:"range",numberOfMonths:2,selected:l,onSelect:A,locale:Me,disabled:H,defaultMonth:D?new Date(D.getFullYear(),D.getMonth()-1):new Date,startMonth:O,endMonth:D,showOutsideDays:!1,components:{Chevron:({orientation:p})=>p==="left"?e.jsx(De,{size:18}):e.jsx(ze,{size:18})}})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-slate-400",children:l!=null&&l.from&&(l!=null&&l.to)?e.jsxs("span",{className:"text-emerald-400 font-medium",children:["å·²é€‰: ",E(l.from,"yyyy-MM-dd")," ~ ",E(l.to,"yyyy-MM-dd")]}):l!=null&&l.from?e.jsx("span",{className:"text-amber-400",children:"è¯·é€‰æ‹©ç»“æŸæ—¥æœŸ"}):e.jsx("span",{children:"ç‚¹å‡»é€‰æ‹©å¼€å§‹æ—¥æœŸ"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>t(!1),className:"px-4 py-2 text-sm text-slate-400 hover:text-white transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:B,disabled:!(l!=null&&l.from)||!(l!=null&&l.to),className:"px-5 py-2 bg-indigo-500 text-white rounded-lg text-sm font-medium hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"ç¡®è®¤é€‰æ‹©"})]})]})]}),document.body)]})},Ue=({theme:a="dark"})=>{const{storeDateRange:r,selectedStore:v}=We(),[f,b]=i.useState([]),[g,k]=i.useState([]),[u,_]=i.useState(!1),[j,h]=i.useState("revenue"),[t,l]=i.useState("desc"),[x,o]=i.useState(""),[c,d]=i.useState(""),[m,O]=i.useState("all"),[D,$]=i.useState([]),[q,T]=i.useState(!1),[w,A]=i.useState(()=>{const s=sessionStorage.getItem("excludedStores");return s?JSON.parse(s):[]}),[B,Y]=i.useState(!1),[H,K]=i.useState([]),[V,J]=i.useState(!1),[P,p]=i.useState(null),N=i.useRef("");i.useEffect(()=>{if(r!=null&&r.max_date){const s=new Date(r.max_date),n=new Date(s);n.setDate(n.getDate()-6),d(s.toISOString().split("T")[0]),o(n.toISOString().split("T")[0])}},[r==null?void 0:r.max_date]);const S=i.useMemo(()=>{if(!x||!c)return{start:"",end:""};const s=new Date(x),n=new Date(c),y=Math.ceil((n.getTime()-s.getTime())/(1e3*60*60*24))+1,C=new Date(s);C.setDate(C.getDate()-1);const F=new Date(C);return F.setDate(F.getDate()-y+1),{start:F.toISOString().split("T")[0],end:C.toISOString().split("T")[0]}},[x,c]);i.useEffect(()=>{if(!x||!c)return;(async()=>{T(!0);try{const n=await G.getAvailableChannels({start_date:x,end_date:c});n.success&&n.data&&$(n.data)}catch(n){console.error("è·å–å¯ç”¨æ¸ é“åˆ—è¡¨å¤±è´¥:",n)}finally{T(!1)}})()},[x,c]),i.useEffect(()=>{if(!x||!c)return;(async()=>{try{const n=await G.getStoresByChannel({start_date:x,end_date:c,channel:m==="all"?void 0:m});n.success&&n.data&&(K(n.data),A(y=>y.filter(C=>n.data.includes(C))))}catch(n){console.error("è·å–é—¨åº—åˆ—è¡¨å¤±è´¥:",n)}})()},[x,c,m]),i.useEffect(()=>{sessionStorage.setItem("excludedStores",JSON.stringify(w))},[w]);const z=i.useMemo(()=>f.filter(s=>!w.includes(s.store_name)),[f,w]),W=i.useMemo(()=>{if(z.length===0)return{total_stores:0,total_orders:0,total_revenue:0,total_profit:0,avg_profit_margin:0,anomaly_count:0};const s=z.reduce((M,L)=>M+L.order_count,0),n=z.reduce((M,L)=>M+L.total_revenue,0),y=z.reduce((M,L)=>M+L.total_profit,0),C=n>0?y/n*100:0,F=z.filter(M=>M.anomalies&&M.anomalies.length>0).length;return{total_stores:z.length,total_orders:s,total_revenue:n,total_profit:y,avg_profit_margin:C,anomaly_count:F}},[z]),ee=i.useCallback(async()=>{if(!x||!c)return;const s=`${x}-${c}-${j}-${t}-${m}`;if(N.current===s){console.log("ğŸ“¦ [é—¨åº—å¯¹æ¯”] è·³è¿‡é‡å¤è¯·æ±‚");return}N.current=s,_(!0);try{const n={sort_by:j,sort_order:t,start_date:x,end_date:c,channel:m==="all"?void 0:m};console.log("ğŸ” [é—¨åº—å¯¹æ¯”] è¯·æ±‚å‚æ•°:",n);const[y,C]=await Promise.all([G.getComparison(n),G.getWeekOverWeek(c,S.start,S.end,m==="all"?void 0:m)]);y.success&&y.data?(console.log("âœ… [é—¨åº—å¯¹æ¯”] é—¨åº—æ•°æ®:",y.data.stores.length,"ä¸ªé—¨åº—"),b(y.data.stores)):b([]),C.success&&C.data&&k(C.data.stores)}catch(n){console.error("âŒ [é—¨åº—å¯¹æ¯”] è·å–æ•°æ®å¤±è´¥:",n),b([])}finally{_(!1)}},[x,c,S.start,S.end,j,t,m]);i.useEffect(()=>{ee()},[ee]);const pe=i.useMemo(()=>z.map(s=>{const n=g.find(y=>y.store_name===s.store_name);return{...s,weekOverWeek:n==null?void 0:n.changes}}),[z,g]),X=i.useMemo(()=>H.length>0?H:f.map(s=>s.store_name).sort(),[H,f]),te=s=>{A(n=>n.includes(s)?n.filter(y=>y!==s):[...n,s])},fe=()=>{w.length===0?A(X):A([])},ue=(s,n)=>{o(s),d(n),N.current=""},se=()=>{if(r!=null&&r.max_date){const s=new Date(r.max_date),n=new Date(s);n.setDate(n.getDate()-6),d(s.toISOString().split("T")[0]),o(n.toISOString().split("T")[0]),N.current=""}},ae=async s=>{J(!0);try{const n=await G.exportData({start_date:x,end_date:c,channel:m==="all"?void 0:m,format:s});if(n.success&&n.data){const{content:y,filename:C}=n.data;if(s==="csv"){const F=new Blob([y],{type:"text/csv;charset=utf-8;"}),M=URL.createObjectURL(F),L=document.createElement("a");L.href=M,L.download=C,L.click(),URL.revokeObjectURL(M)}else{const F=new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),M=URL.createObjectURL(F),L=document.createElement("a");L.href=M,L.download=C,L.click(),URL.revokeObjectURL(M)}}}catch(n){console.error("å¯¼å‡ºå¤±è´¥:",n)}finally{J(!1)}},he=s=>{p(n=>n===s?null:s)};return e.jsxs("div",{className:"flex flex-col gap-6 w-full",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(Q,{size:24,className:"text-indigo-400"}),"å…¨é‡é—¨åº—å¯¹æ¯”åˆ†æ"]}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"å¯¹æ¯”æ‰€æœ‰é—¨åº—çš„å…³é”®æŒ‡æ ‡ï¼Œå‘ç°ä¼˜åŠ£åŠ¿é—¨åº—"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>ae("csv"),disabled:V||u||f.length===0,className:`flex items-center gap-1.5 px-3 py-1.5 bg-emerald-600/20 hover:bg-emerald-600/30 \r
                         text-emerald-400 rounded-lg text-sm transition-colors disabled:opacity-50`,children:[e.jsx(ie,{size:14}),"å¯¼å‡ºCSV"]}),e.jsxs("button",{onClick:()=>ae("json"),disabled:V||u||f.length===0,className:`flex items-center gap-1.5 px-3 py-1.5 bg-blue-600/20 hover:bg-blue-600/30 \r
                         text-blue-400 rounded-lg text-sm transition-colors disabled:opacity-50`,children:[e.jsx(ie,{size:14}),"å¯¼å‡ºJSON"]})]}),v&&e.jsx("div",{className:"text-xs text-amber-400 bg-amber-500/10 px-3 py-2 rounded-lg border border-amber-500/20",children:"ğŸ’¡ å…¨é‡é—¨åº—å¯¹æ¯”æ˜¾ç¤ºæ‰€æœ‰é—¨åº—æ•°æ®ï¼Œä¸å—é¡¶éƒ¨é—¨åº—ç­›é€‰å½±å“"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(Be,{currentStart:x,currentEnd:c,previousStart:S.start,previousEnd:S.end,minDate:(r==null?void 0:r.min_date)||void 0,maxDate:(r==null?void 0:r.max_date)||void 0,onApply:ue,onReset:se}),e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(oe,{size:18,className:"text-blue-400"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"æ¸ é“ç­›é€‰"}),q&&e.jsx("span",{className:"text-xs text-slate-500 animate-pulse",children:"åŠ è½½ä¸­..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{selectedChannel:m,channelList:D,onSelect:s=>{O(s),N.current=""},isDark:a==="dark",accentColor:"cyan"}),e.jsx("span",{className:"text-xs text-slate-400 flex-1",children:m==="all"?`æ˜¾ç¤ºæ‰€æœ‰æ¸ é“ (${D.length}ä¸ª)`:`ä»…æ˜¾ç¤º${m}æ¸ é“`})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"ğŸ’¡ åªæ˜¾ç¤ºå½“å‰æ—¥æœŸèŒƒå›´å†…æœ‰æ•°æ®çš„æ¸ é“"})]}),e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{size:18,className:"text-indigo-400"}),e.jsxs("h3",{className:"text-sm font-semibold text-white",children:["æ˜¾ç¤ºé—¨åº— (",z.length,"/",X.length,")"]})]}),e.jsx("button",{onClick:()=>Y(!B),className:"text-xs text-indigo-400 hover:text-indigo-300",children:B?"æ”¶èµ·":"å±•å¼€"})]}),B&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{onClick:fe,className:"text-xs px-3 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors",children:w.length===0?"å…¨éƒ¨å‰”é™¤":"å…¨éƒ¨æ¢å¤"}),w.length>0&&e.jsxs("span",{className:"text-xs text-amber-400 flex items-center",children:["å·²å‰”é™¤ ",w.length," ä¸ªé—¨åº—"]})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto space-y-1 bg-slate-900/50 rounded p-2",children:X.map(s=>e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 hover:bg-slate-800 rounded cursor-pointer text-sm",children:[e.jsx("input",{type:"checkbox",checked:!w.includes(s),onChange:()=>te(s),className:"w-4 h-4 text-indigo-600 bg-slate-700 border-slate-600 rounded focus:ring-indigo-500"}),e.jsx("span",{className:w.includes(s)?"text-slate-500 line-through":"text-white",children:s})]},s))})]}),!B&&w.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[w.slice(0,3).map(s=>e.jsxs("span",{className:"text-xs px-2 py-1 bg-slate-700 text-slate-300 rounded flex items-center gap-1",children:[s,e.jsx(ce,{size:12,className:"cursor-pointer hover:text-white",onClick:()=>te(s)})]},s)),w.length>3&&e.jsxs("span",{className:"text-xs px-2 py-1 text-slate-400",children:["+",w.length-3," æ›´å¤š"]})]})]})]}),u&&e.jsxs("div",{className:`fixed top-4 right-4 z-50 bg-indigo-600/90 text-white px-4 py-2 rounded-lg \r
                        flex items-center gap-2 shadow-lg animate-pulse`,children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"æ­£åœ¨åŠ è½½æ•°æ®..."]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsx(U,{title:"æ˜¾ç¤ºé—¨åº—æ•°",value:W.total_stores.toString(),subtext:w.length>0?`å·²å‰”é™¤ ${w.length} ä¸ª`:"å…¨éƒ¨é—¨åº—",icon:e.jsx(Q,{size:18}),iconColor:"indigo",theme:a,loading:u,compact:!0}),e.jsx(U,{title:"æ€»è®¢å•é‡",value:W.total_orders.toLocaleString(),subtext:"è®¢å•",icon:e.jsx(Le,{size:18}),iconColor:"cyan",theme:a,loading:u,compact:!0}),e.jsx(U,{title:"æ€»é”€å”®é¢",value:`Â¥${W.total_revenue.toLocaleString()}`,subtext:"é”€å”®é¢",icon:e.jsx(Oe,{size:18}),iconColor:"emerald",theme:a,loading:u,compact:!0}),e.jsx(U,{title:"æ€»åˆ©æ¶¦",value:`Â¥${W.total_profit.toLocaleString()}`,subtext:"åˆ©æ¶¦",icon:e.jsx($e,{size:18}),iconColor:"amber",theme:a,loading:u,compact:!0}),e.jsx(U,{title:"åŠ æƒåˆ©æ¶¦ç‡",value:`${W.avg_profit_margin.toFixed(1)}%`,subtext:"æ€»åˆ©æ¶¦/æ€»é”€å”®é¢",icon:e.jsx(Fe,{size:18}),iconColor:"violet",theme:a,loading:u,compact:!0}),e.jsx(U,{title:"å¼‚å¸¸é—¨åº—",value:W.anomaly_count.toString(),subtext:W.anomaly_count>0?"éœ€å…³æ³¨":"è¿è¥æ­£å¸¸",icon:e.jsx(Z,{size:18}),iconColor:W.anomaly_count>0?"rose":"emerald",theme:a,loading:u,compact:!0})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-[450px]",children:e.jsx(Te,{stores:z,metric:j,theme:a,loading:u})}),e.jsx("div",{className:"h-[450px]",children:e.jsx(Ae,{stores:z,theme:a,loading:u,selectedStore:P,onStoreClick:he})})]}),P&&e.jsxs("div",{className:"bg-indigo-900/30 border border-indigo-500/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(xe,{size:20,className:"text-indigo-400"}),P," è¯¦æƒ…"]}),e.jsx("button",{onClick:()=>p(null),className:"text-slate-400 hover:text-white",children:e.jsx(ce,{size:18})})]}),(()=>{const s=z.find(n=>n.store_name===P);return s?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"è®¢å•é‡"}),e.jsx("p",{className:"text-white font-medium",children:s.order_count.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"é”€å”®é¢"}),e.jsxs("p",{className:"text-white font-medium",children:["Â¥",s.total_revenue.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"åˆ©æ¶¦"}),e.jsxs("p",{className:"text-white font-medium",children:["Â¥",s.total_profit.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"åˆ©æ¶¦ç‡"}),e.jsxs("p",{className:`font-medium ${s.profit_margin>=30?"text-emerald-400":s.profit_margin>=20?"text-cyan-400":s.profit_margin>=10?"text-amber-400":"text-red-400"}`,children:[s.profit_margin.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"å®¢å•ä»·"}),e.jsxs("p",{className:"text-white font-medium",children:["Â¥",s.aov.toFixed(1)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"å•å‡é…é€è´¹"}),e.jsxs("p",{className:"text-white font-medium",children:["Â¥",s.avg_delivery_fee.toFixed(1)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"å•å‡è¥é”€è´¹"}),e.jsxs("p",{className:"text-white font-medium",children:["Â¥",s.avg_marketing_cost.toFixed(1)]})]}),s.anomalies&&s.anomalies.length>0&&e.jsx("div",{className:"col-span-full mt-2 space-y-1",children:s.anomalies.map((n,y)=>e.jsxs("div",{className:`text-xs px-3 py-1.5 rounded flex items-center gap-2 ${n.severity==="high"?"bg-red-500/20 text-red-400":n.severity==="medium"?"bg-amber-500/20 text-amber-400":"bg-blue-500/20 text-blue-400"}`,children:[e.jsx(Z,{size:12}),n.message]},y))})]}):null})()]}),e.jsx("div",{children:e.jsx(Re,{stores:pe,theme:a,loading:u,sortBy:j,sortOrder:t,onSort:(s,n)=>{h(s),l(n),N.current=""},onStoreClick:p})}),!u&&f.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx(Q,{size:48,className:"text-slate-600 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-400 mb-2",children:"æš‚æ— é—¨åº—æ•°æ®"}),e.jsx("p",{className:"text-sm text-slate-500 max-w-md",children:"å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ²¡æœ‰æ‰¾åˆ°é—¨åº—æ•°æ®ã€‚è¯·å°è¯•è°ƒæ•´æ—¥æœŸèŒƒå›´æˆ–æ¸ é“ç­›é€‰æ¡ä»¶ã€‚"}),e.jsx("button",{onClick:se,className:"mt-4 px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-sm transition-colors",children:"é‡ç½®ç­›é€‰æ¡ä»¶"})]})]})};export{Ue as default};
