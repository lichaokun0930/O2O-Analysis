import{r as m,j as l}from"./framework-DfnVWwpF.js";import"./charts-bindingecharts-DvSHEz9I.js";import{u as x}from"./index-BXnA4bXl.js";import{V as y}from"./vendor-DUbYPDw3.js";import"./utils-CB2_sajW.js";const p={配送费减免:"#f43f5e",满减金额:"#f59e0b",商品减免:"#eab308",商家代金券:"#22c55e",商家承担券:"#14b8a6",满赠金额:"#3b82f6",商家其他优惠:"#8b5cf6",新客减免:"#ec4899"},g=[["delivery_discount","配送费减免"],["full_reduction","满减金额"],["product_discount","商品减免"],["merchant_voucher","商家代金券"],["merchant_share","商家承担券"],["gift_amount","满赠金额"],["other_discount","商家其他优惠"],["new_customer_discount","新客减免"]];function C(c,f,o){const s=[],u=[],i="#6366f1",r=new Set,a=new Set;return c.forEach(e=>{const n=e.marketing_costs;let t=!1;g.forEach(([d,h])=>{n[d]>0&&(t=!0,a.add(h))}),t&&r.add(e.channel)}),c.forEach(e=>{r.has(e.channel)&&s.push({name:e.channel,itemStyle:{color:i,opacity:1,borderColor:o,shadowBlur:10,shadowColor:i},label:{position:"left"}})}),g.forEach(([,e])=>{if(a.has(e)){const n=p[e];s.push({name:e,itemStyle:{color:n,borderColor:"#fff",borderWidth:1,shadowBlur:15,shadowColor:n},label:{position:"right"}})}}),c.forEach(e=>{if(!r.has(e.channel))return;const n=e.marketing_costs;g.forEach(([t,d])=>{const h=n[t];if(h>0){const b=p[d];u.push({source:e.channel,target:d,value:h,lineStyle:{color:new y(0,0,1,0,[{offset:0,color:i},{offset:1,color:b}]),opacity:.4,curveness:.5}})}})}),{nodes:s,links:u}}const w=({data:c,theme:f})=>{const o=f==="dark",s=o?"#cbd5e1":"#475569",u=o?"#fff":"#0f172a",i=o?"#a5b4fc":"#6366f1",{nodes:r,links:a}=m.useMemo(()=>C(c,o,i),[c,o,i]),e=m.useMemo(()=>!r.length||!a.length?{series:[]}:{backgroundColor:"transparent",tooltip:{trigger:"item",triggerOn:"mousemove",backgroundColor:o?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:o?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",padding:12,extraCssText:"backdrop-filter: blur(10px);",textStyle:{color:o?"#f8fafc":"#0f172a",fontFamily:"JetBrains Mono",fontSize:12},formatter:t=>!t||!t.data?"":t.dataType==="node"?`<b>${t.data.name}</b>`:t.dataType==="edge"?`${t.data.source} → ${t.data.target}<br/>¥${t.data.value?.toLocaleString()||0}`:""},series:[{type:"sankey",left:120,right:100,top:20,bottom:20,nodeAlign:"justify",draggable:!1,data:r,links:a,emphasis:{focus:"adjacency"},label:{color:s,fontSize:11,fontFamily:"Inter"},lineStyle:{color:"source",curveness:.5},itemStyle:{borderWidth:0}}]},[r,a,o,s]),n=x(e,[r,a,f],f);return l.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col relative group",children:[l.jsxs("div",{className:"mb-2 shrink-0 relative z-10 pointer-events-none",children:[l.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:u},children:[l.jsx("span",{className:"w-1 h-5 bg-neon-blue rounded-full shadow-[0_0_10px_#60a5fa]"}),"营销成本结构"]}),l.jsx("p",{className:"text-xs mt-1 font-mono uppercase tracking-wider opacity-70",style:{color:s},children:"MARKETING COST FLOW: CHANNEL → TYPE"})]}),l.jsx("div",{className:"flex-1 w-full min-h-[300px] relative z-0",children:l.jsx("div",{ref:n,className:"w-full h-full"})})]})};export{w as default,C as transformToSankeyData};
