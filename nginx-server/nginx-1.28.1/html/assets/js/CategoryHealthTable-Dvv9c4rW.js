import{r as we,a as ve,j as e,D as Ne,z as _e}from"./index-C818Opqu.js";import{r as n}from"./react-core-TYaY7wwJ.js";import{l as ke,d as X,C as Z,b as ee,c as Ce,e as te,R as De,H as Me,a1 as Se,T as ze,G as Re,a2 as $e}from"./icons-22UXCqKE.js";import{N as k,z as Ee,y as Le,O as se,g as C}from"./utils-DNh_Lx5Z.js";import"./echarts-BWHOTeAv.js";const Oe={getHealth(g){return we.get("/category/health",{params:g})}},Be=()=>{const[g,B]=n.useState([]),[D,G]=n.useState(!1),[x,M]=n.useState("preset"),[S,I]=n.useState(7),[i,z]=n.useState(""),[c,R]=n.useState(""),[l,$]=n.useState(""),[j,E]=n.useState(!1),[L,w]=n.useState(!1),[r,y]=n.useState(),[o,V]=n.useState(null),[b,K]=n.useState("current_revenue"),[O,F]=n.useState("desc"),[q,ne]=n.useState(null),P=n.useRef(null),T=n.useRef(null),A=n.useRef(null),H=n.useRef(null),{selectedStore:U,storeDateRange:d,channelList:v}=ve(),N=d?.min_date?k(d.min_date,"yyyy-MM-dd",new Date):void 0,h=d?.max_date?k(d.max_date,"yyyy-MM-dd",new Date):void 0;n.useEffect(()=>{l&&v.length>0&&!v.includes(l)&&$("")},[v,l]),n.useEffect(()=>{const t=s=>{const a=s.target;j&&P.current&&!P.current.contains(a)&&T.current&&!T.current.contains(a)&&E(!1),L&&A.current&&!A.current.contains(a)&&H.current&&!H.current.contains(a)&&w(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[j,L]);const ae=n.useCallback(t=>!!(N&&Ee(t,N)||h&&Le(t,h)),[N,h]),re=n.useCallback(()=>{if(x==="custom"&&i&&c){const t=k(i,"yyyy-MM-dd",new Date),s=k(c,"yyyy-MM-dd",new Date);se(t)&&se(s)&&y({from:t,to:s})}else y(void 0);w(!0)},[x,i,c]),oe=n.useCallback(()=>{r?.from&&r?.to&&(z(C(r.from,"yyyy-MM-dd")),R(C(r.to,"yyyy-MM-dd")),M("custom"),w(!1))},[r]),_=n.useCallback(async()=>{G(!0);try{const t={store_name:U||void 0,channel:l||void 0,level:o?3:1,parent_category:o||void 0};x==="custom"&&i&&c?(t.start_date=i,t.end_date=c):t.period=S;const s=await Oe.getHealth(t);s.success&&(B(s.data),ne({start:s.period.start,end:s.period.end}))}catch(t){console.error("è·å–å“ç±»å¥åº·åº¦æ•°æ®å¤±è´¥:",t),B([])}finally{G(!1)}},[U,l,x,S,i,c,o]),le=n.useCallback(()=>{K("current_revenue"),F("desc"),$(""),M("preset"),I(7),z(""),R(""),y(void 0),_()},[_]),ie=t=>{M("preset"),I(t),z(""),R(""),y(void 0)},Y=t=>{$(t),E(!1)};n.useEffect(()=>{_()},[_]);const W=n.useMemo(()=>[...g].sort((t,s)=>{const a=t[b],u=s[b],f=a-u;return O==="desc"?-f:f}),[g,b,O]),m=t=>{b===t?F(s=>s==="desc"?"asc":"desc"):(K(t),F("desc"))},ce=t=>{V(t)},de=()=>{V(null)},J=t=>t>0?e.jsxs("span",{className:"flex items-center gap-1 text-emerald-400 font-mono",children:[e.jsx(ze,{size:14}),"+",t.toFixed(1),"%"]}):t<0?e.jsxs("span",{className:"flex items-center gap-1 text-rose-400 font-mono",children:[e.jsx(Re,{size:14}),t.toFixed(1),"%"]}):e.jsxs("span",{className:"flex items-center gap-1 text-slate-400 font-mono",children:[e.jsx($e,{size:14}),"0%"]}),xe=(t,s)=>{const a={ä½:"bg-emerald-500/20 text-emerald-400 border-emerald-500/30",ä¸­:"bg-amber-500/20 text-amber-400 border-amber-500/30",é«˜:"bg-rose-500/20 text-rose-400 border-rose-500/30"};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium border ${a[t]||a.ä¸­}`,children:t}),e.jsxs("span",{className:"text-slate-500 text-xs font-mono",children:[s.toFixed(1),"%"]})]})},he=(t,s)=>{const a=t<8?"text-rose-400":t<9?"text-amber-400":"text-slate-300";let u=null;return Math.abs(s)>=.1&&(s>0?u=e.jsxs("span",{className:"text-emerald-400 text-xs ml-1",children:["â†‘",s.toFixed(1)]}):u=e.jsxs("span",{className:"text-rose-400 text-xs ml-1",children:["â†“",Math.abs(s).toFixed(1)]})),e.jsxs("span",{className:`font-mono ${a}`,children:[t.toFixed(1),"æŠ˜",u]})},me=t=>{const s=t>=40?"text-emerald-400":t>=25?"text-cyan-400":t>=10?"text-amber-400":"text-rose-400";return e.jsxs("span",{className:`font-mono font-medium ${s}`,children:[t.toFixed(1),"%"]})},pe=t=>{if(!t||t.length<2)return null;const s=Math.max(...t),a=Math.min(...t),u=s-a||1,f=24,Q=60,ue=t.map((ge,je)=>{const ye=je/(t.length-1)*Q,be=f-(ge-a)/u*f;return`${ye},${be}`}).join(" "),fe=(t[t.length-1]>=t[0]?"up":"down")==="up"?"#34d399":"#f87171";return e.jsx("svg",{width:Q,height:f,className:"opacity-70",children:e.jsx("polyline",{points:ue,fill:"none",stroke:fe,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})},p=({column:t})=>b!==t?e.jsx(Se,{size:12,className:"text-slate-600"}):O==="desc"?e.jsx(Z,{size:12,className:"text-indigo-400"}):e.jsx(te,{size:12,className:"text-indigo-400 rotate-[-90deg]"});return e.jsxs("div",{className:"glass-panel rounded-2xl overflow-hidden flex flex-col h-full",children:[e.jsx("div",{className:"p-6 border-b border-white/5 bg-white/[0.02]",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(ke,{size:18,className:"text-violet-400"}),"å“ç±»å¥åº·åº¦åˆ†æ",o&&e.jsxs("span",{className:"text-sm font-normal text-slate-400 ml-2",children:["/ ",o]})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1 font-mono uppercase tracking-wider",children:["CATEGORY HEALTH METRICS Â· ",q?`${q.start} ~ ${q.end}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[o&&e.jsxs("button",{onClick:de,className:"flex items-center gap-1.5 px-3 py-1.5 bg-white/5 hover:bg-white/10 text-slate-300 hover:text-white border border-white/10 rounded-lg text-xs font-medium transition-all",children:[e.jsx(X,{size:14}),"è¿”å›ä¸Šçº§"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:P,onClick:()=>E(!j),className:"flex items-center gap-2 px-3 py-1.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-xs text-white transition-all",children:[e.jsx("span",{className:"text-cyan-400",children:"æ¸ é“:"}),e.jsx("span",{className:"max-w-[80px] truncate",children:l||"å…¨éƒ¨"}),e.jsx(Z,{size:12,className:`text-slate-400 transition-transform ${j?"rotate-180":""}`})]}),j&&e.jsxs("div",{ref:T,className:"absolute top-full left-0 mt-2 w-36 bg-slate-900 border border-white/10 rounded-xl shadow-2xl z-50 overflow-hidden animate-fade-in-up",children:[e.jsxs("button",{onClick:()=>Y(""),className:`w-full flex items-center justify-between px-4 py-2.5 text-xs transition-colors ${l===""?"bg-cyan-500/20 text-cyan-300":"text-slate-300 hover:bg-white/5"}`,children:[e.jsx("span",{children:"å…¨éƒ¨æ¸ é“"}),l===""&&e.jsx(ee,{size:12,className:"text-cyan-400"})]}),v.map(t=>e.jsxs("button",{onClick:()=>Y(t),className:`w-full flex items-center justify-between px-4 py-2.5 text-xs transition-colors ${l===t?"bg-cyan-500/20 text-cyan-300":"text-slate-300 hover:bg-white/5"}`,children:[e.jsx("span",{children:t}),l===t&&e.jsx(ee,{size:12,className:"text-cyan-400"})]},t))]})]}),e.jsx("div",{className:"flex items-center bg-slate-800/50 rounded-lg p-0.5 border border-white/5",children:[7,14,30].map(t=>e.jsxs("button",{onClick:()=>ie(t),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-all ${x==="preset"&&S===t?"bg-violet-500 text-white shadow-lg":"text-slate-400 hover:text-white"}`,children:[t,"å¤©"]},t))}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:A,onClick:re,className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border transition-all text-xs ${x==="custom"?"bg-indigo-500/20 border-indigo-500/50 text-indigo-300":"bg-white/5 border-white/10 text-slate-400 hover:bg-white/10 hover:text-white"}`,children:[e.jsx(Ce,{size:14}),e.jsx("span",{children:x==="custom"&&i&&c?`${i} ~ ${c}`:"è‡ªå®šä¹‰"})]}),L&&e.jsxs("div",{ref:H,className:"absolute top-full right-0 mt-2 p-5 rounded-xl border shadow-2xl bg-slate-900 border-white/10 z-50",style:{width:"580px"},children:[e.jsx("style",{children:`
                    .health-calendar .rdp-months {
                      display: flex !important;
                      flex-direction: row !important;
                      gap: 2rem !important;
                    }
                    .health-calendar .rdp-month {
                      margin: 0 !important;
                    }
                  `}),d?.min_date&&d?.max_date&&e.jsx("div",{className:"mb-4 px-3 py-2 bg-indigo-500/10 border border-indigo-500/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-indigo-300",children:["ğŸ“… å¯é€‰æ•°æ®èŒƒå›´: ",d.min_date," ~ ",d.max_date]})}),e.jsx("div",{className:"health-calendar",style:{display:"flex",justifyContent:"center"},children:e.jsx(Ne,{mode:"range",numberOfMonths:2,selected:r,onSelect:y,locale:_e,disabled:ae,defaultMonth:h?new Date(h.getFullYear(),h.getMonth()-1):new Date,startMonth:N,endMonth:h,showOutsideDays:!1,classNames:{months:"flex flex-row gap-8",month_caption:"flex justify-center items-center h-10 font-semibold text-sm text-slate-100",nav:"absolute top-0 left-0 right-0 flex justify-between px-2",button_previous:"w-8 h-8 rounded-lg bg-white/5 text-slate-400 flex items-center justify-center hover:bg-white/10 hover:text-slate-100",button_next:"w-8 h-8 rounded-lg bg-white/5 text-slate-400 flex items-center justify-center hover:bg-white/10 hover:text-slate-100",weekday:"text-slate-500 text-xs font-medium py-2",day:"w-9 h-9",day_button:"w-9 h-9 rounded-lg text-slate-300 text-sm hover:bg-white/10 hover:text-white transition-colors",today:"text-indigo-400 ring-1 ring-indigo-500 rounded-lg",selected:"bg-indigo-500 text-white rounded-lg",range_start:"bg-indigo-500 text-white rounded-l-lg rounded-r-none",range_end:"bg-indigo-500 text-white rounded-r-lg rounded-l-none",range_middle:"bg-indigo-500/20 text-indigo-300 rounded-none",disabled:"text-slate-600 opacity-40 cursor-not-allowed",outside:"text-slate-600 opacity-50"},components:{Chevron:({orientation:t})=>t==="left"?e.jsx(X,{size:18}):e.jsx(te,{size:18})}})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:r?.from&&r?.to?e.jsxs("span",{className:"text-emerald-400 font-medium",children:["å·²é€‰: ",C(r.from,"yyyy-MM-dd")," ~ ",C(r.to,"yyyy-MM-dd")]}):r?.from?e.jsx("span",{className:"text-amber-400",children:"è¯·é€‰æ‹©ç»“æŸæ—¥æœŸ"}):e.jsx("span",{children:"ç‚¹å‡»é€‰æ‹©å¼€å§‹æ—¥æœŸ"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>w(!1),className:"px-4 py-2 text-xs text-slate-400 hover:text-white transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:oe,disabled:!r?.from||!r?.to,className:"px-5 py-2 bg-indigo-500 text-white rounded-lg text-xs font-medium hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"ç¡®è®¤é€‰æ‹©"})]})]})]})]}),e.jsx("button",{onClick:le,disabled:D,className:"p-2 bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white border border-white/5 rounded-lg transition-all",title:"åˆ·æ–°å¹¶é‡ç½®æ’åº",children:e.jsx(De,{size:14,className:D?"animate-spin":""})})]})]})}),D&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 z-10 rounded-2xl",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-violet-500"})}),e.jsx("div",{className:"overflow-auto flex-1 relative",children:e.jsxs("table",{className:"w-full divide-y divide-white/5 border-collapse",style:{tableLayout:"fixed"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"140px"}})," ",e.jsx("col",{style:{width:"110px"}})," ",e.jsx("col",{style:{width:"100px"}})," ",e.jsx("col",{style:{width:"80px"}}),"  ",e.jsx("col",{style:{width:"100px"}})," ",e.jsx("col",{style:{width:"110px"}})," ",e.jsx("col",{style:{width:"110px"}})," ",e.jsx("col",{style:{width:"80px"}}),"  ",e.jsx("col",{style:{width:"80px"}}),"  ",!o&&e.jsx("col",{style:{width:"60px"}})," "]}),e.jsx("thead",{className:"sticky top-0 z-20",children:e.jsxs("tr",{className:"bg-slate-900",children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-bold text-slate-400 uppercase tracking-wider font-mono sticky left-0 z-30 bg-slate-900 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.3)]",children:o?"ä¸‰çº§åˆ†ç±»":"ä¸€çº§åˆ†ç±»"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>m("current_revenue"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["é”€å”®é¢ ",e.jsx(p,{column:"current_revenue"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>m("growth_rate"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["é”€å”®ç¯æ¯” ",e.jsx(p,{column:"growth_rate"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>m("current_quantity"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["é”€é‡ ",e.jsx(p,{column:"current_quantity"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>m("quantity_growth_rate"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["é”€é‡ç¯æ¯” ",e.jsx(p,{column:"quantity_growth_rate"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>m("volatility"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["æ³¢åŠ¨ ",e.jsx(p,{column:"volatility"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>m("avg_discount"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["æŠ˜æ‰£ ",e.jsx(p,{column:"avg_discount"})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-bold text-slate-400 uppercase tracking-wider font-mono cursor-pointer hover:text-white transition-colors bg-slate-900",onClick:()=>m("profit_margin"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["åˆ©æ¶¦ç‡ ",e.jsx(p,{column:"profit_margin"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-slate-400 uppercase tracking-wider font-mono bg-slate-900",children:"è¶‹åŠ¿"}),!o&&e.jsx("th",{className:"px-2 py-3 text-center text-xs font-bold text-slate-400 uppercase tracking-wider font-mono bg-slate-900",children:"æ“ä½œ"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:W.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:o?9:10,className:"px-4 py-12 text-center text-slate-500",children:"æš‚æ— æ•°æ®"})}):W.map((t,s)=>e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors group",style:{animationDelay:`${s*30}ms`},children:[e.jsx("td",{className:"px-3 py-3 whitespace-nowrap sticky left-0 z-10 bg-slate-900 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.3)] group-hover:bg-slate-800 overflow-hidden",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-xs font-bold bg-violet-500/20 border border-violet-500/30 text-violet-300 flex-shrink-0",children:s+1}),e.jsx("span",{className:"text-sm font-medium text-slate-200 truncate",children:t.name})]})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:e.jsxs("span",{className:"text-sm font-mono text-slate-300",children:["Â¥",t.current_revenue.toLocaleString()]})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:J(t.growth_rate)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:e.jsx("span",{className:"text-sm font-mono text-slate-300",children:t.current_quantity.toLocaleString()})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:J(t.quantity_growth_rate)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:xe(t.volatility_level,t.volatility)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:he(t.avg_discount,t.discount_change)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right",children:me(t.profit_margin)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:e.jsx("div",{className:"flex justify-center",children:pe(t.daily_revenue)})}),!o&&e.jsx("td",{className:"px-2 py-3 text-center",children:e.jsxs("button",{onClick:()=>ce(t.name),className:"flex items-center gap-1 px-2 py-1 text-xs text-slate-400 hover:text-violet-400 hover:bg-violet-500/10 rounded transition-all mx-auto",children:[e.jsx(Me,{size:12}),"ä¸‹é’»"]})})]},t.name))})]})}),e.jsxs("div",{className:"p-3 border-t border-white/5 bg-slate-900/20 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-slate-500 font-mono",children:["å…± ",g.length," ä¸ª",o?"ä¸‰çº§":"ä¸€çº§","åˆ†ç±»"]}),e.jsx("span",{className:"text-xs text-slate-500",children:"ç‚¹å‡»è¡¨å¤´å¯æ’åº Â· ç‚¹å‡»ã€Œä¸‹é’»ã€æŸ¥çœ‹ä¸‰çº§åˆ†ç±»"})]})]})};export{Be as default};
