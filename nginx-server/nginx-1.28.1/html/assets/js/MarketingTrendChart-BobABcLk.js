import{r as h,j as e}from"./framework-DfnVWwpF.js";import{a as v,u as j,C as N}from"./index-CX6U_nV3.js";import"./utils-CB2_sajW.js";import"./vendor-DUbYPDw3.js";import"./charts-bindingecharts-DvSHEz9I.js";const k=[["full_reduction","æ»¡å‡é‡‘é¢"],["product_discount","å•†å“å‡å…"],["merchant_voucher","å•†å®¶ä»£é‡‘åˆ¸"],["merchant_share","å•†å®¶æ‰¿æ‹…åˆ¸"],["gift_amount","æ»¡èµ é‡‘é¢"],["other_discount","å•†å®¶å…¶ä»–ä¼˜æƒ "],["new_customer_discount","æ–°å®¢å‡å…"]],C={æ»¡å‡é‡‘é¢:"#f59e0b",å•†å“å‡å…:"#eab308",å•†å®¶ä»£é‡‘åˆ¸:"#22c55e",å•†å®¶æ‰¿æ‹…åˆ¸:"#14b8a6",æ»¡èµ é‡‘é¢:"#3b82f6",å•†å®¶å…¶ä»–ä¼˜æƒ :"#8b5cf6",æ–°å®¢å‡å…:"#ec4899"};function w(s){return k.filter(([n])=>{const a=s[n];return a&&a.some(o=>o>0)})}function S(s,n){return s.map((a,o)=>{const c=n[o];return c===0?0:a/c*100})}function _(s,n,a){const{dates:o,series:c,totals:m}=s,d=w(c),g=d.map(([t,p])=>{const l=c[t]||[],u=n==="percentage"?S(l,m):l;return{name:p,type:"line",stack:"total",areaStyle:{opacity:.6},emphasis:{focus:"series"},data:u,itemStyle:{color:C[p]},lineStyle:{width:1},symbol:"none",smooth:.3}}),x=a?"#64748b":"#94a3b8",r=a?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)";return{grid:{top:40,right:20,bottom:60,left:50,containLabel:!1},tooltip:{trigger:"axis",backgroundColor:a?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:a?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:12,textStyle:{fontFamily:"JetBrains Mono",color:a?"#fff":"#0f172a",fontSize:11},axisPointer:{type:"cross",label:{backgroundColor:"#6366f1"}},formatter:t=>{if(!Array.isArray(t)||t.length===0)return"";const p=t[0].axisValue;let l=`<div style="font-weight:bold;margin-bottom:8px">${p}</div>`;const u=o.indexOf(p),i=u>=0?m[u]:0;return t.forEach(f=>{const b=f.value||0,y=i>0?b/(n==="percentage"?100:i)*100:0;n==="percentage"?l+=`<div style="display:flex;justify-content:space-between;gap:16px">
              <span>${f.marker}${f.seriesName}</span>
              <span style="font-weight:bold">${b.toFixed(1)}%</span>
            </div>`:l+=`<div style="display:flex;justify-content:space-between;gap:16px">
              <span>${f.marker}${f.seriesName}</span>
              <span style="font-weight:bold">Â¥${b.toLocaleString()} (${y.toFixed(1)}%)</span>
            </div>`}),n==="absolute"&&(l+=`<div style="margin-top:8px;padding-top:8px;border-top:1px solid ${a?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}">
            <span style="font-weight:bold">æ€»è®¡: Â¥${i.toLocaleString()}</span>
          </div>`),l}},legend:{data:d.map(([,t])=>t),bottom:0,textStyle:{color:x,fontSize:10},itemGap:12,icon:"roundRect",itemWidth:12,itemHeight:8},xAxis:{type:"category",data:o.map(t=>t.slice(5)),boundaryGap:!1,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:x,fontSize:10,fontFamily:"JetBrains Mono"}},yAxis:{type:"value",max:n==="percentage"?100:void 0,splitLine:{lineStyle:{color:r,type:"dashed"}},axisLabel:{color:x,fontSize:10,formatter:n==="percentage"?"{value}%":t=>`Â¥${t>=1e3?(t/1e3).toFixed(0)+"k":t}`}},series:g}}const M=({data:s,theme:n,loading:a,error:o,selectedChannel:c,onChannelChange:m})=>{const[d,g]=h.useState("percentage"),{channelList:x}=v();console.log("ğŸ“ˆ MarketingTrendChart channelList:",x);const r=n==="dark",t=r?"#fff":"#0f172a",p=r?"#94a3b8":"#64748b",l=h.useMemo(()=>{if(console.log("ğŸ“ˆ MarketingTrendChart option è®¡ç®—, data:",s),!s||!s.dates||s.dates.length===0)return console.log("ğŸ“ˆ MarketingTrendChart - æ— æ•°æ®ï¼Œè¿”å›ç©º series"),{series:[]};const i=_(s,d,r);return console.log("ğŸ“ˆ MarketingTrendChart option ç»“æœ:",{seriesCount:i.series?.length,xAxisData:i.xAxis?.data?.length,firstSeriesName:i.series?.[0]?.name,firstSeriesDataSample:i.series?.[0]?.data?.slice(0,3)}),i},[s,d,r]),u=j(l,[],n);return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-24 bg-gradient-to-b from-pink-500/5 to-transparent pointer-events-none"}),e.jsxs("div",{className:"mb-2 flex justify-between items-start relative z-10",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:t},children:[e.jsx("span",{className:"w-1 h-5 bg-gradient-to-b from-pink-400 to-pink-600 rounded-full shadow-[0_0_10px_#ec4899]"}),"è¥é”€æˆæœ¬è¶‹åŠ¿"]}),e.jsx("p",{className:"text-xs mt-1 font-mono uppercase tracking-widest opacity-70",style:{color:p},children:"MARKETING COST TREND: TYPE RATIO OVER TIME"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{selectedChannel:c,channelList:x,onSelect:m,isDark:r,accentColor:"pink"}),e.jsxs("div",{className:"flex items-center gap-1 bg-slate-800/50 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>g("percentage"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all duration-200 ${d==="percentage"?"bg-pink-500/20 text-pink-300 shadow-[0_0_10px_rgba(236,72,153,0.3)]":r?"text-slate-400 hover:text-white":"text-slate-600 hover:text-slate-900"}`,children:"ç™¾åˆ†æ¯”"}),e.jsx("button",{onClick:()=>g("absolute"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all duration-200 ${d==="absolute"?"bg-pink-500/20 text-pink-300 shadow-[0_0_10px_rgba(236,72,153,0.3)]":r?"text-slate-400 hover:text-white":"text-slate-600 hover:text-slate-900"}`,children:"ç»å¯¹å€¼"})]})]})]}),e.jsxs("div",{className:"flex-1 w-full min-h-[280px] relative",children:[e.jsx("div",{ref:u,className:"w-full h-full",style:{minHeight:"280px"}}),a&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm rounded-lg",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"})}),o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm rounded-lg",children:e.jsx("p",{className:"text-rose-400 text-sm",children:o})}),!a&&!o&&(!s||!s.dates||s.dates.length===0)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("p",{className:"text-slate-500 text-sm",children:"æš‚æ— æ•°æ®ï¼Œè¯·é€‰æ‹©é—¨åº—"})})]})]})};export{k as MARKETING_FIELD_MAPPING,C as MARKETING_TYPE_COLORS,S as calculatePercentages,M as default,w as filterZeroTypes,_ as transformToStackedAreaData};
