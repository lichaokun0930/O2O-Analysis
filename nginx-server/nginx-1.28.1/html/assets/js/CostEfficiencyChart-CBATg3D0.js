import{r as c,j as e}from"./framework-DfnVWwpF.js";import{i as B}from"./charts-bindingecharts-DvSHEz9I.js";import{a as G,o as H}from"./index-BXnA4bXl.js";import{V as E}from"./vendor-DUbYPDw3.js";import"./utils-CB2_sajW.js";const R=({value:d,label:g,isDark:h})=>{if(d==null)return null;const p=d>0,l=d<0,t=p?"text-emerald-400":l?"text-rose-400":"text-slate-400",b=p?"bg-emerald-500/10":l?"bg-rose-500/10":"bg-slate-500/10",y=p?"â†‘":l?"â†“":"";return e.jsxs("span",{className:`inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium ${b} ${t}`,children:[e.jsx("span",{className:"opacity-70",children:g}),e.jsxs("span",{children:[y,Math.abs(d).toFixed(1),"%"]})]})},U=({storeName:d,channel:g,theme:h,selectedDate:p,selectedDateRange:l})=>{const[t,b]=c.useState(null),[y,$]=c.useState(!0),v=c.useRef(null),n=c.useRef(null),{dateRange:i}=G(),r=h==="dark",m=r?"#64748b":"#94a3b8",F=r?"#fff":"#0f172a",w=r?"#94a3b8":"#64748b",z=r?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",j=p||void 0;c.useEffect(()=>{(async()=>{$(!0);try{const s={store_name:d,channel:g};j?s.target_date=j:l?(s.start_date=l.start,s.end_date=l.end):i.type!=="all"&&i.start&&i.end&&(s.start_date=i.start,s.end_date=i.end),console.log("ğŸ“Š åˆ†æ—¶æ®µè¯Šæ–­è¯·æ±‚å‚æ•°:",s,"| dateRange:",i);const u=await H.getHourlyProfit(s);u.success&&u.data&&(b(u.data),console.log("ğŸ“Š åˆ†æ—¶æ®µè¯Šæ–­è¿”å›æ•°æ®:",u.data.date))}catch(s){console.error("è·å–åˆ†æ—¶åˆ©æ¶¦æ•°æ®å¤±è´¥:",s)}finally{$(!1)}})()},[d,g,j,l,i.type,i.start,i.end]),c.useEffect(()=>{if(!v.current||!t)return;n.current||(n.current=B(v.current,r?"dark":void 0));const{hours:a,orders:s,profits:u,avg_profits:P,peak_periods:S}=t,_=S&&S.length>0?S.map(o=>[{xAxis:a[o.start_hour]||`${o.start_hour}:00`,itemStyle:{color:r?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.03)"}},{xAxis:a[Math.min(o.end_hour+1,23)]||`${o.end_hour+1}:00`}]):[],T={backgroundColor:"transparent",grid:{top:35,right:45,bottom:25,left:40,containLabel:!0},tooltip:{trigger:"axis",backgroundColor:r?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:r?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:16,textStyle:{fontFamily:"JetBrains Mono",color:r?"#fff":"#0f172a",fontSize:12},axisPointer:{type:"shadow"},formatter:o=>{const A=o[0]?.axisValue||"";let N=`<div style="font-weight:600;margin-bottom:8px;font-size:13px">${A}</div>`;o.forEach(f=>{const x=f.value,O=f.seriesName==="å‡€åˆ©æ¶¦"?x>=0?"#22c55e":"#f43f5e":f.color;N+=`<div style="display:flex;justify-content:space-between;align-items:center;margin:4px 0">
              <span style="display:flex;align-items:center;gap:6px">
                <span style="width:8px;height:8px;border-radius:50%;background:${O}"></span>
                ${f.seriesName}
              </span>
              <span style="font-weight:600;margin-left:20px">${f.seriesName==="å‡€åˆ©æ¶¦"?`Â¥${x.toFixed(2)}`:x}</span>
            </div>`});const L=a.indexOf(A);if(L>=0&&s[L]>0){const f=P[L],x=f>=0?"#22c55e":"#f43f5e";N+=`<div style="border-top:1px solid ${r?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"};margin-top:8px;padding-top:8px">
              <span style="color:${r?"#94a3b8":"#64748b"}">å•å‡åˆ©æ¶¦:</span>
              <span style="font-weight:600;color:${x};margin-left:8px">Â¥${f.toFixed(2)}</span>
            </div>`}return N}},legend:{data:["è®¢å•æ•°","å‡€åˆ©æ¶¦"],top:2,right:5,textStyle:{color:m,fontSize:10},itemWidth:10,itemHeight:10,itemGap:12,itemStyle:{}},xAxis:{type:"category",data:a,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:m,fontSize:10,interval:2,formatter:o=>o.replace(":00","")}},yAxis:[{type:"value",name:"",position:"left",splitLine:{lineStyle:{color:z,type:"dashed"}},axisLabel:{color:m,fontSize:10},nameTextStyle:{color:m,fontSize:10}},{type:"value",name:"",position:"right",splitLine:{show:!1},axisLabel:{color:m,fontSize:10,formatter:o=>`Â¥${o}`},nameTextStyle:{color:m,fontSize:10}}],series:[{name:"è®¢å•æ•°",type:"bar",data:s,barWidth:12,itemStyle:{borderRadius:[3,3,0,0],color:new E(0,0,0,1,[{offset:0,color:r?"rgba(139, 92, 246, 0.8)":"rgba(139, 92, 246, 0.7)"},{offset:1,color:r?"rgba(139, 92, 246, 0.2)":"rgba(139, 92, 246, 0.1)"}])},markArea:_.length>0?{silent:!0,data:_}:void 0},{name:"å‡€åˆ©æ¶¦",type:"line",yAxisIndex:1,data:u,smooth:.3,symbol:"circle",symbolSize:6,itemStyle:{color:"#22c55e"},lineStyle:{width:2.5,color:"#22c55e",shadowColor:"rgba(34, 197, 94, 0.3)",shadowBlur:8},areaStyle:{color:new E(0,0,0,1,[{offset:0,color:"rgba(34, 197, 94, 0.25)"},{offset:.5,color:"rgba(34, 197, 94, 0.05)"},{offset:1,color:"rgba(244, 63, 94, 0.15)"}])},markLine:{silent:!0,symbol:"none",lineStyle:{color:r?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.1)",type:"dashed",width:1},data:[{yAxis:0}],label:{show:!1}}}]};n.current.setOption(T,!0);const k=()=>{n.current?.resize()};return window.addEventListener("resize",k),()=>{window.removeEventListener("resize",k)}},[t,r,m,z]),c.useEffect(()=>{n.current&&(n.current.dispose(),n.current=null)},[h]),c.useEffect(()=>()=>{n.current&&(n.current.dispose(),n.current=null)},[]);const C=c.useMemo(()=>{if(t?.date){if(t.date.includes("~")){const a=t.date.split("~").map(s=>s.trim());return a.length===2&&a[0]&&a[1]?`${a[0].slice(5)} ~ ${a[1].slice(5)}`:t.date}return t.date.slice(5)}return null},[t?.date]),I=t&&t.orders&&t.orders.some(a=>a>0),M=l!=null;return e.jsxs("div",{className:"glass-panel rounded-2xl p-4 h-full flex flex-col relative",children:[e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-emerald-500/5 to-transparent pointer-events-none rounded-b-2xl"}),e.jsxs("div",{className:"mb-2 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-bold flex items-center gap-2",style:{color:F},children:[e.jsx("span",{className:"w-1 h-4 bg-gradient-to-b from-emerald-400 to-emerald-600 rounded-full"}),C?`${C} åˆ†æ—¶æ®µè¯Šæ–­`:"åˆ†æ—¶æ®µè¯Šæ–­",(p||M)&&e.jsx("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded-full bg-emerald-500/20 text-emerald-400 ml-1",children:"å·²è”åŠ¨"})]}),t?.comparison&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{value:t.comparison.order_change,label:"è®¢å•",isDark:r}),e.jsx(R,{value:t.comparison.profit_change,label:"åˆ©æ¶¦",isDark:r})]})]}),e.jsxs("p",{className:"text-[10px] mt-0.5 font-mono uppercase tracking-wider opacity-70",style:{color:w},children:["HOURLY PROFIT ANALYSIS",t?.comparison?.period&&e.jsxs("span",{className:"ml-2 normal-case text-slate-500",children:["(",t.comparison.period,")"]})]})]}),e.jsx("div",{className:"flex-1 w-full min-h-0",children:y?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-sm",style:{color:w},children:"åŠ è½½ä¸­..."})}):I?e.jsx("div",{ref:v,className:"w-full h-full"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"text-sm",style:{color:w},children:"æš‚æ— æ•°æ®"})})})]})};export{U as default};
