import{a as q,u as _,j as t,o as P}from"./index-C818Opqu.js";import{r as b}from"./react-core-TYaY7wwJ.js";import{L as B}from"./echarts-BWHOTeAv.js";import{a0 as $,v as j,W as S,p as z}from"./icons-22UXCqKE.js";import"./utils-DNh_Lx5Z.js";const O=({selectedDate:h,selectedDateRange:c,theme:x})=>{const[f,N]=b.useState("quantity"),[p,v]=b.useState(null),[C,w]=b.useState(!1),{selectedStore:g,dateRange:o}=q(),d=x==="dark",M=d?"#fff":"#0f172a",m=d?"#94a3b8":"#64748b";b.useEffect(()=>{(async()=>{if(!g){v(null);return}w(!0);try{const l={store_name:g,sort_by:f,limit:15};c?(l.start_date=c.start,l.end_date=c.end):h?l.date=h:o.type!=="all"&&o.start&&o.end&&(l.start_date=o.start,l.end_date=o.end);const n=await P.getTopProductsByDate(l);n.success&&n.data&&v(n.data)}catch(l){console.error("获取商品排行数据失败:",l)}finally{w(!1)}})()},[g,h,c,o.type,o.start,o.end,f]);const r=b.useMemo(()=>{switch(f){case"quantity":return{colorStart:"#34d399",colorEnd:"#059669",label:"销量",unit:"",valueKey:"quantity"};case"revenue":return{colorStart:"#818cf8",colorEnd:"#4f46e5",label:"营收",unit:"¥",valueKey:"revenue"};case"profit":return{colorStart:"#fbbf24",colorEnd:"#d97706",label:"毛利",unit:"¥",valueKey:"profit"};case"loss":return{colorStart:"#f43f5e",colorEnd:"#be123c",label:"亏损/低利",unit:"¥",valueKey:"profit"};default:return{colorStart:"#34d399",colorEnd:"#059669",label:"销量",unit:"",valueKey:"quantity"}}},[f]),y=b.useMemo(()=>{if(!p||p.products.length===0)return 100;const e=p.products.map(l=>Math.abs(l[r.valueKey]||0));return Math.max(...e)},[p,r.valueKey]),L=b.useMemo(()=>{if(!p||p.products.length===0)return{graphic:{type:"text",left:"center",top:"middle",style:{text:"暂无数据",fill:m,fontSize:14}}};const e=p.products,l=e.map((i,a)=>{const s=a+1;let u=i.name;return u.length>20&&(u=u.slice(0,20)+"..."),`${s}. ${u}`}),n=e.map(i=>Math.abs(i[r.valueKey]||0)),W=e.map((i,a)=>a===0?"#fbbf24":a===1?"#94a3b8":a===2?"#cd7f32":new B(0,0,1,0,[{offset:0,color:r.colorStart},{offset:1,color:r.colorEnd}]));return{graphic:[],grid:{left:0,right:35,top:5,bottom:5,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:d?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:d?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",textStyle:{color:d?"#fff":"#0f172a"},formatter:i=>{if(!Array.isArray(i)||i.length===0)return"";const a=i[0].dataIndex,s=e[a];if(!s)return"";const u=s.growth||0,k=u>0?"#34d399":u<0?"#f43f5e":"#94a3b8",A=u>0?"▲":u<0?"▼":"-";return`
            <div style="font-weight:bold;margin-bottom:4px;display:flex;justify-content:space-between;gap:16px">
              <span>${s.name}</span>
              <span style="color:${k};font-family:monospace">${A} ${Math.abs(u)}%</span>
            </div>
            <div style="font-size:12px;color:${m};margin-bottom:8px">分类: ${s.category}</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px 16px;font-size:12px">
              <span style="color:${m}">销量:</span>
              <span style="font-family:monospace;text-align:right;font-weight:bold;color:${d?"#fff":"#0f172a"}">${s.quantity}</span>
              <span style="color:${m}">营收:</span>
              <span style="font-family:monospace;text-align:right;font-weight:bold;color:#818cf8">¥${Math.round(s.revenue).toLocaleString()}</span>
              <span style="color:${m}">毛利:</span>
              <span style="font-family:monospace;text-align:right;font-weight:bold;color:${s.profit>=0?"#34d399":"#f43f5e"}">¥${Math.round(s.profit).toLocaleString()}</span>
            </div>
          `}},xAxis:{type:"value",show:!1,max:y*1.05},yAxis:{type:"category",data:l,inverse:!0,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:d?"#cbd5e1":"#475569",fontSize:11,fontWeight:"normal",formatter:(i,a)=>{const s=String(i);return a===0?`{gold|${s}}`:a===1?`{silver|${s}}`:a===2?`{bronze|${s}}`:s},rich:{gold:{color:"#fbbf24",fontWeight:"bold",fontSize:11},silver:{color:"#94a3b8",fontWeight:"bold",fontSize:11},bronze:{color:"#cd7f32",fontWeight:"bold",fontSize:11}}}},series:[{type:"bar",data:e.map(()=>y*1.05),barWidth:12,barGap:"-100%",z:0,itemStyle:{color:d?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.03)",borderRadius:6},tooltip:{show:!1},animation:!1},{type:"bar",data:n.map((i,a)=>({value:i,itemStyle:{color:W[a],borderRadius:6}})),barWidth:12,label:{show:!0,position:"right",formatter:i=>{const a=Math.round(i.value);return`${r.unit}${a.toLocaleString()}`},color:d?"#e2e8f0":"#475569",fontSize:11,fontFamily:"JetBrains Mono, monospace",fontWeight:"bold"}}]}},[p,r,y,d,m]),E=_(L,[p,f,x],x),K=[{id:"quantity",label:"销量榜",icon:t.jsx($,{size:12}),color:"emerald"},{id:"revenue",label:"营收榜",icon:t.jsx(j,{size:12}),color:"indigo"},{id:"profit",label:"毛利榜",icon:t.jsx(S,{size:12}),color:"amber"},{id:"loss",label:"亏损榜",icon:t.jsx(z,{size:12}),color:"rose"}],T=b.useMemo(()=>c?c.start===c.end?`${c.start.slice(5)} 商品${r.label}`:`${c.start.slice(5)}~${c.end.slice(5)} 商品${r.label}`:h?`${h.slice(5)} 商品${r.label}`:o.type!=="all"&&o.start&&o.end?o.start===o.end?`${o.start.slice(5)} 商品${r.label}`:`${o.start.slice(5)}~${o.end.slice(5)} 商品${r.label}`:`商品${r.label} TOP 15`,[c,h,o,r.label]);return t.jsxs("div",{className:"glass-panel rounded-2xl p-4 h-full flex flex-col relative overflow-hidden",children:[C&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 z-20 rounded-2xl",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"})}),t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[f==="quantity"&&t.jsx($,{size:16,className:"text-emerald-400"}),f==="revenue"&&t.jsx(j,{size:16,className:"text-indigo-400"}),f==="profit"&&t.jsx(S,{size:16,className:"text-amber-400"}),f==="loss"&&t.jsx(z,{size:16,className:"text-rose-400"}),t.jsx("h3",{className:"text-base font-bold",style:{color:M},children:T})]}),t.jsxs("span",{className:"text-[10px] font-mono uppercase tracking-wider opacity-50",style:{color:m},children:["BY ",r.valueKey.toUpperCase()]})]}),t.jsx("div",{className:"flex p-0.5 bg-slate-900/50 rounded-lg border border-white/5 w-fit mb-3",children:K.map(e=>{const l=f===e.id;let n="";return l?(e.color==="emerald"&&(n="bg-emerald-500 text-white shadow-lg shadow-emerald-500/20"),e.color==="indigo"&&(n="bg-indigo-500 text-white shadow-lg shadow-indigo-500/20"),e.color==="amber"&&(n="bg-amber-500 text-white shadow-lg shadow-amber-500/20"),e.color==="rose"&&(n="bg-rose-500 text-white shadow-lg shadow-rose-500/20")):n="text-slate-400 hover:text-white hover:bg-white/5",t.jsxs("button",{onClick:()=>N(e.id),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-bold transition-all duration-300 ${n}`,children:[e.icon,e.label]},e.id)})}),t.jsx("div",{className:"flex-1 w-full min-h-0",children:t.jsx("div",{ref:E,className:"w-full h-full"})})]})};export{O as default};
