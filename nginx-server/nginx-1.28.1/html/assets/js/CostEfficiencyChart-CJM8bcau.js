import{a as P,j as a,o as G}from"./index-C818Opqu.js";import{r as i}from"./react-core-TYaY7wwJ.js";import{i as H,L as k}from"./echarts-BWHOTeAv.js";import"./utils-DNh_Lx5Z.js";import"./icons-22UXCqKE.js";const U=({storeName:v,channel:w,theme:S,selectedDate:j,selectedDateRange:f})=>{const[o,A]=i.useState(null),[E,L]=i.useState(!0),p=i.useRef(null),l=i.useRef(null),{dateRange:n}=P(),e=S==="dark",d=e?"#64748b":"#94a3b8",R=e?"#fff":"#0f172a",x=e?"#94a3b8":"#64748b",N=e?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",g=j||void 0;i.useEffect(()=>{(async()=>{L(!0);try{const t={store_name:v,channel:w};g?t.target_date=g:f?(t.start_date=f.start,t.end_date=f.end):n.type!=="all"&&n.start&&n.end&&(t.start_date=n.start,t.end_date=n.end),console.log("ğŸ“Š åˆ†æ—¶æ®µè¯Šæ–­è¯·æ±‚å‚æ•°:",t,"| dateRange:",n);const u=await G.getHourlyProfit(t);u.success&&u.data&&(A(u.data),console.log("ğŸ“Š åˆ†æ—¶æ®µè¯Šæ–­è¿”å›æ•°æ®:",u.data.date))}catch(t){console.error("è·å–åˆ†æ—¶åˆ©æ¶¦æ•°æ®å¤±è´¥:",t)}finally{L(!1)}})()},[v,w,g,f,n.type,n.start,n.end]),i.useEffect(()=>{if(!p.current||!o)return;l.current||(l.current=H(p.current,e?"dark":void 0));const{hours:r,orders:t,profits:u,avg_profits:F,peak_periods:h}=o,z=h&&h.length>0?h.map(s=>[{xAxis:r[s.start_hour]||`${s.start_hour}:00`,itemStyle:{color:e?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.03)"}},{xAxis:r[Math.min(s.end_hour+1,23)]||`${s.end_hour+1}:00`}]):[],M={backgroundColor:"transparent",grid:{top:35,right:45,bottom:25,left:40,containLabel:!0},tooltip:{trigger:"axis",backgroundColor:e?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:e?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:16,textStyle:{fontFamily:"JetBrains Mono",color:e?"#fff":"#0f172a",fontSize:12},axisPointer:{type:"shadow"},formatter:s=>{const _=s[0]?.axisValue||"";let b=`<div style="font-weight:600;margin-bottom:8px;font-size:13px">${_}</div>`;s.forEach(c=>{const m=c.value,O=c.seriesName==="å‡€åˆ©æ¶¦"?m>=0?"#22c55e":"#f43f5e":c.color;b+=`<div style="display:flex;justify-content:space-between;align-items:center;margin:4px 0">
              <span style="display:flex;align-items:center;gap:6px">
                <span style="width:8px;height:8px;border-radius:50%;background:${O}"></span>
                ${c.seriesName}
              </span>
              <span style="font-weight:600;margin-left:20px">${c.seriesName==="å‡€åˆ©æ¶¦"?`Â¥${m.toFixed(2)}`:m}</span>
            </div>`});const y=r.indexOf(_);if(y>=0&&t[y]>0){const c=F[y],m=c>=0?"#22c55e":"#f43f5e";b+=`<div style="border-top:1px solid ${e?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"};margin-top:8px;padding-top:8px">
              <span style="color:${e?"#94a3b8":"#64748b"}">å•å‡åˆ©æ¶¦:</span>
              <span style="font-weight:600;color:${m};margin-left:8px">Â¥${c.toFixed(2)}</span>
            </div>`}return b}},legend:{data:["è®¢å•æ•°","å‡€åˆ©æ¶¦"],top:2,right:5,textStyle:{color:d,fontSize:10},itemWidth:10,itemHeight:10,itemGap:12,itemStyle:{}},xAxis:{type:"category",data:r,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:d,fontSize:10,interval:2,formatter:s=>s.replace(":00","")}},yAxis:[{type:"value",name:"",position:"left",splitLine:{lineStyle:{color:N,type:"dashed"}},axisLabel:{color:d,fontSize:10},nameTextStyle:{color:d,fontSize:10}},{type:"value",name:"",position:"right",splitLine:{show:!1},axisLabel:{color:d,fontSize:10,formatter:s=>`Â¥${s}`},nameTextStyle:{color:d,fontSize:10}}],series:[{name:"è®¢å•æ•°",type:"bar",data:t,barWidth:12,itemStyle:{borderRadius:[3,3,0,0],color:new k(0,0,0,1,[{offset:0,color:e?"rgba(139, 92, 246, 0.8)":"rgba(139, 92, 246, 0.7)"},{offset:1,color:e?"rgba(139, 92, 246, 0.2)":"rgba(139, 92, 246, 0.1)"}])},markArea:z.length>0?{silent:!0,data:z}:void 0},{name:"å‡€åˆ©æ¶¦",type:"line",yAxisIndex:1,data:u,smooth:.3,symbol:"circle",symbolSize:6,itemStyle:{color:"#22c55e"},lineStyle:{width:2.5,color:"#22c55e",shadowColor:"rgba(34, 197, 94, 0.3)",shadowBlur:8},areaStyle:{color:new k(0,0,0,1,[{offset:0,color:"rgba(34, 197, 94, 0.25)"},{offset:.5,color:"rgba(34, 197, 94, 0.05)"},{offset:1,color:"rgba(244, 63, 94, 0.15)"}])},markLine:{silent:!0,symbol:"none",lineStyle:{color:e?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.1)",type:"dashed",width:1},data:[{yAxis:0}],label:{show:!1}}}]};l.current.setOption(M,!0);const C=()=>{l.current?.resize()};return window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C)}},[o,e,d,N]),i.useEffect(()=>{l.current&&(l.current.dispose(),l.current=null)},[S]),i.useEffect(()=>()=>{l.current&&(l.current.dispose(),l.current=null)},[]);const $=i.useMemo(()=>{if(o?.date){if(o.date.includes("~")){const r=o.date.split("~").map(t=>t.trim());return r.length===2&&r[0]&&r[1]?`${r[0].slice(5)} ~ ${r[1].slice(5)}`:o.date}return o.date.slice(5)}return null},[o?.date]),I=o&&o.orders&&o.orders.some(r=>r>0),T=f!=null;return a.jsxs("div",{className:"glass-panel rounded-2xl p-4 h-full flex flex-col relative",children:[a.jsx("div",{className:"absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-emerald-500/5 to-transparent pointer-events-none rounded-b-2xl"}),a.jsxs("div",{className:"mb-2 relative z-10",children:[a.jsxs("h3",{className:"text-base font-bold flex items-center gap-2",style:{color:R},children:[a.jsx("span",{className:"w-1 h-4 bg-gradient-to-b from-emerald-400 to-emerald-600 rounded-full"}),$?`${$} åˆ†æ—¶æ®µè¯Šæ–­`:"åˆ†æ—¶æ®µè¯Šæ–­",(j||T)&&a.jsx("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded-full bg-emerald-500/20 text-emerald-400 ml-1",children:"å·²è”åŠ¨"})]}),a.jsx("p",{className:"text-[10px] mt-0.5 font-mono uppercase tracking-wider opacity-70",style:{color:x},children:"HOURLY PROFIT ANALYSIS"})]}),a.jsx("div",{className:"flex-1 w-full min-h-0",children:E?a.jsx("div",{className:"w-full h-full flex items-center justify-center",children:a.jsx("div",{className:"animate-pulse text-sm",style:{color:x},children:"åŠ è½½ä¸­..."})}):I?a.jsx("div",{ref:p,className:"w-full h-full"}):a.jsx("div",{className:"w-full h-full flex items-center justify-center",children:a.jsx("div",{className:"text-sm",style:{color:x},children:"æš‚æ— æ•°æ®"})})})]})};export{U as default};
