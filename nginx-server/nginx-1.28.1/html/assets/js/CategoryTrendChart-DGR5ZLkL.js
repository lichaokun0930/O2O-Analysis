import{r as a,j as e}from"./framework-DfnVWwpF.js";import{a as G,u as U,o as H}from"./index-BXnA4bXl.js";import{c8 as L,bt as V,bu as Y,c6 as F,bv as W}from"./vendor-DUbYPDw3.js";import"./utils-CB2_sajW.js";import"./charts-bindingecharts-DvSHEz9I.js";const D=({selectedDate:u,selectedDateRange:s,theme:j})=>{const[r,x]=a.useState(null),[m,w]=a.useState(!1),[n,g]=a.useState([]),{selectedStore:v,dateRange:t}=G(),f=j==="dark",N=f?"#fff":"#0f172a",h=f?"#94a3b8":"#64748b";a.useEffect(()=>{(async()=>{if(!v){x(null);return}w(!0);try{const d={store_name:v};s?(d.start_date=s.start,d.end_date=s.end):u?d.date=u:t.type!=="all"&&t.start&&t.end&&(d.start_date=t.start,d.end_date=t.end);const i=await H.getCategoryHourlyTrend(d);i.success&&i.data&&(x(i.data),g([]))}catch(d){console.error("获取品类趋势数据失败:",d)}finally{w(!1)}})()},[v,u,s,t.type,t.start,t.end]);const l=a.useMemo(()=>!r||r.categories.length===0?[]:n.length>0?r.categories.filter(c=>n.includes(c)):r.categories.slice(0,5),[r,n]),p=a.useMemo(()=>r?r.series.filter(c=>l.includes(c.name)):[],[r,l]),b=a.useMemo(()=>{if(!r||r.labels.length===0||p.length===0)return{graphic:{type:"text",left:"center",top:"middle",style:{text:"暂无数据",fill:h,fontSize:14}}};const c=["#8b5cf6","#3b82f6","#06b6d4","#10b981","#f59e0b","#ef4444","#ec4899","#6366f1"],d=p.map((i,S)=>({name:i.name,type:"line",stack:"Total",smooth:!0,areaStyle:{opacity:.8},emphasis:{focus:"series"},showSymbol:!1,data:i.data,itemStyle:{color:c[S%c.length]}}));return{color:c,graphic:[],grid:{left:10,right:10,top:40,bottom:10,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},backgroundColor:f?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",textStyle:{color:f?"#fff":"#0f172a"},borderWidth:0,formatter:i=>{if(!Array.isArray(i)||i.length===0)return"";const S=i[0].axisValue,M=i[0].dataIndex,C=r.series.map(o=>({name:o.name,value:o.data[M]||0})).filter(o=>o.value>0).sort((o,y)=>y.value-o.value),T=C.reduce((o,y)=>o+y.value,0),E=n.length>0?C.filter(o=>n.includes(o.name)):C.slice(0,5),I=E.reduce((o,y)=>o+y.value,0);let z=`<div style="font-size:12px;font-weight:bold;margin-bottom:8px;color:${h}">${S} 合计: ¥${I.toLocaleString()}</div>`;return E.forEach((o,y)=>{const P=T>0?(o.value/T*100).toFixed(1):"0.0",_=c[y%c.length];z+=`
              <div style="display:flex;justify-content:space-between;align-items:center;gap:24px;font-size:12px;margin-bottom:4px">
                <div style="display:flex;align-items:center;gap:6px">
                  <span style="width:8px;height:8px;border-radius:50%;background:${_}"></span>
                  <span style="color:${f?"#e2e8f0":"#475569"}">${o.name}</span>
                </div>
                <div style="display:flex;align-items:center;gap:12px">
                  <span style="font-weight:bold;color:${f?"#fff":"#0f172a"}">¥${o.value.toLocaleString()}</span>
                  <span style="font-size:10px;width:40px;text-align:right;color:${h}">${P}%</span>
                </div>
              </div>
            `}),z}},legend:{data:l,top:0,textStyle:{color:h,fontSize:11},icon:"roundRect"},xAxis:{type:"category",boundaryGap:!1,data:r.labels,axisLabel:{color:h,fontSize:10},axisLine:{show:!1}},yAxis:{type:"value",splitLine:{lineStyle:{type:"dashed",color:f?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}},axisLabel:{color:h,fontSize:10,formatter:i=>`¥${i/1e3}k`}},series:d}},[r,p,l,f,h]),$=U(b,[r,j,n,l.length],j),k=c=>{g(d=>d.includes(c)?d.filter(i=>i!==c):[...d,c])},O=()=>{g([])},A=a.useMemo(()=>s?s.start===s.end?`${s.start.slice(5)} 品类销售走势`:`${s.start.slice(5)} ~ ${s.end.slice(5)} 品类销售走势`:u?`${u.slice(5)} 分时段品类走势`:t.type!=="all"&&t.start&&t.end?t.start===t.end?`${t.start.slice(5)} 品类销售走势`:`${t.start.slice(5)} ~ ${t.end.slice(5)} 品类销售走势`:"近7天品类销售占比",[s,u,t]),R=a.useMemo(()=>s||t.type!=="all"&&t.start&&t.end?"DATE RANGE TREND":u?"HOURLY TREND & SHARE":"CATEGORY REVENUE COMPOSITION",[s,u,t]);return e.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col relative overflow-hidden transition-all duration-500",children:[m&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 z-20 rounded-2xl",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-violet-500"})}),e.jsxs("div",{className:"mb-2 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:N},children:[e.jsx(L,{size:18,className:"text-violet-400"}),A]}),e.jsxs("p",{className:"text-xs mt-1 font-mono uppercase tracking-wider opacity-70",style:{color:h},children:[R," ·",n.length>0?` 已选 ${n.length} 个分类`:` TOP ${l.length}`]})]}),e.jsx(X,{categories:r?.categories||[],selectedCategories:n,onToggle:k,onReset:O,isDark:f})]}),e.jsx("div",{className:"flex-1 w-full min-h-[250px]",children:e.jsx("div",{ref:$,className:"w-full h-full"})})]})},X=({categories:u,selectedCategories:s,onToggle:j,onReset:r,isDark:x})=>{const[m,w]=a.useState(!1),[n,g]=a.useState(""),v=a.useRef(null),t=a.useRef(null),f=a.useRef(null);a.useEffect(()=>{const l=p=>{const b=p.target;m&&v.current&&!v.current.contains(b)&&t.current&&!t.current.contains(b)&&(w(!1),g(""))};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[m]),a.useEffect(()=>{m&&f.current&&setTimeout(()=>f.current?.focus(),100)},[m]);const N=a.useMemo(()=>{if(!n)return u;const l=n.toLowerCase();return u.filter(p=>p.toLowerCase().includes(l))},[u,n]),h=s.length>0?`已选 ${s.length} 项`:"TOP 5";return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:v,onClick:()=>w(!m),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-medium transition-all duration-200 ${x?"bg-white/5 hover:bg-white/10 border-white/10 text-slate-300":"bg-black/5 hover:bg-black/10 border-black/10 text-slate-600"} ${s.length>0?"border-violet-500/50 bg-violet-500/10":""}`,children:[e.jsx(L,{size:12,className:"text-violet-400"}),e.jsx("span",{children:h}),e.jsx(V,{size:12,className:`text-slate-400 transition-transform ${m?"rotate-180":""}`})]}),m&&e.jsxs("div",{ref:t,className:`absolute top-full right-0 mt-2 w-56 rounded-xl border shadow-2xl z-50 overflow-hidden animate-fade-in-up ${x?"bg-slate-900 border-white/10":"bg-white border-black/10"}`,children:[e.jsx("div",{className:`p-2 border-b ${x?"border-white/10":"border-black/10"}`,children:e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${x?"bg-white/5":"bg-black/5"}`,children:[e.jsx(Y,{size:14,className:"text-slate-400"}),e.jsx("input",{ref:f,type:"text",value:n,onChange:l=>g(l.target.value),placeholder:"搜索分类...",className:`flex-1 bg-transparent text-xs outline-none ${x?"text-white placeholder-slate-500":"text-slate-900 placeholder-slate-400"}`}),n&&e.jsx("button",{onClick:()=>g(""),className:"text-slate-400 hover:text-slate-300",children:e.jsx(F,{size:12})})]})}),e.jsxs("div",{className:`px-2 py-1.5 border-b flex justify-between items-center ${x?"border-white/10":"border-black/10"}`,children:[e.jsxs("span",{className:`text-[10px] ${x?"text-slate-500":"text-slate-400"}`,children:[N.length," 个分类"]}),s.length>0&&e.jsx("button",{onClick:r,className:"text-[10px] text-violet-400 hover:text-violet-300",children:"重置为 TOP5"})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto custom-scrollbar",children:N.length===0?e.jsx("div",{className:`px-4 py-3 text-xs text-center ${x?"text-slate-500":"text-slate-400"}`,children:"未找到匹配的分类"}):N.map(l=>{const p=s.includes(l),b=u.indexOf(l),$=!n&&s.length===0&&b<5&&b>=0;return e.jsxs("button",{onClick:()=>j(l),className:`w-full flex items-center justify-between px-4 py-2.5 text-xs transition-colors ${p||$?"bg-violet-500/20 text-violet-300":x?"text-slate-300 hover:bg-white/5":"text-slate-600 hover:bg-black/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${p||$?"bg-violet-400":x?"bg-slate-600":"bg-slate-300"}`}),e.jsx("span",{className:"truncate max-w-[140px]",children:l}),$&&e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-violet-500/30 text-violet-300",children:["TOP",b+1]})]}),p&&e.jsx(W,{size:12,className:"text-violet-400"})]},l)})})]})]})};export{D as default};
