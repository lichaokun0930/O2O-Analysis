import{r as d,j as e}from"./framework-DfnVWwpF.js";import{b as k,a as he,u as V}from"./index-BXnA4bXl.js";import{c4 as ue,c5 as fe,c6 as be,c7 as O,c8 as W,c9 as ve,ca as ye,cb as je,bU as q,c1 as G,b_ as Ne,bV as we,cc as Se,cd as Ce,ce as ke}from"./vendor-DUbYPDw3.js";import"./utils-CB2_sajW.js";import"./charts-bindingecharts-DvSHEz9I.js";const z={getSummary:async(a,l)=>{const n=new URLSearchParams;return a&&n.append("store_name",a),l&&n.append("category",l),(await k.get(`/inventory-risk/summary?${n.toString()}`)).data.data},getSoldOutProducts:async(a,l,n=1,c=20)=>{const x=new URLSearchParams;a&&x.append("store_name",a),l&&x.append("category",l),x.append("page",n.toString()),x.append("page_size",c.toString());const h=await k.get(`/inventory-risk/sold-out?${x.toString()}`);return{data:h.data.data,total:h.data.total}},getSlowMovingProducts:async(a,l,n,c=1,x=20)=>{const h=new URLSearchParams;a&&h.append("store_name",a),l&&h.append("category",l),n&&h.append("severity",n),h.append("page",c.toString()),h.append("page_size",x.toString());const C=await k.get(`/inventory-risk/slow-moving?${h.toString()}`);return{data:C.data.data,total:C.data.total,by_severity:C.data.by_severity}},getCategoryRiskStats:async a=>{const l=new URLSearchParams;return a&&l.append("store_name",a),(await k.get(`/inventory-risk/category-risk?${l.toString()}`)).data.data},getRiskTrend:async(a,l,n=30)=>{const c=new URLSearchParams;return a&&c.append("store_name",a),l&&c.append("category",l),c.append("days",n.toString()),(await k.get(`/inventory-risk/trend?${c.toString()}`)).data},getSoldOutAnalysis:async(a,l,n=30)=>{const c=new URLSearchParams;return a&&c.append("store_name",a),l&&c.append("category",l),c.append("days",n.toString()),(await k.get(`/inventory-risk/sold-out-analysis?${c.toString()}`)).data}},Oe={async getPerformanceWithRisk(a){const l=new URLSearchParams;a.store_name&&l.append("store_name",a.store_name),a.parent_category&&l.append("parent_category",a.parent_category),a.channel&&l.append("channel",a.channel);const n=`/category-matrix/with-risk${l.toString()?"?"+l.toString():""}`;return(await k.get(n)).data},async getPerformance(a){const l=new URLSearchParams;a.store_name&&l.append("store_name",a.store_name),a.parent_category&&l.append("parent_category",a.parent_category),a.channel&&l.append("channel",a.channel),a.start_date&&l.append("start_date",a.start_date),a.end_date&&l.append("end_date",a.end_date);const n=`/category-matrix/performance${l.toString()?"?"+l.toString():""}`;return(await k.get(n)).data}},_e=({isOpen:a,onClose:l,itemName:n,riskType:c,data:x,loading:h=!1})=>{const[C,$]=d.useState(!1);if(d.useEffect(()=>{if(a)$(!0);else{const i=setTimeout(()=>$(!1),200);return()=>clearTimeout(i)}},[a]),!C&&!a)return null;const b=c==="OUT_OF_STOCK",u=x.reduce((i,o)=>i+(o.impactValue||0),0),D={light:{label:"轻度",color:"text-yellow-400",bg:"bg-yellow-500/10",border:"border-yellow-500/30"},medium:{label:"中度",color:"text-orange-400",bg:"bg-orange-500/10",border:"border-orange-500/30"},heavy:{label:"重度",color:"text-rose-400",bg:"bg-rose-500/10",border:"border-rose-500/30"},critical:{label:"超重度",color:"text-red-500",bg:"bg-red-500/10",border:"border-red-500/30"}},N=b?null:{light:x.filter(i=>i.severity==="light"),medium:x.filter(i=>i.severity==="medium"),heavy:x.filter(i=>i.severity==="heavy"),critical:x.filter(i=>i.severity==="critical")};return e.jsxs("div",{className:"fixed inset-0 z-[60] flex justify-end",children:[e.jsx("div",{className:`absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity duration-200 ${a?"opacity-100":"opacity-0"}`,onClick:l}),e.jsxs("div",{className:`relative w-full max-w-lg h-full bg-slate-900 border-l border-white/10 shadow-2xl transform transition-transform duration-200 ease-out flex flex-col ${a?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:`px-5 py-4 border-b flex items-center justify-between ${b?"border-rose-500/20 bg-rose-500/5":"border-orange-500/20 bg-orange-500/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${b?"bg-rose-500/20":"bg-orange-500/20"}`,children:b?e.jsx(ue,{size:18,className:"text-rose-400"}):e.jsx(fe,{size:18,className:"text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-bold text-white",children:n}),e.jsx("p",{className:`text-xs ${b?"text-rose-400":"text-orange-400"}`,children:b?"售罄品明细":"滞销品明细"})]})]}),e.jsx("button",{onClick:l,className:"p-2 rounded-lg hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:e.jsx(be,{size:18})})]}),e.jsxs("div",{className:"px-5 py-3 border-b border-white/5 flex items-center justify-between bg-slate-800/30",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-500 uppercase",children:"商品数"}),e.jsx("p",{className:"text-lg font-bold text-white font-mono",children:x.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-500 uppercase",children:b?"潜在损失":"积压资金"}),e.jsxs("p",{className:`text-lg font-bold font-mono ${b?"text-rose-400":"text-orange-400"}`,children:["¥",u.toLocaleString()]})]})]}),h&&e.jsx(O,{size:16,className:"text-indigo-400 animate-spin"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:h?e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx(O,{size:24,className:"text-indigo-400 animate-spin"})}):x.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-40 text-slate-500",children:e.jsx("span",{className:"text-sm",children:"暂无数据"})}):b?e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-slate-800/95 z-10",children:e.jsxs("tr",{className:"border-b border-white/5",children:[e.jsx("th",{className:"text-left py-3 px-4 text-[10px] text-slate-500 font-medium uppercase",children:"商品名称"}),e.jsx("th",{className:"text-right py-3 px-4 text-[10px] text-slate-500 font-medium uppercase w-24",children:"影响金额"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:x.map((i,o)=>e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors",children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"text-slate-200 font-medium truncate max-w-[280px]",title:i.skuName,children:i.skuName}),e.jsx("div",{className:"text-[10px] text-slate-500 mt-0.5",children:i.reason})]}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-rose-400 font-mono font-medium",children:["¥",(i.impactValue||0).toLocaleString()]})})]},i.id||o))})]}):e.jsx("div",{className:"space-y-4 p-4",children:["critical","heavy","medium","light"].map(i=>{const o=N?.[i]||[];if(o.length===0)return null;const j=D[i],P=o.reduce((w,v)=>w+(v.impactValue||0),0);return e.jsxs("div",{className:`rounded-lg border ${j.border} ${j.bg} overflow-hidden`,children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-xs font-bold ${j.color}`,children:[j.label,"滞销"]}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:[i==="light"&&"(7天)",i==="medium"&&"(8-15天)",i==="heavy"&&"(16-30天)",i==="critical"&&"(>30天)"]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("span",{className:"text-slate-400",children:[o.length,"件"]}),e.jsxs("span",{className:`font-mono ${j.color}`,children:["¥",P.toLocaleString()]})]})]}),e.jsx("table",{className:"w-full text-sm",children:e.jsx("tbody",{className:"divide-y divide-white/5",children:o.map((w,v)=>e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors",children:[e.jsx("td",{className:"py-2.5 px-4",children:e.jsx("div",{className:"text-slate-200 text-xs truncate max-w-[240px]",title:w.skuName,children:w.skuName})}),e.jsx("td",{className:"py-2.5 px-4 text-right whitespace-nowrap",children:e.jsx("span",{className:`text-xs font-mono ${j.color}`,children:w.duration})}),e.jsx("td",{className:"py-2.5 px-4 text-right whitespace-nowrap",children:e.jsxs("span",{className:"text-xs text-slate-400 font-mono",children:["¥",(w.impactValue||0).toLocaleString()]})})]},w.id||v))})})]},i)})})})]})]})},Re=({theme:a="dark"})=>{const l=a==="dark",{selectedStore:n}=he(),[c,x]=d.useState([]),[h,C]=d.useState(!1),[$,b]=d.useState(null),[u,D]=d.useState(null),[N,i]=d.useState(null),[o,j]=d.useState([]),[P,w]=d.useState(!1),[v,U]=d.useState(null),[H,B]=d.useState(!1),[m,L]=d.useState({isOpen:!1,date:"",type:null,data:[],loading:!1,total:0}),[T,A]=d.useState({isOpen:!1,itemName:"",type:null,data:[],loading:!1});d.useEffect(()=>{(async()=>{C(!0),b(null);try{const s=await Oe.getPerformanceWithRisk({store_name:n||void 0,parent_category:u||void 0});s.success&&s.data&&s.data.length>0?x(s.data):(x([]),s.error&&b(s.error))}catch(s){x([]),b(s?.message||"获取数据失败")}finally{C(!1)}})()},[n,u]);const f=N||u;d.useEffect(()=>{(async()=>{if(!n){j([]);return}console.log("[TrendFetch] currentFilterCategory:",f),w(!0);try{const s=await z.getRiskTrend(n,f||void 0,30);console.log("[TrendFetch] API响应:",s),s.success&&s.data?j(s.data):j([])}catch(s){console.error("[TrendFetch] 错误:",s),j([])}finally{w(!1)}})()},[n,f]),d.useEffect(()=>{(async()=>{if(!n){U(null);return}B(!0);try{const s=await z.getSoldOutAnalysis(n,f||void 0,30);s.success&&s.data?U(s.data):U(null)}catch{U(null)}finally{B(!1)}})()},[n,f]);const F=d.useCallback(async(t,s)=>{if(m.isOpen&&m.date===t&&m.type===s){L(r=>({...r,isOpen:!1}));return}L({isOpen:!0,date:t,type:s,data:[],loading:!0,total:0});try{let r=[],g=0;if(s==="OUT_OF_STOCK"){const S=await z.getSoldOutProducts(n||void 0,void 0,1,5);r=S.data||[],g=S.total||0}else{const S=await z.getSlowMovingProducts(n||void 0,void 0,void 0,1,5);r=S.data||[],g=S.total||0}L(S=>({...S,data:r,loading:!1,total:g}))}catch{L(g=>({...g,data:[],loading:!1,total:0}))}},[m,n]),X=d.useCallback(()=>{if(!m.type)return;A({isOpen:!0,itemName:m.date,type:m.type,data:[],loading:!0}),(async()=>{try{let s=[];m.type==="OUT_OF_STOCK"?s=(await z.getSoldOutProducts(n||void 0,void 0,1,100)).data||[]:s=(await z.getSlowMovingProducts(n||void 0,void 0,void 0,1,100)).data||[],A(r=>({...r,data:s,loading:!1}))}catch{A(r=>({...r,data:[],loading:!1}))}})()},[m,n]),J=()=>A(t=>({...t,isOpen:!1})),Z=t=>t>=.55?"#22d3ee":t>=.45?"#34d399":t>=.35?"#818cf8":t>=.25?"#a78bfa":t>=.15?"#fbbf24":"#f43f5e",_=d.useMemo(()=>!c||c.length===0?[]:c.map(t=>{const s=t.name.split("|"),r=s.length>1?s[1]:t.name,g=(t.grossMargin||0)/100;return{name:r,fullName:t.name,value:t.revenue||0,profit:t.profit||0,orderCount:t.orderCount||0,margin:t.grossMargin||0,marginDecimal:g,soldOut:t.soldOutCount||0,slowMoving:t.slowMovingCount||0,turnover:t.inventoryTurnover||0,itemStyle:{color:Z(g),borderColor:l?"#0f172a":"#fff",borderWidth:2,gapWidth:1}}}),[c,l]),E=d.useMemo(()=>_.length>0&&_.some(t=>t.value>0),[_]),y=d.useMemo(()=>{if(o.length===0)return null;const t=o[o.length-1],s=o[0];return{latestSoldOut:t.soldOutCount,latestSlowMoving:t.slowMovingCount,latestSlowMovingRate:t.slowMovingRate||0,soldOutChange:t.soldOutCount-s.soldOutCount,slowMovingChange:t.slowMovingCount-s.slowMovingCount,slowMovingRateChange:(t.slowMovingRate||0)-(s.slowMovingRate||0),totalSkuWithStock:t.totalSkuWithStock||0}},[o]),Q=d.useCallback(t=>{const s=t;if(s.name)if(console.log("[TreemapClick] params:",{name:s.name,fullName:s.data?.fullName,selectedCategory:u}),!u)D(s.name),i(null);else{const r=s.data?.fullName||s.name;console.log("[TreemapClick] 选中三级分类:",r),i(N===r?null:r)}},[u,N]),Y=d.useMemo(()=>{if(!E)return{series:[]};const t=_.map(s=>({...s,itemStyle:{...s.itemStyle,borderColor:N===s.fullName?"#a855f7":l?"#0f172a":"#fff",borderWidth:N===s.fullName?3:2}}));return{animation:!0,animationDuration:500,animationEasing:"cubicOut",animationDurationUpdate:500,animationEasingUpdate:"cubicOut",tooltip:{backgroundColor:l?"rgba(15, 23, 42, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:l?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",textStyle:{fontFamily:"JetBrains Mono",color:l?"#fff":"#0f172a"},padding:12,formatter:s=>{const r=s.data;return r?`
            <div style="font-weight: bold; margin-bottom: 8px;">${r.name}</div>
            <div>销售额: ¥${(r.value||0).toLocaleString()}</div>
            <div>利润: ¥${(r.profit||0).toLocaleString()}</div>
            <div>利润率: ${(r.margin||0).toFixed(1)}%</div>
            <div>订单数: ${r.orderCount||0}</div>
            ${r.soldOut>0?`<div style="color:#f43f5e">售罄: ${r.soldOut}个</div>`:""}
            ${r.slowMoving>0?`<div style="color:#f97316">滞销: ${r.slowMoving}个</div>`:""}
            ${u?'<div style="color:#a855f7;margin-top:4px;font-size:10px">点击筛选趋势图</div>':""}
          `:""}},series:[{type:"treemap",data:t,left:0,right:0,top:0,bottom:0,roam:!1,nodeClick:!1,breadcrumb:{show:!1},animation:!0,animationDurationUpdate:500,animationEasingUpdate:"cubicOut",label:{show:!0,formatter:s=>{const r=s.data;let g=`${r.name}
¥${(r.value/1e3).toFixed(0)}k`;return(r.soldOut>0||r.slowMoving>0)&&(g+=`
⚠️`),N===r.fullName&&(g+=`
✓`),g},fontSize:10,color:"#fff",textShadowBlur:2,textShadowColor:"rgba(0,0,0,0.5)"},itemStyle:{borderRadius:4,borderColor:l?"#1e293b":"#fff",borderWidth:2}}]}},[_,l,E,N,u]),ee=V(Y,[_,l,u,N],a,Q),te=d.useMemo(()=>{if(o.length===0)return{series:[]};const t=o.map(r=>r.date.slice(5)),s=o.map(r=>r.soldOutCount);return{backgroundColor:"transparent",tooltip:{trigger:"axis",backgroundColor:"rgba(15, 23, 42, 0.95)",borderColor:"rgba(244, 63, 94, 0.3)",textStyle:{color:"#e2e8f0",fontSize:11},formatter:r=>{const g=r[0];return`<div class="font-mono text-xs">
            <div class="text-slate-400">${g.axisValue}</div>
            <div class="text-rose-400 font-bold mt-1">售罄品: ${g.value} 个</div>
            <div class="text-slate-500 text-[10px] mt-1">点击查看详情</div>
          </div>`}},grid:{top:10,left:35,right:10,bottom:25},xAxis:{type:"category",data:t,axisLine:{lineStyle:{color:"rgba(148, 163, 184, 0.2)"}},axisTick:{show:!1},axisLabel:{color:"#64748b",fontSize:9,interval:Math.floor(t.length/5)}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgba(148, 163, 184, 0.08)"}},axisLabel:{color:"#64748b",fontSize:9}},series:[{type:"line",data:s,smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{color:"#f43f5e",width:2},itemStyle:{color:"#f43f5e"},emphasis:{itemStyle:{borderColor:"#fff",borderWidth:2,shadowBlur:10,shadowColor:"rgba(244,63,94,0.5)"}},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(244, 63, 94, 0.3)"},{offset:1,color:"rgba(244, 63, 94, 0)"}]}}}]}},[o]),se=d.useCallback(t=>{if(t.dataIndex!==void 0&&o[t.dataIndex]){const s=o[t.dataIndex].date;F(s,"OUT_OF_STOCK")}},[o,F]),ae=V(te,[o],a,se),le=d.useMemo(()=>{if(o.length===0)return{series:[]};const t=o.map(p=>p.date.slice(5)),s=o.map(p=>p.slowMovingByLevel?.watch||0),r=o.map(p=>p.slowMovingByLevel?.light||0),g=o.map(p=>p.slowMovingByLevel?.medium||0),S=o.map(p=>p.slowMovingByLevel?.heavy||0),oe=s.some(p=>p>0),ie=r.some(p=>p>0),de=g.some(p=>p>0),ce=S.some(p=>p>0),M=[];return ce&&M.push({name:"重度(30天)",type:"bar",stack:"total",data:S,itemStyle:{color:"#dc2626"},barWidth:"60%"}),de&&M.push({name:"中度(15天)",type:"bar",stack:"total",data:g,itemStyle:{color:"#f97316"}}),ie&&M.push({name:"轻度(7天)",type:"bar",stack:"total",data:r,itemStyle:{color:"#fbbf24"}}),oe&&M.push({name:"关注(3天)",type:"bar",stack:"total",data:s,itemStyle:{color:"#a3e635",borderRadius:[2,2,0,0]}}),M.length===0?{series:[]}:{backgroundColor:"transparent",tooltip:{trigger:"axis",backgroundColor:"rgba(15, 23, 42, 0.95)",borderColor:"rgba(249, 115, 22, 0.3)",textStyle:{color:"#e2e8f0",fontSize:11},formatter:p=>{const xe=p[0]?.axisValue||"",pe=p[0]?.dataIndex,me=o[pe];let K=0,I=`<div class="font-mono text-xs"><div class="text-slate-400 mb-1">${xe}</div>`;p.forEach(R=>{K+=R.value||0,I+=`<div style="display:flex;align-items:center;gap:4px;padding:2px 0">
              <span style="background:${R.color};width:6px;height:6px;border-radius:1px;"></span>
              <span style="color:#94a3b8">${R.seriesName}:</span>
              <span style="color:${R.color};font-weight:bold">${R.value}</span>
            </div>`});const ge=me?.slowMovingRate||0;return I+=`<div style="border-top:1px solid rgba(255,255,255,0.1);margin-top:4px;padding-top:4px;color:#f97316;font-weight:bold">合计: ${K} (${ge}%)</div>`,I+='<div style="color:#64748b;font-size:10px;margin-top:4px">点击查看详情</div></div>',I}},legend:{show:!1},grid:{top:10,left:35,right:10,bottom:25},xAxis:{type:"category",data:t,axisLine:{lineStyle:{color:"rgba(148, 163, 184, 0.2)"}},axisTick:{show:!1},axisLabel:{color:"#64748b",fontSize:9,interval:Math.floor(t.length/5)}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgba(148, 163, 184, 0.08)"}},axisLabel:{color:"#64748b",fontSize:9}},series:M}},[o]),re=d.useCallback(t=>{if(t.dataIndex!==void 0&&o[t.dataIndex]){const s=o[t.dataIndex].date;F(s,"SLOW_MOVING")}},[o,F]),ne=V(le,[o],a,re);return e.jsxs("div",{className:`glass-panel rounded-2xl p-4 h-full flex flex-col relative overflow-hidden transition-all duration-300 ${u?"border-purple-500/50 shadow-[0_0_30px_rgba(168,85,247,0.15)]":""}`,children:[e.jsx(_e,{isOpen:T.isOpen,onClose:J,itemName:T.itemName,riskType:T.type,data:T.data,loading:T.loading}),e.jsxs("div",{className:"mb-3 shrink-0 flex justify-between items-start z-20 relative",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("h3",{className:"text-base font-bold text-white flex items-center gap-2",children:[e.jsx(W,{size:16,className:"text-purple-400"}),"品类效益矩阵工作台"]}),e.jsx("div",{className:"flex items-center gap-2 mt-0.5 h-5",children:h?e.jsxs("p",{className:"text-[10px] text-indigo-400 font-mono flex items-center gap-1 animate-pulse",children:[e.jsx(O,{size:10,className:"animate-spin"})," 加载中..."]}):u?e.jsxs("div",{className:"flex items-center gap-2 animate-fade-in-up",children:[e.jsx("span",{className:"text-[10px] text-slate-500",children:"ROOT /"}),e.jsx("span",{className:"text-[10px] font-bold text-purple-300 px-1.5 py-0.5 bg-purple-500/10 rounded border border-purple-500/20",children:u})]}):e.jsxs("p",{className:"text-[10px] text-slate-400 font-mono uppercase tracking-wider opacity-70 flex items-center gap-1",children:[e.jsx(ve,{size:10})," 点击树状图下钻 · 点击趋势图查看详情"]})})]}),u&&e.jsxs("button",{onClick:t=>{t.stopPropagation(),D(null),i(null)},className:"group flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-white/10 hover:bg-white/20 text-white text-[10px] font-bold transition-all border border-white/10",children:[e.jsx(ye,{size:12,className:"group-hover:-translate-x-1 transition-transform"}),"返回"]})]}),$&&e.jsxs("div",{className:"mb-2 px-2 py-1.5 bg-rose-500/10 border border-rose-500/20 rounded-lg text-rose-400 text-[10px] flex items-center gap-2",children:[e.jsx("span",{children:"⚠️"}),e.jsx("span",{children:$})]}),e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col gap-3 relative z-10",children:[e.jsxs("div",{className:"h-[60%] relative rounded-xl overflow-hidden border border-white/5 bg-slate-950/20 transition-all duration-300",children:[e.jsxs("div",{className:"absolute top-2 left-2 z-10 flex items-center gap-1.5 px-1.5 py-0.5 bg-black/40 backdrop-blur-md rounded text-[9px] text-slate-300 font-mono pointer-events-none",children:[e.jsx(je,{size:9}),"宏观视图"]}),e.jsx("div",{ref:ee,className:`absolute inset-0 transition-opacity duration-300 ${E&&!h?"opacity-100":"opacity-0"}`}),h&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(O,{size:20,className:"text-indigo-400 animate-spin"})}),!h&&!E&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-slate-500 text-xs gap-1 p-4",children:[e.jsx(W,{size:24,className:"text-slate-600"}),e.jsx("span",{children:_.length===0?"暂无品类数据":"销售额为0"})]})]}),e.jsxs("div",{className:"h-[40%] grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"h-full flex flex-col bg-slate-950/20 rounded-xl border border-white/5 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-2.5 py-1.5 border-b border-white/5 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(q,{size:11,className:"text-rose-400"}),e.jsx("span",{className:"text-[11px] font-medium text-white",children:"售罄趋势"}),f&&e.jsx("span",{className:"text-[8px] px-1 py-0.5 rounded bg-purple-500/20 text-purple-300 border border-purple-500/30 max-w-[80px] truncate",title:f,children:f.includes("|")?f.split("|").pop():f}),e.jsx("span",{className:"text-[8px] text-slate-500 ml-1",title:"库存=0 且 近7天有销量",children:"(库存=0且近7天有销)"})]}),y&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-bold text-rose-400",children:y.latestSoldOut}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"个"}),y.soldOutChange!==0&&e.jsxs("span",{className:`text-[9px] px-1 py-0.5 rounded ${y.soldOutChange>0?"bg-rose-500/20 text-rose-400":"bg-emerald-500/20 text-emerald-400"}`,children:[y.soldOutChange>0?"↑":"↓",Math.abs(y.soldOutChange)]})]})]}),e.jsxs("div",{className:"flex-1 relative",children:[P&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 z-10",children:e.jsx(O,{size:16,className:"text-indigo-400 animate-spin"})}),e.jsx("div",{ref:ae,className:"absolute inset-0"})]})]}),e.jsxs("div",{className:"h-full flex flex-col bg-slate-950/20 rounded-xl border border-white/5 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-2.5 py-1.5 border-b border-white/5 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(G,{size:11,className:"text-orange-400"}),e.jsx("span",{className:"text-[11px] font-medium text-white",children:"滞销趋势"}),f&&e.jsx("span",{className:"text-[8px] px-1 py-0.5 rounded bg-purple-500/20 text-purple-300 border border-purple-500/30 max-w-[80px] truncate",title:f,children:f.includes("|")?f.split("|").pop():f}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-lime-400"}),e.jsx("span",{className:"text-[8px] text-slate-500",children:"关注"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-yellow-400"}),e.jsx("span",{className:"text-[8px] text-slate-500",children:"轻"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-orange-500"}),e.jsx("span",{className:"text-[8px] text-slate-500",children:"中"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-red-600"}),e.jsx("span",{className:"text-[8px] text-slate-500",children:"重"})]})]}),y&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-bold text-orange-400",children:y.latestSlowMoving}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"个"}),y.slowMovingChange!==0&&e.jsxs("span",{className:`text-[9px] px-1 py-0.5 rounded ${y.slowMovingChange>0?"bg-rose-500/20 text-rose-400":"bg-emerald-500/20 text-emerald-400"}`,children:[y.slowMovingChange>0?"↑":"↓",Math.abs(y.slowMovingChange)]})]})]}),e.jsxs("div",{className:"flex-1 relative",children:[P&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 z-10",children:e.jsx(O,{size:16,className:"text-indigo-400 animate-spin"})}),e.jsx("div",{ref:ne,className:"absolute inset-0"})]})]})]})]}),v&&e.jsxs("div",{className:"mt-3 grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"bg-slate-900/50 rounded-lg border border-white/5 p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(Ne,{size:12,className:"text-rose-400"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"预估损失"})]}),e.jsxs("div",{className:"text-lg font-bold text-rose-400",children:["¥",v.estimatedLoss.toLocaleString()]}),e.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5",children:"基于日均销售额"})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg border border-white/5 p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(we,{size:12,className:"text-amber-400"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"平均恢复"})]}),e.jsxs("div",{className:"text-lg font-bold text-amber-400",children:[v.avgRecoveryDays," ",e.jsx("span",{className:"text-xs font-normal",children:"天"})]}),e.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5",children:"从售罄到补货"})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg border border-white/5 p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(W,{size:12,className:"text-indigo-400"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"品类分布"})]}),e.jsxs("div",{className:"space-y-1",children:[v.byCategory.slice(0,3).map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsxs("span",{className:"text-slate-300 truncate max-w-[80px]",title:t.category,children:[s+1,". ",t.category]}),e.jsxs("span",{className:"text-rose-400 font-mono",children:[t.count,"个"]})]},t.category)),v.byCategory.length===0&&e.jsx("div",{className:"text-[10px] text-slate-500",children:"暂无数据"})]})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg border border-white/5 p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(Se,{size:12,className:"text-purple-400"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"高频售罄"})]}),e.jsxs("div",{className:"space-y-1",children:[v.frequentSoldOut.slice(0,3).map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsxs("span",{className:"text-slate-300 truncate max-w-[80px]",title:t.name,children:[s+1,". ",t.name]}),e.jsxs("span",{className:"text-purple-400 font-mono",children:[t.times,"次"]})]},t.name)),v.frequentSoldOut.length===0&&e.jsx("div",{className:"text-[10px] text-slate-500",children:"暂无高频售罄"})]})]})]}),H&&!v&&e.jsxs("div",{className:"mt-3 flex items-center justify-center py-4 bg-slate-900/30 rounded-lg border border-white/5",children:[e.jsx(O,{size:14,className:"text-indigo-400 animate-spin mr-2"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"加载售罄分析..."})]}),m.isOpen&&e.jsx("div",{className:"mt-3 animate-fade-in-up",children:e.jsxs("div",{className:"bg-slate-900/50 rounded-xl border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/5 bg-slate-800/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m.type==="OUT_OF_STOCK"?e.jsx(q,{size:14,className:"text-rose-400"}):e.jsx(G,{size:14,className:"text-orange-400"}),e.jsx("span",{className:"text-xs font-bold text-white",children:m.type==="OUT_OF_STOCK"?"售罄品详情":"滞销品详情"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:[m.date," · 共 ",m.total," 个"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m.total>5&&e.jsxs("button",{onClick:X,className:"flex items-center gap-1 px-2 py-1 rounded text-[10px] font-bold bg-indigo-500/20 text-indigo-400 border border-indigo-500/30 hover:bg-indigo-500 hover:text-white transition-all",children:["查看全部 ",e.jsx(Ce,{size:10})]}),e.jsx("button",{onClick:()=>L(t=>({...t,isOpen:!1})),className:"p-1 rounded hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:e.jsx(ke,{size:14})})]})]}),e.jsx("div",{className:"p-2",children:m.loading?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(O,{size:16,className:"text-indigo-400 animate-spin"})}):m.data.length===0?e.jsx("div",{className:"text-center py-4 text-slate-500 text-xs",children:"暂无数据"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-2",children:m.data.slice(0,5).map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 px-2.5 py-2 bg-slate-800/50 rounded-lg border border-white/5 hover:border-white/10 transition-colors",children:[e.jsx("div",{className:`w-1.5 h-8 rounded-full ${m.type==="OUT_OF_STOCK"?"bg-rose-500":"bg-orange-500"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-white truncate",title:t.skuName,children:t.skuName}),e.jsx("div",{className:"text-[10px] text-slate-500",children:t.reason})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-[10px] font-mono text-slate-400",children:["¥",(t.impactValue||0).toFixed(0)]}),e.jsx("div",{className:"text-[9px] text-slate-600",children:t.duration||t.action})]})]},t.id||s))})})]})})]})};export{Re as default};
