import{r as k,j as t}from"./framework-DfnVWwpF.js";import{a as $,u as T,C as _}from"./index-BXnA4bXl.js";import"./utils-CB2_sajW.js";import"./vendor-DUbYPDw3.js";import"./charts-bindingecharts-DvSHEz9I.js";const L=[["full_reduction","æ»¡å‡é‡‘é¢"],["product_discount","å•†å“å‡å…"],["merchant_voucher","å•†å®¶ä»£é‡‘åˆ¸"],["merchant_share","å•†å®¶æ‰¿æ‹…åˆ¸"],["gift_amount","æ»¡èµ é‡‘é¢"],["other_discount","å•†å®¶å…¶ä»–ä¼˜æƒ "],["new_customer_discount","æ–°å®¢å‡å…"]],j={æ»¡å‡é‡‘é¢:"#f59e0b",å•†å“å‡å…:"#eab308",å•†å®¶ä»£é‡‘åˆ¸:"#22c55e",å•†å®¶æ‰¿æ‹…åˆ¸:"#14b8a6",æ»¡èµ é‡‘é¢:"#3b82f6",å•†å®¶å…¶ä»–ä¼˜æƒ :"#8b5cf6",æ–°å®¢å‡å…:"#ec4899"};function C(e){return L.filter(([r])=>{const a=e[r];return a&&a.some(c=>c>0)})}function A(e,r){return e.map((a,c)=>{const p=r[c];return p===0?0:a/p*100})}function E(e,r,a){const{dates:c,series:p,totals:h}=e,l=C(p),y=l.map(([o,x])=>{const d=p[o]||[],g=r==="percentage"?A(d,h):d;return{name:x,type:"line",stack:"total",areaStyle:{opacity:.6},emphasis:{focus:"series"},data:g,itemStyle:{color:j[x]},lineStyle:{width:1},symbol:"none",smooth:.3}}),u=a?"#64748b":"#94a3b8",n=a?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)";return{grid:{top:40,right:20,bottom:60,left:50,containLabel:!1},tooltip:{trigger:"axis",backgroundColor:a?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:a?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:12,textStyle:{fontFamily:"JetBrains Mono",color:a?"#fff":"#0f172a",fontSize:11},axisPointer:{type:"cross",label:{backgroundColor:"#6366f1"}},formatter:o=>{if(!Array.isArray(o)||o.length===0)return"";const x=o[0].axisValue;let d=`<div style="font-weight:bold;margin-bottom:8px">${x}</div>`;const g=c.indexOf(x),v=g>=0?h[g]:0;return o.forEach(i=>{const f=i.value||0,m=v>0?f/(r==="percentage"?100:v)*100:0;r==="percentage"?d+=`<div style="display:flex;justify-content:space-between;gap:16px">
              <span>${i.marker}${i.seriesName}</span>
              <span style="font-weight:bold">${f.toFixed(1)}%</span>
            </div>`:d+=`<div style="display:flex;justify-content:space-between;gap:16px">
              <span>${i.marker}${i.seriesName}</span>
              <span style="font-weight:bold">Â¥${f.toLocaleString()} (${m.toFixed(1)}%)</span>
            </div>`}),r==="absolute"&&(d+=`<div style="margin-top:8px;padding-top:8px;border-top:1px solid ${a?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}">
            <span style="font-weight:bold">æ€»è®¡: Â¥${v.toLocaleString()}</span>
          </div>`),d}},legend:{data:l.map(([,o])=>o),bottom:0,textStyle:{color:u,fontSize:10},itemGap:12,icon:"roundRect",itemWidth:12,itemHeight:8},xAxis:{type:"category",data:c.map(o=>o.slice(5)),boundaryGap:!1,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:u,fontSize:10,fontFamily:"JetBrains Mono"}},yAxis:{type:"value",max:r==="percentage"?100:void 0,splitLine:{lineStyle:{color:n,type:"dashed"}},axisLabel:{color:u,fontSize:10,formatter:r==="percentage"?"{value}%":o=>`Â¥${o>=1e3?(o/1e3).toFixed(0)+"k":o}`}},series:y}}const I=({data:e,theme:r,loading:a,error:c,selectedChannel:p,onChannelChange:h})=>{const[l,y]=k.useState("percentage"),{channelList:u}=$();console.log("ğŸ“ˆ MarketingTrendChart channelList:",u);const n=r==="dark",o=n?"#fff":"#0f172a",x=n?"#94a3b8":"#64748b",d=k.useMemo(()=>{if(console.log("ğŸ“ˆ MarketingTrendChart option è®¡ç®—, data:",e),!e||!e.dates||e.dates.length===0)return console.log("ğŸ“ˆ MarketingTrendChart - æ— æ•°æ®ï¼Œè¿”å›ç©º series"),{series:[]};if(e.dates.length===1){const f=C(e.series),m=n?"#64748b":"#94a3b8",w=n?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",N=f.map(([s,b])=>{const S=e.series[s]?.[0]||0;return{name:b,value:l==="percentage"?e.totals[0]>0?S/e.totals[0]*100:0:S,itemStyle:{color:j[b]}}});return{grid:{top:40,right:20,bottom:60,left:50,containLabel:!1},tooltip:{trigger:"item",backgroundColor:n?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:n?"rgba(255, 255, 255, 0.1)":"rgba(0,0,0,0.1)",padding:12,textStyle:{fontFamily:"JetBrains Mono",color:n?"#fff":"#0f172a",fontSize:11},formatter:s=>{const b=s.value||0;if(l==="percentage")return`${s.marker}${s.name}: ${b.toFixed(1)}%`;{const S=e.totals[0]>0?b/e.totals[0]*100:0;return`${s.marker}${s.name}: Â¥${b.toLocaleString()} (${S.toFixed(1)}%)`}}},legend:{data:f.map(([,s])=>s),bottom:0,textStyle:{color:m,fontSize:10},itemGap:12,icon:"roundRect",itemWidth:12,itemHeight:8},xAxis:{type:"category",data:f.map(([,s])=>s),axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:m,fontSize:10,fontFamily:"JetBrains Mono",rotate:30}},yAxis:{type:"value",max:l==="percentage"?100:void 0,splitLine:{lineStyle:{color:w,type:"dashed"}},axisLabel:{color:m,fontSize:10,formatter:l==="percentage"?"{value}%":s=>`Â¥${s>=1e3?(s/1e3).toFixed(0)+"k":s}`}},series:[{type:"bar",data:N,barWidth:"50%",label:{show:!0,position:"top",formatter:s=>l==="percentage"?`${s.value.toFixed(1)}%`:`Â¥${s.value.toLocaleString()}`,color:m,fontSize:10}}]}}const i=E(e,l,n);return console.log("ğŸ“ˆ MarketingTrendChart option ç»“æœ:",{seriesCount:i.series?.length,xAxisData:i.xAxis?.data?.length,firstSeriesName:i.series?.[0]?.name,firstSeriesDataSample:i.series?.[0]?.data?.slice(0,3)}),i},[e,l,n]),g=T(d,[],r);return t.jsxs("div",{className:"glass-panel rounded-2xl p-6 h-full flex flex-col relative overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 left-0 w-full h-24 bg-gradient-to-b from-pink-500/5 to-transparent pointer-events-none"}),t.jsxs("div",{className:"mb-2 flex justify-between items-start relative z-10",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:o},children:[t.jsx("span",{className:"w-1 h-5 bg-gradient-to-b from-pink-400 to-pink-600 rounded-full shadow-[0_0_10px_#ec4899]"}),"è¥é”€æˆæœ¬è¶‹åŠ¿"]}),t.jsx("p",{className:"text-xs mt-1 font-mono uppercase tracking-widest opacity-70",style:{color:x},children:"MARKETING COST TREND: TYPE RATIO OVER TIME"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(_,{selectedChannel:p,channelList:u,onSelect:h,isDark:n,accentColor:"pink"}),t.jsxs("div",{className:"flex items-center gap-1 bg-slate-800/50 rounded-lg p-1",children:[t.jsx("button",{onClick:()=>y("percentage"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all duration-200 ${l==="percentage"?"bg-pink-500/20 text-pink-300 shadow-[0_0_10px_rgba(236,72,153,0.3)]":n?"text-slate-400 hover:text-white":"text-slate-600 hover:text-slate-900"}`,children:"ç™¾åˆ†æ¯”"}),t.jsx("button",{onClick:()=>y("absolute"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all duration-200 ${l==="absolute"?"bg-pink-500/20 text-pink-300 shadow-[0_0_10px_rgba(236,72,153,0.3)]":n?"text-slate-400 hover:text-white":"text-slate-600 hover:text-slate-900"}`,children:"ç»å¯¹å€¼"})]})]})]}),t.jsxs("div",{className:"flex-1 w-full min-h-[280px] relative",children:[t.jsx("div",{ref:g,className:"w-full h-full",style:{minHeight:"280px"}}),a&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm rounded-lg",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"})}),c&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm rounded-lg",children:t.jsx("p",{className:"text-rose-400 text-sm",children:c})}),!a&&!c&&(!e||!e.dates||e.dates.length===0)&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("p",{className:"text-slate-500 text-sm",children:"æš‚æ— æ•°æ®ï¼Œè¯·é€‰æ‹©é—¨åº—"})})]})]})};export{L as MARKETING_FIELD_MAPPING,j as MARKETING_TYPE_COLORS,A as calculatePercentages,I as default,C as filterZeroTypes,E as transformToStackedAreaData};
