import os
import shutil
import datetime

# å®šä¹‰è¦å½’æ¡£çš„æ–‡ä»¶æ¨¡å¼å’Œå…·ä½“æ–‡ä»¶å
# æ ¼å¼: "æ–‡ä»¶å": "è¯´æ˜ŽåŠå»ºè®®"
FILES_TO_ARCHIVE_INFO = {
    # --- ä¸´æ—¶æµ‹è¯•è„šæœ¬ (å»ºè®®å½’æ¡£) ---
    "SuperTable_Demo_Code.py": "Dashè¡¨æ ¼ç»„ä»¶çš„å®˜æ–¹Demoä»£ç ï¼Œéžé¡¹ç›®æ ¸å¿ƒä»£ç ã€‚å»ºè®®å½’æ¡£ã€‚",
    "debug_consumables.py": "è€—ææ•°æ®è°ƒè¯•è„šæœ¬ï¼Œç”¨äºŽæŽ’æŸ¥ç‰¹å®šé—®é¢˜ã€‚é—®é¢˜è§£å†³åŽå·²æ— ç”¨ã€‚å»ºè®®å½’æ¡£ã€‚",
    "diagnose_data_issues.py": "ä¸€æ¬¡æ€§æ•°æ®è¯Šæ–­è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "diagnose_db.py": "æ•°æ®åº“è¿žæŽ¥è¯Šæ–­è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "gemini_ai_åŠ©æ‰‹.py": "Gemini APIçš„æ—©æœŸæµ‹è¯•è„šæœ¬ï¼ŒåŠŸèƒ½å·²é›†æˆåˆ° ai_analyzer.pyã€‚å»ºè®®å½’æ¡£ã€‚",
    "price_comparison_dashboard.py": "æ—©æœŸçš„ä»·æ ¼å¯¹æ¯”çœ‹æ¿åŽŸåž‹ï¼Œå·²è¢«ä¸»çœ‹æ¿å–ä»£ã€‚å»ºè®®å½’æ¡£ã€‚",
    "verify_encoding.py": "å­—ç¬¦ç¼–ç éªŒè¯è„šæœ¬ï¼Œç”¨äºŽè§£å†³å¯¼å…¥ä¹±ç é—®é¢˜ã€‚é—®é¢˜è§£å†³åŽå·²æ— ç”¨ã€‚å»ºè®®å½’æ¡£ã€‚",
    "ä¿®å¤remaining_stockå­—æ®µ.py": "ä¸€æ¬¡æ€§æ•°æ®åº“ä¿®å¤è„šæœ¬ã€‚ä¿®å¤å®ŒæˆåŽå·²æ— ç”¨ã€‚å»ºè®®å½’æ¡£ã€‚",
    "åŒæ­¥æ•°æ®åº“ç»“æž„.py": "æ•°æ®åº“ç»“æž„åŒæ­¥å·¥å…·ï¼ŒåŠŸèƒ½å¯èƒ½å·²é›†æˆæˆ–ä¸å†éœ€è¦ã€‚å»ºè®®å½’æ¡£ã€‚",
    "å¯¼å‡ºæ•°æ®åº“.py": "ç®€å•çš„æ•°æ®åº“å¯¼å‡ºè„šæœ¬ï¼Œå·²æœ‰æ›´å®Œå–„çš„æ‰¹å¤„ç†å·¥å…·ã€‚å»ºè®®å½’æ¡£ã€‚",
    "å¿«é€ŸéªŒè¯å¯¼å…¥.py": "å¯¼å…¥åŠŸèƒ½æµ‹è¯•è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "å¿«é€ŸéªŒè¯ç¥¥å’Œè·¯åˆ©æ¶¦.py": "ç‰¹å®šé—¨åº—åˆ©æ¶¦éªŒè¯è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ‰“åŒ…æ ¸å¿ƒæ–‡ä»¶.py": "æ—§çš„æ‰“åŒ…è„šæœ¬ï¼Œå·²æœ‰æ›´å®Œå–„çš„ PowerShell æ‰“åŒ…å·¥å…·ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ‰“åŒ…çº¯ä»£ç æ–‡ä»¶.py": "æ—§çš„æ‰“åŒ…è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€.py": "ç®€å•çš„çŠ¶æ€æ£€æŸ¥è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ£€æŸ¥Excelåˆ—å.py": "Excelåˆ—åæ£€æŸ¥å·¥å…·ï¼Œå·²æœ‰ .bat å°è£…ç‰ˆæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ£€æŸ¥æ•°æ®åº“æœ‰æ— æ•°æ®.py": "ç®€å•çš„æ•°æ®åº“æ£€æŸ¥è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ£€æŸ¥æ•°æ®åº“é—¨åº—æ•°æ®.py": "ç®€å•çš„é—¨åº—æ•°æ®æ£€æŸ¥è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æµ‹è¯•Redisæ€§èƒ½.py": "Redisæ€§èƒ½æµ‹è¯•è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æµ‹è¯•Redisè¿žæŽ¥.py": "Redisè¿žæŽ¥æµ‹è¯•è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æµ‹è¯•ä¸‹é’»æž¶æž„é›†æˆ.py": "ä¸‹é’»åŠŸèƒ½å¼€å‘æœŸé—´çš„æµ‹è¯•è„šæœ¬ï¼ŒåŠŸèƒ½å·²ä¸Šçº¿ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æµ‹è¯•åŒæ¯”åŠŸèƒ½.py": "åŒæ¯”åŠŸèƒ½æµ‹è¯•è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æµ‹è¯•å¯¼å…¥è„šæœ¬ä¿®å¤.py": "å¯¼å…¥è„šæœ¬ä¿®å¤æœŸé—´çš„æµ‹è¯•ä»£ç ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æµ‹è¯•è¿”å›žæŒ‰é’®é—®é¢˜.py": "UIäº¤äº’æµ‹è¯•è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ¸…ç†Redisç¼“å­˜.py": "Redisæ¸…ç†è„šæœ¬ï¼Œå·²æœ‰ redis_cache_manager.py ç®¡ç†ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ¸…é™¤ç¼“å­˜é‡æ–°åŠ è½½.py": "ç¼“å­˜æ¸…ç†è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "ç¤ºä¾‹_WebWorkeråŽå°è®¡ç®—.py": "WebWorkeræŠ€æœ¯éªŒè¯Demoã€‚å»ºè®®å½’æ¡£ã€‚",
    "è¯Šæ–­åº“å­˜æ•°æ®.py": "åº“å­˜æ•°æ®è¯Šæ–­è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "é‡å»ºæ•°æ®åº“è¡¨.py": "æ•°æ®åº“é‡å»ºè„šæœ¬ï¼Œå·²æœ‰æ›´å®Œå–„çš„ .bat å·¥å…·ã€‚å»ºè®®å½’æ¡£ã€‚",
    "é˜¶æ®µ1.1å®Œæˆæ€»ç»“.py": "é˜¶æ®µæ€§æ€»ç»“è„šæœ¬/æ–‡æ¡£ã€‚å»ºè®®å½’æ¡£ã€‚",
    "éªŒè¯ä¸‹é’»æ•°æ®ä¸€è‡´æ€§.py": "ä¸‹é’»æ•°æ®éªŒè¯è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "éªŒè¯ç¥¥å’Œè·¯åˆ©æ¶¦_ç›´æŽ¥è¯»Excel.py": "ç‰¹å®šéªŒè¯è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "éªŒè¯ç¾Žå›¢åˆ©æ¶¦_æ•°æ®åº“ç‰ˆ.py": "åˆ©æ¶¦éªŒè¯è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "éªŒè¯ç¾Žå›¢é—ªè´­åˆ©æ¶¦è®¡ç®—.py": "åˆ©æ¶¦éªŒè¯è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    
    # --- å¤‡ä»½æ–‡ä»¶ (å»ºè®®å½’æ¡£) ---
    "æ™ºèƒ½é—¨åº—çœ‹æ¿_Dashç‰ˆ_å¤‡ä»½_20251124_101428.py": "ä¸»ç¨‹åºçš„è‡ªåŠ¨å¤‡ä»½æ–‡ä»¶ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ™ºèƒ½é—¨åº—çœ‹æ¿_Dashç‰ˆ_å¤‡ä»½_20251124_101441.py": "ä¸»ç¨‹åºçš„è‡ªåŠ¨å¤‡ä»½æ–‡ä»¶ã€‚å»ºè®®å½’æ¡£ã€‚",

    # --- æ‰¹å¤„ç†/Shell è„šæœ¬ (éƒ¨åˆ†å»ºè®®å½’æ¡£ï¼Œéƒ¨åˆ†å¯èƒ½æœ‰ç”¨) ---
    "ä¸€é”®å¯¼å‡ºæ•°æ®åº“.bat": "æ•°æ®åº“å¯¼å‡ºå·¥å…·ã€‚å¦‚æžœä¸å†ä½¿ç”¨ï¼Œå»ºè®®å½’æ¡£ã€‚",
    "åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“.bat": "æ•°æ®åº“ç®¡ç†å·¥å…·ã€‚å¦‚æžœä¸å†ä½¿ç”¨ï¼Œå»ºè®®å½’æ¡£ã€‚",
    "åœæ­¢çœ‹æ¿.bat": "åœæ­¢æœåŠ¡è„šæœ¬ã€‚å»ºè®®ä¿ç•™ï¼Œä½†å¦‚æžœå·²æœ‰ PowerShell ç‰ˆæœ¬ï¼Œå¯å½’æ¡£ã€‚",
    "æŸ¥è¯¢æ•°æ®åº“è®¢å•.bat": "æ•°æ®åº“æŸ¥è¯¢å·¥å…·ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æŸ¥è¯¢æœ€æ–°å¯¼å…¥æ•°æ®.bat": "æ•°æ®æ£€æŸ¥å·¥å…·ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ£€æŸ¥Excelåˆ—å.bat": "Excelæ£€æŸ¥å·¥å…·ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ£€æŸ¥å¹¶ä¿®å¤æ•°æ®åº“.bat": "æ•°æ®åº“ç»´æŠ¤å·¥å…·ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ£€æŸ¥æ•°æ®åº“çŠ¶æ€.bat": "æ•°æ®åº“æ£€æŸ¥å·¥å…·ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ¸…ç†ä¸´æ—¶æ–‡ä»¶-ç»¼åˆç‰ˆ.ps1": "æ—§çš„æ¸…ç†è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ¸…ç†ä¸´æ—¶æ–‡ä»¶-ç»¼åˆç‰ˆ_backup.ps1": "æ—§æ¸…ç†è„šæœ¬çš„å¤‡ä»½ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ¸…ç†å†—ä½™MDæ–‡ä»¶.ps1": "æ—§çš„æ¸…ç†è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ¸…ç†é¡¹ç›®æ–‡ä»¶.ps1": "æ—§çš„æ¸…ç†è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "æ¸…ç©ºæ•°æ®åº“.bat": "å±é™©æ“ä½œè„šæœ¬ã€‚å»ºè®®å½’æ¡£ä»¥é˜²è¯¯è§¦ã€‚",
    "é‡å‘½åä¸­æ–‡æ–‡ä»¶ä¸ºè‹±æ–‡.ps1": "ä¸€æ¬¡æ€§é‡å‘½åè„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    "é‡å»ºæ•°æ®åº“_UTF8.bat": "æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ã€‚å¦‚æžœçŽ¯å¢ƒå·²æ­å»ºå¥½ï¼Œå»ºè®®å½’æ¡£ã€‚",
    "é˜¶æ®µ1.1å®Œæˆæ€»ç»“.ps1": "é˜¶æ®µæ€§æ€»ç»“ã€‚å»ºè®®å½’æ¡£ã€‚",
    "å®‰å…¨æ¸…ç†å†—ä½™æ–‡ä»¶.ps1": "æ—§çš„æ¸…ç†è„šæœ¬ã€‚å»ºè®®å½’æ¡£ã€‚",
    
    # --- Excel (å»ºè®®å½’æ¡£) ---
    "ç¾Žå›¢é—ªè´­é€æ—¥åˆ©æ¶¦æ˜Žç»†.xlsx": "ä¸´æ—¶å¯¼å‡ºçš„åˆ†æžæ•°æ®ã€‚å»ºè®®å½’æ¡£ã€‚",

    # --- æ–‡æ¡£ (.md) (å»ºè®®ä¿ç•™ï¼Œé™¤éžç¡®å®šæ— ç”¨) ---
    # "ABç”µè„‘æ“ä½œå¿«é€Ÿå‚è€ƒ.md": "æ“ä½œæŒ‡å—ã€‚å»ºè®®ä¿ç•™ã€‚",
    # "API_KEY_é…ç½®æŒ‡å—.md": "é…ç½®æ–‡æ¡£ã€‚å»ºè®®ä¿ç•™ã€‚",
    # ... (æ–‡æ¡£ç±»æ–‡ä»¶é€šå¸¸å ç”¨ç©ºé—´å°ä¸”ä»·å€¼é«˜ï¼Œå»ºè®®é»˜è®¤ä¿ç•™ï¼Œé™¤éžæ‚¨æ˜Žç¡®è¦æ¸…ç†)
}

DIRS_TO_ARCHIVE = [
    "åˆ é™¤æ–‡ä»¶å¤‡ä»½_20251122_215702",
    "å®¸æ’åž¹é—„ã‚†æžƒæµ è·ºî˜¬æµ çµ–20251118_145452"
]

ARCHIVE_DIR = "_archive"

def clean_workspace(dry_run=True):
    if not os.path.exists(ARCHIVE_DIR):
        os.makedirs(ARCHIVE_DIR)
        print(f"ðŸ“ åˆ›å»ºå½’æ¡£ç›®å½•: {ARCHIVE_DIR}")

    print(f"\nðŸ” æ­£åœ¨æ‰«æå†—ä½™æ–‡ä»¶... (æ¨¡å¼: {'é¢„è§ˆ' if dry_run else 'æ‰§è¡Œå½’æ¡£'})\n")
    
    count = 0
    
    # å¤„ç†æ–‡ä»¶
    for filename, reason in FILES_TO_ARCHIVE_INFO.items():
        if os.path.exists(filename):
            count += 1
            if dry_run:
                print(f"  [å¾…å½’æ¡£] ðŸ“„ {filename}")
                print(f"      â””â”€ â„¹ï¸  {reason}")
            else:
                try:
                    shutil.move(filename, os.path.join(ARCHIVE_DIR, filename))
                    print(f"  [å·²å½’æ¡£] âœ… {filename}")
                except Exception as e:
                    print(f"  [å¤±è´¥] âŒ {filename}: {e}")

    # å¤„ç†ç›®å½•
    for dirname in DIRS_TO_ARCHIVE:
        if os.path.exists(dirname):
            count += 1
            if dry_run:
                print(f"  [å¾…å½’æ¡£] ðŸ“‚ {dirname}")
                print(f"      â””â”€ â„¹ï¸  æ—§çš„å¤‡ä»½ç›®å½•")
            else:
                try:
                    target_path = os.path.join(ARCHIVE_DIR, dirname)
                    if os.path.exists(target_path):
                        shutil.rmtree(target_path)
                    shutil.move(dirname, ARCHIVE_DIR)
                    print(f"  [å·²å½’æ¡£] âœ… {dirname}")
                except Exception as e:
                    print(f"  [å¤±è´¥] âŒ {dirname}: {e}")

    if count == 0:
        print("âœ¨ å·¥ä½œåŒºå¾ˆå¹²å‡€ï¼Œæ²¡æœ‰å‘çŽ°é¢„å®šä¹‰çš„å†—ä½™æ–‡ä»¶ã€‚")
    else:
        print(f"\nå…±å‘çŽ° {count} ä¸ªå†—ä½™é¡¹ç›®ã€‚")
        if dry_run:
            print("\nðŸ’¡ æç¤º: è¿è¡Œ `python æ¸…ç†å·¥ä½œåŒº.py run` æ¥æ‰§è¡Œå½’æ¡£æ“ä½œã€‚")
            print(f"   æ‰€æœ‰æ–‡ä»¶å°†è¢«ç§»åŠ¨åˆ° `{ARCHIVE_DIR}` ç›®å½•ï¼Œä¸ä¼šç›´æŽ¥åˆ é™¤ã€‚")

if __name__ == "__main__":
    import sys
    is_dry_run = True
    if len(sys.argv) > 1 and sys.argv[1] == "run":
        is_dry_run = False
    
    clean_workspace(dry_run=is_dry_run)
