#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""详细对比祥和路店利润计算差异"""

print("="*80)
print("🔍 利润计算差异分析")
print("="*80)

print("\n【用户手动计算】")
print(f"  总利润: ¥23,332")
print(f"  美团闪购: ¥15,066")
print(f"  饿了么: ¥6,826")
print(f"  京东到家: ¥1,439")
print(f"  合计: ¥{15066 + 6826 + 1439:,}")

print("\n【系统计算(枫瑞路店-替代)】")
print(f"  总利润: ¥21,234.95")
print(f"  美团共橙: ¥10,392.26")
print(f"  饿了么: ¥6,835.53")
print(f"  京东到家: ¥3,870.45")
print(f"  闪购小程序: ¥136.71")
print(f"  合计: ¥21,234.95")

print("\n【差异分析】")
user_total = 23332
system_total = 21234.95
diff = user_total - system_total
print(f"  总利润差异: ¥{diff:,.2f} ({diff/user_total*100:.1f}%)")

print("\n【可能原因】")
print("  1. 渠道差异:")
print(f"     - 系统有'闪购小程序'渠道(¥136.71),用户数据中没有")
print(f"     - 如果去除'闪购小程序',系统总利润为: ¥{21234.95 - 136.71:,.2f}")

print("\n  2. 利润计算公式差异:")
print("     - 用户可能使用: 利润 = 销售额 - 成本 - 配送费 - 活动费用")
print("     - 系统使用: order.profit (直接从Excel读取)")
print("     - 如果Excel中的利润额计算有误,会直接影响系统显示")

print("\n  3. 订单级费用vs商品级费用:")
print("     - 配送费、平台佣金是订单级费用(一个订单只扣一次)")
print("     - 如果按商品行累加会重复计算")
print("     - 系统使用: df.groupby('订单ID')['利润额'].first().sum()")

print("\n  4. 耗材成本:")
print("     - 系统保留了耗材数据(购物袋等)")
print("     - 如果用户计算时剔除了耗材,会导致利润虚高")

print("\n【建议验证方法】")
print("  1. 在Excel中检查'利润额'列的计算公式是否正确")
print("  2. 确认耗材成本是否已包含在计算中")
print("  3. 检查是否有订单级费用被重复扣除")
print("  4. 验证是否有'闪购小程序'渠道的订单")

print("\n【需要您提供的信息】")
print("  1. Excel中'利润额'列的计算公式是什么?")
print("  2. 您的手动计算是否包含了耗材成本(购物袋)?")
print("  3. 您的手动计算中是否有'闪购小程序'渠道?")
print("  4. 您是否有按订单去重(避免重复计算订单级费用)?")

print("\n" + "="*80)
print("💡 下一步: 请提供祥和路店的原始Excel文件,我们可以逐行验证利润计算")
print("="*80)
