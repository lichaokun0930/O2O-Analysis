# 📊 智能门店经营看板 - 新功能使用指南

## 🎉 优先级1功能上线通知

### ✅ 已完成功能（2025-10-15）

#### 1. 📤 **批量上传多个Excel文件**

**功能说明：**
- 支持同时选择和上传多个Excel文件（例如：9月、10月、11月的订单数据）
- 系统自动合并所有文件的数据
- 智能去重：基于订单ID自动移除重复订单
- 文件读取统计：清楚显示每个文件的读取状态

**使用方法：**
```
1. 打开系统，进入"订单数据分析"模块
2. 点击"上传新数据"标签
3. 在文件选择器中按住Ctrl键（Windows）或Command键（Mac）
4. 同时选择多个Excel文件
5. 点击"打开"，系统自动合并分析
```

**效果展示：**
```
✅ 检测到 3 个文件，将自动合并分析

文件名                          订单行数    状态
9月订单.xlsx                     24,936    ✅ 成功
10月订单.xlsx                    28,512    ✅ 成功
11月订单.xlsx                    31,245    ✅ 成功

🔄 检测到重复订单，已自动去重：84,693 → 78,450 行（去除 6,243 行重复）
✅ 成功加载 78,450 条原始订单数据
```

---

#### 2. 🔍 **数据质量检查报告**

**功能说明：**
- 上传数据后自动进行全面质量检查
- 100分制评分系统
- 分级评定：优秀(90+) / 良好(70-89) / 一般(50-69) / 较差(<50)
- 智能检测6大类问题

**检查项目：**

| 检查类别 | 检查内容 | 严重度 |
|---------|---------|-------|
| 缺失值检查 | 各字段缺失值比例 | 严重(>50%) / 警告(>10%) |
| 重复数据 | 订单ID重复检测 | 警告 |
| 日期格式 | 下单时间格式验证 | 严重(无法解析) / 警告(部分异常) |
| 数值异常 | 负数、超范围检测 | 警告 |
| 必需字段 | 订单ID、商品名称等 | 严重(缺失) |
| 价格合理性 | 价格<0.1或>10000 | 提示 |

**效果展示：**
```
数据质量评分: 93分
质量等级: 优秀
问题数量: 3个

📋 数据质量详细报告

🔴 严重问题：
• 订单ID: 发现重复订单：18,639条

⚠️ 警告提示：
• 商品实售价: 可能存在异常价格：7,561行（<0.1或>10000）
• 销量: 存在负数：1行
```

---

#### 3. 💾 **自动保存到本地缓存**

**功能说明：**
- 每次上传数据后自动保存到本地
- 使用gzip压缩，节省磁盘空间（压缩率约70%）
- 保存完整元数据（文件名、时间、行数等）
- 下次无需重新上传，秒级加载

**存储位置：**
```
项目目录/
└── 学习数据仓库/
    └── uploaded_data/
        ├── 9月订单_a1b2c3d4_20251015_102030.pkl.gz
        ├── 10月订单_e5f6g7h8_20251015_143520.pkl.gz
        └── 合并数据_3个文件_i9j0k1l2_20251015_162440.pkl.gz
```

**文件命名规则：**
```
{原始文件名}_{内容hash}_{时间戳}.pkl.gz

- 原始文件名：去除.xlsx后缀
- 内容hash：防止重复（8位）
- 时间戳：YYYYMMDD_HHMMSS
```

**缓存信息：**
```
💾 数据已保存到缓存，下次可快速加载
   路径：学习数据仓库/uploaded_data/测试数据_db6f318e_20251015_162440.pkl.gz
   大小：1.30MB（原始：4.5MB，压缩率71%）
```

---

#### 4. 📂 **历史数据快速加载**

**功能说明：**
- 查看所有历史上传的数据版本
- 一键加载任意历史版本
- 显示详细信息：时间、行数、文件大小
- 免去重新上传Excel的等待时间

**使用方法：**
```
1. 打开系统，进入"订单数据分析"模块
2. 点击"加载历史数据"标签
3. 从下拉列表选择要加载的历史版本
4. 点击"🔄 加载选中的历史数据"按钮
5. 秒级完成加载，立即开始分析
```

**效果展示：**
```
✅ 找到 5 个历史数据版本

选择要加载的历史数据：
> 合并数据_3个文件 | 2025-10-15 16:24 | 78,450行 | 5.2MB
  10月订单.xlsx | 2025-10-14 14:35 | 28,512行 | 1.8MB
  9月订单.xlsx | 2025-10-13 10:20 | 24,936行 | 1.3MB
  测试数据.xlsx | 2025-10-12 09:15 | 18,639行 | 0.9MB
  8月订单.xlsx | 2025-10-11 15:42 | 22,105行 | 1.1MB

[🔄 加载选中的历史数据]

✅ 已加载历史数据：78,450条订单
```

---

## 🎯 典型使用场景

### 场景1：月度数据合并分析
```
问题：需要分析9-11月三个月的整体趋势
解决：
1. 同时选择3个月的Excel文件上传
2. 系统自动合并并去重
3. 生成跨月度的完整分析报告
```

### 场景2：数据质量把控
```
问题：不确定上传的数据是否有问题
解决：
1. 上传数据后自动生成质量报告
2. 查看评分和问题详情
3. 根据提示修正Excel源文件
```

### 场景3：快速复查历史数据
```
问题：想重新查看上周分析的数据
解决：
1. 点击"加载历史数据"
2. 选择上周的缓存版本
3. 秒级加载，无需重新上传
```

### 场景4：数据版本管理
```
问题：每天导出新数据，需要保留历史版本
解决：
1. 每天上传新数据自动保存
2. 系统保留所有历史版本
3. 可随时对比不同时间点的数据
```

---

## 📈 性能提升

| 操作 | 原方式 | 新方式 | 提升 |
|-----|-------|-------|------|
| 上传3个月数据 | 分3次上传，手动合并 | 批量上传，自动合并 | **节省5分钟** |
| 数据质量检查 | 手动Excel检查 | 自动生成报告 | **节省10分钟** |
| 重新分析历史数据 | 重新上传Excel | 缓存秒级加载 | **节省2分钟** |
| 存储空间 | 原始Excel占用 | gzip压缩存储 | **节省70%空间** |

---

## ⚠️ 注意事项

1. **数据去重逻辑**
   - 基于"订单ID"字段进行去重
   - 如果存在重复，保留第一条记录
   - 建议在Excel源头避免重复导出

2. **缓存管理**
   - 缓存文件自动保存，不会自动删除
   - 可手动清理 `学习数据仓库/uploaded_data/` 目录
   - 建议定期清理超过3个月的历史缓存

3. **文件格式要求**
   - 必须是.xlsx或.xls格式
   - 必须包含必需字段（订单ID、商品名称、下单时间等）
   - 建议使用标准美团/饿了么导出模板

4. **性能建议**
   - 单次上传建议不超过10个文件
   - 单个文件建议不超过10万行
   - 过大数据建议使用SQLite数据库（优先级2功能）

---

## 🔮 即将上线功能（优先级1 - 剩余）

### 📊 历史数据对比（月度趋势）
- [ ] 同时选择多个历史版本进行对比
- [ ] 自动生成同比/环比增长率
- [ ] 趋势图表可视化
- [ ] 异常波动自动标注

**预计上线时间：** 2小时内完成

---

## 📞 问题反馈

如有任何问题或建议，请通过以下方式反馈：
- 在Streamlit界面点击右上角反馈按钮
- 或直接联系技术支持团队

---

**更新日期：** 2025-10-15  
**版本号：** v2.0 - 优先级1功能版  
**开发状态：** 3/4 已完成，1/4 进行中
