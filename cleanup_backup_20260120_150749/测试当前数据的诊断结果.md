# 测试当前数据的诊断结果

## 问题分析

根据代码分析，热销缺货和价格异常显示为0可能有以下原因：

### 1. 数据本身确实没有异常
- 所有热销商品库存充足
- 所有商品售价都高于成本

### 2. 字段映射问题
数据库字段可能与代码中使用的字段名不匹配：
- 数据库字段：`remaining_stock`
- 代码期望：`剩余库存`

### 3. 数据类型问题
- 库存字段可能是字符串而不是数字
- 价格字段可能包含NULL值

## 建议的调试步骤

### 方法1：在看板中添加调试输出

在 `components/today_must_do/diagnosis_analysis.py` 的 `analyze_urgent_issues` 函数中添加调试输出：

```python
# 在热销缺货分析部分（第760行附近）
print(f"[DEBUG] 热销缺货分析:")
print(f"  - yesterday_df行数: {len(yesterday_df)}")
print(f"  - 是否有'剩余库存'字段: {'剩余库存' in yesterday_df.columns}")
if '剩余库存' in yesterday_df.columns:
    print(f"  - 库存为0的订单行: {(yesterday_df['剩余库存'] == 0).sum()}")

# 在价格异常分析部分（第880行附近）
print(f"[DEBUG] 价格异常分析:")
print(f"  - yesterday_df行数: {len(yesterday_df)}")
print(f"  - 是否有'实收价格'字段: {'实收价格' in yesterday_df.columns}")
print(f"  - 是否有'商品采购成本'字段: {'商品采购成本' in yesterday_df.columns}")
```

### 方法2：检查数据库字段映射

查看 `智能门店看板_Dash版.py` 中的数据加载函数，确认字段映射是否正确。

### 方法3：直接查询数据库

```sql
-- 检查昨日库存为0的商品
SELECT product_name, remaining_stock, quantity
FROM orders
WHERE order_date = (SELECT MAX(order_date) FROM orders)
  AND remaining_stock = 0
LIMIT 10;

-- 检查价格异常的商品
SELECT product_name, actual_price, product_cost, quantity,
       (product_cost / NULLIF(quantity, 0)) as unit_cost
FROM orders
WHERE order_date = (SELECT MAX(order_date) FROM orders)
  AND actual_price < (product_cost / NULLIF(quantity, 0))
LIMIT 10;
```

## 临时解决方案

如果确实是数据问题（没有异常商品），可以：

1. 使用测试数据验证功能正常
2. 等待实际出现异常商品时再观察
3. 手动创建一些测试订单来验证功能

## 下一步

请启动看板，查看控制台输出，看是否有相关的调试信息或错误信息。
