# 查看诊断调试输出

## 问题现状

热销缺货和价格异常卡片显示为0，需要查看详细的调试信息来确定原因。

## 已添加的调试输出

我已经在 `components/today_must_do/diagnosis_analysis.py` 中添加了详细的调试输出，包括：

### 热销缺货分析
- yesterday_df行数
- 数据列名
- sales_col（销量字段名）
- stock_col（库存字段名）
- 昨日库存为0的订单行数

### 价格异常分析
- yesterday_df行数
- sales_field（销量字段名）
- cost_col（成本字段名）
- 是否有'实收价格'字段
- 是否有成本字段
- 检测结果

## 查看调试输出的步骤

### 1. 启动看板
```powershell
cd O2O-Analysis
.\启动看板.ps1
```

### 2. 查看控制台输出
在PowerShell窗口中，你会看到类似这样的输出：

```
[DEBUG] 热销缺货分析:
  - yesterday_df行数: 1234
  - df.columns: ['订单ID', '商品名称', '日期', ...]
  - sales_col: 月售
  - stock_col: 剩余库存
  - category_col: 一级分类名
  - 昨日库存为0的订单行: 0

[DEBUG] 价格异常分析:
  - yesterday_df行数: 1234
  - sales_field: 月售
  - cost_col: 商品采购成本
  - 是否有'实收价格': True
  - 是否有cost_col: True
  ✅ 所有商品售价均高于成本
```

### 3. 分析输出

根据调试输出，可以判断：

#### 情况1：字段不存在
```
- stock_col: None
```
**原因**：数据中没有'剩余库存'或'库存'字段  
**解决**：检查数据库字段映射

#### 情况2：昨日没有数据
```
- yesterday_df行数: 0
```
**原因**：数据库中没有昨日的订单数据  
**解决**：检查数据导入是否正常

#### 情况3：确实没有异常
```
- 昨日库存为0的订单行: 0
✅ 所有商品售价均高于成本
```
**原因**：数据本身没有异常商品  
**解决**：这是正常情况，等待出现异常商品时功能会正常显示

## 常见问题

### Q1: 看不到调试输出
A: 确保在PowerShell窗口中启动看板，不要使用后台模式

### Q2: 输出显示字段不存在
A: 需要检查数据库字段映射，可能需要修改字段名

### Q3: 确认数据中有异常但显示为0
A: 请将完整的调试输出发给我，我会进一步分析

## 下一步

1. 启动看板
2. 访问今日必做TAB
3. 复制控制台中的调试输出
4. 根据输出判断问题原因

如果需要进一步帮助，请提供完整的调试输出。
