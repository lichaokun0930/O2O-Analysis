"""
è¯Šæ–­å•†å“å¥åº·åˆ†æè¡¨æ ¼æ•°æ®æ˜¾ç¤ºé—®é¢˜

æ£€æŸ¥ï¼š
1. æ•°æ®æ˜¯å¦æ­£ç¡®ä¼ é€’
2. åˆ—å®šä¹‰æ˜¯å¦åŒ¹é…
3. DataTableé…ç½®æ˜¯å¦æ­£ç¡®
"""

import sys
import pandas as pd

print("=" * 80)
print("è¯Šæ–­å•†å“å¥åº·åˆ†æè¡¨æ ¼æ•°æ®æ˜¾ç¤ºé—®é¢˜")
print("=" * 80)

# æ¨¡æ‹ŸçœŸå®åœºæ™¯
print("\n1ï¸âƒ£ åˆ›å»ºæµ‹è¯•æ•°æ®ï¼ˆæ¨¡æ‹ŸçœŸå®æ•°æ®ç»“æ„ï¼‰...")

# åˆ›å»ºä¸çœŸå®æ•°æ®ç›¸åŒç»“æ„çš„æµ‹è¯•æ•°æ®
test_data = {
    'æ’å': [1, 2, 3, 4, 5],
    'æ¸ é“': ['ç¾å›¢', 'ç¾å›¢', 'é¥¿äº†ä¹ˆ', 'ç¾å›¢', 'é¥¿äº†ä¹ˆ'],
    'åº—å†…ç ': ['A001', 'A002', 'A003', 'A004', 'A005'],
    'å•†å“åç§°': ['å•†å“A', 'å•†å“B', 'å•†å“C', 'å•†å“D', 'å•†å“E'],
    'ä¸€çº§åˆ†ç±»å': ['é¥®å“', 'å°åƒ', 'é¥®å“', 'ä¸»é£Ÿ', 'å°åƒ'],
    'ä¸‰çº§åˆ†ç±»å': ['å¥¶èŒ¶', 'ç‚¸é¸¡', 'æœæ±', 'ç±³é¥­', 'è–¯æ¡'],
    'å•†å“åŸä»·': ['Â¥15.00', 'Â¥25.00', 'Â¥12.00', 'Â¥18.00', 'Â¥20.00'],
    'å•†å“å®å”®ä»·': ['Â¥12.00', 'Â¥20.00', 'Â¥10.00', 'Â¥15.00', 'Â¥18.00'],
    'å®æ”¶ä»·æ ¼': ['Â¥10.00', 'Â¥18.00', 'Â¥9.00', 'Â¥14.00', 'Â¥16.00'],
    'å•å“æˆæœ¬': ['Â¥5.00', 'Â¥10.00', 'Â¥4.00', 'Â¥8.00', 'Â¥9.00'],
    'ç»¼åˆåˆ©æ¶¦ç‡': ['50.0%', '44.4%', '55.6%', '42.9%', '43.8%'],
    'å®šä»·åˆ©æ¶¦ç‡': ['58.3%', '50.0%', '60.0%', '46.7%', '50.0%'],
    'å‘¨æœŸæ€»é”€é‡': ['100ä»¶', '80ä»¶', '60ä»¶', '50ä»¶', '40ä»¶'],
    'åŠ¨é”€æŒ‡æ•°': ['0.85', '0.72', '0.68', '0.55', '0.48'],
    'é”€å”®é¢': ['Â¥1,000', 'Â¥1,440', 'Â¥540', 'Â¥700', 'Â¥640'],
    'é”€å”®é¢å æ¯”': ['25.00%', '36.00%', '13.50%', '17.50%', '16.00%'],
    'è¶‹åŠ¿æ ‡ç­¾': ['ğŸ“ˆ ä¸Šå‡', 'ğŸ“ˆ ä¸Šå‡', 'ğŸ“‰ ä¸‹é™', 'â¡ï¸ æŒå¹³', 'ğŸ“‰ ä¸‹é™'],
    'å‰æœŸé”€é‡': ['40ä»¶', '35ä»¶', '35ä»¶', '25ä»¶', '25ä»¶'],
    'è¿‘æœŸé”€é‡': ['60ä»¶', '45ä»¶', '25ä»¶', '25ä»¶', '15ä»¶'],
    'é”€é‡å·®å¼‚': ['+20ä»¶', '+10ä»¶', '-10ä»¶', 'æŒå¹³', '-10ä»¶'],
    'åˆ©æ¶¦ç‡å˜åŒ–': ['+5.0%', '+2.0%', '-3.0%', '+0.5%', '-2.0%'],
    'å››è±¡é™åˆ†ç±»': ['ğŸŒŸ æ˜æ˜Ÿå•†å“', 'ğŸ”¥ ç•…é”€å•†å“', 'ğŸ’ æ½œåŠ›å•†å“', 'ğŸ¯ ç­–ç•¥å¼•æµ', 'âš¡ è‡ªç„¶å¼•æµ'],
    'ç‰¹æ®Šæ ‡è®°': ['-', 'ğŸš¨ äºæŸ', '-', 'ğŸ“¦ ä½é¢‘', '-'],
    'é—®é¢˜æ ‡ç­¾': ['-', 'äºæŸ', 'ä½é¢‘', 'ä½ç›ˆåˆ©', 'é«˜è¥é”€'],
    'ä¸šåŠ¡å»ºè®®': ['ä¿æŒç°çŠ¶', 'æé«˜å®šä»·', 'å¢åŠ æ¨å¹¿', 'ä¼˜åŒ–æˆæœ¬', 'å‡å°‘è¥é”€'],
    'å”®ç½„ç‡': ['95.0%', '88.0%', '75.0%', '65.0%', '55.0%'],
    'è¥é”€å æ¯”': ['10.0%', '15.0%', '8.0%', '12.0%', '20.0%'],
    'åº“å­˜å‘¨è½¬å¤©æ•°': ['5å¤©', '7å¤©', '10å¤©', '15å¤©', '20å¤©']
}

df = pd.DataFrame(test_data)

print(f"   æ•°æ®è¡Œæ•°: {len(df)}")
print(f"   æ•°æ®åˆ—æ•°: {len(df.columns)}")
print(f"   åˆ—å: {list(df.columns)[:10]}...")

# æ£€æŸ¥æ•°æ®
print(f"\n2ï¸âƒ£ æ£€æŸ¥æ•°æ®å†…å®¹...")
print(f"   ç¬¬ä¸€è¡Œæ•°æ®:")
for col in df.columns[:5]:
    print(f"      {col}: {df[col].iloc[0]}")

# åˆ›å»ºåˆ—å®šä¹‰ï¼ˆæ¨¡æ‹ŸçœŸå®é€»è¾‘ï¼‰
print(f"\n3ï¸âƒ£ åˆ›å»ºåˆ—å®šä¹‰...")
columns_def = []
for col in df.columns:
    if col == 'å››è±¡é™åˆ†ç±»':
        col_name = 'å…­è±¡é™åˆ†ç±»'  # é‡å‘½å
    else:
        col_name = col
    columns_def.append({'name': col_name, 'id': col})

print(f"   åˆ—å®šä¹‰æ•°é‡: {len(columns_def)}")
print(f"   å‰5ä¸ªåˆ—å®šä¹‰:")
for col_def in columns_def[:5]:
    print(f"      {col_def}")

# æ£€æŸ¥å…³é”®åˆ—
print(f"\n4ï¸âƒ£ æ£€æŸ¥å…³é”®åˆ—...")
for col_def in columns_def:
    if 'è±¡é™' in col_def['name']:
        print(f"   æ‰¾åˆ°è±¡é™åˆ—:")
        print(f"      æ˜¾ç¤ºå: {col_def['name']}")
        print(f"      æ•°æ®åˆ—ID: {col_def['id']}")
        print(f"      DataFrameä¸­æ˜¯å¦å­˜åœ¨: {col_def['id'] in df.columns}")
        if col_def['id'] in df.columns:
            print(f"      æ•°æ®ç¤ºä¾‹: {df[col_def['id']].iloc[0]}")

# è½¬æ¢ä¸ºrecordsæ ¼å¼ï¼ˆDataTableä½¿ç”¨çš„æ ¼å¼ï¼‰
print(f"\n5ï¸âƒ£ è½¬æ¢ä¸ºDataTableæ ¼å¼...")
records = df.to_dict('records')
print(f"   Recordsæ•°é‡: {len(records)}")
print(f"   ç¬¬ä¸€æ¡record:")
for key, value in list(records[0].items())[:5]:
    print(f"      {key}: {value}")

# æ£€æŸ¥åˆ—IDæ˜¯å¦åœ¨recordsçš„keysä¸­
print(f"\n6ï¸âƒ£ éªŒè¯åˆ—IDåŒ¹é…...")
first_record_keys = set(records[0].keys())
column_ids = set([col['id'] for col in columns_def])

print(f"   Recordçš„keysæ•°é‡: {len(first_record_keys)}")
print(f"   åˆ—å®šä¹‰çš„IDæ•°é‡: {len(column_ids)}")

missing_in_records = column_ids - first_record_keys
missing_in_columns = first_record_keys - column_ids

if missing_in_records:
    print(f"   âŒ åˆ—å®šä¹‰ä¸­æœ‰ä½†recordsä¸­æ²¡æœ‰çš„: {missing_in_records}")
else:
    print(f"   âœ… æ‰€æœ‰åˆ—IDéƒ½åœ¨recordsä¸­")

if missing_in_columns:
    print(f"   âš ï¸ Recordsä¸­æœ‰ä½†åˆ—å®šä¹‰ä¸­æ²¡æœ‰çš„: {missing_in_columns}")
else:
    print(f"   âœ… Recordsçš„æ‰€æœ‰keyéƒ½åœ¨åˆ—å®šä¹‰ä¸­")

# æµ‹è¯•åˆ›å»ºDataTable
print(f"\n7ï¸âƒ£ æµ‹è¯•åˆ›å»ºDataTable...")
try:
    from dash import dash_table
    
    table = dash_table.DataTable(
        id='test-table',
        data=records,
        columns=columns_def,
        page_size=10
    )
    
    print(f"   âœ… DataTableåˆ›å»ºæˆåŠŸ")
    print(f"   æ•°æ®è¡Œæ•°: {len(table.data)}")
    print(f"   åˆ—æ•°: {len(table.columns)}")
    
    # æ£€æŸ¥ç¬¬ä¸€è¡Œæ•°æ®æ˜¯å¦èƒ½åŒ¹é…åˆ°åˆ—
    print(f"\n8ï¸âƒ£ æ£€æŸ¥æ•°æ®-åˆ—åŒ¹é…...")
    for col_def in columns_def[:5]:
        col_id = col_def['id']
        col_name = col_def['name']
        if col_id in records[0]:
            value = records[0][col_id]
            print(f"   âœ… {col_name} (id={col_id}): {value}")
        else:
            print(f"   âŒ {col_name} (id={col_id}): æ•°æ®ä¸­ä¸å­˜åœ¨")
    
except Exception as e:
    print(f"   âŒ DataTableåˆ›å»ºå¤±è´¥: {e}")
    import traceback
    traceback.print_exc()

print(f"\n" + "=" * 80)
print("è¯Šæ–­å®Œæˆ")
print("=" * 80)
print("\nç»“è®º:")
print("å¦‚æœæ‰€æœ‰æ£€æŸ¥éƒ½é€šè¿‡ï¼ˆâœ…ï¼‰ï¼Œè¯´æ˜ä»£ç é€»è¾‘æ­£ç¡®")
print("å¦‚æœè¡¨æ ¼ä»ç„¶ä¸æ˜¾ç¤ºæ•°æ®ï¼Œå¯èƒ½æ˜¯ï¼š")
print("1. æµè§ˆå™¨ç¼“å­˜é—®é¢˜ - éœ€è¦ç¡¬åˆ·æ–°ï¼ˆCtrl+Shift+Rï¼‰")
print("2. çœ‹æ¿æ²¡æœ‰é‡å¯ - éœ€è¦é‡å¯çœ‹æ¿")
print("3. å›è°ƒå‡½æ•°æ²¡æœ‰æ­£ç¡®è°ƒç”¨ - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯")
