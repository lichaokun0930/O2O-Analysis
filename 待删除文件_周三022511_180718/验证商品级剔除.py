#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""éªŒè¯ç¥¥å’Œè·¯åº—åˆ©æ¶¦é¢ - å•†å“çº§å‰”é™¤å¹³å°æœåŠ¡è´¹=0"""

import pandas as pd

print("="*80)
print("ğŸ” éªŒè¯ç¥¥å’Œè·¯åº—åˆ©æ¶¦é¢ - å•†å“çº§å‰”é™¤")
print("="*80)

df = pd.read_excel('å®é™…æ•°æ®/ç¥¥å’Œè·¯.xlsx')
print(f"\nğŸ“Š åŸå§‹æ•°æ®: {len(df):,} è¡Œ")

# æ£€æŸ¥å¹³å°æœåŠ¡è´¹å­—æ®µ
print(f"\nå¹³å°æœåŠ¡è´¹ç»Ÿè®¡:")
print(f"   æ€»è¡Œæ•°: {len(df):,}")
print(f"   å¹³å°æœåŠ¡è´¹=0çš„è¡Œæ•°: {(df['å¹³å°æœåŠ¡è´¹'] == 0).sum():,}")
print(f"   å¹³å°æœåŠ¡è´¹>0çš„è¡Œæ•°: {(df['å¹³å°æœåŠ¡è´¹'] > 0).sum():,}")

print("\n" + "="*80)
print("ğŸ“Š åˆ©æ¶¦é¢è®¡ç®— - ä¸åŒå‰”é™¤é€»è¾‘å¯¹æ¯”")
print("="*80)

# æ–¹æ³•1: æ‰€æœ‰å•†å“è¡Œ,æŒ‰è®¢å•èšåˆ
profit_all = df.groupby('è®¢å•ID')['åˆ©æ¶¦é¢'].sum().sum()
orders_all = df['è®¢å•ID'].nunique()
print(f"\næ–¹æ³•1 - æ‰€æœ‰å•†å“(ä¸å‰”é™¤):")
print(f"   è®¢å•æ•°: {orders_all:,}")
print(f"   åˆ©æ¶¦é¢: Â¥{profit_all:,.2f}")

# æ–¹æ³•2: å•†å“çº§å‰”é™¤å¹³å°æœåŠ¡è´¹=0,ç„¶åæŒ‰è®¢å•èšåˆ
df_å•†å“çº§å‰”é™¤ = df[df['å¹³å°æœåŠ¡è´¹'] != 0].copy()
profit_å•†å“çº§ = df_å•†å“çº§å‰”é™¤.groupby('è®¢å•ID')['åˆ©æ¶¦é¢'].sum().sum()
orders_å•†å“çº§ = df_å•†å“çº§å‰”é™¤['è®¢å•ID'].nunique()
print(f"\næ–¹æ³•2 - å•†å“çº§å‰”é™¤å¹³å°æœåŠ¡è´¹=0 (æ‚¨çš„é€»è¾‘):")
print(f"   å‰”é™¤å•†å“è¡Œæ•°: {len(df) - len(df_å•†å“çº§å‰”é™¤):,}")
print(f"   ä¿ç•™å•†å“è¡Œæ•°: {len(df_å•†å“çº§å‰”é™¤):,}")
print(f"   ä¿ç•™è®¢å•æ•°: {orders_å•†å“çº§:,}")
print(f"   åˆ©æ¶¦é¢: Â¥{profit_å•†å“çº§:,.2f}")

# æ–¹æ³•3: è®¢å•çº§å‰”é™¤(å…ˆèšåˆ,å†å‰”é™¤å¹³å°æœåŠ¡è´¹=0çš„è®¢å•)
order_agg = df.groupby('è®¢å•ID').agg({
    'åˆ©æ¶¦é¢': 'sum',
    'å¹³å°æœåŠ¡è´¹': 'sum'
}).reset_index()
order_agg_filtered = order_agg[order_agg['å¹³å°æœåŠ¡è´¹'] > 0]
profit_è®¢å•çº§ = order_agg_filtered['åˆ©æ¶¦é¢'].sum()
orders_è®¢å•çº§ = len(order_agg_filtered)
print(f"\næ–¹æ³•3 - è®¢å•çº§å‰”é™¤å¹³å°æœåŠ¡è´¹=0 (ç³»ç»Ÿå½“å‰é€»è¾‘):")
print(f"   å‰”é™¤è®¢å•æ•°: {len(order_agg) - len(order_agg_filtered):,}")
print(f"   ä¿ç•™è®¢å•æ•°: {orders_è®¢å•çº§:,}")
print(f"   åˆ©æ¶¦é¢: Â¥{profit_è®¢å•çº§:,.2f}")

print("\n" + "="*80)
print("ğŸ“‹ ä¸æ‚¨æä¾›æ•°æ®å¯¹æ¯”")
print("="*80)
print(f"æ‚¨çš„æ•°æ® - å‰”é™¤å¹³å°æœåŠ¡è´¹=0å: Â¥55,921")
print(f"æ–¹æ³•2è®¡ç®—ç»“æœ: Â¥{profit_å•†å“çº§:,.2f}")
print(f"å·®å¼‚: Â¥{profit_å•†å“çº§ - 55921:,.2f}")

if abs(profit_å•†å“çº§ - 55921) < 100:
    print("\nâœ… éªŒè¯é€šè¿‡! å•†å“çº§å‰”é™¤é€»è¾‘æ­£ç¡®")
else:
    print(f"\nâŒ ä»æœ‰å·®å¼‚ {abs(profit_å•†å“çº§ - 55921):.2f}å…ƒ")

# ä»55921åˆ°23332çš„å·®å¼‚
print(f"\nä»Â¥55,921åˆ°æ‚¨çš„Â¥23,332:")
print(f"   å·®å¼‚: Â¥{55921 - 23332:,}")
print(f"   å¯èƒ½åŸå› :")
print(f"   1. å‰”é™¤äº†è€—æå•†å“")
print(f"   2. åªç»Ÿè®¡äº†ç‰¹å®šæ¸ é“")
print(f"   3. å…¶ä»–ä¸šåŠ¡è§„åˆ™è°ƒæ•´")

# æ£€æŸ¥è€—æ
if 'ä¸€çº§åˆ†ç±»å' in df_å•†å“çº§å‰”é™¤.columns:
    è€—æ = df_å•†å“çº§å‰”é™¤[df_å•†å“çº§å‰”é™¤['ä¸€çº§åˆ†ç±»å'] == 'è€—æ']
    if len(è€—æ) > 0:
        è€—æåˆ©æ¶¦ = è€—æ.groupby('è®¢å•ID')['åˆ©æ¶¦é¢'].sum().sum()
        print(f"\n   è€—æåˆ©æ¶¦: Â¥{è€—æåˆ©æ¶¦:,.2f}")
        print(f"   å‰”é™¤è€—æå: Â¥{profit_å•†å“çº§ - è€—æåˆ©æ¶¦:,.2f}")

# æ£€æŸ¥æ¸ é“åˆ†å¸ƒ
if 'æ¸ é“' in df_å•†å“çº§å‰”é™¤.columns:
    print(f"\næ¸ é“åˆ†å¸ƒ(å•†å“çº§å‰”é™¤å):")
    channel_profit = df_å•†å“çº§å‰”é™¤.groupby('æ¸ é“').apply(
        lambda x: x.groupby('è®¢å•ID')['åˆ©æ¶¦é¢'].sum().sum()
    )
    for ch, p in channel_profit.items():
        print(f"   {ch}: Â¥{p:,.2f}")
    print(f"   æ€»è®¡: Â¥{channel_profit.sum():,.2f}")

print("\n" + "="*80)
