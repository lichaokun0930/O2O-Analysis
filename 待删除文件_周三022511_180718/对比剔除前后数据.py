"""
å¯¹æ¯”å‰”é™¤å‰åçš„ç¾å›¢å…±æ©™æ•°æ®
"""
import pandas as pd

# åŠ è½½æ«ç‘åº—æ•°æ®
df = pd.read_excel('å®é™…æ•°æ®/æ«ç‘.xlsx')

# å‰”é™¤è€—æ
if 'ä¸€çº§åˆ†ç±»å' in df.columns:
    df = df[df['ä¸€çº§åˆ†ç±»å'] != 'è€—æ'].copy()

# ç­›é€‰ç¾å›¢å…±æ©™
mt_data = df[df['æ¸ é“'] == 'ç¾å›¢å…±æ©™'].copy()

print("=" * 80)
print("ğŸ” æ£€æŸ¥ç¾å›¢å…±æ©™æ•°æ®")
print("=" * 80)

# æŒ‰è®¢å•èšåˆ
order_agg = mt_data.groupby('è®¢å•ID').agg({
    'åˆ©æ¶¦é¢': 'sum',
    'å¹³å°æœåŠ¡è´¹': 'sum',
    'ç‰©æµé…é€è´¹': 'first'
}).reset_index()

print(f"\nå‰”é™¤å‰(æ‰€æœ‰è®¢å•):")
print(f"  è®¢å•æ•°: {len(order_agg)}")
print(f"  åˆ©æ¶¦é¢æ€»å’Œ: {order_agg['åˆ©æ¶¦é¢'].sum():.2f}")
print(f"  å¹³å°æœåŠ¡è´¹æ€»å’Œ: {order_agg['å¹³å°æœåŠ¡è´¹'].sum():.2f}")
print(f"  ç‰©æµé…é€è´¹æ€»å’Œ: {order_agg['ç‰©æµé…é€è´¹'].sum():.2f}")

# å‰”é™¤å¹³å°æœåŠ¡è´¹=0çš„è®¢å•
filtered = order_agg[order_agg['å¹³å°æœåŠ¡è´¹'] > 0].copy()

print(f"\nå‰”é™¤å(å¹³å°æœåŠ¡è´¹>0):")
print(f"  è®¢å•æ•°: {len(filtered)}")
print(f"  åˆ©æ¶¦é¢æ€»å’Œ: {filtered['åˆ©æ¶¦é¢'].sum():.2f}")
print(f"  å¹³å°æœåŠ¡è´¹æ€»å’Œ: {filtered['å¹³å°æœåŠ¡è´¹'].sum():.2f}")
print(f"  ç‰©æµé…é€è´¹æ€»å’Œ: {filtered['ç‰©æµé…é€è´¹'].sum():.2f}")

# æ£€æŸ¥è¢«å‰”é™¤çš„è®¢å•
removed = order_agg[order_agg['å¹³å°æœåŠ¡è´¹'] == 0].copy()
print(f"\nè¢«å‰”é™¤çš„è®¢å•(å¹³å°æœåŠ¡è´¹=0):")
print(f"  è®¢å•æ•°: {len(removed)}")
print(f"  åˆ©æ¶¦é¢æ€»å’Œ: {removed['åˆ©æ¶¦é¢'].sum():.2f}")
print(f"  å¹³å°æœåŠ¡è´¹æ€»å’Œ: {removed['å¹³å°æœåŠ¡è´¹'].sum():.2f}")
print(f"  ç‰©æµé…é€è´¹æ€»å’Œ: {removed['ç‰©æµé…é€è´¹'].sum():.2f}")

# å¯¹æ¯”ä½ è¯´çš„æ•°æ®
print(f"\nğŸ¯ å¯¹æ¯”ä½ æä¾›çš„æ•°æ®:")
print(f"  ä½ è¯´å‰”é™¤å: 4,874å•")
print(f"  å®é™…å‰”é™¤å: {len(filtered)} å•")
print(f"  å·®å¼‚: {abs(4874 - len(filtered))} å•")
print(f"\n  ä½ è¯´åˆ©æ¶¦é¢: 31,176")
print(f"  å®é™…åˆ©æ¶¦é¢(å‰”é™¤å‰): {order_agg['åˆ©æ¶¦é¢'].sum():.2f}")
print(f"  å®é™…åˆ©æ¶¦é¢(å‰”é™¤å): {filtered['åˆ©æ¶¦é¢'].sum():.2f}")

# æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–è¿‡æ»¤æ¡ä»¶
print(f"\nğŸ” æ£€æŸ¥åŸå§‹æ•°æ®ä¸­çš„åˆ©æ¶¦é¢å­—æ®µ:")
print(f"  åŸå§‹æ•°æ®åˆ©æ¶¦é¢æ€»å’Œ: {mt_data['åˆ©æ¶¦é¢'].sum():.2f}")
print(f"  æ˜¯å¦æœ‰NaN: {mt_data['åˆ©æ¶¦é¢'].isna().sum()} ä¸ª")

# æŠ½æ ·æ£€æŸ¥å‡ ä¸ªè®¢å•
print(f"\nğŸ“‹ æŠ½æ ·è®¢å•(å‰5ä¸ª):")
for idx, row in order_agg.head().iterrows():
    print(f"  è®¢å•{row['è®¢å•ID']}: åˆ©æ¶¦é¢={row['åˆ©æ¶¦é¢']:.2f}, å¹³å°æœåŠ¡è´¹={row['å¹³å°æœåŠ¡è´¹']:.2f}")
