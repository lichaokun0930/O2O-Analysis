# æ¸ é“å¯¹æ¯”æ·±åº¦ä¼˜åŒ– - åœ¨çº¿å®šä»·æ¨¡æ‹Ÿå™¨æ–¹æ¡ˆ

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **åˆ›å»ºæ—¥æœŸ**: 2024-11-24
- **çŠ¶æ€**: æ–¹æ¡ˆè®¾è®¡é˜¶æ®µ
- **ä¼˜å…ˆçº§**: P1 (æ¸ é“å¯¹æ¯”ä¼˜åŒ–å®Œæˆåå®æ–½)
- **é¢„ä¼°å·¥æœŸ**: MVP 2å‘¨, V2.0 1ä¸ªæœˆ, V3.0 2ä¸ªæœˆ

---

## ğŸ¯ æ ¸å¿ƒç†å¿µ

**ä»"çœ‹æ•°æ®"åˆ°"æ”¹æ•°æ®"**: å°†çœ‹æ¿ä»è¢«åŠ¨å±•ç¤ºå·¥å…·å‡çº§ä¸ºä¸»åŠ¨å†³ç­–å·¥å…·

### ä¸šåŠ¡ä»·å€¼

1. **æå‡æ•ˆç‡**: å‘ç°é—®é¢˜ â†’ åˆ¶å®šæ–¹æ¡ˆ â†’ æ‰§è¡Œè°ƒä»·,å…¨æµç¨‹åœ¨çœ‹æ¿å†…å®Œæˆ
2. **é™ä½é£é™©**: è°ƒä»·å‰æ¨¡æ‹Ÿæ•ˆæœ,é¿å…ç›²ç›®å†³ç­–
3. **æ•°æ®é©±åŠ¨**: åŸºäºçœŸå®é”€å”®æ•°æ®å’Œä»·æ ¼å¼¹æ€§æ¨¡å‹,è€Œéæ‹è„‘è¢‹
4. **æ‰¹é‡æ“ä½œ**: ä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªå•†å“,èŠ‚çœ90%æ—¶é—´

### åŠŸèƒ½å®šä½

```
ç°æœ‰åŠŸèƒ½: æ•°æ®çœ‹æ¿ (åªè¯»)
  â””â”€ å±•ç¤ºæ¸ é“åˆ©æ¶¦ç‡ã€æˆæœ¬ç»“æ„

æ–°å¢åŠŸèƒ½: å®šä»·å·¥ä½œå° (è¯»å†™)
  â”œâ”€ è¯†åˆ«é—®é¢˜å•†å“
  â”œâ”€ æ¨¡æ‹Ÿè°ƒä»·æ•ˆæœ
  â”œâ”€ æ‰¹é‡è°ƒæ•´ä»·æ ¼
  â””â”€ å¯¼å‡º/APIæ‰§è¡Œ
```

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç”¨æˆ·ç•Œé¢å±‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚æ¸ é“å¯¹æ¯”  â”‚  â”‚é—®é¢˜è¯Šæ–­  â”‚  â”‚å®šä»·å·¥ä½œå°â”‚      â”‚
â”‚  â”‚(åªè¯»)    â”‚â†’ â”‚(åˆ†æ)    â”‚â†’ â”‚(ç¼–è¾‘)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ä¸šåŠ¡é€»è¾‘å±‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚è§„åˆ™å¼•æ“  â”‚  â”‚ä»·æ ¼å¼¹æ€§  â”‚  â”‚æ‰¹é‡è°ƒä»·  â”‚      â”‚
â”‚  â”‚(è¯Šæ–­)    â”‚  â”‚æ¨¡å‹      â”‚  â”‚å¼•æ“      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®æŒä¹…å±‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚PostgreSQLâ”‚  â”‚Redisç¼“å­˜ â”‚  â”‚æ“ä½œæ—¥å¿—  â”‚      â”‚
â”‚  â”‚(è®¢å•)    â”‚  â”‚(è°ƒä»·æ–¹æ¡ˆ)â”‚  â”‚(å®¡è®¡)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Excelå¯¼å‡º     â”‚              â”‚   ERP API       â”‚
â”‚  (äººå·¥æ‰§è¡Œ)     â”‚              â”‚  (è‡ªåŠ¨æ‰§è¡Œ)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š åŠŸèƒ½åˆ†çº§å®ç°

### ç¬¬1çº§: åŸºç¡€æ‰‹åŠ¨è°ƒä»· (MVP)

**åŠŸèƒ½æ¸…å•**:
- âœ… å¯ç¼–è¾‘è¡¨æ ¼(AG Grid)
- âœ… å®æ—¶åˆ©æ¶¦é¢„è§ˆ
- âœ… Excelå¯¼å‡ºè°ƒä»·æ–¹æ¡ˆ

**UIè®¾è®¡**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”§ å•†å“å®šä»·å·¥ä½œå°                      [ä¿å­˜/å¯¼å‡º/é‡ç½®] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚ ğŸ“‹ é—®é¢˜å•†å“åˆ—è¡¨ (å¯ç¼–è¾‘è¡¨æ ¼)                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚å•†å“  â”‚å½“å‰ä»·â”‚æ–°ä»·æ ¼â”‚æŠ˜æ‰£â”‚åˆ©æ¶¦ç‡â”‚æœˆåˆ©æ¶¦â”‚æ“ä½œâ”‚       â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚ â”‚å¯å£å¯ä¹â”‚3.5  â”‚[4.0]â”‚0% â”‚22%â†‘ â”‚+2.4K â”‚âœ“   â”‚       â”‚  â† å¯ç›´æ¥ç¼–è¾‘
â”‚ â”‚é›ªç¢§   â”‚3.2  â”‚[3.5]â”‚0% â”‚15%â†‘ â”‚+1.8K â”‚âœ“   â”‚       â”‚
â”‚ â”‚çº¢ç‰›   â”‚6.5  â”‚6.5  â”‚10%â”‚18%â†“ â”‚-0.5K â”‚âœ—   â”‚       â”‚  â† è¾“å…¥æŠ˜æ‰£%
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                         â”‚
â”‚ ğŸ’¡ è°ƒæ•´å»ºè®®é¢æ¿                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ é€‰ä¸­å•†å“: å¯å£å¯ä¹                           â”‚       â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚       â”‚
â”‚ â”‚ å½“å‰çŠ¶æ€: åˆ©æ¶¦ç‡8%, æœˆé”€Â¥10,200            â”‚       â”‚
â”‚ â”‚                                              â”‚       â”‚
â”‚ â”‚ æ™ºèƒ½æ¨èä»·æ ¼:                                â”‚       â”‚
â”‚ â”‚  â—‹ ä¿å®ˆæ–¹æ¡ˆ: Â¥3.8 (åˆ©æ¶¦ç‡15%, é¢„ä¼°-5%é”€é‡)â”‚       â”‚
â”‚ â”‚  â— æ¨èæ–¹æ¡ˆ: Â¥4.0 (åˆ©æ¶¦ç‡22%, é¢„ä¼°-10%é”€é‡)â”‚       â”‚  â† å•é€‰
â”‚ â”‚  â—‹ æ¿€è¿›æ–¹æ¡ˆ: Â¥4.5 (åˆ©æ¶¦ç‡30%, é¢„ä¼°-20%é”€é‡)â”‚       â”‚
â”‚ â”‚                                              â”‚       â”‚
â”‚ â”‚ æˆ–æ‰‹åŠ¨è¾“å…¥: [____] å…ƒ                       â”‚       â”‚
â”‚ â”‚                                              â”‚       â”‚
â”‚ â”‚ æŠ˜æ‰£è®¾ç½®: [___]% (ç•™ç©º=æ— æŠ˜æ‰£)              â”‚       â”‚
â”‚ â”‚ ç”Ÿæ•ˆæ—¥æœŸ: [2024-11-25] è‡³ [é•¿æœŸæœ‰æ•ˆ]       â”‚       â”‚
â”‚ â”‚                                              â”‚       â”‚
â”‚ â”‚ [åº”ç”¨åˆ°é€‰ä¸­å•†å“]  [åº”ç”¨åˆ°åŒç±»å•†å“]          â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                         â”‚
â”‚ ğŸ“Š è°ƒæ•´æ•ˆæœé¢„è§ˆ                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚  [å¯¹æ¯”å›¾è¡¨]                                  â”‚       â”‚
â”‚ â”‚  è°ƒæ•´å‰: æœˆåˆ©æ¶¦Â¥15,200  åˆ©æ¶¦ç‡11.2%         â”‚       â”‚
â”‚ â”‚  è°ƒæ•´å: æœˆåˆ©æ¶¦Â¥22,800  åˆ©æ¶¦ç‡18.5% â¬†ï¸      â”‚       â”‚
â”‚ â”‚  é¢„ä¼°å½±å“: é”€é‡-12%, åˆ©æ¶¦+50%               â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                         â”‚
â”‚ [ğŸ’¾ ä¿å­˜è°ƒæ•´æ–¹æ¡ˆ]  [ğŸ“¥ å¯¼å‡ºExcel]  [ğŸ”„ é‡ç½®]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯å®ç°è¦ç‚¹**:

```python
# 1. å¯ç¼–è¾‘è¡¨æ ¼
dag.AgGrid(
    id='editable-price-table',
    columnDefs=[
        {'field': 'å•†å“åç§°', 'editable': False},
        {'field': 'å½“å‰ä»·æ ¼', 'editable': False},
        {
            'field': 'æ–°ä»·æ ¼', 
            'editable': True,
            'cellEditor': 'agNumberCellEditor',
            'cellEditorParams': {'min': 0, 'max': 1000}
        },
        {
            'field': 'æŠ˜æ‰£æ¯”ä¾‹',
            'editable': True,
            'cellEditor': 'agNumberCellEditor',
            'cellEditorParams': {'min': 0, 'max': 100, 'step': 5}
        }
    ],
    rowData=problem_products,
    defaultColDef={'sortable': True, 'filter': True}
)

# 2. å®æ—¶åˆ©æ¶¦é¢„è§ˆ Callback
@app.callback(
    Output('profit-preview', 'children'),
    Input('editable-price-table', 'cellValueChanged'),
    State('editable-price-table', 'rowData')
)
def update_profit_preview(cell_changed, row_data):
    """å®æ—¶è®¡ç®—è°ƒä»·åçš„åˆ©æ¶¦é¢„è§ˆ"""
    if not cell_changed:
        return no_update
    
    row = cell_changed[0]
    new_price = row['æ–°ä»·æ ¼']
    product = row['å•†å“åç§°']
    
    # è®¡ç®—æ–°åˆ©æ¶¦ç‡
    cost = get_product_cost(product)
    new_margin = (new_price - cost) / new_price * 100
    
    # ä»·æ ¼å¼¹æ€§æ¨¡å‹
    price_change_pct = (new_price - row['å½“å‰ä»·æ ¼']) / row['å½“å‰ä»·æ ¼']
    volume_change_pct = -price_change_pct * 1.5  # å¼¹æ€§ç³»æ•°
    
    new_volume = row['å†å²æœˆé”€é‡'] * (1 + volume_change_pct)
    new_profit = (new_price - cost) * new_volume
    
    return create_profit_preview_card(new_margin, new_profit, volume_change_pct)

# 3. Excelå¯¼å‡º
def export_price_adjustments(adjustments):
    """å¯¼å‡ºè°ƒä»·æ–¹æ¡ˆåˆ°Excel"""
    output = io.BytesIO()
    with pd.ExcelWriter(output, engine='openpyxl') as writer:
        # Sheet1: è°ƒä»·æ±‡æ€»
        summary = pd.DataFrame(adjustments)
        summary.to_excel(writer, sheet_name='è°ƒä»·æ–¹æ¡ˆ', index=False)
        
        # Sheet2: æ•ˆæœé¢„ä¼°
        preview = calculate_total_impact(adjustments)
        preview.to_excel(writer, sheet_name='æ•ˆæœé¢„ä¼°', index=False)
    
    return dcc.send_bytes(output.getvalue(), 
                          filename=f"è°ƒä»·æ–¹æ¡ˆ_{datetime.now():%Y%m%d}.xlsx")
```

**æ•°æ®ç»“æ„**:

```python
# è°ƒä»·æ–¹æ¡ˆå­˜å‚¨åœ¨Redis (ä¸´æ—¶,ä¸å½±å“æºæ•°æ®)
{
    'session_id': 'user_20241124_150230',
    'adjustments': [
        {
            'å•†å“ID': '12345',
            'å•†å“åç§°': 'å¯å£å¯ä¹330ml',
            'æ¸ é“': 'ç¾å›¢å¤–å–',
            'å½“å‰ä»·æ ¼': 3.5,
            'æ–°ä»·æ ¼': 4.0,
            'æŠ˜æ‰£æ¯”ä¾‹': 0,
            'å½“å‰åˆ©æ¶¦ç‡': 8.2,
            'é¢„ä¼°åˆ©æ¶¦ç‡': 22.0,
            'é¢„ä¼°æœˆåˆ©æ¶¦å˜åŒ–': 2400,
            'é¢„ä¼°é”€é‡å˜åŒ–': -10,
            'ç”Ÿæ•ˆæ—¥æœŸ': '2024-11-25',
            'å¤±æ•ˆæ—¥æœŸ': None,
            'æ“ä½œæ—¶é—´': '2024-11-24 15:30:45',
            'æ“ä½œäºº': 'admin'
        },
        # ... æ›´å¤šå•†å“
    ],
    'total_impact': {
        'è°ƒæ•´å•†å“æ•°': 12,
        'æœˆåˆ©æ¶¦å˜åŒ–': 8500,
        'é¢„ä¼°é”€é‡å˜åŒ–': -8.5
    }
}
```

---

### ç¬¬2çº§: æ‰¹é‡æ™ºèƒ½è°ƒä»· (V2.0)

**æ–°å¢åŠŸèƒ½**:
- âœ… æŒ‰åˆ†ç±»/æ¸ é“æ‰¹é‡è°ƒä»·
- âœ… æ™ºèƒ½æ¨èç®—æ³•
- âœ… ç«å“ä»·æ ¼å¯¹æ ‡
- âœ… å®šä»·ç­–ç•¥æ¨¡æ¿

**æ‰¹é‡æ“ä½œå·¥å…·æ **:

```
ğŸ”§ æ‰¹é‡æ“ä½œå·¥å…·æ 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€‰æ‹©èŒƒå›´:                               â”‚
â”‚  â—‹ é€‰ä¸­å•†å“(3ä¸ª)                        â”‚
â”‚  â—‹ å½“å‰åˆ†ç±»(é¥®æ–™ç±», 25ä¸ª)              â”‚  â† æŒ‰åˆ†ç±»æ‰¹é‡
â”‚  â—‹ å½“å‰æ¸ é“(ç¾å›¢, 45ä¸ª)                â”‚
â”‚  â—‹ é—®é¢˜å•†å“(åˆ©æ¶¦ç‡<5%, 12ä¸ª)           â”‚
â”‚                                        â”‚
â”‚ è°ƒæ•´æ–¹å¼:                               â”‚
â”‚  â—‹ ç»Ÿä¸€æ¶¨ä»·: [+0.5]å…ƒ                  â”‚
â”‚  â—‹ æŒ‰æ¯”ä¾‹: [+10]%                      â”‚
â”‚  â—‹ ç»Ÿä¸€æŠ˜æ‰£: [85]æŠ˜                    â”‚
â”‚  â— æ™ºèƒ½å¯¹é½: å¯¹é½æœ€é«˜ä»·(Â¥4.0)         â”‚  â† AIæ¨è
â”‚                                        â”‚
â”‚ [é¢„è§ˆæ•ˆæœ]  [æ‰¹é‡åº”ç”¨]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ™ºèƒ½æ¨èç®—æ³•**:

```python
def intelligent_price_recommendation(product, historical_data):
    """
    åŸºäºå¤šå› ç´ çš„æ™ºèƒ½å®šä»·æ¨è
    
    è€ƒè™‘å› ç´ :
    1. å†å²ä»·æ ¼å¼¹æ€§ (é”€é‡å¯¹ä»·æ ¼çš„æ•æ„Ÿåº¦)
    2. ç«å“ä»·æ ¼ (åŒç±»å•†å“åœ¨å…¶ä»–æ¸ é“çš„ä»·æ ¼)
    3. åº“å­˜å‘¨è½¬ (åº“å­˜ç§¯å‹ç¨‹åº¦)
    4. å­£èŠ‚æ€§å› ç´  (èŠ‚å‡æ—¥/å‘¨æœ«)
    5. åˆ©æ¶¦ç›®æ ‡ (é—¨åº—åˆ©æ¶¦ç‡ç›®æ ‡)
    """
    
    # 1. ä»·æ ¼å¼¹æ€§åˆ†æ
    elasticity = calculate_price_elasticity(historical_data)
    
    # 2. ç«å“ä»·æ ¼
    competitor_prices = fetch_competitor_prices(product['å•†å“åç§°'])
    median_price = np.median(list(competitor_prices.values()))
    
    # 3. åº“å­˜å‹åŠ›
    inventory_days = product['åº“å­˜æ•°é‡'] / product['æ—¥å‡é”€é‡']
    inventory_pressure = 1 if inventory_days > 30 else 0.5 if inventory_days > 15 else 0
    
    # 4. åˆ©æ¶¦ç›®æ ‡
    target_margin = 0.15  # ç›®æ ‡åˆ©æ¶¦ç‡15%
    cost = product['æˆæœ¬']
    base_price = cost / (1 - target_margin)
    
    # ç»¼åˆè®¡ç®—
    if elasticity < -1.5:  # é«˜åº¦ä»·æ ¼æ•æ„Ÿ
        # ä¿å®ˆç­–ç•¥:ä¸å»ºè®®æ¶¨ä»·,å¯ä»¥é™ä»·ä¿ƒé”€
        recommended_price = min(base_price, median_price * 0.95)
    elif elasticity > -0.5:  # ä½ä»·æ ¼æ•æ„Ÿ
        # æ¿€è¿›ç­–ç•¥:å¯ä»¥æ¶¨ä»·æå‡åˆ©æ¶¦
        recommended_price = max(base_price, median_price * 1.05)
    else:
        # ä¸­æ€§ç­–ç•¥:å¯¹é½ç«å“ä»·æ ¼
        recommended_price = median_price
    
    # è€ƒè™‘åº“å­˜å‹åŠ›è°ƒæ•´
    if inventory_pressure > 0.5:
        recommended_price *= 0.9  # æ‰“æŠ˜æ¸…åº“å­˜
    
    return {
        'æ¨èä»·æ ¼': round(recommended_price, 2),
        'ç†ç”±': generate_recommendation_reason(elasticity, median_price, inventory_pressure),
        'é¢„ä¼°æ•ˆæœ': estimate_impact(product, recommended_price, elasticity)
    }

def generate_recommendation_reason(elasticity, median_price, inventory_pressure):
    """ç”Ÿæˆæ¨èç†ç”±"""
    reasons = []
    
    if elasticity < -1.5:
        reasons.append("å•†å“ä»·æ ¼æ•æ„Ÿåº¦é«˜,ä¸å»ºè®®å¤§å¹…æ¶¨ä»·")
    elif elasticity > -0.5:
        reasons.append("å•†å“ä»·æ ¼æ•æ„Ÿåº¦ä½,æœ‰æ¶¨ä»·ç©ºé—´")
    
    if median_price:
        reasons.append(f"ç«å“å‡ä»·Â¥{median_price:.2f}")
    
    if inventory_pressure > 0.5:
        reasons.append("åº“å­˜ç§¯å‹,å»ºè®®ä¿ƒé”€")
    
    return "; ".join(reasons)
```

**å®šä»·ç­–ç•¥æ¨¡æ¿**:

```python
# é¢„ç½®ç­–ç•¥æ¨¡æ¿
PRICING_STRATEGIES = {
    'æ¸…åº“å­˜ç­–ç•¥': {
        'ç­›é€‰æ¡ä»¶': lambda p: p['åº“å­˜å¤©æ•°'] > 30 or p['ä¿è´¨æœŸå‰©ä½™'] < 15,
        'è°ƒä»·è§„åˆ™': lambda p: p['å½“å‰ä»·æ ¼'] * 0.8 if p['ä¿è´¨æœŸå‰©ä½™'] < 15 else p['å½“å‰ä»·æ ¼'] * 0.9,
        'æè¿°': 'åº“å­˜>30å¤©æ‰“9æŠ˜,ä¿è´¨æœŸ<15å¤©æ‰“8æŠ˜'
    },
    
    'çˆ†æ¬¾æ‰“é€ ç­–ç•¥': {
        'ç­›é€‰æ¡ä»¶': lambda p: p['åˆ©æ¶¦ç‡'] > 25,
        'è°ƒä»·è§„åˆ™': lambda p: p['å½“å‰ä»·æ ¼'] * 0.9,
        'æè¿°': 'é«˜åˆ©æ¶¦å•†å“(>25%)é™ä»·10%å¸å¼•æµé‡'
    },
    
    'èŠ‚å‡æ—¥ç­–ç•¥': {
        'ç­›é€‰æ¡ä»¶': lambda p: p['åˆ†ç±»'] in ['ç¤¼ç›’', 'é›¶é£Ÿ', 'é…’æ°´'],
        'è°ƒä»·è§„åˆ™': lambda p: p['å½“å‰ä»·æ ¼'] * 1.15,
        'æè¿°': 'ç¤¼ç›’/é›¶é£Ÿ/é…’æ°´æ¶¨ä»·15%'
    },
    
    'åˆ©æ¶¦ä¿®å¤ç­–ç•¥': {
        'ç­›é€‰æ¡ä»¶': lambda p: p['åˆ©æ¶¦ç‡'] < 5,
        'è°ƒä»·è§„åˆ™': lambda p: p['æˆæœ¬'] / (1 - 0.10),  # è°ƒæ•´åˆ°10%åˆ©æ¶¦ç‡
        'æè¿°': 'åˆ©æ¶¦ç‡<5%å•†å“æ¶¨ä»·è‡³10%'
    },
    
    'ç«å“å¯¹æ ‡ç­–ç•¥': {
        'ç­›é€‰æ¡ä»¶': lambda p: True,  # æ‰€æœ‰å•†å“
        'è°ƒä»·è§„åˆ™': lambda p: get_competitor_median_price(p['å•†å“åç§°']) * 0.95,
        'æè¿°': 'å¯¹æ ‡ç«å“ä»·æ ¼,ä½5%å¸å¼•å®¢æˆ·'
    }
}

def apply_pricing_strategy(products, strategy_name):
    """åº”ç”¨å®šä»·ç­–ç•¥"""
    strategy = PRICING_STRATEGIES[strategy_name]
    
    # ç­›é€‰ç¬¦åˆæ¡ä»¶çš„å•†å“
    eligible_products = [p for p in products if strategy['ç­›é€‰æ¡ä»¶'](p)]
    
    # åº”ç”¨è°ƒä»·è§„åˆ™
    adjustments = []
    for p in eligible_products:
        new_price = strategy['è°ƒä»·è§„åˆ™'](p)
        adjustments.append({
            'å•†å“': p['å•†å“åç§°'],
            'å½“å‰ä»·æ ¼': p['å½“å‰ä»·æ ¼'],
            'æ–°ä»·æ ¼': new_price,
            'ç­–ç•¥': strategy_name,
            'ç†ç”±': strategy['æè¿°']
        })
    
    return adjustments
```

**ç«å“ä»·æ ¼çˆ¬å–**:

```python
import requests
from bs4 import BeautifulSoup

def fetch_competitor_prices(product_name):
    """
    çˆ¬å–ç«å“ä»·æ ¼ (ç®€åŒ–ç¤ºä¾‹)
    
    å®é™…å®ç°éœ€è¦:
    1. ä½¿ç”¨Seleniumå¤„ç†JSåŠ¨æ€åŠ è½½
    2. å¤„ç†åçˆ¬è™«æœºåˆ¶
    3. å®šæœŸæ›´æ–°ç¼“å­˜
    """
    
    # ç¤ºä¾‹:ä»ç¾å›¢/é¥¿äº†ä¹ˆ/äº¬ä¸œAPIè·å–ä»·æ ¼
    prices = {}
    
    try:
        # ç¾å›¢ä»·æ ¼ (å®é™…éœ€è¦ç™»å½•å‡­è¯)
        meituan_price = get_meituan_price(product_name)
        if meituan_price:
            prices['ç¾å›¢'] = meituan_price
        
        # é¥¿äº†ä¹ˆä»·æ ¼
        eleme_price = get_eleme_price(product_name)
        if eleme_price:
            prices['é¥¿äº†ä¹ˆ'] = eleme_price
        
        # äº¬ä¸œä»·æ ¼
        jd_price = get_jd_price(product_name)
        if jd_price:
            prices['äº¬ä¸œ'] = jd_price
    
    except Exception as e:
        print(f"ç«å“ä»·æ ¼çˆ¬å–å¤±è´¥: {e}")
    
    return prices

def get_competitor_median_price(product_name):
    """è·å–ç«å“ä¸­ä½ä»·"""
    prices = fetch_competitor_prices(product_name)
    if prices:
        return np.median(list(prices.values()))
    return None
```

---

### ç¬¬3çº§: è‡ªåŠ¨åŒ–æ‰§è¡Œ (V3.0)

**æ–°å¢åŠŸèƒ½**:
- âœ… ERPç³»ç»ŸAPIå¯¹æ¥
- âœ… å®šæ—¶æ‰§è¡Œä»»åŠ¡
- âœ… å®¡æ‰¹æµç¨‹
- âœ… A/Bæµ‹è¯•åŠŸèƒ½

**APIå¯¹æ¥é…ç½®ç•Œé¢**:

```
âš™ï¸ è‡ªåŠ¨æ‰§è¡Œé…ç½®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰§è¡Œæ–¹å¼:                               â”‚
â”‚  â—‹ æ‰‹åŠ¨å¯¼å‡ºExcelåäººå·¥è°ƒä»·             â”‚
â”‚  â— APIå¯¹æ¥è‡ªåŠ¨æ›´æ–°(æ¨è)               â”‚  â† è°ƒç”¨ERPç³»ç»ŸAPI
â”‚                                        â”‚
â”‚ APIé…ç½®:                                â”‚
â”‚  ç«¯ç‚¹: https://erp.company.com/api/priceâ”‚
â”‚  å¯†é’¥: [**********************]        â”‚
â”‚  æµ‹è¯•è¿æ¥: [âœ“ å·²è¿æ¥]                  â”‚
â”‚                                        â”‚
â”‚ æ‰§è¡Œæ—¶é—´:                               â”‚
â”‚  â—‹ ç«‹å³æ‰§è¡Œ                            â”‚
â”‚  â— å®šæ—¶æ‰§è¡Œ: æ¯æ—¥å‡Œæ™¨2ç‚¹               â”‚
â”‚  â—‹ å®¡æ‰¹åæ‰§è¡Œ(éœ€ä¸»ç®¡ç¡®è®¤)              â”‚
â”‚                                        â”‚
â”‚ å®‰å…¨è®¾ç½®:                               â”‚
â”‚  âœ“ å•æ¬¡è°ƒä»·å¹…åº¦<30%                    â”‚
â”‚  âœ“ å•æ—¥è°ƒä»·å•†å“<50ä¸ª                   â”‚
â”‚  âœ“ è°ƒä»·å‰å‘é€é€šçŸ¥                      â”‚
â”‚                                        â”‚
â”‚ [ä¿å­˜é…ç½®]  [æ‰§è¡Œè°ƒä»·]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**APIæ‰§è¡Œä»£ç **:

```python
import requests
import hmac
import hashlib

class ERPPriceAPI:
    """ERPç³»ç»Ÿä»·æ ¼æ›´æ–°APIå®¢æˆ·ç«¯"""
    
    def __init__(self, api_endpoint, api_key, api_secret):
        self.endpoint = api_endpoint
        self.api_key = api_key
        self.api_secret = api_secret
    
    def update_prices(self, adjustments, config):
        """
        è°ƒç”¨ERP APIæ›´æ–°ä»·æ ¼
        
        Args:
            adjustments: è°ƒä»·åˆ—è¡¨
            config: å®‰å…¨é…ç½®
        """
        
        # 1. å®‰å…¨æ£€æŸ¥
        self._validate_adjustments(adjustments, config)
        
        # 2. ç”Ÿæˆç­¾å
        timestamp = int(time.time())
        signature = self._generate_signature(adjustments, timestamp)
        
        # 3. è°ƒç”¨API
        response = requests.post(
            f"{self.endpoint}/v1/products/prices/batch",
            headers={
                'Authorization': f"Bearer {self.api_key}",
                'X-Signature': signature,
                'X-Timestamp': str(timestamp),
                'Content-Type': 'application/json'
            },
            json={
                'adjustments': [
                    {
                        'product_id': adj['å•†å“ID'],
                        'new_price': adj['æ–°ä»·æ ¼'],
                        'discount': adj['æŠ˜æ‰£æ¯”ä¾‹'],
                        'effective_date': adj['ç”Ÿæ•ˆæ—¥æœŸ'],
                        'expiry_date': adj['å¤±æ•ˆæ—¥æœŸ'],
                        'reason': adj['è°ƒä»·ç†ç”±']
                    }
                    for adj in adjustments
                ],
                'operator': config['user_name'],
                'timestamp': timestamp
            }
        )
        
        # 4. å¤„ç†å“åº”
        if response.status_code == 200:
            result = response.json()
            self._log_success(adjustments, result)
            return {'status': 'success', 'data': result}
        else:
            self._log_error(adjustments, response.text)
            raise Exception(f"APIè°ƒç”¨å¤±è´¥: {response.text}")
    
    def _validate_adjustments(self, adjustments, config):
        """å®‰å…¨æ ¡éªŒ"""
        # æ£€æŸ¥å•æ¬¡è°ƒä»·å¹…åº¦
        for adj in adjustments:
            price_change_pct = abs(
                (adj['æ–°ä»·æ ¼'] - adj['å½“å‰ä»·æ ¼']) / adj['å½“å‰ä»·æ ¼']
            )
            if price_change_pct > config['max_change_pct']:
                raise ValueError(
                    f"å•†å“{adj['å•†å“åç§°']}è°ƒä»·å¹…åº¦{price_change_pct:.0%}è¶…è¿‡é™åˆ¶"
                )
        
        # æ£€æŸ¥å•æ—¥è°ƒä»·å•†å“æ•°
        if len(adjustments) > config['max_daily_changes']:
            raise ValueError(
                f"å•æ—¥è°ƒä»·å•†å“æ•°{len(adjustments)}è¶…è¿‡é™åˆ¶{config['max_daily_changes']}"
            )
    
    def _generate_signature(self, data, timestamp):
        """ç”ŸæˆAPIç­¾å"""
        message = f"{self.api_key}{timestamp}{json.dumps(data)}"
        return hmac.new(
            self.api_secret.encode(),
            message.encode(),
            hashlib.sha256
        ).hexdigest()
    
    def _log_success(self, adjustments, result):
        """è®°å½•æˆåŠŸæ—¥å¿—"""
        log_entry = {
            'timestamp': datetime.now().isoformat(),
            'status': 'success',
            'adjustments_count': len(adjustments),
            'api_response': result
        }
        # å†™å…¥PostgreSQLæ“ä½œæ—¥å¿—è¡¨
        save_operation_log(log_entry)
    
    def _log_error(self, adjustments, error_msg):
        """è®°å½•å¤±è´¥æ—¥å¿—"""
        log_entry = {
            'timestamp': datetime.now().isoformat(),
            'status': 'error',
            'adjustments_count': len(adjustments),
            'error_message': error_msg
        }
        save_operation_log(log_entry)

# ä½¿ç”¨ç¤ºä¾‹
api_client = ERPPriceAPI(
    api_endpoint=os.getenv('ERP_API_ENDPOINT'),
    api_key=os.getenv('ERP_API_KEY'),
    api_secret=os.getenv('ERP_API_SECRET')
)

result = api_client.update_prices(
    adjustments=selected_adjustments,
    config={
        'max_change_pct': 0.3,  # æœ€å¤§30%
        'max_daily_changes': 50,
        'user_name': current_user
    }
)
```

**å®¡æ‰¹æµç¨‹**:

```python
class PriceApprovalWorkflow:
    """ä»·æ ¼å®¡æ‰¹å·¥ä½œæµ"""
    
    def __init__(self):
        self.approval_rules = {
            'æ™®é€šè°ƒä»·': {'threshold': 0.1, 'approver': 'åº—é•¿'},
            'å¤§å¹…è°ƒä»·': {'threshold': 0.3, 'approver': 'åŒºåŸŸç»ç†'},
            'æ‰¹é‡è°ƒä»·': {'threshold': 20, 'approver': 'è¿è¥æ€»ç›‘'}
        }
    
    def submit_for_approval(self, adjustments, submitter):
        """æäº¤å®¡æ‰¹"""
        # åˆ¤æ–­å®¡æ‰¹çº§åˆ«
        approval_level = self._determine_approval_level(adjustments)
        
        # åˆ›å»ºå®¡æ‰¹å•
        approval_id = self._create_approval_record({
            'submitter': submitter,
            'adjustments': adjustments,
            'level': approval_level,
            'approver': self.approval_rules[approval_level]['approver'],
            'status': 'pending',
            'submit_time': datetime.now()
        })
        
        # å‘é€é€šçŸ¥
        self._send_notification(approval_id, approval_level)
        
        return approval_id
    
    def _determine_approval_level(self, adjustments):
        """åˆ¤æ–­å®¡æ‰¹çº§åˆ«"""
        # æ£€æŸ¥æ˜¯å¦å¤§å¹…è°ƒä»·
        max_change = max([
            abs((adj['æ–°ä»·æ ¼'] - adj['å½“å‰ä»·æ ¼']) / adj['å½“å‰ä»·æ ¼'])
            for adj in adjustments
        ])
        
        if max_change > 0.3:
            return 'å¤§å¹…è°ƒä»·'
        elif len(adjustments) > 20:
            return 'æ‰¹é‡è°ƒä»·'
        else:
            return 'æ™®é€šè°ƒä»·'
    
    def approve(self, approval_id, approver, decision, comments):
        """å®¡æ‰¹å¤„ç†"""
        # æ›´æ–°å®¡æ‰¹çŠ¶æ€
        update_approval_status(approval_id, {
            'approver': approver,
            'decision': decision,  # 'approved' or 'rejected'
            'comments': comments,
            'approve_time': datetime.now()
        })
        
        # å¦‚æœé€šè¿‡,æ‰§è¡Œè°ƒä»·
        if decision == 'approved':
            adjustments = get_approval_adjustments(approval_id)
            execute_price_update(adjustments)
        
        # å‘é€é€šçŸ¥
        self._send_result_notification(approval_id, decision)
```

**A/Bæµ‹è¯•åŠŸèƒ½**:

```python
class PriceABTest:
    """ä»·æ ¼A/Bæµ‹è¯•"""
    
    def create_test(self, product, price_a, price_b, duration_days=7):
        """
        åˆ›å»ºA/Bæµ‹è¯•
        
        åŸç†:
        - 50%ç”¨æˆ·çœ‹åˆ°ä»·æ ¼A
        - 50%ç”¨æˆ·çœ‹åˆ°ä»·æ ¼B
        - è¿è¡ŒNå¤©åæ¯”è¾ƒæ•ˆæœ
        """
        
        test_config = {
            'test_id': generate_test_id(),
            'product': product,
            'variants': {
                'A': {'price': price_a, 'traffic': 0.5},
                'B': {'price': price_b, 'traffic': 0.5}
            },
            'start_date': datetime.now(),
            'end_date': datetime.now() + timedelta(days=duration_days),
            'metrics': ['é”€é‡', 'åˆ©æ¶¦', 'è½¬åŒ–ç‡'],
            'status': 'running'
        }
        
        save_ab_test_config(test_config)
        return test_config['test_id']
    
    def assign_variant(self, test_id, user_id):
        """ä¸ºç”¨æˆ·åˆ†é…æµ‹è¯•å˜ä½“"""
        # ä½¿ç”¨ç”¨æˆ·IDçš„å“ˆå¸Œå€¼ç¡®ä¿ç¨³å®šåˆ†ç»„
        hash_value = int(hashlib.md5(f"{test_id}_{user_id}".encode()).hexdigest(), 16)
        return 'A' if hash_value % 2 == 0 else 'B'
    
    def analyze_results(self, test_id):
        """åˆ†ææµ‹è¯•ç»“æœ"""
        test = get_ab_test_config(test_id)
        results = get_ab_test_metrics(test_id)
        
        # ç»Ÿè®¡æ˜¾è‘—æ€§æ£€éªŒ
        from scipy import stats
        
        sales_a = results['A']['é”€é‡']
        sales_b = results['B']['é”€é‡']
        
        t_stat, p_value = stats.ttest_ind(sales_a, sales_b)
        
        winner = 'A' if results['A']['åˆ©æ¶¦'] > results['B']['åˆ©æ¶¦'] else 'B'
        significant = p_value < 0.05
        
        return {
            'winner': winner,
            'significant': significant,
            'p_value': p_value,
            'recommendation': f"å»ºè®®é‡‡ç”¨æ–¹æ¡ˆ{winner}çš„ä»·æ ¼Â¥{test['variants'][winner]['price']}"
        }
```

---

## ğŸ“Š æ•°æ®æ¨¡å‹è®¾è®¡

### æ–°å¢æ•°æ®è¡¨

```sql
-- 1. è°ƒä»·æ–¹æ¡ˆè¡¨
CREATE TABLE price_adjustments (
    id SERIAL PRIMARY KEY,
    session_id VARCHAR(100) NOT NULL,  -- ä¼šè¯ID
    product_id VARCHAR(50) NOT NULL,   -- å•†å“ID
    product_name VARCHAR(200) NOT NULL,
    channel VARCHAR(50) NOT NULL,      -- æ¸ é“
    old_price DECIMAL(10,2) NOT NULL,  -- æ—§ä»·æ ¼
    new_price DECIMAL(10,2) NOT NULL,  -- æ–°ä»·æ ¼
    discount_rate DECIMAL(5,2) DEFAULT 0,  -- æŠ˜æ‰£ç‡
    old_margin DECIMAL(5,2),           -- æ—§åˆ©æ¶¦ç‡
    estimated_margin DECIMAL(5,2),     -- é¢„ä¼°åˆ©æ¶¦ç‡
    estimated_volume_change DECIMAL(5,2),  -- é¢„ä¼°é”€é‡å˜åŒ–%
    effective_date DATE,               -- ç”Ÿæ•ˆæ—¥æœŸ
    expiry_date DATE,                  -- å¤±æ•ˆæ—¥æœŸ
    reason TEXT,                       -- è°ƒä»·ç†ç”±
    status VARCHAR(20) DEFAULT 'draft',  -- draft/pending/approved/executed
    created_by VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    executed_at TIMESTAMP,
    INDEX idx_session (session_id),
    INDEX idx_product (product_id),
    INDEX idx_status (status)
);

-- 2. æ“ä½œæ—¥å¿—è¡¨
CREATE TABLE price_operation_logs (
    id SERIAL PRIMARY KEY,
    operation_type VARCHAR(50) NOT NULL,  -- create/update/execute/rollback
    adjustment_ids INTEGER[],             -- å…³è”çš„è°ƒä»·è®°å½•ID
    operator VARCHAR(50) NOT NULL,
    operation_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status VARCHAR(20) NOT NULL,          -- success/error
    error_message TEXT,
    api_response JSONB,                   -- APIå“åº”åŸå§‹æ•°æ®
    INDEX idx_operator (operator),
    INDEX idx_time (operation_time)
);

-- 3. å®¡æ‰¹è®°å½•è¡¨
CREATE TABLE price_approvals (
    id SERIAL PRIMARY KEY,
    adjustment_ids INTEGER[],
    submitter VARCHAR(50) NOT NULL,
    approval_level VARCHAR(50) NOT NULL,  -- æ™®é€š/å¤§å¹…/æ‰¹é‡
    required_approver VARCHAR(50),
    actual_approver VARCHAR(50),
    status VARCHAR(20) DEFAULT 'pending',  -- pending/approved/rejected
    submit_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    approve_time TIMESTAMP,
    comments TEXT,
    INDEX idx_status (status),
    INDEX idx_approver (required_approver)
);

-- 4. A/Bæµ‹è¯•è¡¨
CREATE TABLE price_ab_tests (
    id SERIAL PRIMARY KEY,
    test_id VARCHAR(50) UNIQUE NOT NULL,
    product_id VARCHAR(50) NOT NULL,
    variant_a_price DECIMAL(10,2) NOT NULL,
    variant_b_price DECIMAL(10,2) NOT NULL,
    traffic_split JSONB NOT NULL,  -- {"A": 0.5, "B": 0.5}
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    status VARCHAR(20) DEFAULT 'running',  -- running/completed/cancelled
    metrics JSONB,  -- æµ‹è¯•æŒ‡æ ‡ç»“æœ
    winner VARCHAR(1),  -- A/B
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_test_id (test_id),
    INDEX idx_product (product_id),
    INDEX idx_status (status)
);

-- 5. ä»·æ ¼å†å²è¡¨ (ç”¨äºè¿½æº¯)
CREATE TABLE price_history (
    id SERIAL PRIMARY KEY,
    product_id VARCHAR(50) NOT NULL,
    channel VARCHAR(50) NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    discount_rate DECIMAL(5,2) DEFAULT 0,
    effective_date DATE NOT NULL,
    expiry_date DATE,
    change_reason VARCHAR(200),
    operator VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_product_channel (product_id, channel),
    INDEX idx_date (effective_date)
);
```

---

## ğŸ”’ å®‰å…¨ä¸é£é™©æ§åˆ¶

### 1. æƒé™æ§åˆ¶

```python
# è§’è‰²æƒé™å®šä¹‰
ROLE_PERMISSIONS = {
    'åº—å‘˜': ['view'],  # åªèƒ½æŸ¥çœ‹
    'åº—é•¿': ['view', 'edit', 'export'],  # å¯ä»¥ç¼–è¾‘å’Œå¯¼å‡º
    'åŒºåŸŸç»ç†': ['view', 'edit', 'export', 'approve'],  # å¯ä»¥å®¡æ‰¹
    'è¿è¥æ€»ç›‘': ['view', 'edit', 'export', 'approve', 'execute', 'api_access']  # å…¨æƒé™
}

def check_permission(user, action):
    """æ£€æŸ¥ç”¨æˆ·æƒé™"""
    user_role = get_user_role(user)
    allowed_actions = ROLE_PERMISSIONS.get(user_role, [])
    
    if action not in allowed_actions:
        raise PermissionError(f"ç”¨æˆ·{user}({user_role})æ— {action}æƒé™")
```

### 2. æ“ä½œé™åˆ¶

```python
# å®‰å…¨é…ç½®
SAFETY_CONFIG = {
    'max_price_change_pct': 0.30,  # å•æ¬¡æœ€å¤§è°ƒä»·å¹…åº¦30%
    'max_daily_changes': 50,       # å•æ—¥æœ€å¤§è°ƒä»·å•†å“æ•°
    'min_price': 0.01,             # æœ€ä½ä»·æ ¼0.01å…ƒ
    'max_price': 10000,            # æœ€é«˜ä»·æ ¼10000å…ƒ
    'blacklist_products': [        # ç¦æ­¢è°ƒä»·çš„å•†å“
        'é¦™çƒŸ',  # ä»·æ ¼ç®¡åˆ¶
        'å¤„æ–¹è¯'
    ],
    'approval_threshold': {
        'æ™®é€š': 0.10,  # æ¶¨è·Œå¹…<10%è‡ªåŠ¨é€šè¿‡
        'å¤§å¹…': 0.30   # æ¶¨è·Œå¹…>30%éœ€æ€»ç›‘å®¡æ‰¹
    }
}
```

### 3. å›æ»šæœºåˆ¶

```python
def rollback_price_changes(adjustment_ids):
    """
    å›æ»šä»·æ ¼è°ƒæ•´
    
    åœºæ™¯:
    1. è°ƒä»·åå‘ç°é—®é¢˜,éœ€è¦ç´§æ€¥æ¢å¤
    2. A/Bæµ‹è¯•ç»“æŸ,æ¢å¤åŸä»·
    3. ä¿ƒé”€æ´»åŠ¨ç»“æŸ
    """
    
    adjustments = get_adjustments_by_ids(adjustment_ids)
    
    # åˆ›å»ºå›æ»šæ–¹æ¡ˆ
    rollback_adjustments = []
    for adj in adjustments:
        rollback_adjustments.append({
            'product_id': adj['product_id'],
            'new_price': adj['old_price'],  # æ¢å¤æ—§ä»·æ ¼
            'reason': f"å›æ»šæ“ä½œ(åŸå› :{adj['reason']})"
        })
    
    # æ‰§è¡Œå›æ»š
    api_client.update_prices(rollback_adjustments, config)
    
    # è®°å½•å›æ»šæ—¥å¿—
    log_rollback(adjustment_ids, rollback_adjustments)
```

### 4. å®¡è®¡æ—¥å¿—

```python
def audit_log_decorator(func):
    """å®¡è®¡æ—¥å¿—è£…é¥°å™¨"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        # è®°å½•æ“ä½œå‰çŠ¶æ€
        operation = {
            'function': func.__name__,
            'args': args,
            'kwargs': kwargs,
            'operator': get_current_user(),
            'timestamp': datetime.now(),
            'ip_address': get_client_ip()
        }
        
        try:
            # æ‰§è¡Œæ“ä½œ
            result = func(*args, **kwargs)
            operation['status'] = 'success'
            operation['result'] = result
            return result
        
        except Exception as e:
            operation['status'] = 'error'
            operation['error'] = str(e)
            raise
        
        finally:
            # å†™å…¥å®¡è®¡æ—¥å¿—
            save_audit_log(operation)
    
    return wrapper

@audit_log_decorator
def execute_price_update(adjustments):
    """æ‰§è¡Œä»·æ ¼æ›´æ–°(å¸¦å®¡è®¡)"""
    # ... å®é™…é€»è¾‘
    pass
```

---

## ğŸ“ˆ æ•ˆæœè¯„ä¼°

### KPIæŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰(æ‰‹å·¥) | ç›®æ ‡(è‡ªåŠ¨åŒ–) | æå‡ |
|-----|-----------|-------------|------|
| å‘ç°é—®é¢˜è€—æ—¶ | 2å°æ—¶ | 10åˆ†é’Ÿ | **92%â†“** |
| åˆ¶å®šæ–¹æ¡ˆè€—æ—¶ | 1å°æ—¶ | 5åˆ†é’Ÿ | **92%â†“** |
| æ‰§è¡Œè°ƒä»·è€—æ—¶ | 30åˆ†é’Ÿ | 1åˆ†é’Ÿ | **97%â†“** |
| è°ƒä»·å¤±è¯¯ç‡ | 15% | <2% | **87%â†“** |
| åˆ©æ¶¦ç‡æå‡ | - | 3-5pp | **æ–°å¢** |
| æœˆè°ƒä»·æ¬¡æ•° | 5æ¬¡ | 20+æ¬¡ | **4x** |

### ROIåˆ†æ

```
æˆæœ¬æŠ•å…¥:
  â€¢ å¼€å‘æˆæœ¬: 3ä¸ªæœˆ Ã— 1äºº = Â¥45,000
  â€¢ ERPå¯¹æ¥æˆæœ¬: Â¥20,000
  â€¢ è¿ç»´æˆæœ¬: Â¥3,000/æœˆ
  
æ”¶ç›Šé¢„ä¼° (å•åº—/æœˆ):
  â€¢ åˆ©æ¶¦ç‡æå‡3pp Ã— æœˆé”€å”®é¢Â¥300,000 = +Â¥9,000
  â€¢ äººå·¥èŠ‚çœ20å°æ—¶ Ã— Â¥50/å°æ—¶ = +Â¥1,000
  â€¢ æœˆæ”¶ç›Šåˆè®¡: Â¥10,000
  
å›æœ¬å‘¨æœŸ:
  â€¢ 10åº— Ã— Â¥10,000/æœˆ = Â¥100,000/æœˆ
  â€¢ æ€»æŠ•å…¥Â¥65,000 / Â¥100,000 = 0.65ä¸ªæœˆ
  
å¹´åŒ–ROI:
  â€¢ (Â¥100,000 Ã— 12 - Â¥36,000) / Â¥65,000 = 1723%
```

---

## ğŸ“… å®æ–½è·¯çº¿å›¾

### MVPç‰ˆæœ¬ (2å‘¨)

**ç›®æ ‡**: éªŒè¯æ ¸å¿ƒä»·å€¼

**äº¤ä»˜ç‰©**:
- âœ… å¯ç¼–è¾‘è¡¨æ ¼(AG Grid)
- âœ… å®æ—¶åˆ©æ¶¦é¢„è§ˆ
- âœ… Excelå¯¼å‡ºåŠŸèƒ½
- âœ… åŸºç¡€è§„åˆ™å¼•æ“(åˆ©æ¶¦ç‡/æˆæœ¬ç‡è¯Šæ–­)

**éªŒæ”¶æ ‡å‡†**:
- ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ä»·æ ¼
- ä¿®æ”¹åç«‹å³çœ‹åˆ°é¢„ä¼°æ•ˆæœ
- å¯ä»¥å¯¼å‡ºExcelè°ƒä»·æ–¹æ¡ˆ

### V2.0 (1ä¸ªæœˆ)

**ç›®æ ‡**: æå‡æ•ˆç‡å’Œæ™ºèƒ½åŒ–

**äº¤ä»˜ç‰©**:
- âœ… æ‰¹é‡è°ƒä»·å·¥å…·
- âœ… æ™ºèƒ½æ¨èç®—æ³•
- âœ… å®šä»·ç­–ç•¥æ¨¡æ¿(5ä¸ªé¢„ç½®ç­–ç•¥)
- âœ… ç«å“ä»·æ ¼å¯¹æ ‡(æ‰‹åŠ¨å½•å…¥)

**éªŒæ”¶æ ‡å‡†**:
- æ”¯æŒæŒ‰åˆ†ç±»æ‰¹é‡è°ƒä»·
- ç³»ç»Ÿèƒ½æ¨è3ä¸ªä»·æ ¼æ–¹æ¡ˆ
- å¯ä»¥ä¸€é”®åº”ç”¨é¢„ç½®ç­–ç•¥

### V3.0 (2ä¸ªæœˆ)

**ç›®æ ‡**: å…¨è‡ªåŠ¨åŒ–é—­ç¯

**äº¤ä»˜ç‰©**:
- âœ… ERP APIå¯¹æ¥
- âœ… å®šæ—¶ä»»åŠ¡è°ƒåº¦
- âœ… å®¡æ‰¹æµç¨‹å¼•æ“
- âœ… A/Bæµ‹è¯•å¹³å°
- âœ… ä»·æ ¼å†å²è¿½æº¯

**éªŒæ”¶æ ‡å‡†**:
- è°ƒä»·æ–¹æ¡ˆå¯ä»¥è‡ªåŠ¨æäº¤åˆ°ERP
- æ”¯æŒå®šæ—¶æ‰§è¡Œ(æ¯æ—¥å‡Œæ™¨)
- å¤§å¹…è°ƒä»·éœ€è¦å®¡æ‰¹
- å¯ä»¥è¿è¡ŒA/Bæµ‹è¯•å¯¹æ¯”æ•ˆæœ

---

## ğŸ¯ æˆåŠŸæ¡ˆä¾‹åœºæ™¯

### åœºæ™¯1: æ¸…ç†åº“å­˜ç§¯å‹

**èƒŒæ™¯**: å‘ç°25ä¸ªé¥®æ–™å•†å“åº“å­˜>30å¤©

**æ“ä½œæµç¨‹**:
1. æ‰“å¼€"æ¸ é“å¯¹æ¯”" â†’ "é—®é¢˜è¯Šæ–­"
2. ç­›é€‰"åº“å­˜>30å¤©"çš„å•†å“
3. åº”ç”¨"æ¸…åº“å­˜ç­–ç•¥" â†’ è‡ªåŠ¨æ‰“9æŠ˜
4. é¢„è§ˆæ•ˆæœ: é¢„ä¼°15å¤©æ¸…ç©ºåº“å­˜,æŸå¤±åˆ©æ¶¦Â¥2,000
5. å¯¼å‡ºExcel â†’ æäº¤å®¡æ‰¹ â†’ æ‰§è¡Œ

**ç»“æœ**:
- åº“å­˜12å¤©æ¸…ç©º(ä¼˜äºé¢„æœŸ)
- å®é™…æŸå¤±Â¥1,500(ä½äºé¢„æœŸ)
- é¿å…äº†è¿‡æœŸæŠ¥åºŸæŸå¤±Â¥8,000

### åœºæ™¯2: åˆ©æ¶¦ç‡ä¿®å¤

**èƒŒæ™¯**: ç¾å›¢æ¸ é“åˆ©æ¶¦ç‡6.2%,ä½äºç›®æ ‡8%

**æ“ä½œæµç¨‹**:
1. æŸ¥çœ‹"é—®é¢˜å•†å“åˆ—è¡¨" â†’ å‘ç°12ä¸ªå•†å“åˆ©æ¶¦ç‡<5%
2. ç³»ç»Ÿæ¨è:
   - å¯å£å¯ä¹: Â¥3.5 â†’ Â¥4.0 (å¯¹é½é¥¿äº†ä¹ˆä»·æ ¼)
   - é›ªç¢§: Â¥3.2 â†’ Â¥3.5
   - ...
3. æ‰¹é‡åº”ç”¨æ¨èä»·æ ¼
4. é¢„è§ˆæ•ˆæœ: åˆ©æ¶¦ç‡ 6.2% â†’ 11.5%
5. APIè‡ªåŠ¨æ›´æ–° â†’ å‡Œæ™¨2ç‚¹ç”Ÿæ•ˆ

**ç»“æœ**:
- ç¬¬äºŒå¤©åˆ©æ¶¦ç‡è¾¾åˆ°11.8%(ç¬¦åˆé¢„æœŸ)
- æœˆåˆ©æ¶¦æå‡Â¥12,500
- é”€é‡ä»…ä¸‹é™3%(è¿œä½äºé¢„ä¼°-10%)

### åœºæ™¯3: èŠ‚å‡æ—¥å®šä»·

**èƒŒæ™¯**: æ˜¥èŠ‚å‰2å‘¨,ç¤¼ç›’ç±»å•†å“éœ€æ¶¨ä»·

**æ“ä½œæµç¨‹**:
1. é€‰æ‹©"ç¤¼ç›’"åˆ†ç±»(18ä¸ªå•†å“)
2. åº”ç”¨"èŠ‚å‡æ—¥ç­–ç•¥" â†’ ç»Ÿä¸€æ¶¨ä»·15%
3. è®¾ç½®ç”Ÿæ•ˆæœŸ: 1/15-2/20
4. é¢„è§ˆæ•ˆæœ: æœˆåˆ©æ¶¦+Â¥25,000
5. å®šæ—¶æ‰§è¡Œ: 1/15å‡Œæ™¨è‡ªåŠ¨ç”Ÿæ•ˆ

**ç»“æœ**:
- æ˜¥èŠ‚æœŸé—´åˆ©æ¶¦ç‡æå‡è‡³22%
- å®é™…åˆ©æ¶¦+Â¥28,000(è¶…å‡ºé¢„æœŸ)
- èŠ‚åè‡ªåŠ¨æ¢å¤åŸä»·

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### å‰ç«¯
- Dash + dash-bootstrap-components (UIæ¡†æ¶)
- dash-ag-grid (å¯ç¼–è¾‘è¡¨æ ¼)
- Plotly (å›¾è¡¨å¯è§†åŒ–)
- JavaScript (è‡ªå®šä¹‰äº¤äº’)

### åç«¯
- Python 3.10+
- PostgreSQL 15 (æ•°æ®æŒä¹…åŒ–)
- Redis 7 (ä¸´æ—¶æ–¹æ¡ˆå­˜å‚¨)
- SQLAlchemy (ORM)

### å¤–éƒ¨é›†æˆ
- ERPç³»ç»ŸAPI (ä»·æ ¼æ›´æ–°)
- ç«å“ä»·æ ¼çˆ¬è™« (Selenium/Scrapy)
- é‚®ä»¶/çŸ­ä¿¡é€šçŸ¥ (å®¡æ‰¹æé†’)

### æœºå™¨å­¦ä¹ 
- scikit-learn (ä»·æ ¼å¼¹æ€§æ¨¡å‹)
- pandas/numpy (æ•°æ®åˆ†æ)
- scipy (ç»Ÿè®¡æ£€éªŒ)

---

## ğŸ“ å¾…è®¨è®ºé—®é¢˜

### é—®é¢˜æ¸…å•

1. **ERPç³»ç»ŸAPI**
   - Q: å…¬å¸ERPç³»ç»Ÿæ˜¯å¦æä¾›ä»·æ ¼æ›´æ–°API?
   - Q: APIè°ƒç”¨é¢‘ç‡é™åˆ¶?
   - Q: æ˜¯å¦éœ€è¦å®¡æ‰¹æµç¨‹å¯¹æ¥?

2. **ä»·æ ¼å¼¹æ€§æ¨¡å‹**
   - Q: å†å²æ•°æ®æ˜¯å¦è¶³å¤Ÿ(å»ºè®®>3ä¸ªæœˆ)?
   - Q: æ˜¯å¦éœ€è¦åˆ†å•†å“/æ¸ é“å•ç‹¬å»ºæ¨¡?

3. **ç«å“ä»·æ ¼**
   - Q: æ˜¯å¦éœ€è¦è‡ªåŠ¨çˆ¬å–?è¿˜æ˜¯æ‰‹åŠ¨ç»´æŠ¤?
   - Q: æ›´æ–°é¢‘ç‡(æ¯æ—¥/æ¯å‘¨)?

4. **æƒé™ç®¡ç†**
   - Q: ç°æœ‰ç”¨æˆ·è§’è‰²ä½“ç³»?
   - Q: å®¡æ‰¹æµç¨‹è§„åˆ™?

5. **é£é™©æ§åˆ¶**
   - Q: å•æ¬¡è°ƒä»·å¹…åº¦ä¸Šé™?
   - Q: å“ªäº›å•†å“ä¸å…è®¸è°ƒä»·?

### ä¼˜å…ˆçº§æ’åº

å¾…æ¸ é“å¯¹æ¯”ä¼˜åŒ–å®Œæˆå,æ ¹æ®å®é™…éœ€æ±‚ç¡®å®š:
- P0: å¿…é¡»æœ‰ (MVPæ ¸å¿ƒåŠŸèƒ½)
- P1: é‡è¦ (V2.0)
- P2: å¯é€‰ (V3.0)
- P3: åç»­è€ƒè™‘

---

## ğŸ“š å‚è€ƒèµ„æ–™

### ç›¸å…³æ–‡æ¡£
- `æ™ºèƒ½é—¨åº—çœ‹æ¿_Dashç‰ˆ.py` (ä¸»ç¨‹åº)
- `ã€æƒå¨ã€‘ä¸šåŠ¡é€»è¾‘ä¸æ•°æ®å­—å…¸å®Œæ•´æ‰‹å†Œ.md` (æ•°æ®æ ‡å‡†)
- `æ ¸å¿ƒæ–‡ä»¶å®Œæ•´ä¾èµ–åˆ†æ.md` (æ¶æ„)

### å¤–éƒ¨èµ„æº
- [AG Gridæ–‡æ¡£](https://www.ag-grid.com/python/getting-started/)
- [ä»·æ ¼å¼¹æ€§è®¡ç®—æ–¹æ³•](https://en.wikipedia.org/wiki/Price_elasticity_of_demand)
- [A/Bæµ‹è¯•æœ€ä½³å®è·µ](https://exp-platform.com/)

---

## ğŸ”„ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´å†…å®¹ |
|-----|------|------|---------|
| v1.0 | 2024-11-24 | AIåŠ©æ‰‹ | åˆå§‹ç‰ˆæœ¬,æ–¹æ¡ˆè®¾è®¡ |

---

**å¤‡æ³¨**: æœ¬æ–‡æ¡£ä¸ºæ–¹æ¡ˆè®¾è®¡é˜¶æ®µ,æ‰€æœ‰åŠŸèƒ½å’ŒæŠ€æœ¯ç»†èŠ‚å¾…å®æ–½æ—¶æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ã€‚
