# -*- coding: utf-8 -*-
"""
æµ‹è¯•å»é‡é€»è¾‘ä¿®å¤
éªŒè¯è®¢å•-å•†å“æ˜ç»†æ•°æ®ä¸ä¼šè¢«é”™è¯¯åˆ é™¤
"""

import pandas as pd
import numpy as np

# åˆ›å»ºæµ‹è¯•æ•°æ®ï¼šæ¨¡æ‹Ÿè®¢å•-å•†å“æ˜ç»†ç»“æ„
test_data = {
    'è®¢å•ID': [
        '2024001', '2024001', '2024001',  # è®¢å•1æœ‰3ä¸ªå•†å“
        '2024002', '2024002',              # è®¢å•2æœ‰2ä¸ªå•†å“
        '2024003',                          # è®¢å•3æœ‰1ä¸ªå•†å“
        '2024004', '2024004', '2024004', '2024004',  # è®¢å•4æœ‰4ä¸ªå•†å“
        '2024001', '2024001', '2024001',  # é‡å¤ï¼šè®¢å•1çš„3ä¸ªå•†å“å†æ¬¡å‡ºç°ï¼ˆå®Œå…¨é‡å¤ï¼‰
    ],
    'å•†å“åç§°': [
        'å¯å£å¯ä¹', 'è–¯ç‰‡', 'çŸ¿æ³‰æ°´',
        'ç‰›å¥¶', 'é¢åŒ…',
        'é¥¼å¹²',
        'å•¤é…’', 'èŠ±ç”Ÿ', 'ç“œå­', 'ç«è…¿è‚ ',
        'å¯å£å¯ä¹', 'è–¯ç‰‡', 'çŸ¿æ³‰æ°´',  # å®Œå…¨é‡å¤è¡Œ
    ],
    'æ•°é‡': [
        2, 1, 3,
        2, 1,
        5,
        6, 2, 3, 1,
        2, 1, 3,  # å®Œå…¨é‡å¤è¡Œ
    ],
    'å•ä»·': [
        3.5, 8.0, 2.0,
        12.0, 5.0,
        6.0,
        4.5, 8.0, 5.0, 6.0,
        3.5, 8.0, 2.0,  # å®Œå…¨é‡å¤è¡Œ
    ],
    'é‡‘é¢': [
        7.0, 8.0, 6.0,
        24.0, 5.0,
        30.0,
        27.0, 16.0, 15.0, 6.0,
        7.0, 8.0, 6.0,  # å®Œå…¨é‡å¤è¡Œ
    ]
}

df = pd.DataFrame(test_data)

print("=" * 80)
print("ğŸ“Š æµ‹è¯•æ•°æ®æ¦‚è§ˆ")
print("=" * 80)
print(df)
print()

print("=" * 80)
print("ğŸ” æ•°æ®ç»Ÿè®¡")
print("=" * 80)
print(f"æ€»æ•°æ®è¡Œæ•°: {len(df)}")
print(f"å”¯ä¸€è®¢å•æ•°: {df['è®¢å•ID'].nunique()}")
print(f"å¹³å‡æ¯å•å•†å“æ•°: {len(df) / df['è®¢å•ID'].nunique():.2f}")
print()

print("=" * 80)
print("âŒ é”™è¯¯çš„å»é‡æ–¹å¼ï¼šæŒ‰è®¢å•IDå»é‡ï¼ˆä¼šä¸¢å¤±å•†å“æ˜ç»†ï¼‰")
print("=" * 80)
df_wrong = df.drop_duplicates(subset=['è®¢å•ID'], keep='first')
print(f"å»é‡å‰: {len(df)} è¡Œ")
print(f"å»é‡å: {len(df_wrong)} è¡Œ")
print(f"ä¸¢å¤±æ•°æ®: {len(df) - len(df_wrong)} è¡Œ ({(len(df) - len(df_wrong)) / len(df) * 100:.1f}%)")
print()
print("âŒ ç»“æœæ•°æ®ï¼ˆä¸¢å¤±äº†å¤§é‡å•†å“ï¼‰ï¼š")
print(df_wrong)
print()

print("=" * 80)
print("âœ… æ­£ç¡®çš„å»é‡æ–¹å¼ï¼šåªåˆ é™¤å®Œå…¨é‡å¤çš„è¡Œ")
print("=" * 80)
df_correct = df.drop_duplicates(keep='first')
print(f"å»é‡å‰: {len(df)} è¡Œ")
print(f"å»é‡å: {len(df_correct)} è¡Œ")
print(f"åˆ é™¤è¡Œæ•°: {len(df) - len(df_correct)} è¡Œï¼ˆå®Œå…¨é‡å¤çš„æ•°æ®ï¼‰")
print()
print("âœ… ç»“æœæ•°æ®ï¼ˆä¿ç•™äº†æ‰€æœ‰ä¸é‡å¤çš„å•†å“æ˜ç»†ï¼‰ï¼š")
print(df_correct)
print()

print("=" * 80)
print("ğŸ“Š æ­£ç¡®ç»“æœç»Ÿè®¡")
print("=" * 80)
print(f"æ€»å•†å“æ˜ç»†æ•°: {len(df_correct)}")
print(f"å”¯ä¸€è®¢å•æ•°: {df_correct['è®¢å•ID'].nunique()}")
print(f"å¹³å‡æ¯å•å•†å“æ•°: {len(df_correct) / df_correct['è®¢å•ID'].nunique():.2f}")
print()

# æŒ‰è®¢å•åˆ†ç»„ç»Ÿè®¡
print("=" * 80)
print("ğŸ“¦ å„è®¢å•çš„å•†å“æ•°é‡")
print("=" * 80)
order_counts = df_correct.groupby('è®¢å•ID').size()
for order_id, count in order_counts.items():
    items = df_correct[df_correct['è®¢å•ID'] == order_id]['å•†å“åç§°'].tolist()
    print(f"{order_id}: {count}ä¸ªå•†å“ - {', '.join(items)}")
print()

print("=" * 80)
print("âœ… ç»“è®º")
print("=" * 80)
print("1. é”™è¯¯æ–¹å¼ï¼šæŒ‰è®¢å•IDå»é‡ä¼šå¯¼è‡´æ¯ä¸ªè®¢å•åªä¿ç•™1ä¸ªå•†å“")
print(f"   ä¸¢å¤±ç‡: {(len(df) - len(df_wrong)) / len(df) * 100:.1f}%")
print()
print("2. æ­£ç¡®æ–¹å¼ï¼šåªåˆ é™¤æ‰€æœ‰å­—æ®µå®Œå…¨ç›¸åŒçš„è¡Œ")
print(f"   ä¿ç•™ç‡: {len(df_correct) / len(df) * 100:.1f}%")
print(f"   åˆ é™¤çš„æ˜¯çœŸæ­£çš„é‡å¤æ•°æ®: {len(df) - len(df_correct)} è¡Œ")
print()
print("3. æ‚¨çš„å®é™…æ•°æ®: 24,936è¡Œ â†’ 6,297è¡Œ")
print("   å¦‚æœç”¨é”™è¯¯æ–¹å¼ï¼Œæ„å‘³ç€:")
print(f"   - å”¯ä¸€è®¢å•æ•°: 6,297")
print(f"   - åŸå§‹å¹³å‡æ¯å•å•†å“æ•°: {24936 / 6297:.2f}")
print(f"   - ç”¨é”™è¯¯æ–¹å¼å: æ¯å•åªå‰©1ä¸ªå•†å“ï¼ˆä¸¢å¤±äº†{(24936 - 6297) / 24936 * 100:.1f}%çš„å•†å“ï¼‰")
print()
print("ğŸ’¡ å»ºè®®ï¼šç«‹å³é‡æ–°ä¸Šä¼ æ•°æ®ï¼Œä½¿ç”¨æ­£ç¡®çš„å»é‡é€»è¾‘ï¼")
print("=" * 80)
