# 🚀 全栈项目快速启动指南

## 📋 前置要求

✅ Python 3.8+  
✅ PostgreSQL 已安装  
✅ 依赖包已安装（见下方）

---

## 🔧 第一步：配置数据库

### 方式1：使用自动化脚本（推荐）

```powershell
# 运行数据库配置脚本
.\setup_database.ps1
```

脚本会自动：
- 检查PostgreSQL服务状态
- 创建数据库 `o2o_dashboard`
- 生成 `.env` 配置文件

### 方式2：手动配置

```powershell
# 1. 连接PostgreSQL
psql -U postgres

# 2. 创建数据库
CREATE DATABASE o2o_dashboard;

# 3. 退出
\q

# 4. 复制配置文件
Copy-Item .env.example .env

# 5. 编辑.env文件，修改数据库密码
# DATABASE_URL=postgresql://postgres:你的密码@localhost:5432/o2o_dashboard
```

---

## 📦 第二步：安装依赖

```powershell
# 安装后端依赖
pip install fastapi uvicorn sqlalchemy psycopg2-binary python-dotenv

# 安装前端依赖
pip install dash plotly pandas openpyxl

# 或一次性安装所有依赖
pip install -r requirements.txt
```

---

## 🗄️ 第三步：初始化数据库表并导入数据

```powershell
# 创建数据表并导入Excel数据
python database/migrate.py

# 如果需要重新导入（清空后重新导入）
python database/migrate.py --force
```

**注意**：首次运行会：
1. 创建所有数据表（订单、商品、场景标签等）
2. 从Excel导入数据到数据库
3. 执行智能场景打标
4. 大约需要 1-3 分钟（取决于数据量）

---

## 🎯 第四步：启动服务

### 方式1：使用一键启动脚本（推荐）

```powershell
.\启动全栈服务.ps1
```

选择启动模式：
- **选项1**: 仅启动后端API (端口8000)
- **选项2**: 仅启动前端看板 (端口8050)
- **选项3**: 同时启动前后端（推荐）

### 方式2：分别启动

**后端API:**
```powershell
python backend/main.py
```
访问：http://localhost:8000/api/docs

**前端看板:**
```powershell
python 智能门店看板_Dash版.py
```
访问：http://localhost:8050

---

## 🧪 第五步：测试验证

### 1. 测试后端API

访问 Swagger 文档：
```
http://localhost:8000/api/docs
```

测试健康检查：
```powershell
curl http://localhost:8000/api/health
```

预期返回：
```json
{
  "status": "healthy",
  "database": "connected",
  "stats": {
    "products": 1234,
    "orders": 17450
  }
}
```

### 2. 测试前端看板

访问：
```
http://localhost:8050
```

检查以下功能：
- ✅ Tab1: 订单概览 - 显示订单统计
- ✅ Tab2: 商品分析 - 显示商品分布
- ✅ Tab4: 问题诊断 - 可以执行诊断
- ✅ Tab5: 场景分析 - 显示场景数据

---

## 📝 配置文件说明

### .env 配置示例

```bash
# 数据库配置
DATABASE_URL=postgresql://postgres:你的密码@localhost:5432/o2o_dashboard

# API配置
API_HOST=0.0.0.0
API_PORT=8000

# 应用配置
DEBUG=True
HOST=0.0.0.0
PORT=8050

# 安全配置
SECRET_KEY=dev-secret-key-change-in-production
```

---

## 🐛 常见问题

### 问题1: 数据库连接失败

**错误信息**: `could not connect to server`

**解决方案**:
```powershell
# 检查PostgreSQL服务
Get-Service postgresql*

# 如果未运行，启动服务
Start-Service postgresql-x64-XX  # XX是版本号
```

### 问题2: 端口被占用

**错误信息**: `Address already in use`

**解决方案**:
```powershell
# 查找占用端口的进程
netstat -ano | findstr :8000  # 或 :8050

# 结束进程
taskkill /PID <进程ID> /F
```

### 问题3: 导入数据失败

**错误信息**: `File not found`

**解决方案**:
```powershell
# 检查数据文件路径
ls "实际数据/*.xlsx"

# 如果文件名不同，指定正确的文件
python database/migrate.py --file "实际数据/你的文件名.xlsx"
```

### 问题4: 缺少依赖包

**错误信息**: `ModuleNotFoundError`

**解决方案**:
```powershell
# 安装缺失的包
pip install <缺失的包名>

# 或重新安装所有依赖
pip install -r requirements.txt --upgrade
```

---

## 🔄 日常使用流程

### 更新数据

```powershell
# 1. 将新的Excel文件放到"实际数据"目录
# 2. 重新导入数据
python database/migrate.py --file "实际数据/新文件.xlsx" --force

# 3. 重启服务
.\启动全栈服务.ps1
```

### 查看日志

```powershell
# 后端日志
type 看板错误日志.txt

# 前端日志
type 看板启动日志.txt
```

### 停止服务

```powershell
# Ctrl+C 停止当前运行的服务

# 或使用脚本强制停止
.\停止看板.bat
```

---

## 📊 数据库管理

### 连接数据库

```powershell
# 使用psql
psql -U postgres -d o2o_dashboard

# 常用SQL命令
\dt                    # 查看所有表
\d orders             # 查看订单表结构
SELECT COUNT(*) FROM orders;  # 统计订单数量
```

### 备份数据库

```powershell
# 备份
pg_dump -U postgres -d o2o_dashboard -f backup_$(Get-Date -Format 'yyyyMMdd').sql

# 恢复
psql -U postgres -d o2o_dashboard -f backup_20250104.sql
```

---

## 🌐 下一步：云端部署

完成本地测试后，可以部署到云平台：

1. **Railway** (推荐新手)
   - 自动配置数据库
   - 支持GitHub自动部署
   - 免费额度充足

2. **Render**
   - 免费PostgreSQL数据库
   - 支持Web服务
   - 配置简单

3. **阿里云/腾讯云**
   - 适合生产环境
   - 需要手动配置
   - 更灵活强大

详见：`云端看板部署与管理手册.md`

---

## 📚 更多文档

- `README_Dash版使用指南.md` - 看板功能详解
- `业务逻辑核心知识库.md` - 业务逻辑说明
- `API_KEY_配置指南.md` - AI功能配置
- `部署指南_PostgreSQL.md` - 数据库部署详解

---

## 💬 需要帮助？

如有问题，请检查：
1. 看板错误日志.txt
2. 数据库连接配置
3. Python版本（需要3.8+）
4. 依赖包版本

---

**祝你使用愉快！🎉**
