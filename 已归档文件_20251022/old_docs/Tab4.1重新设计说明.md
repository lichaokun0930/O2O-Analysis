![1760798125439](image/Tab4.1重新设计说明/1760798125439.png)# Tab 4.1 销量下滑诊断 - 重新设计说明

## 📋 设计变更概述

**变更日期**: 2025-10-18  
**变更原因**: 原有设计中"基础参数的对比周期"和"自定义周期对比"功能重叠冗余，逻辑混乱

---

## 🎯 新设计方案

### 1️⃣ 基础参数 → 数据查看参数

**功能定位**: 控制看板展示数据的粒度和维度

#### 📊 数据维度选择器
- **全部数据（商品级明细）**: 展示所有符合条件的商品，不做时间聚合
- **按日聚合**: 按日期汇总数据，查看每日趋势
- **按周聚合**: 按周汇总数据，查看每周变化
- **按月聚合**: 按月汇总数据，查看月度趋势

#### 📉 下滑阈值
- 范围: -80% 到 -5%
- 默认值: -20%
- 作用: 只显示下滑幅度超过此阈值的数据
- 实时显示: 滑块下方显示当前选择的阈值

### 2️⃣ 自定义周期对比功能 - 暂时搁置

**状态**: ⏸️ 已隐藏（代码中已注释）

**原因**: 
- 与基础参数功能重叠
- 逻辑复杂，容易混淆
- 需要先优化基础看板

**后续计划**: 等基础数据看板完全优化好后，再重新设计此功能

---

## 🔄 功能变更对比

| 项目 | 原设计 | 新设计 |
|-----|--------|--------|
| **基础参数名称** | ⚙️ 基础参数 | ⚙️ 数据查看参数 |
| **对比周期** | 按日对比/按周对比/按月对比 | 全部数据/按日聚合/按周聚合/按月聚合 |
| **功能定位** | 用于对比计算 | 控制数据展示粒度 |
| **周期对比卡片** | ✅ 显示 | ⏸️ 隐藏 |
| **默认值** | week | all |

---

## 📊 新的数据流程

### 用户操作流程
```
1. 选择数据维度（全部/日/周/月）
   ↓
2. 设置下滑阈值（-80% ~ -5%）
   ↓
3. 选择场景/时段筛选（可选）
   ↓
4. 点击"开始诊断"
   ↓
5. 看板展示对应维度的下滑数据
```

### 数据处理逻辑
```python
if time_period == 'all':
    # 模式1: 商品级明细
    - 显示所有符合条件的商品
    - 不做时间聚合
    - 适合查看具体哪些商品下滑
    
else:  # day, week, month
    # 模式2: 时间聚合
    - 按选定维度聚合数据
    - 显示该维度的下滑趋势
    - 适合查看整体变化规律
```

---

## 🎨 UI变更

### 基础参数卡片

#### 修改前
```
⚙️ 基础参数
├─ 对比周期: 按日对比/按周对比/按月对比
└─ 下滑阈值: -20%
```

#### 修改后
```
⚙️ 数据查看参数 - 选择看板展示的数据粒度
├─ 数据维度: 📋 全部数据（商品级明细）/ 📅 按日聚合 / 📆 按周聚合 / 📊 按月聚合
│  └─ 提示: 选择不同维度会影响图表的展示粒度和统计方式
└─ 下滑阈值: -20%
   └─ 当前阈值: -20% (实时显示)
```

### 周期对比卡片
```
❌ 已隐藏（代码注释）
📅 自定义周期对比
├─ 对比周期: 上周同期/上月同期...
└─ 当前周期: 最近7天/最近14天...
```

---

## 💻 代码修改

### 修改的文件
- `智能门店看板_Dash版.py`

### 修改的组件
1. **基础参数卡片** (约 607-650 行)
   - 改名为"数据查看参数"
   - 添加详细说明文本
   - 增加"全部数据"选项
   - 添加实时阈值显示

2. **周期对比卡片** (约 712-748 行)
   - 整个卡片被注释
   - 添加搁置说明

3. **回调函数** (约 2430-2490 行)
   - 移除 `compare-period-selector` 参数
   - 移除 `current-period-selector` 参数
   - 简化为只接收 `time_period` 和 `threshold`
   - 添加"全部数据"模式处理逻辑

4. **新增回调** (约 2422-2428 行)
   - 添加阈值实时显示回调
   - 输入: `threshold-slider` 的值
   - 输出: `threshold-display` 的文本

---

## ✅ 优势分析

### 新设计的优点

1. **逻辑清晰**
   - 功能定位明确：数据查看 vs 周期对比
   - 不再混淆"查看维度"和"对比周期"

2. **用户友好**
   - "全部数据"选项更直观
   - 实时显示当前选择的阈值
   - 详细的提示文本

3. **易于扩展**
   - 为后续添加"自定义周期对比"预留空间
   - 代码结构更清晰

4. **降低复杂度**
   - 减少参数数量（7个 → 5个）
   - 减少用户决策成本

---

## 🔮 后续优化计划

### Phase 1: 基础看板优化（当前）
- ✅ 重新设计基础参数
- ✅ 隐藏周期对比功能
- ⏳ 优化图表展示逻辑
- ⏳ 完善数据聚合算法
- ⏳ 添加更多筛选维度

### Phase 2: 周期对比功能（未来）
- 重新设计交互方式
- 支持任意周期选择
- 可视化对比结果
- 导出对比报告

---

## 📝 使用指南

### 场景1: 查看所有下滑商品
```
数据维度: 📋 全部数据（商品级明细）
下滑阈值: -20%
→ 结果: 显示所有下滑超过20%的商品明细
```

### 场景2: 查看每周下滑趋势
```
数据维度: 📆 按周聚合
下滑阈值: -10%
→ 结果: 显示每周聚合后下滑超过10%的数据
```

### 场景3: 分析特定时段
```
数据维度: 📅 按日聚合
筛选时段: 午餐(10-14点)
下滑阈值: -15%
→ 结果: 显示午餐时段每日下滑超过15%的数据
```

---

## 🐛 已知问题

暂无

---

## 📞 反馈与建议

如有任何问题或建议，请及时反馈！

---

**文档版本**: v1.0  
**最后更新**: 2025-10-18 22:30
