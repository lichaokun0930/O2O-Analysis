# 🧪 修复后测试指南

## 快速测试步骤

### 1️⃣ 基础功能测试（必做）

#### ✅ 启动应用
```powershell
# 方式1：直接运行
python -u "智能门店看板_Dash版.py"

# 方式2：使用启动脚本
.\启动看板_新.ps1
```

**预期结果：**
```
✅ ECharts 可用，将使用 ECharts 图表
📊 数据量: 17450 行
Dash is running on http://0.0.0.0:8050/
```

**检查点：**
- [ ] 无报错信息
- [ ] 端口8050成功监听
- [ ] 日志正常输出到控制台

---

#### ✅ 访问首页
打开浏览器访问：http://localhost:8050

**检查点：**
- [ ] 页面正常加载
- [ ] 无乱码显示
- [ ] 按钮文本为 "🔍 开始诊断" (而非 "� 开始诊断")
- [ ] 下拉框选项正常显示

---

#### ✅ Tab 4 诊断功能测试

1. **点击 Tab 4 - "📋 问题诊断"**
   - [ ] Tab切换无报错
   - [ ] 筛选条件正常显示

2. **调整诊断参数**
   - 时间周期：选择 "📆 周度对比"
   - 下滑阈值：调整到 -5%
   
3. **点击"🔍 开始诊断"按钮**
   
**预期结果：**
- [ ] 页面短暂加载
- [ ] 表格显示诊断数据
- [ ] 统计卡片显示数字
- [ ] **所有图表正常显示**（重点！）

---

### 2️⃣ Plotly降级兼容性测试（关键修复）

#### 测试目的
验证没有 dash-echarts 时也能正常工作

#### 测试步骤

**步骤1：卸载 ECharts**
```powershell
pip uninstall dash-echarts -y
```

**步骤2：重启应用**
```powershell
python -u "智能门店看板_Dash版.py"
```

**预期输出：**
```
⚠️ ECharts 不可用，将使用 Plotly 图表: No module named 'dash_echarts'
```

**步骤3：访问应用并测试**

打开 http://localhost:8050，进入 Tab 4，点击"开始诊断"

**检查点（核心）：**
- [ ] ❌ 图表区域**不显示** "[object Object]"
- [ ] ✅ 图表区域**正常显示** Plotly 图表
- [ ] ✅ 分时段分布图 - 显示柱状图
- [ ] ✅ 分场景分布图 - 显示饼图
- [ ] ✅ 收入损失TOP10 - 显示瀑布图或柱状图

**步骤4：恢复 ECharts（可选）**
```powershell
pip install dash-echarts
```

---

### 3️⃣ 日志系统测试

#### 检查日志文件

**步骤1：打开日志文件**
```powershell
Get-Content callback_debug.log -Tail 20
```

**预期输出：**
```
2025-10-20 14:08:45,027 - __main__ - INFO - [update_table] data_length=156
2025-10-20 14:08:45,123 - __main__ - INFO - [update_slot_distribution_chart] data_length=156
```

**检查点：**
- [ ] 日志格式统一（带时间戳）
- [ ] 包含模块名和日志级别
- [ ] 无文件锁定错误

**步骤2：实时查看日志**
```powershell
Get-Content callback_debug.log -Wait
```

然后在浏览器中操作，观察日志实时输出

**检查点：**
- [ ] 日志即时更新
- [ ] 回调触发有记录
- [ ] 无乱码

---

### 4️⃣ 界面文案检查

#### 检查位置清单

| 位置 | 检查内容 | 预期 |
|------|---------|------|
| Tab 4 顶部 | 按钮文本 | "🔍 开始诊断" |
| Tab 2 | 卡片标题 | "💰 利润率详细分析" |
| Tab 2 | 统计卡片 | "💵 总销售额" |
| Tab 2 筛选器 | 下拉选项 | "💵 实际利润" "📈 利润率" |

**检查点：**
- [ ] 所有位置无 "�" 乱码
- [ ] emoji 正常显示
- [ ] 文本完整

---

### 5️⃣ 性能测试（可选）

#### 多次点击测试

1. 连续点击"开始诊断"按钮 **5 次**
2. 观察响应时间

**检查点：**
- [ ] 每次响应时间 < 2秒
- [ ] 无内存泄漏（任务管理器查看Python进程内存）
- [ ] 日志文件大小合理（< 10MB）

---

### 6️⃣ 错误场景测试

#### 测试1：空数据
1. 清空筛选条件
2. 将阈值设置为 -100%
3. 点击"开始诊断"

**预期：**
- [ ] 显示友好提示："未找到符合条件的商品"
- [ ] 图表区域显示空态提示
- [ ] 无JavaScript控制台报错

#### 测试2：无效日期
1. 选择 "📆 日度对比"
2. 不选择日期
3. 点击"开始诊断"

**预期：**
- [ ] 显示警告："请选择日期范围"
- [ ] 不触发诊断
- [ ] 无报错

---

## 测试通过标准

### ✅ 基础通过
- 应用正常启动
- 所有Tab页面能切换
- 无乱码显示
- 日志正常输出

### ✅ 核心通过（关键）
- **Plotly降级模式下所有图表正常显示**
- 无 "[object Object]" 错误
- 图表交互功能正常

### ✅ 稳定性通过
- 连续操作无崩溃
- 内存占用稳定
- 日志文件无IO错误

---

## 问题反馈模板

如发现问题，请按以下格式反馈：

```markdown
### 问题描述
[简述问题]

### 复现步骤
1. 打开页面
2. 点击XXX
3. 观察到XXX

### 预期行为
[应该怎样]

### 实际行为
[实际怎样]

### 环境信息
- Python版本：
- 是否安装dash-echarts：
- 浏览器：
- 截图：[如有]
```

---

## 快速命令参考

```powershell
# 启动应用
python -u "智能门店看板_Dash版.py"

# 验证修复质量
python "验证修复质量.py"

# 查看实时日志
Get-Content callback_debug.log -Wait

# 检查端口占用
netstat -ano | findstr :8050

# 停止应用
Get-Process python | Stop-Process -Force

# 卸载ECharts（测试降级）
pip uninstall dash-echarts -y

# 重装ECharts
pip install dash-echarts
```

---

## 测试完成确认

完成所有测试后，请在此打勾：

- [ ] 1️⃣ 基础功能测试
- [ ] 2️⃣ Plotly降级兼容性测试
- [ ] 3️⃣ 日志系统测试
- [ ] 4️⃣ 界面文案检查
- [ ] 5️⃣ 性能测试（可选）
- [ ] 6️⃣ 错误场景测试

**测试人员：** _______________  
**测试日期：** _______________  
**测试结果：** ⭕ 通过 / ❌ 失败  
**备注：** _______________

---

祝测试顺利！🎉
