"""
演示新的下滑商品表格结构

改进前: 所有信息挤在一个单元格
【饮料】可口可乐(¥4.0 之前¥3.5) → 💰涨价导致销量降

改进后: 每个信息独立成列
商品名称 | 分类 | 当前单价 | 之前单价 | 单价变化 | 销量变化 | 下滑原因
可口可乐 | 饮料 | ¥4.0    | ¥3.5    | ¥+0.5   | -20件   | 💰涨价导致销量降
"""

import pandas as pd

# 模拟新的数据结构
demo_data = {
    '对比周期': ['09-29 vs 09-30'],
    '之前客单价': ['¥25.7'],
    '当前客单价': ['¥22.8'],
    '客单价变化': ['¥-2.9'],
    '变化幅度%': ['-11.5%'],
    
    # TOP1商品
    'TOP1-商品名称': ['可口可乐'],
    'TOP1-分类': ['饮料'],
    'TOP1-当前单价': ['¥4.0'],
    'TOP1-之前单价': ['¥3.5'],
    'TOP1-单价变化': ['¥+0.5'],
    'TOP1-销量变化': ['-20件'],
    'TOP1-下滑原因': ['💰涨价导致销量降'],
    
    # TOP2商品
    'TOP2-商品名称': ['薯片'],
    'TOP2-分类': ['零食'],
    'TOP2-当前单价': [''],
    'TOP2-之前单价': ['¥5.2'],
    'TOP2-单价变化': [''],
    'TOP2-销量变化': ['-50件'],
    'TOP2-下滑原因': ['🔴售罄'],
    
    # TOP3商品
    'TOP3-商品名称': ['洗发水'],
    'TOP3-分类': ['日用'],
    'TOP3-当前单价': ['¥12.0'],
    'TOP3-之前单价': ['¥15.0'],
    'TOP3-单价变化': ['¥-3.0'],
    'TOP3-销量变化': ['-15件'],
    'TOP3-下滑原因': ['💸降价仍降量'],
    
    # TOP4商品
    'TOP4-商品名称': ['红牛'],
    'TOP4-分类': ['饮料'],
    'TOP4-当前单价': ['¥6.5'],
    'TOP4-之前单价': ['¥6.5'],
    'TOP4-单价变化': [''],
    'TOP4-销量变化': ['-40件'],
    'TOP4-下滑原因': ['📉销量大幅下滑'],
    
    # TOP5商品
    'TOP5-商品名称': ['巧克力'],
    'TOP5-分类': ['零食'],
    'TOP5-当前单价': ['¥8.5'],
    'TOP5-之前单价': ['¥8.5'],
    'TOP5-单价变化': [''],
    'TOP5-销量变化': ['-10件'],
    'TOP5-下滑原因': ['📉销量小幅下滑'],
    
    '商品角色分布': ['引流:120单 | 利润:80单 | 走量:50单'],
    '问题等级': ['🔴 严重'],
    '建议操作': ['优化引流商品定价策略']
}

df = pd.DataFrame(demo_data)

print("=" * 120)
print("【新的下滑商品表格结构演示】")
print("=" * 120)
print()
print("✅ 改进优势:")
print("  1. 商品名称独立成列 - 便于搜索和筛选")
print("  2. 价格信息独立成列 - 便于排序和对比")
print("  3. 变化量独立成列 - 一目了然")
print("  4. 下滑原因独立成列 - 便于分类统计")
print()
print("=" * 120)
print("【完整数据预览】")
print("=" * 120)
print()

# 显示客单价信息
print("📊 客单价概览:")
print(f"  对比周期: {df['对比周期'].iloc[0]}")
print(f"  之前客单价: {df['之前客单价'].iloc[0]}")
print(f"  当前客单价: {df['当前客单价'].iloc[0]}")
print(f"  客单价变化: {df['客单价变化'].iloc[0]} ({df['变化幅度%'].iloc[0]})")
print(f"  问题等级: {df['问题等级'].iloc[0]}")
print()

# 显示TOP商品表格
print("🏆 下滑TOP商品详情:")
print()

# 构建TOP商品表格
top_products = []
for i in range(1, 6):
    if df[f'TOP{i}-商品名称'].iloc[0]:
        top_products.append({
            'TOP': f'TOP{i}',
            '商品名称': df[f'TOP{i}-商品名称'].iloc[0],
            '分类': df[f'TOP{i}-分类'].iloc[0],
            '当前单价': df[f'TOP{i}-当前单价'].iloc[0],
            '之前单价': df[f'TOP{i}-之前单价'].iloc[0],
            '单价变化': df[f'TOP{i}-单价变化'].iloc[0],
            '销量变化': df[f'TOP{i}-销量变化'].iloc[0],
            '下滑原因': df[f'TOP{i}-下滑原因'].iloc[0]
        })

top_df = pd.DataFrame(top_products)
print(top_df.to_string(index=False))
print()

print("=" * 120)
print("【运营建议】")
print("=" * 120)
print()

for i, row in top_df.iterrows():
    print(f"{row['TOP']}: {row['商品名称']} ({row['分类']})")
    print(f"  └─ 原因: {row['下滑原因']}")
    
    # 根据原因给出建议
    if '🔴售罄' in row['下滑原因']:
        print(f"  └─ 建议: ⚡立即补货,避免销售机会流失")
    elif '💰涨价' in row['下滑原因']:
        print(f"  └─ 建议: 🔧调整定价策略,考虑恢复原价或进行促销")
    elif '💸降价' in row['下滑原因']:
        print(f"  └─ 建议: 🔍分析竞品压力,可能需要加强营销推广")
    elif '📉销量大幅下滑' in row['下滑原因']:
        print(f"  └─ 建议: ⚠️检查商品质量、陈列位置、营销力度")
    elif '📉销量小幅下滑' in row['下滑原因']:
        print(f"  └─ 建议: 👀持续观察,暂无需干预")
    print()

print("=" * 120)
print("✅ 新结构的优势:")
print("  1. 数据清晰 - 每列一个维度,便于理解")
print("  2. 易于筛选 - 可按原因、分类、价格变化等维度筛选")
print("  3. 便于分析 - 独立的数值列便于统计分析")
print("  4. 可操作性 - 每个原因都对应明确的行动建议")
print("=" * 120)
