# ğŸ”´ ç´§æ€¥é—®é¢˜åˆ†æï¼šæ—¥å†é€‰æ‹©å™¨æ— æ³•æ˜¾ç¤º

## ğŸ“‹ é—®é¢˜æè¿°

**ç—‡çŠ¶**:
1. é€‰æ‹©"ğŸ“… æ—¥åº¦å¯¹æ¯”"åï¼Œç•Œé¢**ä»ç„¶æ˜¾ç¤ºä¸‹æ‹‰æ¡†**ï¼ˆ10æœˆ18æ—¥ Saturdayç­‰ï¼‰
2. ç»ˆç«¯**å®Œå…¨æ²¡æœ‰å›è°ƒæ—¥å¿—**ï¼ˆæ²¡æœ‰ `ğŸ”„ [toggle_period_selector_style]` è¾“å‡ºï¼‰
3. å¼ºåˆ¶åˆ·æ–°é¡µé¢ï¼ˆCtrl+Shift+Rï¼‰åé—®é¢˜ä¾æ—§

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### åŸå› 1ï¼šå›è°ƒæœªè¢«è§¦å‘ âŒ

**é—®é¢˜**: `prevent_initial_call=False` ä¸ä¿è¯é¡µé¢åŠ è½½æ—¶è§¦å‘

**è§£é‡Š**:
```python
@app.callback(
    Output('current-period-container', 'children'),
    Input('time-period-selector', 'value'),
    prevent_initial_call=False  # â† åªæ˜¯"å…è®¸"åˆå§‹è°ƒç”¨ï¼Œä¸æ˜¯"å¼ºåˆ¶"
)
```

Dash çš„ `prevent_initial_call=False` çš„å«ä¹‰æ˜¯ï¼š
- âœ… "å¦‚æœè¾“å…¥å€¼æ”¹å˜äº†ï¼Œå…è®¸åœ¨é¡µé¢åŠ è½½æ—¶è§¦å‘"
- âŒ **ä¸æ˜¯** "é¡µé¢åŠ è½½æ—¶å¿…å®šè§¦å‘"

**å®é™…æƒ…å†µ**:
- é¡µé¢åŠ è½½æ—¶ `time-period-selector` çš„å€¼ = `'week'`
- å®¹å™¨åˆå§‹å†…å®¹ä¹Ÿæ˜¯ä¸º `'week'` è®¾è®¡çš„ä¸‹æ‹‰æ¡†
- Dash è®¤ä¸º"å€¼æ²¡æœ‰å˜åŒ–"ï¼Œ**ä¸è§¦å‘å›è°ƒ**

---

### åŸå› 2ï¼šå®¹å™¨åˆå§‹å†…å®¹åŒ¹é…é»˜è®¤å€¼ âŒ

**åˆå§‹HTML**ï¼ˆä¿®å¤å‰ï¼‰:
```python
html.Div(id='current-period-container', children=[
    html.Label("ğŸ“… å½“å‰å‘¨æœŸ"),
    dcc.Dropdown(  # â† ä¸‹æ‹‰æ¡†ï¼ˆé€‚åˆ week æ¨¡å¼ï¼‰
        id='current-period-selector',
        ...
    )
])
```

**`time-period-selector` é»˜è®¤å€¼**: `'week'`

**ç»“æœ**: Dash è®¤ä¸ºä¸éœ€è¦æ›´æ–°å®¹å™¨ï¼ˆå› ä¸ºå†…å®¹å·²ç»æ˜¯å‘¨æ¨¡å¼çš„ä¸‹æ‹‰æ¡†ï¼‰

---

## âœ… æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šç®€åŒ–åˆå§‹å®¹å™¨ï¼ˆå·²å®æ–½ï¼‰

**ä¿®æ”¹**:
```python
html.Div(id='current-period-container', children=[
    html.Div([
        html.Label("ğŸ“… å½“å‰å‘¨æœŸ"),
        html.P("åŠ è½½ä¸­...")  # â† å ä½ç¬¦ï¼Œå¼ºåˆ¶å›è°ƒå¡«å……çœŸå®å†…å®¹
    ])
])
```

**é¢„æœŸæ•ˆæœ**:
- é¡µé¢åŠ è½½æ—¶ï¼Œå®¹å™¨æ˜¯"åŠ è½½ä¸­..."å ä½ç¬¦
- Dash æ£€æµ‹åˆ°éœ€è¦ç”¨çœŸå®å†…å®¹æ›¿æ¢
- è§¦å‘ `toggle_period_selector_style` å›è°ƒ

**é—®é¢˜**: ä»ç„¶å¯èƒ½ä¸è§¦å‘ï¼ˆå–å†³äº Dash ç‰ˆæœ¬å’Œé…ç½®ï¼‰

---

### æ–¹æ¡ˆBï¼šä½¿ç”¨ clientside callbackï¼ˆæ¨èï¼‰

**åŸç†**: åœ¨æµè§ˆå™¨ç«¯å¼ºåˆ¶è§¦å‘ä¸€æ¬¡å€¼å˜åŒ–

```python
app.clientside_callback(
    """
    function(n_intervals) {
        // é¡µé¢åŠ è½½å1ç§’ï¼Œè§¦å‘ä¸€æ¬¡ä¸‹æ‹‰æ¡†å˜åŒ–
        if (n_intervals === 1) {
            var elem = document.getElementById('time-period-selector');
            if (elem) {
                var event = new Event('change', { bubbles: true });
                elem.dispatchEvent(event);
            }
        }
        return dash_clientside.no_update;
    }
    """,
    Output('dummy-output', 'children'),
    Input('interval-component', 'n_intervals')
)
```

---

### æ–¹æ¡ˆCï¼šæ·»åŠ éšè—çš„è§¦å‘æŒ‰é’®ï¼ˆæœ€å¯é ï¼‰

**å®ç°**:

1. æ·»åŠ éšè—çš„ Store ç»„ä»¶ï¼š
```python
dcc.Store(id='init-trigger', data={'loaded': False})
```

2. ä¿®æ”¹å›è°ƒï¼Œæ·»åŠ  Store ä½œä¸ºé¢å¤–è¾“å…¥ï¼š
```python
@app.callback(
    [Output('current-period-container', 'children'),
     Output('compare-period-container', 'children'),
     Output('init-trigger', 'data')],  # â† æ–°å¢
    [Input('time-period-selector', 'value'),
     Input('init-trigger', 'data')],  # â† æ–°å¢
    prevent_initial_call=False
)
def toggle_period_selector_style(time_period, init_data):
    # é¦–æ¬¡åŠ è½½æ—¶å¼ºåˆ¶åˆå§‹åŒ–
    if init_data and not init_data.get('loaded'):
        print("ğŸ”„ [é¦–æ¬¡åŠ è½½] å¼ºåˆ¶åˆå§‹åŒ–é€‰æ‹©å™¨")
        init_data = {'loaded': True}
    
    ... # åŸæœ‰é€»è¾‘
    
    return current_selector, compare_selector, init_data
```

---

### æ–¹æ¡ˆDï¼šç›´æ¥ä¿®æ”¹é»˜è®¤å€¼ä¸º `'day'`ï¼ˆæœ€ç®€å•ï¼Œç«‹å³ç”Ÿæ•ˆï¼‰

**åŸç†**: è®©é»˜è®¤å°±æ˜¾ç¤ºæ—¥å†é€‰æ‹©å™¨

```python
dcc.Dropdown(
    id='time-period-selector',
    options=[...],
    value='day',  # â† æ”¹ä¸º day
    ...
)
```

**æ•ˆæœ**:
- é¡µé¢åŠ è½½æ—¶å°±æ˜¯æ—¥åº¦å¯¹æ¯”æ¨¡å¼
- å›è°ƒè§¦å‘ï¼Œæ˜¾ç¤ºæ—¥å†é€‰æ‹©å™¨
- ç”¨æˆ·å¯ä»¥åˆ‡æ¢å›å‘¨åº¦/æœˆåº¦

---

## ğŸš€ ç«‹å³å¯ç”¨çš„ä¿®å¤ä»£ç 

### ä¿®å¤1ï¼šæ·»åŠ é¡µé¢åŠ è½½è§¦å‘å™¨

**æ–‡ä»¶**: `æ™ºèƒ½é—¨åº—çœ‹æ¿_Dashç‰ˆ.py`

**åœ¨ Tab-4 çš„å‚æ•°å¡ç‰‡å‰æ·»åŠ **:
```python
# æ·»åŠ åˆ°ç¬¬896è¡Œå·¦å³ï¼ŒTab-4-1 å¼€å§‹å¤„
dcc.Interval(
    id='init-interval',
    interval=500,  # 500æ¯«ç§’åè§¦å‘
    n_intervals=0,
    max_intervals=1  # åªè§¦å‘ä¸€æ¬¡
),
```

**ä¿®æ”¹å›è°ƒ**ï¼ˆç¬¬2877è¡Œï¼‰:
```python
@app.callback(
    [Output('current-period-container', 'children'),
     Output('compare-period-container', 'children')],
    [Input('time-period-selector', 'value'),
     Input('init-interval', 'n_intervals')],  # â† æ–°å¢
    prevent_initial_call=False
)
def toggle_period_selector_style(time_period, n_intervals):
    print(f"ğŸ”„ [toggle_period_selector_style] time_period={time_period}, n_intervals={n_intervals}")
    
    if time_period == 'day':
        ...
```

---

### ä¿®å¤2ï¼šæ”¹å˜é»˜è®¤å€¼ï¼ˆæœ€å¿«é€Ÿï¼‰

**æ–‡ä»¶**: `æ™ºèƒ½é—¨åº—çœ‹æ¿_Dashç‰ˆ.py` ç¬¬922è¡Œ

**ä¿®æ”¹å‰**:
```python
value='week',
```

**ä¿®æ”¹å**:
```python
value='day',  # é»˜è®¤æ˜¾ç¤ºæ—¥å†é€‰æ‹©å™¨
```

---

### ä¿®å¤3ï¼šä½¿ç”¨ JavaScript å¼ºåˆ¶è§¦å‘ï¼ˆæœ€å¯é ï¼‰

**åœ¨ `app.index_string` çš„ `</body>` å‰æ·»åŠ **:
```html
<script>
document.addEventListener('DOMContentLoaded', function() {
    // é¡µé¢åŠ è½½å®Œæˆåï¼Œå¼ºåˆ¶è§¦å‘ä¸€æ¬¡é€‰æ‹©å™¨æ›´æ–°
    setTimeout(function() {
        var selector = document.getElementById('time-period-selector');
        if (selector) {
            var event = new Event('change', { bubbles: true });
            selector.dispatchEvent(event);
            console.log('ğŸ”„ å¼ºåˆ¶è§¦å‘å‘¨æœŸé€‰æ‹©å™¨å›è°ƒ');
        }
    }, 1000);
});
</script>
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•åº”ç”¨

å·²åˆ›å»º `æµ‹è¯•æ—¥å†é€‰æ‹©å™¨.py`ï¼š
```bash
python æµ‹è¯•æ—¥å†é€‰æ‹©å™¨.py
# è®¿é—®: http://127.0.0.1:8051
```

**æµ‹è¯•æ­¥éª¤**:
1. æ‰“å¼€æµ‹è¯•åº”ç”¨
2. æŸ¥çœ‹ç»ˆç«¯æ˜¯å¦æœ‰ `ğŸ”„ å›è°ƒè§¦å‘ï¼` æ—¥å¿—
3. åˆ‡æ¢ä¸‹æ‹‰æ¡†ï¼Œè§‚å¯Ÿç•Œé¢å˜åŒ–
4. éªŒè¯æ—¥å†é€‰æ‹©å™¨æ˜¯å¦æ­£å¸¸æ˜¾ç¤º

---

## ğŸ“Š é—®é¢˜ä¼˜å…ˆçº§

| æ–¹æ¡ˆ | éš¾åº¦ | å¯é æ€§ | æ¨èåº¦ |
|------|------|--------|--------|
| æ–¹æ¡ˆDï¼šæ”¹é»˜è®¤å€¼ | â­ | â­â­â­â­â­ | ğŸ¥‡ **ç«‹å³ä½¿ç”¨** |
| æ–¹æ¡ˆCï¼šè§¦å‘æŒ‰é’® | â­â­ | â­â­â­â­ | ğŸ¥ˆ æ¨è |
| æ–¹æ¡ˆBï¼šclientside | â­â­â­ | â­â­â­ | ğŸ¥‰ å¤‡é€‰ |
| æ–¹æ¡ˆAï¼šç©ºå®¹å™¨ | â­ | â­â­ | âŒ å·²å¤±æ•ˆ |

---

## ğŸ¯ æ¨èè¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œï¼ˆ1åˆ†é’Ÿï¼‰

**æ–¹æ¡ˆD** - æ”¹å˜é»˜è®¤å€¼ä¸º `'day'`:

1. æ‰“å¼€ `æ™ºèƒ½é—¨åº—çœ‹æ¿_Dashç‰ˆ.py`
2. æ‰¾åˆ°ç¬¬922è¡Œ `value='week'`
3. æ”¹ä¸º `value='day'`
4. ä¿å­˜å¹¶é‡å¯åº”ç”¨
5. åˆ·æ–°æµè§ˆå™¨

**é¢„æœŸæ•ˆæœ**:
- âœ… é¡µé¢åŠ è½½æ—¶é»˜è®¤æ˜¾ç¤ºæ—¥å†é€‰æ‹©å™¨
- âœ… ç»ˆç«¯æ˜¾ç¤ºå›è°ƒæ—¥å¿—
- âœ… å¯ä»¥æ­£å¸¸é€‰æ‹©æ—¥æœŸèŒƒå›´
- âœ… å¯ä»¥åˆ‡æ¢å›å‘¨åº¦/æœˆåº¦æ¨¡å¼

---

### å¦‚æœæ–¹æ¡ˆDä¸å¤Ÿç”¨ï¼ˆ10åˆ†é’Ÿï¼‰

**æ–¹æ¡ˆC** - æ·»åŠ å¼ºåˆ¶è§¦å‘ï¼š

è¯¦è§ä¸Šæ–‡"ä¿®å¤1ï¼šæ·»åŠ é¡µé¢åŠ è½½è§¦å‘å™¨"

---

## ğŸ› è°ƒè¯•æ¸…å•

å¦‚æœä¿®æ”¹åä»æœ‰é—®é¢˜ï¼Œè¯·æä¾›ï¼š

- [ ] æµè§ˆå™¨æ§åˆ¶å°æˆªå›¾ï¼ˆF12 â†’ Consoleï¼‰
- [ ] ç»ˆç«¯å®Œæ•´è¾“å‡ºï¼ˆä»å¯åŠ¨åˆ°é—®é¢˜å‡ºç°ï¼‰
- [ ] ç•Œé¢æˆªå›¾ï¼ˆå½“å‰æ˜¾ç¤ºå†…å®¹ï¼‰
- [ ] æ“ä½œæ­¥éª¤ï¼ˆç‚¹å‡»äº†ä»€ä¹ˆï¼‰
- [ ] æµè§ˆå™¨å’Œç‰ˆæœ¬ï¼ˆChrome 120?ï¼‰
- [ ] Dash ç‰ˆæœ¬ï¼ˆ`pip show dash`ï¼‰

---

## ğŸ“ æŠ€æœ¯å¤‡æ³¨

### ä¸ºä»€ä¹ˆ `prevent_initial_call=False` ä¸èµ·ä½œç”¨ï¼Ÿ

Dash çš„å›è°ƒè§¦å‘é€»è¾‘ï¼š
1. é¡µé¢åŠ è½½æ—¶ï¼Œæ‰€æœ‰è¾“å…¥ç»„ä»¶çš„å€¼è¢«è®¾ç½®
2. å¦‚æœ `prevent_initial_call=True`ï¼Œè·³è¿‡åˆå§‹è§¦å‘
3. å¦‚æœ `prevent_initial_call=False` ä¸”**å€¼ç¡®å®æ”¹å˜äº†**ï¼Œè§¦å‘å›è°ƒ
4. å…³é”®ï¼šDash ä¼šæ¯”è¾ƒ"æ—§å€¼"å’Œ"æ–°å€¼"

**é—®é¢˜**:
- åˆå§‹å®¹å™¨å·²ç»æœ‰ Dropdownï¼ˆä¸‹æ‹‰æ¡†ï¼‰
- é»˜è®¤å€¼æ˜¯ `'week'`ï¼ˆå‘¨æ¨¡å¼ï¼‰
- ä¸‹æ‹‰æ¡†é€‚åˆå‘¨æ¨¡å¼
- Dash è®¤ä¸º**æ²¡æœ‰å¿…è¦æ›´æ–°**

### ä¸ºä»€ä¹ˆæ”¹é»˜è®¤å€¼ä¸º `'day'` å°±èƒ½è§£å†³ï¼Ÿ

- é»˜è®¤å€¼ `'day'` â‰  å®¹å™¨åˆå§‹å†…å®¹ï¼ˆå ä½ç¬¦æˆ–ä¸‹æ‹‰æ¡†ï¼‰
- Dash æ£€æµ‹åˆ°"éœ€è¦æ›´æ–°"
- è§¦å‘ `toggle_period_selector_style` å›è°ƒ
- è¿”å› `DatePickerRange`ï¼ˆæ—¥å†é€‰æ‹©å™¨ï¼‰
- ç”¨æˆ·çœ‹åˆ°æ—¥å† âœ…

---

**æœ€åæ›´æ–°**: 2025-10-19
**ç´§æ€¥ç¨‹åº¦**: ğŸ”´ é«˜
**å»ºè®®æ–¹æ¡ˆ**: æ–¹æ¡ˆDï¼ˆæ”¹é»˜è®¤å€¼ä¸º `'day'`ï¼‰

ç«‹å³æ‰§è¡Œä¿®å¤ï¼Œ1åˆ†é’Ÿè§£å†³é—®é¢˜ï¼
