# 营销成本分析功能说明文档

## 📋 功能概述

新增第6个Tab页"💰 营销分析"，帮助门店识别营销成本异常的商品、分析营销活动效率、优化营销ROI。

## 🎯 核心价值

### 1. 从"看到问题"到"定位问题商品"
- **之前**: 渠道表现中看到营销成本结构
- **现在**: 明确知道哪些商品营销成本过高、是什么活动导致的

### 2. 数据驱动的营销决策
- **异常识别**: 自动标记营销占比>50%或ROI<1.0的商品
- **活动效率**: 对比8类营销活动的投入产出比
- **优化建议**: 基于数据生成可执行的优化策略

## 📊 功能模块

### 模块1: 异常商品识别 🚨

**功能**:
- 识别营销成本异常的商品
- 支持按异常级别筛选 (全部/高危/严重)
- 可调节营销占比阈值 (20%-100%)

**异常判定规则**:
1. **营销占比过高**: 营销总成本/实收金额 > 50%
2. **ROI过低**: 营销ROI < 1.0 (投入1元利润增长<1元)
3. **成本超利润**: 营销总成本 > 利润额 (亏本营销)

**输出**:
- 异常商品列表 (TOP 20)
- 每个商品的异常类型、异常级别
- 销售数量、实收金额、利润额、营销成本、营销占比、营销ROI

**案例**:
```
商品: 伊利 原味优酸乳 250ml/盒
异常类型: 营销占比过高;ROI过低;营销成本超利润
异常级别: 7
销量: 129
实收金额: ¥302.20
利润额: ¥36.13
营销成本: ¥1,196.96  ← 营销占比396.1%!
营销ROI: 0.03  ← 投入1元只赚0.03元

成本构成:
  配送补贴: ¥526.00 (43.9%)
  商品折扣: ¥457.76 (38.2%)
  代金券: ¥144.20 (12.0%)
  满减活动: ¥69.00 (5.8%)
```

### 模块2: 营销活动效率 📈

**功能**:
- 统计8类营销活动的使用情况
- 对比各活动的成本占比和ROI
- 识别低效营销活动

**分析的营销活动**:
1. **配送补贴** (配送费减免金额) - 使用率88.1%, 成本占比44.9%
2. **商品折扣** (商品减免金额) - 使用率61.2%, 成本占比25.2%
3. **代金券** (商家代金券) - 使用率42.6%, 成本占比21.8%
4. **满减活动** (满减金额) - 使用率16.0%, 成本占比7.0%
5. **平台券** (商家承担部分券) - 使用率1.8%, 成本占比1.1%
6. **新客立减** (新客减免金额) - 使用率0.1%, 成本占比0.0%
7. **满赠活动** (满赠金额) - 数据中未使用
8. **其他优惠** (商家其他优惠) - 数据中未使用

**输出指标**:
- 使用次数 / 使用率
- 总成本 / 平均单次成本 / 最高单次成本
- 带来销售额 / 带来利润
- 成本占比 / 平均ROI

**可视化**:
1. **饼图**: 营销活动成本分布
2. **柱状图**: 各活动ROI对比 (含盈亏平衡线 ROI=1.0)

### 模块3: 营销成本TOP商品 💎

**功能**:
- 展示营销成本最高的20个商品
- 气泡图可视化营销效率
- 识别每个商品的主要营销方式

**气泡图设计**:
- **X轴**: 销售数量
- **Y轴**: 营销占比 (%)
- **气泡大小**: 营销总成本
- **气泡颜色**: 营销ROI (红色=低ROI, 绿色=高ROI)
- **参考线**: Y=50%异常阈值线

**典型场景识别**:
- **左上角**: 销量低+营销占比高 → 营销无效商品
- **右上角**: 销量高+营销占比高 → 引流商品(需控制总量)
- **右下角**: 销量高+营销占比低 → 优质商品(扩大推广)
- **左下角**: 销量低+营销占比低 → 观察期商品

### 模块4: 优化建议 💡

**基于数据自动生成3类建议**:

1. **针对异常商品**:
   - 降低配送补贴或设置免配送费门槛
   - 减少商品折扣,改为满减/赠品
   - 评估是否为引流商品,控制总量
   - 对比竞品定价,适当提高售价

2. **针对低ROI活动**:
   - 设置使用门槛 (如满减改为满80减10)
   - 精准投放给高价值客户
   - A/B测试不同优惠力度
   - 限制单个用户使用次数

3. **针对配送补贴** (通常是最大成本项):
   - 设置免配送费门槛 (如满39元免配送费)
   - 对近距离订单降低补贴
   - 高峰时段适当降低补贴
   - 引导用户自提或到店消费

## 🔧 技术实现

### 核心文件
1. **营销异常分析器.py** - 数据分析引擎
2. **智能门店看板_Dash版.py** - UI集成 (Tab 6)

### 关键类和方法

#### MarketingAnomalyAnalyzer
```python
class MarketingAnomalyAnalyzer:
    """营销成本异常分析器"""
    
    def identify_anomalies(ratio_threshold=0.5, roi_threshold=1.0)
        """识别营销异常商品"""
        # 规则1: 营销占比 > threshold
        # 规则2: 营销ROI < threshold
        # 规则3: 营销成本 > 利润
        
    def analyze_marketing_activities()
        """分析各类营销活动效果"""
        # 统计8类活动的使用率、成本、ROI
        
    def get_top_marketing_products(n=20)
        """获取营销成本TOP N商品"""
        # 按营销总成本排序
        # 识别主要营销方式
```

### 计算公式

**营销总成本**:
```python
营销总成本 = (
    配送费减免金额 +
    满减金额 +
    商品减免金额 +
    商家代金券 +
    商家承担部分券 +
    新客减免金额 +
    满赠金额 +
    商家其他优惠
)
```

**营销占比**:
```python
营销占比 = 营销总成本 / 实收金额
```

**营销ROI**:
```python
营销ROI = 利润额 / 营销总成本

解释:
- ROI < 0: 亏损
- ROI < 1: 不划算 (投入1元,利润增长<1元)
- ROI >= 1: 有效 (投入1元,利润增长≥1元)
- ROI >= 1.5: 优秀
```

## 📈 使用场景

### 场景1: 周度营销复盘
1. 打开"营销分析"Tab
2. 查看异常商品数量 (指标卡片)
3. 点击"异常商品识别"查看详情
4. 找出营销占比>50%的商品
5. 分析成本构成,调整下周营销策略

### 场景2: 新品上架营销评估
1. 上传包含新品的数据
2. 查看"营销成本TOP商品"
3. 观察新品在气泡图中的位置
4. 如果在左上角(低销量高成本),及时调整
5. 如果在右下角(高销量低成本),加大推广

### 场景3: 营销活动优化
1. 点击"营销活动效率"
2. 查看ROI柱状图
3. 识别ROI<1.0的活动
4. 阅读"优化建议"Tab的具体策略
5. 执行优化 (如设置使用门槛、精准投放)

### 场景4: 月度营销预算规划
1. 查看"营销活动效率"的成本占比
2. 配送补贴占比44.9% → 下月重点优化
3. 满减活动ROI=0.80 → 调整为满80减10
4. 新客立减使用率仅0.1% → 加大新客拉新力度

## 📊 数据洞察案例

### 共橙超市-南通海安店 实际数据分析

**营销成本总览**:
- 营销总成本: ¥150,677.49
- 占销售额比例: 35-40%
- 异常商品数: 3,186个 (占比很高!)
- 平均营销ROI: 约1.2

**营销活动排名**:
1. **配送补贴**: ¥67,694 (44.9%) - ROI=1.24 ✅
2. **商品折扣**: ¥37,989 (25.2%) - ROI=1.25 ✅
3. **代金券**: ¥32,833 (21.8%) - ROI=1.27 ✅
4. **满减活动**: ¥10,517 (7.0%) - ROI=0.80 ❌
5. **平台券**: ¥1,596 (1.1%) - ROI=1.51 ✅
6. **新客立减**: ¥50 (0.0%) - ROI=0.59 ❌

**关键发现**:
1. **满减活动ROI<1.0**: 投入1元只赚0.80元,建议提高使用门槛
2. **新客立减使用率极低**: 仅0.1%,但ROI也低,需重新设计
3. **配送补贴成本最高**: 占45%,是优化重点
4. **异常商品占比过高**: 3,186/总商品数,说明营销策略需要全面优化

**优化优先级**:
1. **高优先级**: 优化配送补贴策略 (设置满39免配送费)
2. **中优先级**: 调整满减规则 (改为满80减10)
3. **持续监控**: 异常商品的营销成本变化
4. **长期目标**: 提升整体营销ROI至1.5以上

## 🎯 预期效果

实施优化后,预计可实现:
- **营销成本降低**: 15-20%
- **营销ROI提升**: 从1.2提升至1.5+
- **异常商品数减少**: 从3,186降至<1,000
- **整体利润率提升**: 2-3个百分点

## 📝 后续扩展方向

1. **环比分析**: 添加营销成本的环比变化趋势
2. **商品分类分析**: 按一级分类统计营销效率
3. **渠道差异**: 对比美团/饿了么/京东的营销策略
4. **时段优化**: 分析不同时段的营销效率
5. **客户分群**: 新客/老客的营销ROI对比
6. **AI建议**: 接入AI生成个性化营销方案

## 🔄 使用流程

```
1. 启动看板
   ↓
2. 加载数据 (数据库/上传Excel)
   ↓
3. 点击"💰 营销分析"Tab
   ↓
4. 查看4个指标卡片 (总成本/异常数/ROI/活动数)
   ↓
5. 切换子Tab查看详细分析:
   - 🚨 异常商品识别 → 找出问题商品
   - 📈 营销活动效率 → 对比活动ROI
   - 💎 营销成本TOP → 气泡图定位
   - 💡 优化建议 → 获取执行策略
   ↓
6. 基于建议优化营销策略
   ↓
7. 下周复查数据验证效果
```

---

## 💡 快速开始

```bash
# 1. 启动看板
python 智能门店看板_Dash版.py

# 2. 浏览器访问
http://localhost:8050

# 3. 加载数据
# 方式1: 从数据库加载
# 方式2: 上传Excel文件

# 4. 点击"💰 营销分析"Tab
# 查看营销成本分析结果
```

## ❓ 常见问题

**Q: 为什么我的营销ROI显示N/A?**
A: 该商品的营销总成本为0,无法计算ROI。

**Q: 异常级别怎么判定?**
A: 异常级别 = 命中规则数 × 权重
- 营销占比过高: +2分
- ROI过低: +2分
- 成本超利润: +3分
- 最高7分 (命中全部3条规则)

**Q: 气泡图中气泡大小代表什么?**
A: 气泡大小 = 营销总成本 / 10 (等比例缩放,便于展示)

**Q: 如何导出异常商品列表?**
A: 目前暂不支持导出,可截图或手动记录。后续版本将添加导出功能。

---

**文档版本**: v1.0  
**创建日期**: 2025-01-14  
**作者**: GitHub Copilot  
**最后更新**: 2025-01-14
