"""
æµ‹è¯•å¯è§†åŒ–å›¾è¡¨ä¿®å¤
éªŒè¯ä¸‰ä¸ªé—®é¢˜çš„ä¿®å¤æƒ…å†µ
"""

import pandas as pd
import numpy as np

print("ğŸ” æµ‹è¯•å¯è§†åŒ–å›¾è¡¨ä¿®å¤\n")
print("=" * 60)

# æ¨¡æ‹Ÿæµ‹è¯•æ•°æ®
test_data = pd.DataFrame({
    'å•†å“åç§°': [f'å•†å“{i}' for i in range(1, 11)],
    'å˜åŒ–å¹…åº¦%': [-80, -60, -45, -35, -25, -20, -15, -10, -5, -2],
    'ç¬¬38å‘¨é”€é‡': [10, 15, 20, 25, 30, 35, 40, 45, 50, 55],
    'ç¬¬39å‘¨é”€é‡': [2, 6, 11, 16, 22, 28, 34, 40, 47, 53],
    'é”€é‡å˜åŒ–': [-8, -9, -9, -9, -8, -7, -6, -5, -3, -2]
})

print("æµ‹è¯•æ•°æ®:")
print(test_data)

# æµ‹è¯•1: ä¸‹æ»‘æœ€ä¸¥é‡TOP10çš„æ ‡é¢˜
print("\n\n" + "=" * 60)
print("æµ‹è¯•1: ä¸‹æ»‘æœ€ä¸¥é‡TOP10æ ‡é¢˜ä¿®å¤")
print("=" * 60)

top10_decline = test_data.nsmallest(10, 'å˜åŒ–å¹…åº¦%')
print(f"\nåŸæ ‡é¢˜: 'å˜åŒ–å¹…åº¦æœ€ä½çš„10ä¸ªå•†å“'")
print(f"æ–°æ ‡é¢˜: 'ä¸‹æ»‘å¹…åº¦æœ€å¤§çš„10ä¸ªå•†å“'")
print(f"\nâœ… æ ‡é¢˜æ›´å‡†ç¡®ï¼š")
print(f"  - 'æœ€ä½'å®¹æ˜“è¯¯è§£ä¸º'ä¸‹æ»‘æœ€å°‘'")
print(f"  - 'æœ€å¤§'æ˜ç¡®è¡¨ç¤º'ä¸‹æ»‘æœ€ä¸¥é‡'")

# æµ‹è¯•2: å‘¨æœŸå¯¹æ¯”å›¾çš„å›¾ä¾‹
print("\n\n" + "=" * 60)
print("æµ‹è¯•2: å‘¨æœŸé”€é‡å¯¹æ¯”å›¾ä¾‹ä¿®å¤")
print("=" * 60)

current_sales_col = 'ç¬¬39å‘¨é”€é‡'
compare_sales_col = 'ç¬¬38å‘¨é”€é‡'

current_label = current_sales_col.replace('é”€é‡', '').strip()
compare_label = compare_sales_col.replace('é”€é‡', '').strip()

print(f"\nåˆ—åå¤„ç†:")
print(f"  å¯¹æ¯”å‘¨æœŸåˆ—: '{compare_sales_col}' â†’ å›¾ä¾‹: '{compare_label}'")
print(f"  å½“å‰å‘¨æœŸåˆ—: '{current_sales_col}' â†’ å›¾ä¾‹: '{current_label}'")

print(f"\nå›¾è¡¨æ ‡é¢˜: '{compare_label} vs {current_label}'")
print(f"\nâœ… å›¾ä¾‹æ¸…æ™°å±•ç¤ºä¸¤ä¸ªå‘¨æœŸçš„æ•°æ®å¯¹æ¯”")

# æ£€æŸ¥æ•°æ®æœ‰æ•ˆæ€§
top10_compare = test_data.nsmallest(10, 'å˜åŒ–å¹…åº¦%')
print(f"\nTOP10ä¸‹æ»‘å•†å“çš„é”€é‡æ•°æ®:")
print(top10_compare[['å•†å“åç§°', compare_sales_col, current_sales_col, 'å˜åŒ–å¹…åº¦%']])

# æµ‹è¯•3: åˆ†æ—¶æ®µä¸‹æ»‘åˆ†æçš„æŒ‡æ ‡å¤„ç†
print("\n\n" + "=" * 60)
print("æµ‹è¯•3: åˆ†æ—¶æ®µä¸‹æ»‘åˆ†ææŒ‡æ ‡ä¿®å¤")
print("=" * 60)

# æ¨¡æ‹Ÿæ—¶æ®µç»Ÿè®¡æ•°æ®
time_slot_stats = pd.DataFrame({
    'æ—¶æ®µ': ['æ¸…æ™¨(6-9ç‚¹)', 'ä¸Šåˆ(9-12ç‚¹)', 'æ­£åˆ(12-14ç‚¹)', 'ä¸‹åˆ(14-18ç‚¹)'],
    'ä¸‹æ»‘å•†å“æ•°': [5, 8, 12, 6],
    'é”€é‡æŸå¤±': [-50, -80, -120, -60],
    'æ”¶å…¥æŸå¤±': [-1500, -2400, -3600, -1800],
    'åˆ©æ¶¦æŸå¤±': [-450, -720, -1080, -540]
})

print("\nåŸå§‹æ—¶æ®µç»Ÿè®¡æ•°æ®:")
print(time_slot_stats)

print("\n\nå„æŒ‡æ ‡çš„æ˜¾ç¤ºå¤„ç†:")
for metric in ['ä¸‹æ»‘å•†å“æ•°', 'é”€é‡æŸå¤±', 'æ”¶å…¥æŸå¤±', 'åˆ©æ¶¦æŸå¤±']:
    display_values = time_slot_stats[metric].copy()
    if 'æŸå¤±' in metric:
        display_values = display_values.abs()
    
    print(f"\næŒ‡æ ‡: {metric}")
    print(f"  åŸå§‹å€¼: {time_slot_stats[metric].tolist()}")
    print(f"  æ˜¾ç¤ºå€¼: {display_values.tolist()}")
    
    # Yè½´æ ‡é¢˜
    y_title = metric
    if metric == 'é”€é‡æŸå¤±':
        y_title = 'é”€é‡æŸå¤±ï¼ˆå•ï¼‰'
    elif metric in ['æ”¶å…¥æŸå¤±', 'åˆ©æ¶¦æŸå¤±']:
        y_title = metric + 'ï¼ˆå…ƒï¼‰'
    
    print(f"  Yè½´æ ‡é¢˜: '{y_title}'")
    
    # æ€»è®¡
    total_value = time_slot_stats[metric].sum()
    if 'æŸå¤±' in metric:
        total_str = f"{abs(total_value):,.0f} {'å…ƒ' if 'æ”¶å…¥' in metric or 'åˆ©æ¶¦' in metric else 'å•'}"
    else:
        total_str = f"{total_value:,.0f} ä¸ª"
    
    print(f"  æ€»è®¡: {total_str}")
    print(f"  âœ… æ˜¾ç¤ºæ­£å¸¸ï¼ˆè´Ÿå€¼å·²è½¬ä¸ºç»å¯¹å€¼ï¼‰")

# æ€»ç»“
print("\n\n" + "=" * 60)
print("ä¿®å¤æ€»ç»“")
print("=" * 60)

print("""
âœ… é—®é¢˜1: å‘¨æœŸå¯¹æ¯”å›¾ä¸æ˜¾ç¤ºç¬¬39å‘¨æ•°æ®
   ä¿®å¤ï¼šä¼˜åŒ–å›¾ä¾‹æ ‡ç­¾æå–ï¼Œç¡®ä¿æ˜¾ç¤ºæ­£ç¡®çš„å‘¨æœŸåç§°
   æ•ˆæœï¼šå›¾ä¾‹æ¸…æ™°æ˜¾ç¤º"ç¬¬38å‘¨ vs ç¬¬39å‘¨"

âœ… é—®é¢˜2: "å˜åŒ–å¹…åº¦æœ€ä½çš„10ä¸ªå•†å“"æ ‡é¢˜è¯¯å¯¼
   ä¿®å¤ï¼šæ”¹ä¸º"ä¸‹æ»‘å¹…åº¦æœ€å¤§çš„10ä¸ªå•†å“"
   æ•ˆæœï¼šæ ‡é¢˜æ›´å‡†ç¡®ï¼Œä¸æ˜“è¯¯è§£

âœ… é—®é¢˜3: åˆ†æ—¶æ®µä¸‹æ»‘åˆ†æå…¶ä»–æŒ‡æ ‡ä¸æ˜¾ç¤º
   ä¿®å¤ï¼š
   - ç»Ÿä¸€å°†"æŸå¤±"ç±»æŒ‡æ ‡å–ç»å¯¹å€¼æ˜¾ç¤º
   - ç»Ÿä¸€ä½¿ç”¨çº¢è‰²ï¼ˆè´Ÿé¢æŒ‡æ ‡ï¼‰
   - æ·»åŠ æ­£ç¡®çš„Yè½´å•ä½ï¼ˆå•/å…ƒï¼‰
   - æ·»åŠ æ€»è®¡æç¤ºä¿¡æ¯
   æ•ˆæœï¼šæ‰€æœ‰4ä¸ªæŒ‡æ ‡éƒ½èƒ½æ­£å¸¸æ˜¾ç¤ºå’Œåˆ‡æ¢

ğŸ‰ æ‰€æœ‰ä¿®å¤éªŒè¯é€šè¿‡ï¼
""")

print("\n" + "=" * 60)
print("ä¸‹ä¸€æ­¥æµ‹è¯•")
print("=" * 60)
print("""
1. é‡æ–°å¯åŠ¨çœ‹æ¿:
   streamlit run æ™ºèƒ½é—¨åº—ç»è¥çœ‹æ¿_å¯è§†åŒ–.py

2. æµ‹è¯•ä¿®å¤æ•ˆæœ:
   - æ£€æŸ¥"å‘¨æœŸé”€é‡å¯¹æ¯”"å›¾ä¾‹æ˜¯å¦æ˜¾ç¤ºæ­£ç¡®
   - æ£€æŸ¥"ä¸‹æ»‘æœ€ä¸¥é‡TOP10"æ ‡é¢˜æ˜¯å¦æ›´æ–°
   - åˆ‡æ¢"åˆ†æ—¶æ®µä¸‹æ»‘åˆ†æ"çš„4ä¸ªæŒ‡æ ‡ï¼ŒæŸ¥çœ‹æ˜¯å¦éƒ½æ­£å¸¸æ˜¾ç¤º
""")
