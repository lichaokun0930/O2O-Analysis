# 销量下滑可视化看板 - 快速上手指南

## 🚀 立即开始

### 1. 启动看板

```powershell
# 方法1：使用启动脚本
.\启动智能看板.ps1

# 方法2：直接运行
streamlit run 智能门店经营看板_可视化.py
```

### 2. 访问地址

```
本地: http://localhost:8502
网络: http://你的IP:8502
```

---

## 📊 完整功能展示

### 步骤1：上传数据

1. 点击左侧边栏"📂 上传订单数据"
2. 选择Excel文件（订单数据）
3. 等待数据加载完成

### 步骤2：进入诊断模块

1. 在顶部导航选择"🔍 问题诊断"Tab
2. 进入"📉 销量下滑"子Tab

### 步骤3：配置诊断参数

**基础配置**（第一行）：
```
对比周期：按周对比 / 按日对比 / 按月对比
下滑阈值：-20%（可调整为-5%到-80%）
场景筛选：全部场景（或选择特定场景）
时段筛选：全部时段（或选择特定时段）
```

**周期选择**（第二行，可选）：
```
当前周期：第39周
对比周期：第38周
启用自定义：勾选后使用自定义周期
```

### 步骤4：开始诊断

点击 **"🔍 开始诊断"** 按钮

---

## 🎨 可视化看板导览

### 区域1：核心指标卡片（最顶部）

```
┌──────────────┬──────────────┬──────────────┬──────────────┐
│ 📉 下滑商品数 │ 📦 销量损失   │ 💸 收入损失   │ 💰 利润损失   │
│   15 个      │  -135 单     │  ¥-12,345   │  ¥-4,567    │
└──────────────┴──────────────┴──────────────┴──────────────┘
```

**一眼看懂**：
- 有多少商品下滑
- 总共损失多少销量
- 总共损失多少收入
- 总共损失多少利润

---

### 区域2：左侧图表（分析维度）

#### 图表1：⏰ 分时段下滑分析

**位置**：左上

**功能**：
- 查看各时段的下滑情况
- 可切换指标（商品数/销量/收入/利润）

**如何使用**：
```
1. 下拉选择器选择指标
2. 柱状图显示各时段数据
3. 找到最高的柱子 = 问题时段
```

**业务应用**：
- 发现"清晨时段下滑最严重"
- 制定"清晨促销活动"

---

#### 图表2：🎭 分场景下滑分布

**位置**：左中

**功能**：
- 各场景占比（环形饼图）
- 快速识别问题场景

**如何使用**：
```
1. 查看最大的扇形 = 占比最高的场景
2. 悬停查看具体数值
```

**业务应用**：
- "早餐场景占35%"
- "优先优化早餐商品"

---

#### 图表3：📦 品类下滑TOP5

**位置**：左下

**功能**：
- 收入损失最大的5个品类
- 横向柱状图

**如何使用**：
```
1. 查看最长的柱子 = 损失最大的品类
2. 悬停查看商品数和金额
```

**业务应用**：
- "熟食制品损失¥5,000"
- "重点优化熟食类商品"

---

### 区域3：右侧图表（排名与对比）

#### 图表4：🔻 下滑最严重TOP10

**位置**：右上

**功能**：
- 变化幅度最低的10个商品
- 颜色分级（深红=严重，浅红=警告）

**如何使用**：
```
1. 看最长的柱子 = 下滑最快的商品
2. 看颜色深浅 = 严重程度
3. 看文本标签 = 具体数值
```

**业务应用**：
- "活珠子下滑-75%（-9单）"
- "紧急制定挽回策略"

---

#### 图表5：💸 收入损失TOP10

**位置**：右中

**功能**：
- 收入损失最大的10个商品
- 瀑布图（累积效果）

**如何使用**：
```
1. 从左到右看瀑布下降
2. 最高的柱子 = 损失最大的商品
3. 整体高度 = 累积损失
```

**业务应用**：
- "活珠子损失¥135"
- "优先恢复高价值商品"

---

#### 图表6：📊 周期销量对比

**位置**：右下

**功能**：
- 当前期 vs 对比期销量对比
- 分组柱状图

**如何使用**：
```
1. 蓝色柱 = 对比期（第38周）
2. 红色柱 = 当前期（第39周）
3. 对比高度差 = 销量变化
```

**业务应用**：
- "活珠子从12单降到3单"
- "评估恢复可能性"

---

### 区域4：高级分析（Tab切换）

#### Tab 1：💰 利润影响分析

**功能**：四维散点图

**四个维度**：
```
X轴 = 销量变化
Y轴 = 利润损失
气泡大小 = 商品售价
气泡颜色 = 毛利率
```

**如何使用**：
```
1. 左下角 = 高损失区域
2. 大气泡 = 高价商品
3. 红色气泡 = 低毛利商品
4. 点击查看商品名称
```

**重点关注**：
- **左下角大红泡** = 最优先处理
  - 销量大跌 + 利润损失大 + 高价格 + 低毛利

**业务应用**：
- "活珠子：-9单，-¥47利润，¥15售价，35%毛利"
- "制定综合优化方案"

---

#### Tab 2：🌳 分类树状图

**功能**：三级分类层级可视化

**层级**：
```
一级分类（大矩形）
  └─ 三级分类（中矩形）
      └─ 商品（小矩形）
```

**如何使用**：
```
1. 矩形面积 = 收入损失大小
2. 矩形颜色 = 下滑严重程度（越红越严重）
3. 点击层级可钻取
```

**业务应用**：
- "熟食制品下深红色大块"
- "其中卤制品占比最大"
- "重点优化卤制品"

---

#### Tab 3：🔥 时段×场景热力图

**功能**：交叉分析问题点

**矩阵**：
```
行 = 场景（早餐、午餐...）
列 = 时段（清晨、上午...）
颜色 = 下滑商品数
```

**如何使用**：
```
1. 找深红色格子 = 问题严重区域
2. 单元格数字 = 下滑商品数
3. 横向/纵向看模式
```

**示例发现**：
```
清晨×早餐 = 🔴15 → 清晨早餐下滑严重
正午×午餐 = 🔴20 → 午餐高峰竞争力不足
傍晚×晚餐 = 🔴18 → 晚餐时段被抢走市场
```

**业务应用**：
- "针对清晨早餐推出促销套餐"
- "优化正午午餐SKU"
- "加强傍晚晚餐竞争力"

---

## 🎯 典型使用场景

### 场景1：快速巡检（30秒）

**目标**：快速了解整体情况

**步骤**：
```
1. 看核心指标卡片
   → 15个商品下滑，损失¥12,345

2. 看时段分析
   → 清晨时段最严重

3. 看TOP10排名
   → 活珠子、豆浆、油条是重点
```

**结论**：
- 主要问题：清晨时段
- 重点商品：活珠子、豆浆、油条

---

### 场景2：深度分析（5分钟）

**目标**：全面分析下滑原因

**步骤**：
```
1. 核心指标 → 了解整体影响

2. 时段分析 → 清晨、上午下滑严重

3. 场景分析 → 早餐场景占35%

4. 品类分析 → 熟食制品损失最大

5. TOP10排名 → 活珠子-75%最严重

6. 四维散点图 → 活珠子在左下角（高损失）

7. 热力图 → 清晨×早餐是红色重灾区
```

**结论**：
- **问题定位**：清晨早餐场景的熟食类商品
- **核心商品**：活珠子（-75%，-¥135）
- **优先级**：清晨>上午，早餐>午餐，熟食>其他

---

### 场景3：专项优化（精准诊断）

**目标**：针对特定维度深挖

**示例A：优化清晨时段**
```
1. 时段筛选：选择"清晨(6-9点)"
2. 点击"开始诊断"
3. 只看清晨时段的下滑商品
4. 制定清晨专项促销
```

**示例B：优化早餐场景**
```
1. 场景筛选：选择"早餐"
2. 点击"开始诊断"
3. 只看早餐场景的下滑商品
4. 优化早餐商品组合
```

**示例C：清晨早餐交叉优化**
```
1. 时段筛选：清晨
2. 场景筛选：早餐
3. 点击"开始诊断"
4. 精准定位"清晨早餐"的问题商品
5. 制定"清晨早餐套餐促销"
```

---

## 💡 图表阅读技巧

### 柱状图

**看什么**：
- ✅ 柱子高度 → 数值大小
- ✅ 柱子颜色 → 问题严重程度
- ✅ 柱子对比 → 不同维度差异

**怎么看**：
```
最高的柱子 = 问题最严重
红色柱子 = 需要关注
对比柱子 = 评估变化
```

---

### 饼图

**看什么**：
- ✅ 扇形面积 → 占比大小
- ✅ 扇形颜色 → 分类区分
- ✅ 标签数字 → 具体百分比

**怎么看**：
```
最大的扇形 = 占比最高的场景
多个小扇形 = 分散的问题
```

---

### 散点图

**看什么**：
- ✅ 点的位置 → X/Y轴关系
- ✅ 点的大小 → 第三维度
- ✅ 点的颜色 → 第四维度
- ✅ 点的聚类 → 问题模式

**怎么看**：
```
左下角 = 销量大跌 + 利润损失大 = 高损失区
大气泡 = 高价商品 = 优先关注
红气泡 = 低毛利 = 需要优化定价
```

---

### 热力图

**看什么**：
- ✅ 颜色深浅 → 严重程度
- ✅ 横向模式 → 时段规律
- ✅ 纵向模式 → 场景规律
- ✅ 深色格子 → 问题点

**怎么看**：
```
深红色 = 问题严重
一整行红 = 该场景全时段都有问题
一整列红 = 该时段各场景都有问题
```

---

## ⚡ 性能优化建议

### 数据量较大时

**问题**：
- 时段/场景分析需要多次诊断
- 热力图计算慢（时段×场景=40次）

**优化方法**：

1. **提高下滑阈值**
   ```
   阈值从-20%改为-30%
   → 减少下滑商品数量
   → 加快计算速度
   ```

2. **使用筛选器**
   ```
   不选择"全部时段/全部场景"
   → 跳过相关图表
   → 减少计算量
   ```

3. **分段分析**
   ```
   先看整体 → 再看细节
   第1次：全部时段/场景 → 找问题维度
   第2次：只看问题时段 → 深度分析
   ```

---

## 📥 数据导出

### 导出表格数据

点击 **"⬇️ 导出CSV（纯数值）"** 按钮

**特点**：
- 移除所有格式符号（¥、%、逗号）
- 可直接在Excel中计算
- UTF-8 with BOM编码（中文兼容）

### 导出图表

**方法**：
1. 悬停在图表右上角
2. 点击"📷"图标
3. 保存为PNG图片

---

## 🔧 常见问题解决

### Q1: 某些图表不显示？

**检查清单**：
- [ ] 时段分析：数据中有"时段"字段吗？
- [ ] 时段分析：时段筛选器选择了"全部时段"吗？
- [ ] 场景分析：数据中有"场景"字段吗？
- [ ] 场景分析：场景筛选器选择了"全部场景"吗？

**解决方法**：
```
如果缺少时段字段：
→ 系统会自动从"下单时间"生成

如果缺少场景字段：
→ 在Excel中手动添加"场景"列
```

---

### Q2: 热力图计算很慢？

**原因**：
- 需要计算所有"时段×场景"组合
- 8个时段 × 5个场景 = 40次诊断

**解决方法**：
```
方法1：使用筛选器缩小范围
  时段筛选：只选3-4个重点时段
  场景筛选：只选2-3个重点场景

方法2：提高下滑阈值
  从-20%改为-30%或-40%
  减少每次诊断的商品数

方法3：耐心等待
  计算时会显示进度条
  一般30秒内完成
```

---

### Q3: 图表数据与表格不一致？

**原因**：
- 图表是用原始数据重新统计的
- 表格是当前筛选条件的结果

**检查方法**：
```
1. 确认筛选条件一致
2. 查看周期选择是否相同
3. 检查阈值设置
```

---

### Q4: 如何切换分析周期？

**方法**：
```
1. 勾选"启用自定义"复选框
2. 选择"当前周期"（如第39周）
3. 选择"对比周期"（如第38周）
4. 点击"开始诊断"
```

**提示**：
- 不勾选时使用默认周期（最新周 vs 上一周）
- 勾选后可自由选择任意两个周期对比

---

## 🎓 进阶技巧

### 技巧1：多维度交叉分析

**场景**：想知道"清晨早餐的熟食类商品"下滑情况

**步骤**：
```
1. 时段筛选：清晨
2. 场景筛选：早餐
3. 开始诊断 → 得到清晨早餐的下滑商品
4. 查看详细表格 → 筛选"一级分类名=熟食制品"
5. 得到精准结果
```

---

### 技巧2：对比不同时段

**场景**：想对比清晨和上午哪个更严重

**步骤**：
```
1. 第1次诊断：
   时段筛选：清晨
   记录结果：15个商品，损失¥5,000

2. 第2次诊断：
   时段筛选：上午
   记录结果：12个商品，损失¥4,200

3. 结论：清晨更严重
```

**更简单的方法**：
```
使用时段分析图（左上）
→ 一张图对比所有时段
```

---

### 技巧3：趋势追踪

**场景**：想知道问题是否在恶化

**步骤**：
```
1. 第1次：对比第38周 vs 第37周
   记录：15个商品下滑

2. 第2次：对比第39周 vs 第38周
   记录：18个商品下滑

3. 第3次：对比第40周 vs 第39周
   记录：20个商品下滑

4. 结论：问题在恶化，需紧急处理
```

---

## 📞 获取帮助

### 查看文档

- **功能说明**：`销量下滑可视化功能说明.md`
- **设计方案**：`销量下滑诊断可视化设计方案.md`
- **本指南**：`销量下滑可视化使用指南.md`

### 常见错误

| 错误信息 | 原因 | 解决方法 |
|---------|------|---------|
| "数据时间范围不足" | 数据少于2个周期 | 增加数据时间跨度 |
| "无法获取周期列表" | 数据缺少日期字段 | 检查"日期"列是否存在 |
| "诊断失败" | 数据格式错误 | 检查必需列是否完整 |

---

## ✅ 检查清单

### 使用前检查

- [ ] Streamlit已启动
- [ ] 数据已上传
- [ ] 数据包含必需字段（订单ID、商品名称、日期等）
- [ ] 时段字段已自动生成（或手动添加）

### 诊断时检查

- [ ] 对比周期选择正确
- [ ] 下滑阈值设置合理
- [ ] 筛选条件符合分析需求

### 结果验证

- [ ] 核心指标卡片显示正常
- [ ] 图表数据合理（无异常值）
- [ ] 表格数据与图表一致
- [ ] 导出功能正常

---

## 🎉 开始使用

现在您已经掌握了所有功能！

**建议流程**：
```
1. 快速巡检（30秒）
   → 核心指标 + TOP10

2. 深度分析（5分钟）
   → 所有图表巡览

3. 专项优化（10分钟）
   → 针对性筛选诊断

4. 导出报告
   → CSV + 图表截图
```

祝您使用愉快！📊✨
