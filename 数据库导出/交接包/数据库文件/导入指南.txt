
================================================================================
PostgreSQL æ•°æ®åº“å¯¼å…¥æŒ‡å—
================================================================================

ä¸€ã€ç¯å¢ƒå‡†å¤‡
------------
1. å®‰è£… PostgreSQL æ•°æ®åº“ï¼ˆç‰ˆæœ¬ 12 æˆ–æ›´é«˜ï¼‰
   - Windows: https://www.postgresql.org/download/windows/
   - Linux: apt-get install postgresql æˆ– yum install postgresql
   - macOS: brew install postgresql

2. ç¡®ä¿ PostgreSQL æœåŠ¡æ­£åœ¨è¿è¡Œ
   - Windows: æ‰“å¼€"æœåŠ¡"ï¼Œæ‰¾åˆ° PostgreSQL æœåŠ¡
   - Linux: sudo systemctl status postgresql
   - macOS: brew services start postgresql


äºŒã€åˆ›å»ºæ•°æ®åº“
--------------
ä½¿ç”¨ psql å‘½ä»¤è¡Œå·¥å…·æˆ– pgAdmin å›¾å½¢ç•Œé¢åˆ›å»ºæ•°æ®åº“ï¼š

æ–¹æ³•1ï¼šä½¿ç”¨ psql å‘½ä»¤è¡Œ
------------------------
psql -U postgres
CREATE DATABASE o2o_dashboard;
\q

æ–¹æ³•2ï¼šä½¿ç”¨ SQL è¯­å¥
-------------------
CREATE DATABASE o2o_dashboard
    WITH 
    OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'zh_CN.UTF-8'
    LC_CTYPE = 'zh_CN.UTF-8'
    TABLESPACE = pg_default
    CONNECTION LIMIT = -1;


ä¸‰ã€å¯¼å…¥æ•°æ®
------------

ğŸ“¦ æ–¹æ³•1ï¼šå¯¼å…¥å®Œæ•´å¤‡ä»½ï¼ˆæ¨èï¼‰
-------------------------------
psql -U postgres -d o2o_dashboard -f o2o_dashboard_full_YYYYMMDD_HHMMSS.sql

è¿™ä¸ªå‘½ä»¤ä¼šï¼š
âœ… åˆ›å»ºæ‰€æœ‰è¡¨ç»“æ„
âœ… å¯¼å…¥æ‰€æœ‰æ•°æ®
âœ… åˆ›å»ºç´¢å¼•


ğŸ“‹ æ–¹æ³•2ï¼šå…ˆå¯¼å…¥ç»“æ„ï¼Œå†å¯¼å…¥æ•°æ®
--------------------------------
# æ­¥éª¤1ï¼šå¯¼å…¥è¡¨ç»“æ„
psql -U postgres -d o2o_dashboard -f o2o_dashboard_schema_YYYYMMDD_HHMMSS.sql

# æ­¥éª¤2ï¼šå¯¼å…¥æ•°æ®
psql -U postgres -d o2o_dashboard -f o2o_dashboard_data_YYYYMMDD_HHMMSS.sql


å››ã€éªŒè¯å¯¼å…¥
------------
å¯¼å…¥å®Œæˆåï¼ŒéªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®ï¼š

psql -U postgres -d o2o_dashboard

-- æŸ¥çœ‹æ‰€æœ‰è¡¨
\dt

-- æŸ¥çœ‹ orders è¡¨ç»“æ„
\d orders

-- æŸ¥çœ‹ orders è¡¨æ•°æ®é‡
SELECT COUNT(*) FROM orders;

-- æŸ¥çœ‹ products è¡¨æ•°æ®é‡
SELECT COUNT(*) FROM products;

-- æŸ¥çœ‹é—¨åº—åˆ—è¡¨
SELECT DISTINCT store_name FROM orders;

-- é€€å‡º
\q


äº”ã€é…ç½®åº”ç”¨è¿æ¥
----------------
ä¿®æ”¹åº”ç”¨çš„ .env æ–‡ä»¶æˆ– database/config.py æ–‡ä»¶ï¼š

DB_HOST=localhost
DB_PORT=5432
DB_NAME=o2o_dashboard
DB_USER=postgres
DB_PASSWORD=ä½ çš„å¯†ç 


å…­ã€å¸¸è§é—®é¢˜
------------

é—®é¢˜1ï¼šå¯¼å…¥æ—¶å‡ºç°ç¼–ç é”™è¯¯
è§£å†³ï¼šç¡®ä¿æ•°æ®åº“åˆ›å»ºæ—¶ä½¿ç”¨ UTF8 ç¼–ç 
      CREATE DATABASE o2o_dashboard ENCODING 'UTF8';

é—®é¢˜2ï¼šå¯¼å…¥æ—¶å‡ºç°æƒé™é”™è¯¯
è§£å†³ï¼šä½¿ç”¨è¶…çº§ç”¨æˆ·å¯¼å…¥ï¼Œæˆ–æˆäºˆç›¸åº”æƒé™
      GRANT ALL PRIVILEGES ON DATABASE o2o_dashboard TO your_user;

é—®é¢˜3ï¼šå¯¼å…¥æ—¶é—´è¿‡é•¿
è§£å†³ï¼šå…ˆå¯¼å…¥ç»“æ„ï¼Œåˆ›å»ºç´¢å¼•å‰å¯¼å…¥æ•°æ®ï¼Œæœ€ååˆ›å»ºç´¢å¼•

é—®é¢˜4ï¼šè¡¨å·²å­˜åœ¨é”™è¯¯
è§£å†³ï¼šåˆ é™¤ç°æœ‰æ•°æ®åº“é‡æ–°åˆ›å»º
      DROP DATABASE IF EXISTS o2o_dashboard;
      CREATE DATABASE o2o_dashboard;


ä¸ƒã€æ•°æ®åº“é…ç½®å»ºè®®
------------------

1. æ€§èƒ½ä¼˜åŒ–ï¼ˆä¿®æ”¹ postgresql.confï¼‰ï¼š
   shared_buffers = 256MB
   effective_cache_size = 1GB
   work_mem = 16MB
   maintenance_work_mem = 128MB

2. è¿æ¥æ•°é…ç½®ï¼š
   max_connections = 100

3. æ—¥å¿—é…ç½®ï¼š
   logging_collector = on
   log_directory = 'pg_log'
   log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'


å…«ã€å¤‡ä»½å»ºè®®
------------

1. å®šæœŸå¤‡ä»½ï¼ˆæ¯å¤©ï¼‰ï¼š
   pg_dump -h localhost -U postgres -d o2o_dashboard -F c -f backup_$(date +%Y%m%d).dump

2. è‡ªåŠ¨å¤‡ä»½è„šæœ¬ï¼ˆLinux/macOSï¼‰ï¼š
   #!/bin/bash
   BACKUP_DIR="/path/to/backup"
   DATE=$(date +%Y%m%d_%H%M%S)
   pg_dump -h localhost -U postgres -d o2o_dashboard -F c -f ${BACKUP_DIR}/backup_${DATE}.dump
   
   # ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
   find ${BACKUP_DIR} -name "backup_*.dump" -mtime +7 -delete

3. Windows è®¡åˆ’ä»»åŠ¡ï¼š
   åˆ›å»º .bat æ–‡ä»¶ï¼Œä½¿ç”¨ Windows ä»»åŠ¡è®¡åˆ’ç¨‹åºå®šæ—¶æ‰§è¡Œ

