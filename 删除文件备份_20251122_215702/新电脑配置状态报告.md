# ✅ 新电脑环境配置状态报告

**生成时间**: 2025-11-22  
**电脑类型**: 新电脑(GitHub克隆)

---

## 📊 当前配置状态

### ✅ 已完成项

| 项目 | 状态 | 备注 |
|------|------|------|
| Python 3.11.9 | ✅ 已安装 | 系统Python |
| Git | ✅ 已安装 | 版本 2.52.0 |
| Python虚拟环境(.venv) | ✅ 已创建 | 路径: `.venv/` |
| .env配置文件 | ✅ 已创建 | **需要修改数据库密码** |
| 核心Python依赖 | ✅ 已安装 | dash, pandas, plotly, sqlalchemy, redis等 |
| 机器学习库 | ✅ 已安装 | scikit-learn, scipy, statsmodels |
| 可视化库 | ✅ 已安装 | matplotlib, seaborn |
| 后端框架 | ✅ 已安装 | fastapi, uvicorn, alembic |

### ❌ 待完成项

| 项目 | 状态 | 操作指南 |
|------|------|----------|
| PostgreSQL数据库 | ❌ 未安装 | 见下方"第一步" |
| Redis缓存 | ❌ 未安装 | 见下方"第二步" |
| 数据库初始化 | ⏸️ 等待数据库安装 | 见下方"第三步" |
| AI API密钥 | ⏸️ 可选配置 | 见下方"第四步(可选)" |

---

## 🚀 接下来的操作步骤

### 第一步: 安装PostgreSQL数据库 (10分钟)

#### 1.1 下载PostgreSQL

访问官网下载: https://www.postgresql.org/download/windows/

推荐版本: **PostgreSQL 15.6** 或 **PostgreSQL 16.x**

#### 1.2 安装配置

运行安装程序,配置参数:
```
安装路径: C:\Program Files\PostgreSQL\15 (默认)
端口: 5432 (默认)
超级用户: postgres
密码: [设置一个强密码,比如: Postgres@2025]  ⚠️ 务必记住!
语言: Chinese, China
组件: 全部勾选
```

#### 1.3 验证安装

打开PowerShell:
```powershell
# 检查服务
Get-Service -Name "postgresql*"

# 测试连接(输入密码后应能进入psql)
psql -U postgres
# 成功后输入 \q 退出
```

#### 1.4 创建数据库

```powershell
# 创建项目数据库
psql -U postgres -c "CREATE DATABASE o2o_dashboard;"
```

---

### 第二步: 安装Redis缓存 (5分钟)

#### 方式1: 自动安装(推荐)

```powershell
# 运行自动安装脚本
.\启动Redis.ps1
```

脚本会自动检测并安装 **Memurai** (Windows版Redis)

#### 方式2: 手动安装

1. 访问: https://www.memurai.com/get-memurai
2. 下载: Memurai Developer Edition (免费)
3. 运行安装程序(默认配置即可)
4. 启动服务:
   ```powershell
   Start-Service Memurai
   ```

#### 验证安装

```powershell
# 检查服务状态
Get-Service Memurai

# 测试连接
python 测试Redis连接.py
# 应显示: ✅ Redis连接成功!
```

---

### 第三步: 配置.env文件和初始化数据库

#### 3.1 修改.env文件

```powershell
# 用记事本打开
notepad .env
```

**修改数据库密码**:
```env
# 将 YOUR_PASSWORD_HERE 改为您在第一步设置的PostgreSQL密码
DATABASE_URL=postgresql://postgres:Postgres@2025@localhost:5432/o2o_dashboard

# Redis配置通常不需要修改
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
```

保存并关闭文件

#### 3.2 初始化数据库表结构

```powershell
# 激活虚拟环境(如果还没激活)
.\.venv\Scripts\Activate.ps1

# 运行数据库迁移
python database\migrate.py
```

**预期输出**:
```
✅ 数据库连接成功
✅ 创建表: orders
✅ 创建表: products
✅ 创建表: scene_tags
✅ 创建表: analysis_cache
✅ 数据库初始化完成!
```

#### 3.3 验证环境

运行综合检查:
```powershell
python -c "
import psycopg2, redis
conn = psycopg2.connect('postgresql://postgres:Postgres@2025@localhost:5432/o2o_dashboard')
conn.close()
r = redis.Redis()
r.ping()
print('🎉 所有环境检查通过!')
"
```

---

### 第四步: 启动看板 (2分钟)

#### 4.1 确保服务运行

```powershell
# 确保PostgreSQL运行中
Get-Service -Name "postgresql*" | Start-Service

# 确保Redis运行中
Start-Service Memurai
```

#### 4.2 启动看板

```powershell
# 方式1: 使用启动脚本(推荐)
.\启动看板.ps1

# 方式2: 直接运行
python 智能门店看板_Dash版.py
```

#### 4.3 访问看板

浏览器打开: **http://localhost:8050**

首次访问会看到数据上传界面,上传Excel订单文件即可开始使用!

---

## 🎯 可选配置

### 配置AI功能 (可选)

#### 获取API密钥

1. **智谱GLM-4**: 访问 https://open.bigmodel.cn/ 注册获取
2. **Google Gemini**: 访问 https://ai.google.dev/ 获取

#### 配置到.env

```powershell
notepad .env
```

添加API密钥:
```env
# AI接口配置
ZHIPU_API_KEY=your_glm_api_key_here
GEMINI_API_KEY=your_gemini_api_key_here
```

重启看板生效。

---

## 📚 常用命令速查

### 每次开发前执行

```powershell
# 1. 进入项目目录
cd "d:\Python\订单数据看板\O2O-Analysis"

# 2. 激活虚拟环境
.\.venv\Scripts\Activate.ps1

# 3. 确保服务运行
Get-Service postgresql* | Start-Service
Start-Service Memurai

# 4. 启动看板
.\启动看板.ps1
```

### 停止服务

```powershell
# 停止看板
.\停止看板.bat

# 或手动停止Python进程
Get-Process python | Stop-Process
```

### 查看服务状态

```powershell
# PostgreSQL状态
Get-Service postgresql*

# Redis状态
Get-Service Memurai

# 看板进程
Get-Process python | Where-Object {$_.MainWindowTitle -match "看板"}
```

### 数据库操作

```powershell
# 连接数据库
psql -U postgres -d o2o_dashboard

# 查看表结构
python 查看数据库状态.py

# 备份数据库
.\一键导出数据库.bat

# 导入数据
python 智能导入门店数据.py
```

---

## 🔧 故障排查

### Q1: PostgreSQL连接失败

**错误**: `FATAL: password authentication failed`

**解决方案**:
1. 确认密码是否正确
2. 检查.env文件中的DATABASE_URL是否正确
3. 尝试重置密码:
   ```powershell
   # 修改 pg_hba.conf
   notepad "C:\Program Files\PostgreSQL\15\data\pg_hba.conf"
   # 将 md5 改为 trust
   # 重启服务
   Restart-Service postgresql*
   ```

### Q2: Redis连接失败

**错误**: `ConnectionRefusedError`

**解决方案**:
```powershell
# 检查服务
Get-Service Memurai

# 启动服务
Start-Service Memurai

# 如果服务不存在,重新运行
.\启动Redis.ps1
```

### Q3: 端口被占用

**错误**: `OSError: [Errno 10048]`

**解决方案**:
```powershell
# 查找占用8050端口的进程
Get-NetTCPConnection -LocalPort 8050 | Select-Object OwningProcess

# 停止进程
taskkill /PID <进程ID> /F
```

### Q4: 虚拟环境激活失败

**错误**: `无法加载文件 *.ps1`

**解决方案**:
```powershell
# 允许脚本执行
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser

# 重新激活
.\.venv\Scripts\Activate.ps1
```

---

## 📖 参考文档

| 文档 | 用途 |
|------|------|
| `新电脑完整配置指南.md` | 详细的分步配置教程 |
| `快速开始指南.md` | 快速上手使用 |
| `【权威】业务逻辑与数据字典完整手册.md` | 业务逻辑参考 |
| `PostgreSQL环境配置完整指南.md` | 数据库详细配置 |
| `Redis安装配置指南.md` | Redis详细配置 |
| `.github\copilot-instructions.md` | AI开发指南 |
| `GLM-4.6接入指南.md` | AI接口配置 |
| `局域网多人访问指南.md` | 多人访问配置 |

---

## ✅ 配置完成检查清单

完成后请确认:

- [ ] PostgreSQL数据库已安装并运行
- [ ] Redis/Memurai缓存已安装并运行
- [ ] .env文件已修改(数据库密码正确)
- [ ] 数据库o2o_dashboard已创建
- [ ] 数据库表结构已初始化
- [ ] 环境验证脚本通过
- [ ] 看板能成功启动
- [ ] 浏览器能访问 http://localhost:8050
- [ ] 能成功上传Excel文件

---

## 🎉 完成后的下一步

1. **导入历史数据**: 准备Excel订单文件,通过看板界面上传
2. **熟悉功能**: 浏览6个Tab页,了解各项分析功能
3. **配置AI**: 如需AI智能建议功能,配置API密钥
4. **多人访问**: 如需局域网访问,参考`局域网多人访问指南.md`
5. **定期备份**: 使用`一键导出数据库.bat`定期备份数据

---

**环境配置完成! 祝使用愉快! 🎊**
