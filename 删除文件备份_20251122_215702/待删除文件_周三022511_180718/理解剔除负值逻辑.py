#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
解释:为什么剔除负值反而增加利润?
"""

import pandas as pd

print("="*80)
print("理解剔除负值的逻辑")
print("="*80)

# 简单例子
print("\n📝 简单例子:")
print("假设有3个数: +100, +50, -30")
print("\n情况1: 不剔除负值")
print("  计算: 100 + 50 + (-30) = 120")
print("\n情况2: 剔除负值")
print("  计算: 100 + 50 = 150")
print("\n结论: 剔除负值后,总和从120变成150,增加了30!")

print("\n" + "="*80)
print("真实数据验证:")
print("="*80)

df = pd.read_excel('实际数据/枫瑞.xlsx')
df_mt = df[df['渠道'] == '美团共橙'].copy()

# 情况1: 不剔除耗材
print("\n【情况1: 不剔除耗材】")
print(f"总行数: {len(df_mt)}")
print(f"利润额总和: {df_mt['利润额'].sum():.2f}")

# 分开看
正常商品 = df_mt[df_mt['一级分类名'] != '耗材']['利润额'].sum()
耗材商品 = df_mt[df_mt['一级分类名'] == '耗材']['利润额'].sum()

print(f"\n详细计算:")
print(f"  正常商品利润: {正常商品:.2f}")
print(f"  耗材利润(负值): {耗材商品:.2f}")
print(f"  总利润 = {正常商品:.2f} + ({耗材商品:.2f}) = {正常商品 + 耗材商品:.2f}")

# 情况2: 剔除耗材
print("\n【情况2: 剔除耗材】")
df_no_hc = df_mt[df_mt['一级分类名'] != '耗材']
print(f"总行数: {len(df_no_hc)}")
print(f"利润额总和: {df_no_hc['利润额'].sum():.2f}")

print("\n" + "="*80)
print("关键理解:")
print("="*80)
print("❌ 错误理解: '剔除负值 = 减去负值'")
print("   剔除负值 ≠ 减去负值")
print("\n✅ 正确理解:")
print("   • 不剔除耗材: 100 + 50 + (-30) = 120")
print("   • 剔除耗材:   100 + 50        = 150")
print("\n剔除负值 = 直接删除这个数,不参与计算")
print("减去负值 = 100 + 50 - (-30) = 100 + 50 + 30 = 180")

print("\n" + "="*80)
print("所以:")
print("="*80)
print(f"不剔除耗材(负值参与求和): {正常商品 + 耗材商品:.2f}元")
print(f"剔除耗材(负值不参与计算): {正常商品:.2f}元")
print(f"差异: {正常商品 - (正常商品 + 耗材商品):.2f}元 = 耗材负值被去掉了")
print("\n剔除负值后,利润反而增加,因为负值不再拉低总和!")
