# 手动性能测试指南

## 目的

真实测量从启动看板到"今日必做"Tab完全加载的时间。

## 测试步骤

### 准备工作

1. **关闭所有正在运行的看板实例**
2. **清空Redis缓存**（可选，用于测试冷启动）
   ```bash
   redis-cli FLUSHALL
   ```

### 测试1: 冷启动（无缓存）

#### 步骤1: 启动看板并记录时间

```powershell
# 记录启动时间
$startTime = Get-Date
Write-Host "启动时间: $($startTime.ToString('HH:mm:ss.fff'))"

# 启动看板
python -u 智能门店看板_Dash版.py
```

#### 步骤2: 等待服务器就绪

看到这个提示说明服务器已启动：
```
    ╔══════════════════════════════════════════════════════════════╗
    ║                 🏪 门店诊断看板(订单数据)                     ║
    ║  📍 本机访问: http://localhost:8051                          ║
    ╚══════════════════════════════════════════════════════════════╝
```

**记录服务器就绪时间**

#### 步骤3: 打开浏览器

1. 打开浏览器
2. 访问: http://localhost:8051
3. **记录页面打开时间**

#### 步骤4: 点击"今日必做"Tab

1. 点击"今日必做"Tab
2. **记录点击时间**
3. 观察页面加载过程：
   - 是否显示骨架屏？
   - 骨架屏显示多久？
   - 数据何时完全加载？
4. **记录数据完全加载时间**

#### 步骤5: 记录结果

```
启动时间: __:__:__
服务器就绪: __:__:__ (耗时: __ 秒)
页面打开: __:__:__ (耗时: __ 秒)
点击Tab: __:__:__
数据加载完成: __:__:__ (耗时: __ 秒)

总耗时（启动到数据加载）: __ 秒
用户等待时间（点击到加载）: __ 秒
```

### 测试2: 热启动（有缓存）

#### 前提条件

- 看板已启动并运行至少5分钟
- 后台任务已完成至少一次缓存更新

#### 步骤1: 刷新页面

1. 在浏览器中按 F5 刷新
2. **记录刷新时间**

#### 步骤2: 点击"今日必做"Tab

1. 点击"今日必做"Tab
2. **记录点击时间**
3. 观察加载速度
4. **记录数据完全加载时间**

#### 步骤3: 记录结果

```
刷新时间: __:__:__
点击Tab: __:__:__
数据加载完成: __:__:__ (耗时: __ 秒)

用户等待时间: __ 秒
```

### 测试3: 多次访问（验证缓存稳定性）

重复测试2的步骤3次，记录每次的加载时间：

```
第1次: __ 秒
第2次: __ 秒
第3次: __ 秒

平均: __ 秒
```

## 观察要点

### 1. 骨架屏

- [ ] 点击Tab后是否立即显示骨架屏？
- [ ] 骨架屏显示时间: __ 秒
- [ ] 骨架屏是否平滑过渡到真实数据？

### 2. 后台任务

在启动日志中查找：

```
[后台任务] 🚀 启动后台任务调度器...
[后台任务] ✅ 已添加任务: 更新诊断数据缓存 (每5分钟)
[后台任务] ✅ 调度器已启动
[后台任务] 🔥 立即执行一次预热缓存...
```

- [ ] 是否看到后台任务启动日志？
- [ ] 是否看到缓存预热日志？

### 3. Redis缓存

在另一个终端检查：

```bash
# 检查Redis是否运行
redis-cli ping

# 检查缓存键
redis-cli keys diagnosis:*

# 查看缓存内容
redis-cli get diagnosis:latest
```

- [ ] Redis是否运行？
- [ ] 是否有缓存键？
- [ ] 缓存是否有数据？

### 4. 浏览器开发者工具

按 F12 打开开发者工具，切换到 Network 标签：

1. 点击"今日必做"Tab
2. 观察网络请求：
   - 有多少个请求？
   - 哪个请求最慢？
   - 总传输大小？
3. 切换到 Console 标签：
   - 是否有错误？
   - 是否有警告？

## 性能基准

### 预期性能（V8.2优化后）

| 场景 | 预期时间 | 说明 |
|------|----------|------|
| 服务器启动 | 10-20秒 | 数据加载+模块初始化 |
| 首次访问Tab（冷启动） | 1-2秒 | 后台任务已预热缓存 |
| 后续访问Tab（热启动） | <1秒 | 从Redis读取缓存 |
| 骨架屏显示 | <0.5秒 | 立即显示 |

### 对比基准（V7.6优化前）

| 场景 | 时间 |
|------|------|
| 首次访问Tab | 70秒 |
| 后续访问Tab | 70秒 |
| 骨架屏 | 无 |

## 问题排查

### 如果加载时间>10秒

1. **检查后台任务是否运行**
   ```bash
   # 在启动日志中查找
   grep "后台任务" 启动日志.txt
   ```

2. **检查Redis缓存**
   ```bash
   redis-cli keys diagnosis:*
   ```

3. **检查是否有错误**
   - 查看浏览器Console
   - 查看服务器日志

### 如果骨架屏不显示

1. **检查CSS是否注入**
   - 在浏览器中按 F12
   - 切换到 Elements 标签
   - 搜索 `skeleton-loading`

2. **检查回调函数**
   - 查看服务器日志
   - 是否有回调错误？

### 如果缓存不生效

1. **检查Redis连接**
   ```bash
   redis-cli ping
   ```

2. **检查后台任务日志**
   ```
   [后台任务] ✅ 诊断数据已更新并缓存
   ```

3. **手动触发缓存更新**
   ```python
   python -u 测试V8.1后台任务.py
   ```

## 测试报告模板

```
================================================================================
V8.2 性能测试报告
================================================================================

测试时间: 2025-12-11 __:__:__
测试人员: ________
数据量: ______ 行

--------------------------------------------------------------------------------
测试1: 冷启动（无缓存）
--------------------------------------------------------------------------------
启动时间: __:__:__
服务器就绪: __:__:__ (耗时: __ 秒)
页面打开: __:__:__ (耗时: __ 秒)
点击Tab: __:__:__
骨架屏显示: __:__:__ (耗时: __ 秒)
数据加载完成: __:__:__ (耗时: __ 秒)

总耗时: __ 秒
用户等待时间: __ 秒

--------------------------------------------------------------------------------
测试2: 热启动（有缓存）
--------------------------------------------------------------------------------
第1次: __ 秒
第2次: __ 秒
第3次: __ 秒
平均: __ 秒

--------------------------------------------------------------------------------
观察结果
--------------------------------------------------------------------------------
[ ] 后台任务已启动
[ ] Redis缓存已生效
[ ] 骨架屏正常显示
[ ] 数据加载正常
[ ] 无错误或警告

--------------------------------------------------------------------------------
性能评估
--------------------------------------------------------------------------------
[ ] 优秀（<2秒）
[ ] 良好（2-5秒）
[ ] 一般（5-10秒）
[ ] 较差（>10秒）

--------------------------------------------------------------------------------
问题和建议
--------------------------------------------------------------------------------
1. 
2. 
3. 

================================================================================
```

## 总结

这个手动测试虽然不如自动化测试方便，但能提供最真实的用户体验数据。

**关键指标**:
1. **用户等待时间**（点击Tab到数据加载）- 最重要
2. **骨架屏响应时间** - 影响用户感知
3. **缓存命中率** - 影响后续访问速度

**请按照这个指南进行测试，并记录详细的时间数据。**
